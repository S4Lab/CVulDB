groonga__groonga
commit fb43e40e78ed3b6fb734cab13833c5ab030f850a
Author:     HAYASHI Kentaro <hayashi@clear-code.com>
AuthorDate: Mon Aug 11 17:07:53 2014 +0900
Commit:     HAYASHI Kentaro <hayashi@clear-code.com>
CommitDate: Mon Aug 11 17:07:53 2014 +0900

    nginx: update the latest mainline
    
    1.7.3 ->
    1.7.4
    
    This update contains STARTTLS vulnerability fix (CVE-2014-3556)

diff --git a/nginx_version b/nginx_version
index 661e7aead..10c088013 100644
--- a/nginx_version
+++ b/nginx_version
@@ -1 +1 @@
-1.7.3
+1.7.4
diff --git a/vendor/nginx-1.7.3/auto/lib/zlib/patch.zlib.h b/vendor/nginx-1.7.3/auto/lib/zlib/patch.zlib.h
deleted file mode 100644
index 122f7fa86..000000000
--- a/vendor/nginx-1.7.3/auto/lib/zlib/patch.zlib.h
+++ /dev/null
@@ -1,10 +0,0 @@
---- zlib.h	Thu Jul  9 20:06:56 1998
-+++ zlib-1.1.3/zlib.h	Tue Mar 22 13:41:04 2005
-@@ -709,7 +709,6 @@
-    (0 in case of error).
- */
- 
--ZEXTERN int ZEXPORTVA   gzprintf OF((gzFile file, const char *format, ...));
- /*
-      Converts, formats, and writes the args to the compressed file under
-    control of the format string, as in fprintf. gzprintf returns the number of
diff --git a/vendor/nginx-1.7.3/CHANGES b/vendor/nginx-1.7.4/CHANGES
similarity index 99%
rename from vendor/nginx-1.7.3/CHANGES
rename to vendor/nginx-1.7.4/CHANGES
index a4837bd6c..5ff1c201d 100644
--- a/vendor/nginx-1.7.3/CHANGES
+++ b/vendor/nginx-1.7.4/CHANGES
@@ -1,4 +1,41 @@
 
+Changes with nginx 1.7.4                                         05 Aug 2014
+
+    *) Security: pipelined commands were not discarded after STARTTLS
+       command in SMTP proxy (CVE-2014-3556); the bug had appeared in 1.5.6.
+       Thanks to Chris Boulton.
+
+    *) Change: URI escaping now uses uppercase hexadecimal digits.
+       Thanks to Piotr Sikora.
+
+    *) Feature: now nginx can be build with BoringSSL and LibreSSL.
+       Thanks to Piotr Sikora.
+
+    *) Bugfix: requests might hang if resolver was used and a DNS server
+       returned a malformed response; the bug had appeared in 1.5.8.
+
+    *) Bugfix: in the ngx_http_spdy_module.
+       Thanks to Piotr Sikora.
+
+    *) Bugfix: the $uri variable might contain garbage when returning errors
+       with code 400.
+       Thanks to Sergey Bobrov.
+
+    *) Bugfix: in error handling in the "proxy_store" directive and the
+       ngx_http_dav_module.
+       Thanks to Feng Gu.
+
+    *) Bugfix: a segmentation fault might occur if logging of errors to
+       syslog was used; the bug had appeared in 1.7.1.
+
+    *) Bugfix: the $geoip_latitude, $geoip_longitude, $geoip_dma_code, and
+       $geoip_area_code variables might not work.
+       Thanks to Yichun Zhang.
+
+    *) Bugfix: in memory allocation error handling.
+       Thanks to Tatsuhiko Kubo and Piotr Sikora.
+
+
 Changes with nginx 1.7.3                                         08 Jul 2014
 
     *) Feature: weak entity tags are now preserved on response
diff --git a/vendor/nginx-1.7.3/CHANGES.ru b/vendor/nginx-1.7.4/CHANGES.ru
similarity index 99%
rename from vendor/nginx-1.7.3/CHANGES.ru
rename to vendor/nginx-1.7.4/CHANGES.ru
index f87375fc5..720180c01 100644
--- a/vendor/nginx-1.7.3/CHANGES.ru
+++ b/vendor/nginx-1.7.4/CHANGES.ru
@@ -1,4 +1,43 @@
 
+Изменения в nginx 1.7.4                                           05.08.2014
+
+    *) Безопасность: pipelined-команды не отбрасывались после команды
+       STARTTLS в SMTP прокси-сервере (CVE-2014-3556); ошибка появилась в
+       1.5.6.
+       Спасибо Chris Boulton.
+
+    *) Изменение: экранирование символов в URI теперь использует
+       шестнадцатеричные цифры в верхнем регистре.
+       Спасибо Piotr Sikora.
+
+    *) Добавление: теперь nginx можно собрать с BoringSSL и LibreSSL.
+       Спасибо Piotr Sikora.
+
+    *) Исправление: запросы могли зависать, если использовался resolver и
+       DNS-сервер возвращал некорректный ответ; ошибка появилась в 1.5.8.
+
+    *) Исправление: в модуле ngx_http_spdy_module.
+       Спасибо Piotr Sikora.
+
+    *) Исправление: переменная $uri могла содержать мусор при возврате
+       ошибок с кодом 400.
+       Спасибо Сергею Боброву.
+
+    *) Исправление: в обработке ошибок в директиве proxy_store и в модуле
+       ngx_http_dav_module.
+       Спасибо Feng Gu.
+
+    *) Исправление: при логгировании ошибок в syslog мог происходить
+       segmentation fault; ошибка появилась в 1.7.1.
+
+    *) Исправление: переменные $geoip_latitude, $geoip_longitude,
+       $geoip_dma_code и $geoip_area_code могли не работать.
+       Спасибо Yichun Zhang.
+
+    *) Исправление: в обработке ошибок выделения памяти.
+       Спасибо Tatsuhiko Kubo и Piotr Sikora.
+
+
 Изменения в nginx 1.7.3                                           08.07.2014
 
     *) Добавление: weak entity tags теперь не удаляются при изменениях
@@ -1614,7 +1653,7 @@
 Изменения в nginx 0.9.2                                           06.12.2010
 
     *) Добавление: поддержка строки "If-Unmodified-Since" в заголовке
-       запросе клиента.
+       запроса клиента.
 
     *) Изменение: использование accept(), если accept4() не реализован;
        ошибка появилась в 0.9.0.
@@ -3562,7 +3601,7 @@
 Изменения в nginx 0.6.31                                          12.05.2008
 
     *) Исправление: nginx не обрабатывал ответ FastCGI-сервера, если строка
-       заголовка ответ была в конце записи FastCGI; ошибка появилась в
+       заголовка ответа была в конце записи FastCGI; ошибка появилась в
        0.6.2.
        Спасибо Сергею Серову.
 
@@ -4638,7 +4677,7 @@
 
     *) Добавление: директива ip_hash в блоке upstream.
 
-    *) Добавление: статус WAIT в строке "Auth-Status" в заголовка ответа
+    *) Добавление: статус WAIT в строке "Auth-Status" в заголовке ответа
        сервера аутентификации IMAP/POP3 прокси.
 
     *) Исправление: nginx не собирался на 64-битных платформах; ошибка
@@ -6123,7 +6162,7 @@
 
 Изменения в nginx 0.1.36                                          15.06.2005
 
-    *) Изменение: если в заголовке запросе есть дублирующиеся строки "Host",
+    *) Изменение: если в заголовке запроса есть дублирующиеся строки "Host",
        "Connection", "Content-Length" и "Authorization", то nginx теперь
        выдаёт ошибку 400.
 
diff --git a/vendor/nginx-1.7.3/LICENSE b/vendor/nginx-1.7.4/LICENSE
similarity index 100%
rename from vendor/nginx-1.7.3/LICENSE
rename to vendor/nginx-1.7.4/LICENSE
diff --git a/vendor/nginx-1.7.3/README b/vendor/nginx-1.7.4/README
similarity index 100%
rename from vendor/nginx-1.7.3/README
rename to vendor/nginx-1.7.4/README
diff --git a/vendor/nginx-1.7.3/auto/cc/acc b/vendor/nginx-1.7.4/auto/cc/acc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/cc/acc
rename to vendor/nginx-1.7.4/auto/cc/acc
diff --git a/vendor/nginx-1.7.3/auto/cc/bcc b/vendor/nginx-1.7.4/auto/cc/bcc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/cc/bcc
rename to vendor/nginx-1.7.4/auto/cc/bcc
diff --git a/vendor/nginx-1.7.3/auto/cc/ccc b/vendor/nginx-1.7.4/auto/cc/ccc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/cc/ccc
rename to vendor/nginx-1.7.4/auto/cc/ccc
diff --git a/vendor/nginx-1.7.3/auto/cc/clang b/vendor/nginx-1.7.4/auto/cc/clang
similarity index 100%
rename from vendor/nginx-1.7.3/auto/cc/clang
rename to vendor/nginx-1.7.4/auto/cc/clang
diff --git a/vendor/nginx-1.7.3/auto/cc/conf b/vendor/nginx-1.7.4/auto/cc/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/cc/conf
rename to vendor/nginx-1.7.4/auto/cc/conf
diff --git a/vendor/nginx-1.7.3/auto/cc/gcc b/vendor/nginx-1.7.4/auto/cc/gcc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/cc/gcc
rename to vendor/nginx-1.7.4/auto/cc/gcc
diff --git a/vendor/nginx-1.7.3/auto/cc/icc b/vendor/nginx-1.7.4/auto/cc/icc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/cc/icc
rename to vendor/nginx-1.7.4/auto/cc/icc
diff --git a/vendor/nginx-1.7.3/auto/cc/msvc b/vendor/nginx-1.7.4/auto/cc/msvc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/cc/msvc
rename to vendor/nginx-1.7.4/auto/cc/msvc
diff --git a/vendor/nginx-1.7.3/auto/cc/name b/vendor/nginx-1.7.4/auto/cc/name
similarity index 100%
rename from vendor/nginx-1.7.3/auto/cc/name
rename to vendor/nginx-1.7.4/auto/cc/name
diff --git a/vendor/nginx-1.7.3/auto/cc/owc b/vendor/nginx-1.7.4/auto/cc/owc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/cc/owc
rename to vendor/nginx-1.7.4/auto/cc/owc
diff --git a/vendor/nginx-1.7.3/auto/cc/sunc b/vendor/nginx-1.7.4/auto/cc/sunc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/cc/sunc
rename to vendor/nginx-1.7.4/auto/cc/sunc
diff --git a/vendor/nginx-1.7.3/auto/define b/vendor/nginx-1.7.4/auto/define
similarity index 100%
rename from vendor/nginx-1.7.3/auto/define
rename to vendor/nginx-1.7.4/auto/define
diff --git a/vendor/nginx-1.7.3/auto/endianness b/vendor/nginx-1.7.4/auto/endianness
similarity index 100%
rename from vendor/nginx-1.7.3/auto/endianness
rename to vendor/nginx-1.7.4/auto/endianness
diff --git a/vendor/nginx-1.7.3/auto/feature b/vendor/nginx-1.7.4/auto/feature
similarity index 100%
rename from vendor/nginx-1.7.3/auto/feature
rename to vendor/nginx-1.7.4/auto/feature
diff --git a/vendor/nginx-1.7.3/auto/have b/vendor/nginx-1.7.4/auto/have
similarity index 100%
rename from vendor/nginx-1.7.3/auto/have
rename to vendor/nginx-1.7.4/auto/have
diff --git a/vendor/nginx-1.7.3/auto/have_headers b/vendor/nginx-1.7.4/auto/have_headers
similarity index 100%
rename from vendor/nginx-1.7.3/auto/have_headers
rename to vendor/nginx-1.7.4/auto/have_headers
diff --git a/vendor/nginx-1.7.3/auto/headers b/vendor/nginx-1.7.4/auto/headers
similarity index 100%
rename from vendor/nginx-1.7.3/auto/headers
rename to vendor/nginx-1.7.4/auto/headers
diff --git a/vendor/nginx-1.7.3/auto/include b/vendor/nginx-1.7.4/auto/include
similarity index 100%
rename from vendor/nginx-1.7.3/auto/include
rename to vendor/nginx-1.7.4/auto/include
diff --git a/vendor/nginx-1.7.3/auto/init b/vendor/nginx-1.7.4/auto/init
similarity index 100%
rename from vendor/nginx-1.7.3/auto/init
rename to vendor/nginx-1.7.4/auto/init
diff --git a/vendor/nginx-1.7.3/auto/install b/vendor/nginx-1.7.4/auto/install
similarity index 100%
rename from vendor/nginx-1.7.3/auto/install
rename to vendor/nginx-1.7.4/auto/install
diff --git a/vendor/nginx-1.7.3/auto/lib/conf b/vendor/nginx-1.7.4/auto/lib/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/conf
rename to vendor/nginx-1.7.4/auto/lib/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/geoip/conf b/vendor/nginx-1.7.4/auto/lib/geoip/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/geoip/conf
rename to vendor/nginx-1.7.4/auto/lib/geoip/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/google-perftools/conf b/vendor/nginx-1.7.4/auto/lib/google-perftools/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/google-perftools/conf
rename to vendor/nginx-1.7.4/auto/lib/google-perftools/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/libatomic/conf b/vendor/nginx-1.7.4/auto/lib/libatomic/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/libatomic/conf
rename to vendor/nginx-1.7.4/auto/lib/libatomic/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/libatomic/make b/vendor/nginx-1.7.4/auto/lib/libatomic/make
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/libatomic/make
rename to vendor/nginx-1.7.4/auto/lib/libatomic/make
diff --git a/vendor/nginx-1.7.3/auto/lib/libgd/conf b/vendor/nginx-1.7.4/auto/lib/libgd/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/libgd/conf
rename to vendor/nginx-1.7.4/auto/lib/libgd/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/libxslt/conf b/vendor/nginx-1.7.4/auto/lib/libxslt/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/libxslt/conf
rename to vendor/nginx-1.7.4/auto/lib/libxslt/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/make b/vendor/nginx-1.7.4/auto/lib/make
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/make
rename to vendor/nginx-1.7.4/auto/lib/make
diff --git a/vendor/nginx-1.7.3/auto/lib/md5/conf b/vendor/nginx-1.7.4/auto/lib/md5/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/md5/conf
rename to vendor/nginx-1.7.4/auto/lib/md5/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/md5/make b/vendor/nginx-1.7.4/auto/lib/md5/make
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/md5/make
rename to vendor/nginx-1.7.4/auto/lib/md5/make
diff --git a/vendor/nginx-1.7.3/auto/lib/md5/makefile.bcc b/vendor/nginx-1.7.4/auto/lib/md5/makefile.bcc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/md5/makefile.bcc
rename to vendor/nginx-1.7.4/auto/lib/md5/makefile.bcc
diff --git a/vendor/nginx-1.7.3/auto/lib/md5/makefile.msvc b/vendor/nginx-1.7.4/auto/lib/md5/makefile.msvc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/md5/makefile.msvc
rename to vendor/nginx-1.7.4/auto/lib/md5/makefile.msvc
diff --git a/vendor/nginx-1.7.3/auto/lib/md5/makefile.owc b/vendor/nginx-1.7.4/auto/lib/md5/makefile.owc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/md5/makefile.owc
rename to vendor/nginx-1.7.4/auto/lib/md5/makefile.owc
diff --git a/vendor/nginx-1.7.3/auto/lib/openssl/conf b/vendor/nginx-1.7.4/auto/lib/openssl/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/openssl/conf
rename to vendor/nginx-1.7.4/auto/lib/openssl/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/openssl/make b/vendor/nginx-1.7.4/auto/lib/openssl/make
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/openssl/make
rename to vendor/nginx-1.7.4/auto/lib/openssl/make
diff --git a/vendor/nginx-1.7.3/auto/lib/openssl/makefile.bcc b/vendor/nginx-1.7.4/auto/lib/openssl/makefile.bcc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/openssl/makefile.bcc
rename to vendor/nginx-1.7.4/auto/lib/openssl/makefile.bcc
diff --git a/vendor/nginx-1.7.3/auto/lib/openssl/makefile.msvc b/vendor/nginx-1.7.4/auto/lib/openssl/makefile.msvc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/openssl/makefile.msvc
rename to vendor/nginx-1.7.4/auto/lib/openssl/makefile.msvc
diff --git a/vendor/nginx-1.7.3/auto/lib/pcre/conf b/vendor/nginx-1.7.4/auto/lib/pcre/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/pcre/conf
rename to vendor/nginx-1.7.4/auto/lib/pcre/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/pcre/make b/vendor/nginx-1.7.4/auto/lib/pcre/make
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/pcre/make
rename to vendor/nginx-1.7.4/auto/lib/pcre/make
diff --git a/vendor/nginx-1.7.3/auto/lib/pcre/makefile.bcc b/vendor/nginx-1.7.4/auto/lib/pcre/makefile.bcc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/pcre/makefile.bcc
rename to vendor/nginx-1.7.4/auto/lib/pcre/makefile.bcc
diff --git a/vendor/nginx-1.7.3/auto/lib/pcre/makefile.msvc b/vendor/nginx-1.7.4/auto/lib/pcre/makefile.msvc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/pcre/makefile.msvc
rename to vendor/nginx-1.7.4/auto/lib/pcre/makefile.msvc
diff --git a/vendor/nginx-1.7.3/auto/lib/pcre/makefile.owc b/vendor/nginx-1.7.4/auto/lib/pcre/makefile.owc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/pcre/makefile.owc
rename to vendor/nginx-1.7.4/auto/lib/pcre/makefile.owc
diff --git a/vendor/nginx-1.7.3/auto/lib/perl/conf b/vendor/nginx-1.7.4/auto/lib/perl/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/perl/conf
rename to vendor/nginx-1.7.4/auto/lib/perl/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/perl/make b/vendor/nginx-1.7.4/auto/lib/perl/make
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/perl/make
rename to vendor/nginx-1.7.4/auto/lib/perl/make
diff --git a/vendor/nginx-1.7.3/auto/lib/sha1/conf b/vendor/nginx-1.7.4/auto/lib/sha1/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/sha1/conf
rename to vendor/nginx-1.7.4/auto/lib/sha1/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/sha1/make b/vendor/nginx-1.7.4/auto/lib/sha1/make
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/sha1/make
rename to vendor/nginx-1.7.4/auto/lib/sha1/make
diff --git a/vendor/nginx-1.7.3/auto/lib/sha1/makefile.bcc b/vendor/nginx-1.7.4/auto/lib/sha1/makefile.bcc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/sha1/makefile.bcc
rename to vendor/nginx-1.7.4/auto/lib/sha1/makefile.bcc
diff --git a/vendor/nginx-1.7.3/auto/lib/sha1/makefile.msvc b/vendor/nginx-1.7.4/auto/lib/sha1/makefile.msvc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/sha1/makefile.msvc
rename to vendor/nginx-1.7.4/auto/lib/sha1/makefile.msvc
diff --git a/vendor/nginx-1.7.3/auto/lib/sha1/makefile.owc b/vendor/nginx-1.7.4/auto/lib/sha1/makefile.owc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/sha1/makefile.owc
rename to vendor/nginx-1.7.4/auto/lib/sha1/makefile.owc
diff --git a/vendor/nginx-1.7.3/auto/lib/test b/vendor/nginx-1.7.4/auto/lib/test
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/test
rename to vendor/nginx-1.7.4/auto/lib/test
diff --git a/vendor/nginx-1.7.3/auto/lib/zlib/conf b/vendor/nginx-1.7.4/auto/lib/zlib/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/zlib/conf
rename to vendor/nginx-1.7.4/auto/lib/zlib/conf
diff --git a/vendor/nginx-1.7.3/auto/lib/zlib/make b/vendor/nginx-1.7.4/auto/lib/zlib/make
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/zlib/make
rename to vendor/nginx-1.7.4/auto/lib/zlib/make
diff --git a/vendor/nginx-1.7.3/auto/lib/zlib/makefile.bcc b/vendor/nginx-1.7.4/auto/lib/zlib/makefile.bcc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/zlib/makefile.bcc
rename to vendor/nginx-1.7.4/auto/lib/zlib/makefile.bcc
diff --git a/vendor/nginx-1.7.3/auto/lib/zlib/makefile.msvc b/vendor/nginx-1.7.4/auto/lib/zlib/makefile.msvc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/zlib/makefile.msvc
rename to vendor/nginx-1.7.4/auto/lib/zlib/makefile.msvc
diff --git a/vendor/nginx-1.7.3/auto/lib/zlib/makefile.owc b/vendor/nginx-1.7.4/auto/lib/zlib/makefile.owc
similarity index 100%
rename from vendor/nginx-1.7.3/auto/lib/zlib/makefile.owc
rename to vendor/nginx-1.7.4/auto/lib/zlib/makefile.owc
diff --git a/vendor/nginx-1.7.3/auto/make b/vendor/nginx-1.7.4/auto/make
similarity index 100%
rename from vendor/nginx-1.7.3/auto/make
rename to vendor/nginx-1.7.4/auto/make
diff --git a/vendor/nginx-1.7.3/auto/modules b/vendor/nginx-1.7.4/auto/modules
similarity index 100%
rename from vendor/nginx-1.7.3/auto/modules
rename to vendor/nginx-1.7.4/auto/modules
diff --git a/vendor/nginx-1.7.3/auto/nohave b/vendor/nginx-1.7.4/auto/nohave
similarity index 100%
rename from vendor/nginx-1.7.3/auto/nohave
rename to vendor/nginx-1.7.4/auto/nohave
diff --git a/vendor/nginx-1.7.3/auto/options b/vendor/nginx-1.7.4/auto/options
similarity index 100%
rename from vendor/nginx-1.7.3/auto/options
rename to vendor/nginx-1.7.4/auto/options
diff --git a/vendor/nginx-1.7.3/auto/os/conf b/vendor/nginx-1.7.4/auto/os/conf
similarity index 100%
rename from vendor/nginx-1.7.3/auto/os/conf
rename to vendor/nginx-1.7.4/auto/os/conf
diff --git a/vendor/nginx-1.7.3/auto/os/darwin b/vendor/nginx-1.7.4/auto/os/darwin
similarity index 100%
rename from vendor/nginx-1.7.3/auto/os/darwin
rename to vendor/nginx-1.7.4/auto/os/darwin
diff --git a/vendor/nginx-1.7.3/auto/os/freebsd b/vendor/nginx-1.7.4/auto/os/freebsd
similarity index 100%
rename from vendor/nginx-1.7.3/auto/os/freebsd
rename to vendor/nginx-1.7.4/auto/os/freebsd
diff --git a/vendor/nginx-1.7.3/auto/os/linux b/vendor/nginx-1.7.4/auto/os/linux
similarity index 100%
rename from vendor/nginx-1.7.3/auto/os/linux
rename to vendor/nginx-1.7.4/auto/os/linux
diff --git a/vendor/nginx-1.7.3/auto/os/solaris b/vendor/nginx-1.7.4/auto/os/solaris
similarity index 100%
rename from vendor/nginx-1.7.3/auto/os/solaris
rename to vendor/nginx-1.7.4/auto/os/solaris
diff --git a/vendor/nginx-1.7.3/auto/os/win32 b/vendor/nginx-1.7.4/auto/os/win32
similarity index 100%
rename from vendor/nginx-1.7.3/auto/os/win32
rename to vendor/nginx-1.7.4/auto/os/win32
diff --git a/vendor/nginx-1.7.3/auto/sources b/vendor/nginx-1.7.4/auto/sources
similarity index 100%
rename from vendor/nginx-1.7.3/auto/sources
rename to vendor/nginx-1.7.4/auto/sources
diff --git a/vendor/nginx-1.7.3/auto/stubs b/vendor/nginx-1.7.4/auto/stubs
similarity index 100%
rename from vendor/nginx-1.7.3/auto/stubs
rename to vendor/nginx-1.7.4/auto/stubs
diff --git a/vendor/nginx-1.7.3/auto/summary b/vendor/nginx-1.7.4/auto/summary
similarity index 100%
rename from vendor/nginx-1.7.3/auto/summary
rename to vendor/nginx-1.7.4/auto/summary
diff --git a/vendor/nginx-1.7.3/auto/types/sizeof b/vendor/nginx-1.7.4/auto/types/sizeof
similarity index 100%
rename from vendor/nginx-1.7.3/auto/types/sizeof
rename to vendor/nginx-1.7.4/auto/types/sizeof
diff --git a/vendor/nginx-1.7.3/auto/types/typedef b/vendor/nginx-1.7.4/auto/types/typedef
similarity index 100%
rename from vendor/nginx-1.7.3/auto/types/typedef
rename to vendor/nginx-1.7.4/auto/types/typedef
diff --git a/vendor/nginx-1.7.3/auto/types/uintptr_t b/vendor/nginx-1.7.4/auto/types/uintptr_t
similarity index 100%
rename from vendor/nginx-1.7.3/auto/types/uintptr_t
rename to vendor/nginx-1.7.4/auto/types/uintptr_t
diff --git a/vendor/nginx-1.7.3/auto/types/value b/vendor/nginx-1.7.4/auto/types/value
similarity index 100%
rename from vendor/nginx-1.7.3/auto/types/value
rename to vendor/nginx-1.7.4/auto/types/value
diff --git a/vendor/nginx-1.7.3/auto/unix b/vendor/nginx-1.7.4/auto/unix
similarity index 100%
rename from vendor/nginx-1.7.3/auto/unix
rename to vendor/nginx-1.7.4/auto/unix
diff --git a/vendor/nginx-1.7.3/conf/fastcgi.conf b/vendor/nginx-1.7.4/conf/fastcgi.conf
similarity index 100%
rename from vendor/nginx-1.7.3/conf/fastcgi.conf
rename to vendor/nginx-1.7.4/conf/fastcgi.conf
diff --git a/vendor/nginx-1.7.3/conf/fastcgi_params b/vendor/nginx-1.7.4/conf/fastcgi_params
similarity index 100%
rename from vendor/nginx-1.7.3/conf/fastcgi_params
rename to vendor/nginx-1.7.4/conf/fastcgi_params
diff --git a/vendor/nginx-1.7.3/conf/koi-utf b/vendor/nginx-1.7.4/conf/koi-utf
similarity index 100%
rename from vendor/nginx-1.7.3/conf/koi-utf
rename to vendor/nginx-1.7.4/conf/koi-utf
diff --git a/vendor/nginx-1.7.3/conf/koi-win b/vendor/nginx-1.7.4/conf/koi-win
similarity index 100%
rename from vendor/nginx-1.7.3/conf/koi-win
rename to vendor/nginx-1.7.4/conf/koi-win
diff --git a/vendor/nginx-1.7.3/conf/mime.types b/vendor/nginx-1.7.4/conf/mime.types
similarity index 100%
rename from vendor/nginx-1.7.3/conf/mime.types
rename to vendor/nginx-1.7.4/conf/mime.types
diff --git a/vendor/nginx-1.7.3/conf/nginx.conf b/vendor/nginx-1.7.4/conf/nginx.conf
similarity index 100%
rename from vendor/nginx-1.7.3/conf/nginx.conf
rename to vendor/nginx-1.7.4/conf/nginx.conf
diff --git a/vendor/nginx-1.7.3/conf/scgi_params b/vendor/nginx-1.7.4/conf/scgi_params
similarity index 100%
rename from vendor/nginx-1.7.3/conf/scgi_params
rename to vendor/nginx-1.7.4/conf/scgi_params
diff --git a/vendor/nginx-1.7.3/conf/uwsgi_params b/vendor/nginx-1.7.4/conf/uwsgi_params
similarity index 100%
rename from vendor/nginx-1.7.3/conf/uwsgi_params
rename to vendor/nginx-1.7.4/conf/uwsgi_params
diff --git a/vendor/nginx-1.7.3/conf/win-utf b/vendor/nginx-1.7.4/conf/win-utf
similarity index 100%
rename from vendor/nginx-1.7.3/conf/win-utf
rename to vendor/nginx-1.7.4/conf/win-utf
diff --git a/vendor/nginx-1.7.3/configure b/vendor/nginx-1.7.4/configure
similarity index 100%
rename from vendor/nginx-1.7.3/configure
rename to vendor/nginx-1.7.4/configure
diff --git a/vendor/nginx-1.7.3/contrib/README b/vendor/nginx-1.7.4/contrib/README
similarity index 100%
rename from vendor/nginx-1.7.3/contrib/README
rename to vendor/nginx-1.7.4/contrib/README
diff --git a/vendor/nginx-1.7.3/contrib/geo2nginx.pl b/vendor/nginx-1.7.4/contrib/geo2nginx.pl
similarity index 100%
rename from vendor/nginx-1.7.3/contrib/geo2nginx.pl
rename to vendor/nginx-1.7.4/contrib/geo2nginx.pl
diff --git a/vendor/nginx-1.7.3/contrib/unicode2nginx/koi-utf b/vendor/nginx-1.7.4/contrib/unicode2nginx/koi-utf
similarity index 100%
rename from vendor/nginx-1.7.3/contrib/unicode2nginx/koi-utf
rename to vendor/nginx-1.7.4/contrib/unicode2nginx/koi-utf
diff --git a/vendor/nginx-1.7.3/contrib/unicode2nginx/unicode-to-nginx.pl b/vendor/nginx-1.7.4/contrib/unicode2nginx/unicode-to-nginx.pl
similarity index 100%
rename from vendor/nginx-1.7.3/contrib/unicode2nginx/unicode-to-nginx.pl
rename to vendor/nginx-1.7.4/contrib/unicode2nginx/unicode-to-nginx.pl
diff --git a/vendor/nginx-1.7.3/contrib/unicode2nginx/win-utf b/vendor/nginx-1.7.4/contrib/unicode2nginx/win-utf
similarity index 100%
rename from vendor/nginx-1.7.3/contrib/unicode2nginx/win-utf
rename to vendor/nginx-1.7.4/contrib/unicode2nginx/win-utf
diff --git a/vendor/nginx-1.7.3/contrib/vim/ftdetect/nginx.vim b/vendor/nginx-1.7.4/contrib/vim/ftdetect/nginx.vim
similarity index 100%
rename from vendor/nginx-1.7.3/contrib/vim/ftdetect/nginx.vim
rename to vendor/nginx-1.7.4/contrib/vim/ftdetect/nginx.vim
diff --git a/vendor/nginx-1.7.3/contrib/vim/indent/nginx.vim b/vendor/nginx-1.7.4/contrib/vim/indent/nginx.vim
similarity index 100%
rename from vendor/nginx-1.7.3/contrib/vim/indent/nginx.vim
rename to vendor/nginx-1.7.4/contrib/vim/indent/nginx.vim
diff --git a/vendor/nginx-1.7.3/contrib/vim/syntax/nginx.vim b/vendor/nginx-1.7.4/contrib/vim/syntax/nginx.vim
similarity index 100%
rename from vendor/nginx-1.7.3/contrib/vim/syntax/nginx.vim
rename to vendor/nginx-1.7.4/contrib/vim/syntax/nginx.vim
diff --git a/vendor/nginx-1.7.3/html/50x.html b/vendor/nginx-1.7.4/html/50x.html
similarity index 100%
rename from vendor/nginx-1.7.3/html/50x.html
rename to vendor/nginx-1.7.4/html/50x.html
diff --git a/vendor/nginx-1.7.3/html/index.html b/vendor/nginx-1.7.4/html/index.html
similarity index 100%
rename from vendor/nginx-1.7.3/html/index.html
rename to vendor/nginx-1.7.4/html/index.html
diff --git a/vendor/nginx-1.7.3/man/nginx.8 b/vendor/nginx-1.7.4/man/nginx.8
similarity index 100%
rename from vendor/nginx-1.7.3/man/nginx.8
rename to vendor/nginx-1.7.4/man/nginx.8
diff --git a/vendor/nginx-1.7.3/src/core/nginx.c b/vendor/nginx-1.7.4/src/core/nginx.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/nginx.c
rename to vendor/nginx-1.7.4/src/core/nginx.c
diff --git a/vendor/nginx-1.7.3/src/core/nginx.h b/vendor/nginx-1.7.4/src/core/nginx.h
similarity index 85%
rename from vendor/nginx-1.7.3/src/core/nginx.h
rename to vendor/nginx-1.7.4/src/core/nginx.h
index 8d134487a..3cdf3ec6a 100644
--- a/vendor/nginx-1.7.3/src/core/nginx.h
+++ b/vendor/nginx-1.7.4/src/core/nginx.h
@@ -9,8 +9,8 @@
 #define _NGINX_H_INCLUDED_
 
 
-#define nginx_version      1007003
-#define NGINX_VERSION      "1.7.3"
+#define nginx_version      1007004
+#define NGINX_VERSION      "1.7.4"
 #define NGINX_VER          "nginx/" NGINX_VERSION
 
 #ifdef NGX_BUILD
diff --git a/vendor/nginx-1.7.3/src/core/ngx_array.c b/vendor/nginx-1.7.4/src/core/ngx_array.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_array.c
rename to vendor/nginx-1.7.4/src/core/ngx_array.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_array.h b/vendor/nginx-1.7.4/src/core/ngx_array.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_array.h
rename to vendor/nginx-1.7.4/src/core/ngx_array.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_buf.c b/vendor/nginx-1.7.4/src/core/ngx_buf.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_buf.c
rename to vendor/nginx-1.7.4/src/core/ngx_buf.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_buf.h b/vendor/nginx-1.7.4/src/core/ngx_buf.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_buf.h
rename to vendor/nginx-1.7.4/src/core/ngx_buf.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_conf_file.c b/vendor/nginx-1.7.4/src/core/ngx_conf_file.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/core/ngx_conf_file.c
rename to vendor/nginx-1.7.4/src/core/ngx_conf_file.c
index d6b5cdf1e..ec3c1fae1 100644
--- a/vendor/nginx-1.7.3/src/core/ngx_conf_file.c
+++ b/vendor/nginx-1.7.4/src/core/ngx_conf_file.c
@@ -781,6 +781,9 @@ ngx_conf_include(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
 
         file.len = name.len++;
         file.data = ngx_pstrdup(cf->pool, &name);
+        if (file.data == NULL) {
+            return NGX_CONF_ERROR;
+        }
 
         ngx_log_debug1(NGX_LOG_DEBUG_CORE, cf->log, 0, "include %s", file.data);
 
diff --git a/vendor/nginx-1.7.3/src/core/ngx_conf_file.h b/vendor/nginx-1.7.4/src/core/ngx_conf_file.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_conf_file.h
rename to vendor/nginx-1.7.4/src/core/ngx_conf_file.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_config.h b/vendor/nginx-1.7.4/src/core/ngx_config.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_config.h
rename to vendor/nginx-1.7.4/src/core/ngx_config.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_connection.c b/vendor/nginx-1.7.4/src/core/ngx_connection.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_connection.c
rename to vendor/nginx-1.7.4/src/core/ngx_connection.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_connection.h b/vendor/nginx-1.7.4/src/core/ngx_connection.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_connection.h
rename to vendor/nginx-1.7.4/src/core/ngx_connection.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_core.h b/vendor/nginx-1.7.4/src/core/ngx_core.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_core.h
rename to vendor/nginx-1.7.4/src/core/ngx_core.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_cpuinfo.c b/vendor/nginx-1.7.4/src/core/ngx_cpuinfo.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_cpuinfo.c
rename to vendor/nginx-1.7.4/src/core/ngx_cpuinfo.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_crc.h b/vendor/nginx-1.7.4/src/core/ngx_crc.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_crc.h
rename to vendor/nginx-1.7.4/src/core/ngx_crc.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_crc32.c b/vendor/nginx-1.7.4/src/core/ngx_crc32.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_crc32.c
rename to vendor/nginx-1.7.4/src/core/ngx_crc32.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_crc32.h b/vendor/nginx-1.7.4/src/core/ngx_crc32.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_crc32.h
rename to vendor/nginx-1.7.4/src/core/ngx_crc32.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_crypt.c b/vendor/nginx-1.7.4/src/core/ngx_crypt.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_crypt.c
rename to vendor/nginx-1.7.4/src/core/ngx_crypt.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_crypt.h b/vendor/nginx-1.7.4/src/core/ngx_crypt.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_crypt.h
rename to vendor/nginx-1.7.4/src/core/ngx_crypt.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_cycle.c b/vendor/nginx-1.7.4/src/core/ngx_cycle.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_cycle.c
rename to vendor/nginx-1.7.4/src/core/ngx_cycle.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_cycle.h b/vendor/nginx-1.7.4/src/core/ngx_cycle.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_cycle.h
rename to vendor/nginx-1.7.4/src/core/ngx_cycle.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_file.c b/vendor/nginx-1.7.4/src/core/ngx_file.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_file.c
rename to vendor/nginx-1.7.4/src/core/ngx_file.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_file.h b/vendor/nginx-1.7.4/src/core/ngx_file.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_file.h
rename to vendor/nginx-1.7.4/src/core/ngx_file.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_hash.c b/vendor/nginx-1.7.4/src/core/ngx_hash.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_hash.c
rename to vendor/nginx-1.7.4/src/core/ngx_hash.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_hash.h b/vendor/nginx-1.7.4/src/core/ngx_hash.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_hash.h
rename to vendor/nginx-1.7.4/src/core/ngx_hash.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_inet.c b/vendor/nginx-1.7.4/src/core/ngx_inet.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_inet.c
rename to vendor/nginx-1.7.4/src/core/ngx_inet.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_inet.h b/vendor/nginx-1.7.4/src/core/ngx_inet.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_inet.h
rename to vendor/nginx-1.7.4/src/core/ngx_inet.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_list.c b/vendor/nginx-1.7.4/src/core/ngx_list.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_list.c
rename to vendor/nginx-1.7.4/src/core/ngx_list.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_list.h b/vendor/nginx-1.7.4/src/core/ngx_list.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_list.h
rename to vendor/nginx-1.7.4/src/core/ngx_list.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_log.c b/vendor/nginx-1.7.4/src/core/ngx_log.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/core/ngx_log.c
rename to vendor/nginx-1.7.4/src/core/ngx_log.c
index 375d52f65..005d9ff88 100644
--- a/vendor/nginx-1.7.3/src/core/ngx_log.c
+++ b/vendor/nginx-1.7.4/src/core/ngx_log.c
@@ -387,20 +387,22 @@ ngx_log_open_default(ngx_cycle_t *cycle)
             return NGX_ERROR;
         }
 
-        log->log_level = NGX_LOG_ERR;
-        ngx_log_insert(&cycle->new_log, log);
-
     } else {
         /* no error logs at all */
         log = &cycle->new_log;
-        log->log_level = NGX_LOG_ERR;
     }
 
+    log->log_level = NGX_LOG_ERR;
+
     log->file = ngx_conf_open_file(cycle, &error_log);
     if (log->file == NULL) {
         return NGX_ERROR;
     }
 
+    if (log != &cycle->new_log) {
+        ngx_log_insert(&cycle->new_log, log);
+    }
+
     return NGX_OK;
 }
 
diff --git a/vendor/nginx-1.7.3/src/core/ngx_log.h b/vendor/nginx-1.7.4/src/core/ngx_log.h
similarity index 99%
rename from vendor/nginx-1.7.3/src/core/ngx_log.h
rename to vendor/nginx-1.7.4/src/core/ngx_log.h
index c1a52c44f..95ecca528 100644
--- a/vendor/nginx-1.7.3/src/core/ngx_log.h
+++ b/vendor/nginx-1.7.4/src/core/ngx_log.h
@@ -248,7 +248,7 @@ char *ngx_log_set_log(ngx_conf_t *cf, ngx_log_t **head);
 static ngx_inline void
 ngx_write_stderr(char *text)
 {
-    (void) ngx_write_fd(ngx_stderr, text, strlen(text));
+    (void) ngx_write_fd(ngx_stderr, text, ngx_strlen(text));
 }
 
 
diff --git a/vendor/nginx-1.7.3/src/core/ngx_md5.c b/vendor/nginx-1.7.4/src/core/ngx_md5.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_md5.c
rename to vendor/nginx-1.7.4/src/core/ngx_md5.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_md5.h b/vendor/nginx-1.7.4/src/core/ngx_md5.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_md5.h
rename to vendor/nginx-1.7.4/src/core/ngx_md5.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_murmurhash.c b/vendor/nginx-1.7.4/src/core/ngx_murmurhash.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_murmurhash.c
rename to vendor/nginx-1.7.4/src/core/ngx_murmurhash.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_murmurhash.h b/vendor/nginx-1.7.4/src/core/ngx_murmurhash.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_murmurhash.h
rename to vendor/nginx-1.7.4/src/core/ngx_murmurhash.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_open_file_cache.c b/vendor/nginx-1.7.4/src/core/ngx_open_file_cache.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_open_file_cache.c
rename to vendor/nginx-1.7.4/src/core/ngx_open_file_cache.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_open_file_cache.h b/vendor/nginx-1.7.4/src/core/ngx_open_file_cache.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_open_file_cache.h
rename to vendor/nginx-1.7.4/src/core/ngx_open_file_cache.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_output_chain.c b/vendor/nginx-1.7.4/src/core/ngx_output_chain.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_output_chain.c
rename to vendor/nginx-1.7.4/src/core/ngx_output_chain.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_palloc.c b/vendor/nginx-1.7.4/src/core/ngx_palloc.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_palloc.c
rename to vendor/nginx-1.7.4/src/core/ngx_palloc.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_palloc.h b/vendor/nginx-1.7.4/src/core/ngx_palloc.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_palloc.h
rename to vendor/nginx-1.7.4/src/core/ngx_palloc.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_parse.c b/vendor/nginx-1.7.4/src/core/ngx_parse.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_parse.c
rename to vendor/nginx-1.7.4/src/core/ngx_parse.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_parse.h b/vendor/nginx-1.7.4/src/core/ngx_parse.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_parse.h
rename to vendor/nginx-1.7.4/src/core/ngx_parse.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_proxy_protocol.c b/vendor/nginx-1.7.4/src/core/ngx_proxy_protocol.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_proxy_protocol.c
rename to vendor/nginx-1.7.4/src/core/ngx_proxy_protocol.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_proxy_protocol.h b/vendor/nginx-1.7.4/src/core/ngx_proxy_protocol.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_proxy_protocol.h
rename to vendor/nginx-1.7.4/src/core/ngx_proxy_protocol.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_queue.c b/vendor/nginx-1.7.4/src/core/ngx_queue.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_queue.c
rename to vendor/nginx-1.7.4/src/core/ngx_queue.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_queue.h b/vendor/nginx-1.7.4/src/core/ngx_queue.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_queue.h
rename to vendor/nginx-1.7.4/src/core/ngx_queue.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_radix_tree.c b/vendor/nginx-1.7.4/src/core/ngx_radix_tree.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_radix_tree.c
rename to vendor/nginx-1.7.4/src/core/ngx_radix_tree.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_radix_tree.h b/vendor/nginx-1.7.4/src/core/ngx_radix_tree.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_radix_tree.h
rename to vendor/nginx-1.7.4/src/core/ngx_radix_tree.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_rbtree.c b/vendor/nginx-1.7.4/src/core/ngx_rbtree.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_rbtree.c
rename to vendor/nginx-1.7.4/src/core/ngx_rbtree.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_rbtree.h b/vendor/nginx-1.7.4/src/core/ngx_rbtree.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_rbtree.h
rename to vendor/nginx-1.7.4/src/core/ngx_rbtree.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_regex.c b/vendor/nginx-1.7.4/src/core/ngx_regex.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_regex.c
rename to vendor/nginx-1.7.4/src/core/ngx_regex.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_regex.h b/vendor/nginx-1.7.4/src/core/ngx_regex.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_regex.h
rename to vendor/nginx-1.7.4/src/core/ngx_regex.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_resolver.c b/vendor/nginx-1.7.4/src/core/ngx_resolver.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/core/ngx_resolver.c
rename to vendor/nginx-1.7.4/src/core/ngx_resolver.c
index 645738ce5..dfe3dcb1e 100644
--- a/vendor/nginx-1.7.3/src/core/ngx_resolver.c
+++ b/vendor/nginx-1.7.4/src/core/ngx_resolver.c
@@ -1467,7 +1467,6 @@ ngx_resolver_process_a(ngx_resolver_t *r, u_char *buf, size_t last,
             goto failed;
         }
 
-        rn->naddrs6 = 0;
         qident = (rn->query6[0] << 8) + rn->query6[1];
 
         break;
@@ -1482,7 +1481,6 @@ ngx_resolver_process_a(ngx_resolver_t *r, u_char *buf, size_t last,
             goto failed;
         }
 
-        rn->naddrs = 0;
         qident = (rn->query[0] << 8) + rn->query[1];
     }
 
@@ -1507,6 +1505,8 @@ ngx_resolver_process_a(ngx_resolver_t *r, u_char *buf, size_t last,
 
         case NGX_RESOLVE_AAAA:
 
+            rn->naddrs6 = 0;
+
             if (rn->naddrs == (u_short) -1) {
                 goto next;
             }
@@ -1519,6 +1519,8 @@ ngx_resolver_process_a(ngx_resolver_t *r, u_char *buf, size_t last,
 
         default: /* NGX_RESOLVE_A */
 
+            rn->naddrs = 0;
+
             if (rn->naddrs6 == (u_short) -1) {
                 goto next;
             }
@@ -1539,6 +1541,8 @@ ngx_resolver_process_a(ngx_resolver_t *r, u_char *buf, size_t last,
 
         case NGX_RESOLVE_AAAA:
 
+            rn->naddrs6 = 0;
+
             if (rn->naddrs == (u_short) -1) {
                 rn->code = (u_char) code;
                 goto next;
@@ -1548,6 +1552,8 @@ ngx_resolver_process_a(ngx_resolver_t *r, u_char *buf, size_t last,
 
         default: /* NGX_RESOLVE_A */
 
+            rn->naddrs = 0;
+
             if (rn->naddrs6 == (u_short) -1) {
                 rn->code = (u_char) code;
                 goto next;
@@ -1817,6 +1823,25 @@ ngx_resolver_process_a(ngx_resolver_t *r, u_char *buf, size_t last,
         }
     }
 
+    switch (qtype) {
+
+#if (NGX_HAVE_INET6)
+    case NGX_RESOLVE_AAAA:
+
+        if (rn->naddrs6 == (u_short) -1) {
+            rn->naddrs6 = 0;
+        }
+
+        break;
+#endif
+
+    default: /* NGX_RESOLVE_A */
+
+        if (rn->naddrs == (u_short) -1) {
+            rn->naddrs = 0;
+        }
+    }
+
     if (rn->naddrs != (u_short) -1
 #if (NGX_HAVE_INET6)
         && rn->naddrs6 != (u_short) -1
@@ -2722,8 +2747,7 @@ done:
     }
 
     if (len == -1) {
-        name->len = 0;
-        name->data = NULL;
+        ngx_str_null(name);
         return NGX_OK;
     }
 
diff --git a/vendor/nginx-1.7.3/src/core/ngx_resolver.h b/vendor/nginx-1.7.4/src/core/ngx_resolver.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_resolver.h
rename to vendor/nginx-1.7.4/src/core/ngx_resolver.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_sha1.h b/vendor/nginx-1.7.4/src/core/ngx_sha1.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_sha1.h
rename to vendor/nginx-1.7.4/src/core/ngx_sha1.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_shmtx.c b/vendor/nginx-1.7.4/src/core/ngx_shmtx.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_shmtx.c
rename to vendor/nginx-1.7.4/src/core/ngx_shmtx.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_shmtx.h b/vendor/nginx-1.7.4/src/core/ngx_shmtx.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_shmtx.h
rename to vendor/nginx-1.7.4/src/core/ngx_shmtx.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_slab.c b/vendor/nginx-1.7.4/src/core/ngx_slab.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/core/ngx_slab.c
rename to vendor/nginx-1.7.4/src/core/ngx_slab.c
index 24f2ff16a..c1125062a 100644
--- a/vendor/nginx-1.7.3/src/core/ngx_slab.c
+++ b/vendor/nginx-1.7.4/src/core/ngx_slab.c
@@ -160,7 +160,7 @@ ngx_slab_alloc_locked(ngx_slab_pool_t *pool, size_t size)
     ngx_uint_t        i, slot, shift, map;
     ngx_slab_page_t  *page, *prev, *slots;
 
-    if (size >= ngx_slab_max_size) {
+    if (size > ngx_slab_max_size) {
 
         ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, ngx_cycle->log, 0,
                        "slab alloc: %uz", size);
diff --git a/vendor/nginx-1.7.3/src/core/ngx_slab.h b/vendor/nginx-1.7.4/src/core/ngx_slab.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_slab.h
rename to vendor/nginx-1.7.4/src/core/ngx_slab.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_spinlock.c b/vendor/nginx-1.7.4/src/core/ngx_spinlock.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_spinlock.c
rename to vendor/nginx-1.7.4/src/core/ngx_spinlock.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_string.c b/vendor/nginx-1.7.4/src/core/ngx_string.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/core/ngx_string.c
rename to vendor/nginx-1.7.4/src/core/ngx_string.c
index 4e279176c..9d854fa0e 100644
--- a/vendor/nginx-1.7.3/src/core/ngx_string.c
+++ b/vendor/nginx-1.7.4/src/core/ngx_string.c
@@ -1407,7 +1407,7 @@ ngx_escape_uri(u_char *dst, u_char *src, size_t size, ngx_uint_t type)
 {
     ngx_uint_t      n;
     uint32_t       *escape;
-    static u_char   hex[] = "0123456789abcdef";
+    static u_char   hex[] = "0123456789ABCDEF";
 
                     /* " ", "#", "%", "?", %00-%1F, %7F-%FF */
 
diff --git a/vendor/nginx-1.7.3/src/core/ngx_string.h b/vendor/nginx-1.7.4/src/core/ngx_string.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_string.h
rename to vendor/nginx-1.7.4/src/core/ngx_string.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_syslog.c b/vendor/nginx-1.7.4/src/core/ngx_syslog.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_syslog.c
rename to vendor/nginx-1.7.4/src/core/ngx_syslog.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_syslog.h b/vendor/nginx-1.7.4/src/core/ngx_syslog.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_syslog.h
rename to vendor/nginx-1.7.4/src/core/ngx_syslog.h
diff --git a/vendor/nginx-1.7.3/src/core/ngx_times.c b/vendor/nginx-1.7.4/src/core/ngx_times.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_times.c
rename to vendor/nginx-1.7.4/src/core/ngx_times.c
diff --git a/vendor/nginx-1.7.3/src/core/ngx_times.h b/vendor/nginx-1.7.4/src/core/ngx_times.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/core/ngx_times.h
rename to vendor/nginx-1.7.4/src/core/ngx_times.h
diff --git a/vendor/nginx-1.7.3/src/event/modules/ngx_aio_module.c b/vendor/nginx-1.7.4/src/event/modules/ngx_aio_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/modules/ngx_aio_module.c
rename to vendor/nginx-1.7.4/src/event/modules/ngx_aio_module.c
diff --git a/vendor/nginx-1.7.3/src/event/modules/ngx_devpoll_module.c b/vendor/nginx-1.7.4/src/event/modules/ngx_devpoll_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/modules/ngx_devpoll_module.c
rename to vendor/nginx-1.7.4/src/event/modules/ngx_devpoll_module.c
diff --git a/vendor/nginx-1.7.3/src/event/modules/ngx_epoll_module.c b/vendor/nginx-1.7.4/src/event/modules/ngx_epoll_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/modules/ngx_epoll_module.c
rename to vendor/nginx-1.7.4/src/event/modules/ngx_epoll_module.c
diff --git a/vendor/nginx-1.7.3/src/event/modules/ngx_eventport_module.c b/vendor/nginx-1.7.4/src/event/modules/ngx_eventport_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/modules/ngx_eventport_module.c
rename to vendor/nginx-1.7.4/src/event/modules/ngx_eventport_module.c
diff --git a/vendor/nginx-1.7.3/src/event/modules/ngx_kqueue_module.c b/vendor/nginx-1.7.4/src/event/modules/ngx_kqueue_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/modules/ngx_kqueue_module.c
rename to vendor/nginx-1.7.4/src/event/modules/ngx_kqueue_module.c
diff --git a/vendor/nginx-1.7.3/src/event/modules/ngx_poll_module.c b/vendor/nginx-1.7.4/src/event/modules/ngx_poll_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/modules/ngx_poll_module.c
rename to vendor/nginx-1.7.4/src/event/modules/ngx_poll_module.c
diff --git a/vendor/nginx-1.7.3/src/event/modules/ngx_rtsig_module.c b/vendor/nginx-1.7.4/src/event/modules/ngx_rtsig_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/modules/ngx_rtsig_module.c
rename to vendor/nginx-1.7.4/src/event/modules/ngx_rtsig_module.c
diff --git a/vendor/nginx-1.7.3/src/event/modules/ngx_select_module.c b/vendor/nginx-1.7.4/src/event/modules/ngx_select_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/modules/ngx_select_module.c
rename to vendor/nginx-1.7.4/src/event/modules/ngx_select_module.c
diff --git a/vendor/nginx-1.7.3/src/event/modules/ngx_win32_select_module.c b/vendor/nginx-1.7.4/src/event/modules/ngx_win32_select_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/modules/ngx_win32_select_module.c
rename to vendor/nginx-1.7.4/src/event/modules/ngx_win32_select_module.c
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event.c b/vendor/nginx-1.7.4/src/event/ngx_event.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event.c
rename to vendor/nginx-1.7.4/src/event/ngx_event.c
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event.h b/vendor/nginx-1.7.4/src/event/ngx_event.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event.h
rename to vendor/nginx-1.7.4/src/event/ngx_event.h
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_accept.c b/vendor/nginx-1.7.4/src/event/ngx_event_accept.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_accept.c
rename to vendor/nginx-1.7.4/src/event/ngx_event_accept.c
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_busy_lock.c b/vendor/nginx-1.7.4/src/event/ngx_event_busy_lock.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_busy_lock.c
rename to vendor/nginx-1.7.4/src/event/ngx_event_busy_lock.c
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_busy_lock.h b/vendor/nginx-1.7.4/src/event/ngx_event_busy_lock.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_busy_lock.h
rename to vendor/nginx-1.7.4/src/event/ngx_event_busy_lock.h
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_connect.c b/vendor/nginx-1.7.4/src/event/ngx_event_connect.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_connect.c
rename to vendor/nginx-1.7.4/src/event/ngx_event_connect.c
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_connect.h b/vendor/nginx-1.7.4/src/event/ngx_event_connect.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_connect.h
rename to vendor/nginx-1.7.4/src/event/ngx_event_connect.h
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_mutex.c b/vendor/nginx-1.7.4/src/event/ngx_event_mutex.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_mutex.c
rename to vendor/nginx-1.7.4/src/event/ngx_event_mutex.c
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_openssl.c b/vendor/nginx-1.7.4/src/event/ngx_event_openssl.c
similarity index 97%
rename from vendor/nginx-1.7.3/src/event/ngx_event_openssl.c
rename to vendor/nginx-1.7.4/src/event/ngx_event_openssl.c
index 50691ade7..bb82143d3 100644
--- a/vendor/nginx-1.7.3/src/event/ngx_event_openssl.c
+++ b/vendor/nginx-1.7.4/src/event/ngx_event_openssl.c
@@ -50,7 +50,7 @@ static int ngx_ssl_session_ticket_key_callback(ngx_ssl_conn_t *ssl_conn,
     HMAC_CTX *hctx, int enc);
 #endif
 
-#if OPENSSL_VERSION_NUMBER < 0x10002001L
+#if (OPENSSL_VERSION_NUMBER < 0x10002002L || defined LIBRESSL_VERSION_NUMBER)
 static ngx_int_t ngx_ssl_check_name(ngx_str_t *name, ASN1_STRING *str);
 #endif
 
@@ -106,7 +106,9 @@ int  ngx_ssl_stapling_index;
 ngx_int_t
 ngx_ssl_init(ngx_log_t *log)
 {
+#ifndef OPENSSL_IS_BORINGSSL
     OPENSSL_config(NULL);
+#endif
 
     SSL_library_init();
     SSL_load_error_strings();
@@ -217,7 +219,10 @@ ngx_ssl_create(ngx_ssl_t *ssl, ngx_uint_t protocols, void *data)
     SSL_CTX_set_options(ssl->ctx, SSL_OP_MSIE_SSLV2_RSA_PADDING);
 #endif
 
+#ifdef SSL_OP_SSLEAY_080_CLIENT_DH_BUG
     SSL_CTX_set_options(ssl->ctx, SSL_OP_SSLEAY_080_CLIENT_DH_BUG);
+#endif
+
     SSL_CTX_set_options(ssl->ctx, SSL_OP_TLS_D5_BUG);
     SSL_CTX_set_options(ssl->ctx, SSL_OP_TLS_BLOCK_PADDING_BUG);
 
@@ -382,8 +387,13 @@ ngx_ssl_certificate(ngx_conf_t *cf, ngx_ssl_t *ssl, ngx_str_t *cert,
         if (--tries) {
             n = ERR_peek_error();
 
+#ifdef OPENSSL_IS_BORINGSSL
+            if (ERR_GET_LIB(n) == ERR_LIB_CIPHER
+                && ERR_GET_REASON(n) == CIPHER_R_BAD_DECRYPT)
+#else
             if (ERR_GET_LIB(n) == ERR_LIB_EVP
                 && ERR_GET_REASON(n) == EVP_R_BAD_DECRYPT)
+#endif
             {
                 ERR_clear_error();
                 SSL_CTX_set_default_passwd_cb_userdata(ssl->ctx, ++pwd);
@@ -588,7 +598,7 @@ ngx_ssl_verify_callback(int ok, X509_STORE_CTX *x509_store)
 
     ngx_log_debug5(NGX_LOG_DEBUG_EVENT, c->log, 0,
                    "verify:%d, error:%d, depth:%d, "
-                   "subject:\"%s\",issuer: \"%s\"",
+                   "subject:\"%s\", issuer:\"%s\"",
                    ok, err, depth, subject, issuer);
 
     if (sname) {
@@ -652,12 +662,18 @@ ngx_ssl_rsa512_key_callback(ngx_ssl_conn_t *ssl_conn, int is_export,
 {
     static RSA  *key;
 
-    if (key_length == 512) {
-        if (key == NULL) {
-            key = RSA_generate_key(512, RSA_F4, NULL, NULL);
-        }
+    if (key_length != 512) {
+        return NULL;
+    }
+
+#ifndef OPENSSL_NO_DEPRECATED
+
+    if (key == NULL) {
+        key = RSA_generate_key(512, RSA_F4, NULL, NULL);
     }
 
+#endif
+
     return key;
 }
 
@@ -2072,9 +2088,10 @@ static int
 ngx_ssl_new_session(ngx_ssl_conn_t *ssl_conn, ngx_ssl_session_t *sess)
 {
     int                       len;
-    u_char                   *p, *id, *cached_sess;
+    u_char                   *p, *id, *cached_sess, *session_id;
     uint32_t                  hash;
     SSL_CTX                  *ssl_ctx;
+    unsigned int              session_id_length;
     ngx_shm_zone_t           *shm_zone;
     ngx_connection_t         *c;
     ngx_slab_pool_t          *shpool;
@@ -2137,13 +2154,24 @@ ngx_ssl_new_session(ngx_ssl_conn_t *ssl_conn, ngx_ssl_session_t *sess)
         }
     }
 
+#if OPENSSL_VERSION_NUMBER >= 0x0090800fL
+
+    session_id = (u_char *) SSL_SESSION_get_id(sess, &session_id_length);
+
+#else
+
+    session_id = sess->session_id;
+    session_id_length = sess->session_id_length;
+
+#endif
+
 #if (NGX_PTR_SIZE == 8)
 
     id = sess_id->sess_id;
 
 #else
 
-    id = ngx_slab_alloc_locked(shpool, sess->session_id_length);
+    id = ngx_slab_alloc_locked(shpool, session_id_length);
 
     if (id == NULL) {
 
@@ -2151,7 +2179,7 @@ ngx_ssl_new_session(ngx_ssl_conn_t *ssl_conn, ngx_ssl_session_t *sess)
 
         ngx_ssl_expire_sessions(cache, shpool, 0);
 
-        id = ngx_slab_alloc_locked(shpool, sess->session_id_length);
+        id = ngx_slab_alloc_locked(shpool, session_id_length);
 
         if (id == NULL) {
             goto failed;
@@ -2162,16 +2190,16 @@ ngx_ssl_new_session(ngx_ssl_conn_t *ssl_conn, ngx_ssl_session_t *sess)
 
     ngx_memcpy(cached_sess, buf, len);
 
-    ngx_memcpy(id, sess->session_id, sess->session_id_length);
+    ngx_memcpy(id, session_id, session_id_length);
 
-    hash = ngx_crc32_short(sess->session_id, sess->session_id_length);
+    hash = ngx_crc32_short(session_id, session_id_length);
 
     ngx_log_debug3(NGX_LOG_DEBUG_EVENT, c->log, 0,
-                   "ssl new session: %08XD:%d:%d",
-                   hash, sess->session_id_length, len);
+                   "ssl new session: %08XD:%ud:%d",
+                   hash, session_id_length, len);
 
     sess_id->node.key = hash;
-    sess_id->node.data = (u_char) sess->session_id_length;
+    sess_id->node.data = (u_char) session_id_length;
     sess_id->id = id;
     sess_id->len = len;
     sess_id->session = cached_sess;
@@ -2319,10 +2347,10 @@ ngx_ssl_remove_cached_session(SSL_CTX *ssl, ngx_ssl_session_t *sess)
 static void
 ngx_ssl_remove_session(SSL_CTX *ssl, ngx_ssl_session_t *sess)
 {
-    size_t                    len;
     u_char                   *id;
     uint32_t                  hash;
     ngx_int_t                 rc;
+    unsigned int              len;
     ngx_shm_zone_t           *shm_zone;
     ngx_slab_pool_t          *shpool;
     ngx_rbtree_node_t        *node, *sentinel;
@@ -2337,13 +2365,21 @@ ngx_ssl_remove_session(SSL_CTX *ssl, ngx_ssl_session_t *sess)
 
     cache = shm_zone->data;
 
+#if OPENSSL_VERSION_NUMBER >= 0x0090800fL
+
+    id = (u_char *) SSL_SESSION_get_id(sess, &len);
+
+#else
+
     id = sess->session_id;
-    len = (size_t) sess->session_id_length;
+    len = sess->session_id_length;
+
+#endif
 
     hash = ngx_crc32_short(id, len);
 
     ngx_log_debug2(NGX_LOG_DEBUG_EVENT, ngx_cycle->log, 0,
-                   "ssl remove session: %08XD:%uz", hash, len);
+                   "ssl remove session: %08XD:%ud", hash, len);
 
     shpool = (ngx_slab_pool_t *) shm_zone->shm.addr;
 
@@ -2638,7 +2674,7 @@ ngx_ssl_session_ticket_key_callback(ngx_ssl_conn_t *ssl_conn,
         EVP_EncryptInit_ex(ectx, EVP_aes_128_cbc(), NULL, key[0].aes_key, iv);
         HMAC_Init_ex(hctx, key[0].hmac_key, 16,
                      ngx_ssl_session_ticket_md(), NULL);
-        memcpy(name, key[0].name, 16);
+        ngx_memcpy(name, key[0].name, 16);
 
         return 0;
 
@@ -2707,7 +2743,7 @@ ngx_ssl_check_host(ngx_connection_t *c, ngx_str_t *name)
         return NGX_ERROR;
     }
 
-#if OPENSSL_VERSION_NUMBER >= 0x10002001L
+#if (OPENSSL_VERSION_NUMBER >= 0x10002002L && !defined LIBRESSL_VERSION_NUMBER)
 
     /* X509_check_host() is only available in OpenSSL 1.0.2+ */
 
@@ -2715,7 +2751,7 @@ ngx_ssl_check_host(ngx_connection_t *c, ngx_str_t *name)
         goto failed;
     }
 
-    if (X509_check_host(cert, name->data, name->len, 0) != 1) {
+    if (X509_check_host(cert, (char *) name->data, name->len, 0, NULL) != 1) {
         ngx_log_debug0(NGX_LOG_DEBUG_EVENT, c->log, 0,
                        "X509_check_host(): no match");
         goto failed;
@@ -2824,7 +2860,7 @@ found:
 }
 
 
-#if OPENSSL_VERSION_NUMBER < 0x10002001L
+#if (OPENSSL_VERSION_NUMBER < 0x10002002L || defined LIBRESSL_VERSION_NUMBER)
 
 static ngx_int_t
 ngx_ssl_check_name(ngx_str_t *name, ASN1_STRING *pattern)
@@ -2885,9 +2921,9 @@ ngx_ssl_get_cipher_name(ngx_connection_t *c, ngx_pool_t *pool, ngx_str_t *s)
 ngx_int_t
 ngx_ssl_get_session_id(ngx_connection_t *c, ngx_pool_t *pool, ngx_str_t *s)
 {
-    int           len;
-    u_char       *buf;
-    SSL_SESSION  *sess;
+    u_char        *buf;
+    SSL_SESSION   *sess;
+    unsigned int   len;
 
     sess = SSL_get0_session(c->ssl->connection);
     if (sess == NULL) {
@@ -2895,9 +2931,17 @@ ngx_ssl_get_session_id(ngx_connection_t *c, ngx_pool_t *pool, ngx_str_t *s)
         return NGX_OK;
     }
 
+#if OPENSSL_VERSION_NUMBER >= 0x0090800fL
+
+    buf = (u_char *) SSL_SESSION_get_id(sess, &len);
+
+#else
+
     buf = sess->session_id;
     len = sess->session_id_length;
 
+#endif
+
     s->len = 2 * len;
     s->data = ngx_pnalloc(pool, 2 * len);
     if (s->data == NULL) {
@@ -3245,6 +3289,8 @@ ngx_openssl_create_conf(ngx_cycle_t *cycle)
 static char *
 ngx_openssl_engine(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
 {
+#ifndef OPENSSL_NO_ENGINE
+
     ngx_openssl_conf_t *oscf = conf;
 
     ENGINE     *engine;
@@ -3279,6 +3325,12 @@ ngx_openssl_engine(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
     ENGINE_free(engine);
 
     return NGX_CONF_OK;
+
+#else
+
+    return "is not supported";
+
+#endif
 }
 
 
@@ -3286,5 +3338,7 @@ static void
 ngx_openssl_exit(ngx_cycle_t *cycle)
 {
     EVP_cleanup();
+#ifndef OPENSSL_NO_ENGINE
     ENGINE_cleanup();
+#endif
 }
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_openssl.h b/vendor/nginx-1.7.4/src/event/ngx_event_openssl.h
similarity index 96%
rename from vendor/nginx-1.7.3/src/event/ngx_event_openssl.h
rename to vendor/nginx-1.7.4/src/event/ngx_event_openssl.h
index 0194602f6..408694035 100644
--- a/vendor/nginx-1.7.3/src/event/ngx_event_openssl.h
+++ b/vendor/nginx-1.7.4/src/event/ngx_event_openssl.h
@@ -14,10 +14,21 @@
 
 #include <openssl/ssl.h>
 #include <openssl/err.h>
+#include <openssl/bn.h>
 #include <openssl/conf.h>
+#include <openssl/crypto.h>
+#include <openssl/dh.h>
+#ifndef OPENSSL_NO_ENGINE
 #include <openssl/engine.h>
+#endif
 #include <openssl/evp.h>
+#ifndef OPENSSL_NO_OCSP
 #include <openssl/ocsp.h>
+#endif
+#include <openssl/rand.h>
+#include <openssl/rsa.h>
+#include <openssl/x509.h>
+#include <openssl/x509v3.h>
 
 #define NGX_SSL_NAME     "OpenSSL"
 
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_openssl_stapling.c b/vendor/nginx-1.7.4/src/event/ngx_event_openssl_stapling.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/event/ngx_event_openssl_stapling.c
rename to vendor/nginx-1.7.4/src/event/ngx_event_openssl_stapling.c
index 69340b37b..2fa067309 100644
--- a/vendor/nginx-1.7.3/src/event/ngx_event_openssl_stapling.c
+++ b/vendor/nginx-1.7.4/src/event/ngx_event_openssl_stapling.c
@@ -11,7 +11,7 @@
 #include <ngx_event_connect.h>
 
 
-#ifdef SSL_CTRL_SET_TLSEXT_STATUS_REQ_CB
+#if (!defined OPENSSL_NO_OCSP && defined SSL_CTRL_SET_TLSEXT_STATUS_REQ_CB)
 
 
 typedef struct {
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_pipe.c b/vendor/nginx-1.7.4/src/event/ngx_event_pipe.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_pipe.c
rename to vendor/nginx-1.7.4/src/event/ngx_event_pipe.c
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_pipe.h b/vendor/nginx-1.7.4/src/event/ngx_event_pipe.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_pipe.h
rename to vendor/nginx-1.7.4/src/event/ngx_event_pipe.h
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_posted.c b/vendor/nginx-1.7.4/src/event/ngx_event_posted.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_posted.c
rename to vendor/nginx-1.7.4/src/event/ngx_event_posted.c
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_posted.h b/vendor/nginx-1.7.4/src/event/ngx_event_posted.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_posted.h
rename to vendor/nginx-1.7.4/src/event/ngx_event_posted.h
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_timer.c b/vendor/nginx-1.7.4/src/event/ngx_event_timer.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_timer.c
rename to vendor/nginx-1.7.4/src/event/ngx_event_timer.c
diff --git a/vendor/nginx-1.7.3/src/event/ngx_event_timer.h b/vendor/nginx-1.7.4/src/event/ngx_event_timer.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/event/ngx_event_timer.h
rename to vendor/nginx-1.7.4/src/event/ngx_event_timer.h
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_access_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_access_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_access_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_access_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_addition_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_addition_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_addition_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_addition_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_auth_basic_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_auth_basic_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_auth_basic_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_auth_basic_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_auth_request_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_auth_request_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_auth_request_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_auth_request_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_autoindex_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_autoindex_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_autoindex_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_autoindex_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_browser_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_browser_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_browser_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_browser_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_charset_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_charset_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_charset_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_charset_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_chunked_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_chunked_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_chunked_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_chunked_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_dav_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_dav_module.c
similarity index 98%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_dav_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_dav_module.c
index e7f9e9ae3..529aba533 100644
--- a/vendor/nginx-1.7.3/src/http/modules/ngx_http_dav_module.c
+++ b/vendor/nginx-1.7.4/src/http/modules/ngx_http_dav_module.c
@@ -212,7 +212,10 @@ ngx_http_dav_put_handler(ngx_http_request_t *r)
         return;
     }
 
-    ngx_http_map_uri_to_path(r, &path, &root, 0);
+    if (ngx_http_map_uri_to_path(r, &path, &root, 0) == NULL) {
+        ngx_http_finalize_request(r, NGX_HTTP_INTERNAL_SERVER_ERROR);
+        return;
+    }
 
     path.len--;
 
@@ -320,7 +323,9 @@ ngx_http_dav_delete_handler(ngx_http_request_t *r)
 
 ok:
 
-    ngx_http_map_uri_to_path(r, &path, &root, 0);
+    if (ngx_http_map_uri_to_path(r, &path, &root, 0) == NULL) {
+        return NGX_HTTP_INTERNAL_SERVER_ERROR;
+    }
 
     ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r->connection->log, 0,
                    "http delete filename: \"%s\"", path.data);
@@ -488,6 +493,9 @@ ngx_http_dav_mkcol_handler(ngx_http_request_t *r, ngx_http_dav_loc_conf_t *dlcf)
     }
 
     p = ngx_http_map_uri_to_path(r, &path, &root, 0);
+    if (p == NULL) {
+        return NGX_HTTP_INTERNAL_SERVER_ERROR;
+    }
 
     *(p - 1) = '\0';
     r->uri.len--;
@@ -666,7 +674,9 @@ destination_done:
 
 overwrite_done:
 
-    ngx_http_map_uri_to_path(r, &path, &root, 0);
+    if (ngx_http_map_uri_to_path(r, &path, &root, 0) == NULL) {
+        return NGX_HTTP_INTERNAL_SERVER_ERROR;
+    }
 
     ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r->connection->log, 0,
                    "http copy from: \"%s\"", path.data);
@@ -674,7 +684,9 @@ overwrite_done:
     uri = r->uri;
     r->uri = duri;
 
-    ngx_http_map_uri_to_path(r, &copy.path, &root, 0);
+    if (ngx_http_map_uri_to_path(r, &copy.path, &root, 0) == NULL) {
+        return NGX_HTTP_INTERNAL_SERVER_ERROR;
+    }
 
     r->uri = uri;
 
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_degradation_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_degradation_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_degradation_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_degradation_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_empty_gif_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_empty_gif_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_empty_gif_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_empty_gif_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_fastcgi_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_fastcgi_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_fastcgi_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_fastcgi_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_flv_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_flv_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_flv_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_flv_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_geo_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_geo_module.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_geo_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_geo_module.c
index 34c3b190d..9b3c6cb9c 100644
--- a/vendor/nginx-1.7.3/src/http/modules/ngx_http_geo_module.c
+++ b/vendor/nginx-1.7.4/src/http/modules/ngx_http_geo_module.c
@@ -1470,7 +1470,7 @@ ngx_http_geo_include_binary_base(ngx_conf_t *cf, ngx_http_geo_conf_ctx_t *ctx,
 
     vv = (ngx_http_variable_value_t *) (base + sizeof(ngx_http_geo_header_t));
 
-    while(vv->data) {
+    while (vv->data) {
         len = ngx_align(sizeof(ngx_http_variable_value_t) + vv->len,
                         sizeof(void *));
         ngx_crc32_update(&crc32, (u_char *) vv, len);
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_geoip_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_geoip_module.c
similarity index 98%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_geoip_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_geoip_module.c
index 576fc5f3c..8e151aa8f 100644
--- a/vendor/nginx-1.7.3/src/http/modules/ngx_http_geoip_module.c
+++ b/vendor/nginx-1.7.4/src/http/modules/ngx_http_geoip_module.c
@@ -553,6 +553,9 @@ ngx_http_geoip_city_float_variable(ngx_http_request_t *r,
     val = *(float *) ((char *) gr + data);
 
     v->len = ngx_sprintf(v->data, "%.4f", val) - v->data;
+    v->valid = 1;
+    v->no_cacheable = 0;
+    v->not_found = 0;
 
     GeoIPRecord_delete(gr);
 
@@ -582,6 +585,9 @@ ngx_http_geoip_city_int_variable(ngx_http_request_t *r,
     val = *(int *) ((char *) gr + data);
 
     v->len = ngx_sprintf(v->data, "%d", val) - v->data;
+    v->valid = 1;
+    v->no_cacheable = 0;
+    v->not_found = 0;
 
     GeoIPRecord_delete(gr);
 
@@ -691,7 +697,7 @@ ngx_http_geoip_country(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
 
     if (cf->args->nelts == 3) {
         if (ngx_strcmp(value[2].data, "utf8") == 0) {
-            GeoIP_set_charset (gcf->country, GEOIP_CHARSET_UTF8);
+            GeoIP_set_charset(gcf->country, GEOIP_CHARSET_UTF8);
 
         } else {
             ngx_conf_log_error(NGX_LOG_EMERG, cf, 0,
@@ -746,7 +752,7 @@ ngx_http_geoip_org(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
 
     if (cf->args->nelts == 3) {
         if (ngx_strcmp(value[2].data, "utf8") == 0) {
-            GeoIP_set_charset (gcf->org, GEOIP_CHARSET_UTF8);
+            GeoIP_set_charset(gcf->org, GEOIP_CHARSET_UTF8);
 
         } else {
             ngx_conf_log_error(NGX_LOG_EMERG, cf, 0,
@@ -807,7 +813,7 @@ ngx_http_geoip_city(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
 
     if (cf->args->nelts == 3) {
         if (ngx_strcmp(value[2].data, "utf8") == 0) {
-            GeoIP_set_charset (gcf->city, GEOIP_CHARSET_UTF8);
+            GeoIP_set_charset(gcf->city, GEOIP_CHARSET_UTF8);
 
         } else {
             ngx_conf_log_error(NGX_LOG_EMERG, cf, 0,
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_gunzip_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_gunzip_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_gunzip_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_gunzip_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_gzip_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_gzip_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_gzip_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_gzip_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_gzip_static_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_gzip_static_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_gzip_static_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_gzip_static_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_headers_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_headers_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_headers_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_headers_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_image_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_image_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_image_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_image_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_index_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_index_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_index_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_index_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_limit_conn_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_limit_conn_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_limit_conn_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_limit_conn_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_limit_req_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_limit_req_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_limit_req_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_limit_req_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_log_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_log_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_log_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_log_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_map_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_map_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_map_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_map_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_memcached_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_memcached_module.c
similarity index 98%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_memcached_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_memcached_module.c
index aaa047e8f..bda038da4 100644
--- a/vendor/nginx-1.7.3/src/http/modules/ngx_http_memcached_module.c
+++ b/vendor/nginx-1.7.4/src/http/modules/ngx_http_memcached_module.c
@@ -380,11 +380,8 @@ found:
             }
 
             h->hash = 1;
-            h->key.len = sizeof("Content-Encoding") - 1;
-            h->key.data = (u_char *) "Content-Encoding";
-            h->value.len = sizeof("gzip") - 1;
-            h->value.data = (u_char *) "gzip";
-
+            ngx_str_set(&h->key, "Content-Encoding");
+            ngx_str_set(&h->value, "gzip");
             r->headers_out.content_encoding = h;
         }
 
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_mp4_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_mp4_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_mp4_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_mp4_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_not_modified_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_not_modified_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_not_modified_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_not_modified_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_proxy_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_proxy_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_proxy_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_proxy_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_random_index_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_random_index_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_random_index_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_random_index_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_range_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_range_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_range_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_range_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_realip_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_realip_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_realip_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_realip_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_referer_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_referer_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_referer_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_referer_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_rewrite_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_rewrite_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_rewrite_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_rewrite_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_scgi_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_scgi_module.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_scgi_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_scgi_module.c
index d3a8f11b6..0be5066ec 100644
--- a/vendor/nginx-1.7.3/src/http/modules/ngx_http_scgi_module.c
+++ b/vendor/nginx-1.7.4/src/http/modules/ngx_http_scgi_module.c
@@ -1645,7 +1645,7 @@ ngx_http_scgi_pass(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
         return "is duplicate";
     }
 
-    clcf = ngx_http_conf_get_module_loc_conf (cf, ngx_http_core_module);
+    clcf = ngx_http_conf_get_module_loc_conf(cf, ngx_http_core_module);
     clcf->handler = ngx_http_scgi_handler;
 
     value = cf->args->elts;
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_secure_link_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_secure_link_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_secure_link_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_secure_link_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_split_clients_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_split_clients_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_split_clients_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_split_clients_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_ssi_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_ssi_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_ssi_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_ssi_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_ssi_filter_module.h b/vendor/nginx-1.7.4/src/http/modules/ngx_http_ssi_filter_module.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_ssi_filter_module.h
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_ssi_filter_module.h
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_ssl_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_ssl_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_ssl_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_ssl_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_ssl_module.h b/vendor/nginx-1.7.4/src/http/modules/ngx_http_ssl_module.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_ssl_module.h
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_ssl_module.h
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_static_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_static_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_static_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_static_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_stub_status_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_stub_status_module.c
similarity index 93%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_stub_status_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_stub_status_module.c
index b5ecd6d9e..f4f5888b6 100644
--- a/vendor/nginx-1.7.3/src/http/modules/ngx_http_stub_status_module.c
+++ b/vendor/nginx-1.7.4/src/http/modules/ngx_http_stub_status_module.c
@@ -10,18 +10,19 @@
 #include <ngx_http.h>
 
 
+static ngx_int_t ngx_http_stub_status_handler(ngx_http_request_t *r);
 static ngx_int_t ngx_http_stub_status_variable(ngx_http_request_t *r,
     ngx_http_variable_value_t *v, uintptr_t data);
 static ngx_int_t ngx_http_stub_status_add_variables(ngx_conf_t *cf);
+static char *ngx_http_set_stub_status(ngx_conf_t *cf, ngx_command_t *cmd,
+    void *conf);
 
-static char *ngx_http_set_status(ngx_conf_t *cf, ngx_command_t *cmd,
-                                 void *conf);
 
 static ngx_command_t  ngx_http_status_commands[] = {
 
     { ngx_string("stub_status"),
       NGX_HTTP_SRV_CONF|NGX_HTTP_LOC_CONF|NGX_CONF_FLAG,
-      ngx_http_set_status,
+      ngx_http_set_stub_status,
       0,
       0,
       NULL },
@@ -30,7 +31,6 @@ static ngx_command_t  ngx_http_status_commands[] = {
 };
 
 
-
 static ngx_http_module_t  ngx_http_stub_status_module_ctx = {
     ngx_http_stub_status_add_variables,    /* preconfiguration */
     NULL,                                  /* postconfiguration */
@@ -80,7 +80,8 @@ static ngx_http_variable_t  ngx_http_stub_status_vars[] = {
 };
 
 
-static ngx_int_t ngx_http_status_handler(ngx_http_request_t *r)
+static ngx_int_t
+ngx_http_stub_status_handler(ngx_http_request_t *r)
 {
     size_t             size;
     ngx_int_t          rc;
@@ -223,12 +224,13 @@ ngx_http_stub_status_add_variables(ngx_conf_t *cf)
 }
 
 
-static char *ngx_http_set_status(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
+static char *
+ngx_http_set_stub_status(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
 {
     ngx_http_core_loc_conf_t  *clcf;
 
     clcf = ngx_http_conf_get_module_loc_conf(cf, ngx_http_core_module);
-    clcf->handler = ngx_http_status_handler;
+    clcf->handler = ngx_http_stub_status_handler;
 
     return NGX_CONF_OK;
 }
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_sub_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_sub_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_sub_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_sub_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_upstream_hash_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_upstream_hash_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_upstream_hash_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_upstream_hash_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_upstream_ip_hash_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_upstream_ip_hash_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_upstream_ip_hash_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_upstream_ip_hash_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_upstream_keepalive_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_upstream_keepalive_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_upstream_keepalive_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_upstream_keepalive_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_upstream_least_conn_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_upstream_least_conn_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_upstream_least_conn_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_upstream_least_conn_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_userid_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_userid_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_userid_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_userid_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_uwsgi_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_uwsgi_module.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_uwsgi_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_uwsgi_module.c
index 588b13547..a613b684a 100644
--- a/vendor/nginx-1.7.3/src/http/modules/ngx_http_uwsgi_module.c
+++ b/vendor/nginx-1.7.4/src/http/modules/ngx_http_uwsgi_module.c
@@ -1868,7 +1868,7 @@ ngx_http_uwsgi_pass(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
         return "is duplicate";
     }
 
-    clcf = ngx_http_conf_get_module_loc_conf (cf, ngx_http_core_module);
+    clcf = ngx_http_conf_get_module_loc_conf(cf, ngx_http_core_module);
     clcf->handler = ngx_http_uwsgi_handler;
 
     value = cf->args->elts;
diff --git a/vendor/nginx-1.7.3/src/http/modules/ngx_http_xslt_filter_module.c b/vendor/nginx-1.7.4/src/http/modules/ngx_http_xslt_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/ngx_http_xslt_filter_module.c
rename to vendor/nginx-1.7.4/src/http/modules/ngx_http_xslt_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/perl/Makefile.PL b/vendor/nginx-1.7.4/src/http/modules/perl/Makefile.PL
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/perl/Makefile.PL
rename to vendor/nginx-1.7.4/src/http/modules/perl/Makefile.PL
diff --git a/vendor/nginx-1.7.3/src/http/modules/perl/nginx.pm b/vendor/nginx-1.7.4/src/http/modules/perl/nginx.pm
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/perl/nginx.pm
rename to vendor/nginx-1.7.4/src/http/modules/perl/nginx.pm
diff --git a/vendor/nginx-1.7.3/src/http/modules/perl/nginx.xs b/vendor/nginx-1.7.4/src/http/modules/perl/nginx.xs
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/perl/nginx.xs
rename to vendor/nginx-1.7.4/src/http/modules/perl/nginx.xs
diff --git a/vendor/nginx-1.7.3/src/http/modules/perl/ngx_http_perl_module.c b/vendor/nginx-1.7.4/src/http/modules/perl/ngx_http_perl_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/perl/ngx_http_perl_module.c
rename to vendor/nginx-1.7.4/src/http/modules/perl/ngx_http_perl_module.c
diff --git a/vendor/nginx-1.7.3/src/http/modules/perl/ngx_http_perl_module.h b/vendor/nginx-1.7.4/src/http/modules/perl/ngx_http_perl_module.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/perl/ngx_http_perl_module.h
rename to vendor/nginx-1.7.4/src/http/modules/perl/ngx_http_perl_module.h
diff --git a/vendor/nginx-1.7.3/src/http/modules/perl/typemap b/vendor/nginx-1.7.4/src/http/modules/perl/typemap
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/modules/perl/typemap
rename to vendor/nginx-1.7.4/src/http/modules/perl/typemap
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http.c b/vendor/nginx-1.7.4/src/http/ngx_http.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http.c
rename to vendor/nginx-1.7.4/src/http/ngx_http.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http.h b/vendor/nginx-1.7.4/src/http/ngx_http.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http.h
rename to vendor/nginx-1.7.4/src/http/ngx_http.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_busy_lock.c b/vendor/nginx-1.7.4/src/http/ngx_http_busy_lock.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_busy_lock.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_busy_lock.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_busy_lock.h b/vendor/nginx-1.7.4/src/http/ngx_http_busy_lock.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_busy_lock.h
rename to vendor/nginx-1.7.4/src/http/ngx_http_busy_lock.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_cache.h b/vendor/nginx-1.7.4/src/http/ngx_http_cache.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_cache.h
rename to vendor/nginx-1.7.4/src/http/ngx_http_cache.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_config.h b/vendor/nginx-1.7.4/src/http/ngx_http_config.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_config.h
rename to vendor/nginx-1.7.4/src/http/ngx_http_config.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_copy_filter_module.c b/vendor/nginx-1.7.4/src/http/ngx_http_copy_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_copy_filter_module.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_copy_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_core_module.c b/vendor/nginx-1.7.4/src/http/ngx_http_core_module.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/http/ngx_http_core_module.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_core_module.c
index 2947ad32a..4071b6126 100644
--- a/vendor/nginx-1.7.3/src/http/ngx_http_core_module.c
+++ b/vendor/nginx-1.7.4/src/http/ngx_http_core_module.c
@@ -2355,7 +2355,7 @@ ngx_http_gzip_accept_encoding(ngx_str_t *ae)
     p += 4;
 
     while (p < last) {
-        switch(*p++) {
+        switch (*p++) {
         case ',':
             return NGX_OK;
         case ';':
@@ -2372,7 +2372,7 @@ ngx_http_gzip_accept_encoding(ngx_str_t *ae)
 quantity:
 
     while (p < last) {
-        switch(*p++) {
+        switch (*p++) {
         case 'q':
         case 'Q':
             goto equal;
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_core_module.h b/vendor/nginx-1.7.4/src/http/ngx_http_core_module.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_core_module.h
rename to vendor/nginx-1.7.4/src/http/ngx_http_core_module.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_file_cache.c b/vendor/nginx-1.7.4/src/http/ngx_http_file_cache.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_file_cache.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_file_cache.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_header_filter_module.c b/vendor/nginx-1.7.4/src/http/ngx_http_header_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_header_filter_module.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_header_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_parse.c b/vendor/nginx-1.7.4/src/http/ngx_http_parse.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/http/ngx_http_parse.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_parse.c
index f28786946..b60f41bb6 100644
--- a/vendor/nginx-1.7.3/src/http/ngx_http_parse.c
+++ b/vendor/nginx-1.7.4/src/http/ngx_http_parse.c
@@ -1287,7 +1287,7 @@ ngx_http_parse_complex_uri(ngx_http_request_t *r, ngx_uint_t merge_slashes)
                 break;
             }
 
-            switch(ch) {
+            switch (ch) {
 #if (NGX_WIN32)
             case '\\':
                 if (u - 2 >= r->uri.data
@@ -1357,7 +1357,7 @@ ngx_http_parse_complex_uri(ngx_http_request_t *r, ngx_uint_t merge_slashes)
                 break;
             }
 
-            switch(ch) {
+            switch (ch) {
 #if (NGX_WIN32)
             case '\\':
                 break;
@@ -1400,7 +1400,7 @@ ngx_http_parse_complex_uri(ngx_http_request_t *r, ngx_uint_t merge_slashes)
                 break;
             }
 
-            switch(ch) {
+            switch (ch) {
 #if (NGX_WIN32)
             case '\\':
 #endif
@@ -1441,7 +1441,7 @@ ngx_http_parse_complex_uri(ngx_http_request_t *r, ngx_uint_t merge_slashes)
                 break;
             }
 
-            switch(ch) {
+            switch (ch) {
 #if (NGX_WIN32)
             case '\\':
 #endif
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_parse_time.c b/vendor/nginx-1.7.4/src/http/ngx_http_parse_time.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_parse_time.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_parse_time.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_postpone_filter_module.c b/vendor/nginx-1.7.4/src/http/ngx_http_postpone_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_postpone_filter_module.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_postpone_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_request.c b/vendor/nginx-1.7.4/src/http/ngx_http_request.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/http/ngx_http_request.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_request.c
index 4bf9d1fcf..845ada322 100644
--- a/vendor/nginx-1.7.3/src/http/ngx_http_request.c
+++ b/vendor/nginx-1.7.4/src/http/ngx_http_request.c
@@ -1071,6 +1071,8 @@ ngx_http_process_request_uri(ngx_http_request_t *r)
         cscf = ngx_http_get_module_srv_conf(r, ngx_http_core_module);
 
         if (ngx_http_parse_complex_uri(r, cscf->merge_slashes) != NGX_OK) {
+            r->uri.len = 0;
+
             ngx_log_error(NGX_LOG_INFO, r->connection->log, 0,
                           "client sent invalid request");
             ngx_http_finalize_request(r, NGX_HTTP_BAD_REQUEST);
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_request.h b/vendor/nginx-1.7.4/src/http/ngx_http_request.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_request.h
rename to vendor/nginx-1.7.4/src/http/ngx_http_request.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_request_body.c b/vendor/nginx-1.7.4/src/http/ngx_http_request_body.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_request_body.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_request_body.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_script.c b/vendor/nginx-1.7.4/src/http/ngx_http_script.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_script.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_script.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_script.h b/vendor/nginx-1.7.4/src/http/ngx_http_script.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_script.h
rename to vendor/nginx-1.7.4/src/http/ngx_http_script.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_spdy.c b/vendor/nginx-1.7.4/src/http/ngx_http_spdy.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/http/ngx_http_spdy.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_spdy.c
index 810d8d8f4..478036979 100644
--- a/vendor/nginx-1.7.3/src/http/ngx_http_spdy.c
+++ b/vendor/nginx-1.7.4/src/http/ngx_http_spdy.c
@@ -2584,6 +2584,8 @@ ngx_http_spdy_parse_header(ngx_http_request_t *r)
                 r->header_end = p;
                 r->header_in->pos = p + 1;
 
+                r->state = sw_value;
+
                 return NGX_OK;
             }
 
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_spdy.h b/vendor/nginx-1.7.4/src/http/ngx_http_spdy.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_spdy.h
rename to vendor/nginx-1.7.4/src/http/ngx_http_spdy.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_spdy_filter_module.c b/vendor/nginx-1.7.4/src/http/ngx_http_spdy_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_spdy_filter_module.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_spdy_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_spdy_module.c b/vendor/nginx-1.7.4/src/http/ngx_http_spdy_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_spdy_module.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_spdy_module.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_spdy_module.h b/vendor/nginx-1.7.4/src/http/ngx_http_spdy_module.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_spdy_module.h
rename to vendor/nginx-1.7.4/src/http/ngx_http_spdy_module.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_special_response.c b/vendor/nginx-1.7.4/src/http/ngx_http_special_response.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_special_response.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_special_response.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_upstream.c b/vendor/nginx-1.7.4/src/http/ngx_http_upstream.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/http/ngx_http_upstream.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_upstream.c
index 012969170..18b04f775 100644
--- a/vendor/nginx-1.7.3/src/http/ngx_http_upstream.c
+++ b/vendor/nginx-1.7.4/src/http/ngx_http_upstream.c
@@ -1393,6 +1393,11 @@ ngx_http_upstream_ssl_init_connection(ngx_http_request_t *r,
     rc = ngx_ssl_handshake(c);
 
     if (rc == NGX_AGAIN) {
+
+        if (!c->write->timer_set) {
+            ngx_add_timer(c->write, u->conf->connect_timeout);
+        }
+
         c->ssl->handler = ngx_http_upstream_ssl_handshake;
         return;
     }
@@ -3253,7 +3258,6 @@ ngx_http_upstream_process_request(ngx_http_request_t *r)
                         || u->headers_in.content_length_n == tf->offset))
                 {
                     ngx_http_upstream_store(r, u);
-                    u->store = 0;
                 }
             }
         }
@@ -3375,7 +3379,9 @@ ngx_http_upstream_store(ngx_http_request_t *r, ngx_http_upstream_t *u)
 
     if (u->conf->store_lengths == NULL) {
 
-        ngx_http_map_uri_to_path(r, &path, &root, 0);
+        if (ngx_http_map_uri_to_path(r, &path, &root, 0) == NULL) {
+            return;
+        }
 
     } else {
         if (ngx_http_script_run(r, &path, u->conf->store_lengths->elts, 0,
@@ -3393,6 +3399,8 @@ ngx_http_upstream_store(ngx_http_request_t *r, ngx_http_upstream_t *u)
                    tf->file.name.data, path.data);
 
     (void) ngx_ext_rename_file(&tf->file.name, &path, &ext);
+
+    u->store = 0;
 }
 
 
@@ -3441,7 +3449,7 @@ ngx_http_upstream_next(ngx_http_request_t *r, ngx_http_upstream_t *u,
         u->peer.tries++;
 
     } else {
-        switch(ft_type) {
+        switch (ft_type) {
 
         case NGX_HTTP_UPSTREAM_FT_TIMEOUT:
             status = NGX_HTTP_GATEWAY_TIME_OUT;
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_upstream.h b/vendor/nginx-1.7.4/src/http/ngx_http_upstream.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_upstream.h
rename to vendor/nginx-1.7.4/src/http/ngx_http_upstream.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_upstream_round_robin.c b/vendor/nginx-1.7.4/src/http/ngx_http_upstream_round_robin.c
similarity index 97%
rename from vendor/nginx-1.7.3/src/http/ngx_http_upstream_round_robin.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_upstream_round_robin.c
index 37c835cbd..b39eeae50 100644
--- a/vendor/nginx-1.7.3/src/http/ngx_http_upstream_round_robin.c
+++ b/vendor/nginx-1.7.4/src/http/ngx_http_upstream_round_robin.c
@@ -632,9 +632,8 @@ ngx_http_upstream_set_round_robin_peer_session(ngx_peer_connection_t *pc,
 
     rc = ngx_ssl_set_session(pc->connection, ssl_session);
 
-    ngx_log_debug2(NGX_LOG_DEBUG_HTTP, pc->log, 0,
-                   "set session: %p:%d",
-                   ssl_session, ssl_session ? ssl_session->references : 0);
+    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, pc->log, 0,
+                   "set session: %p", ssl_session);
 
     /* ngx_unlock_mutex(rrp->peers->mutex); */
 
@@ -657,8 +656,8 @@ ngx_http_upstream_save_round_robin_peer_session(ngx_peer_connection_t *pc,
         return;
     }
 
-    ngx_log_debug2(NGX_LOG_DEBUG_HTTP, pc->log, 0,
-                   "save session: %p:%d", ssl_session, ssl_session->references);
+    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, pc->log, 0,
+                   "save session: %p", ssl_session);
 
     peer = &rrp->peers->peer[rrp->current];
 
@@ -672,9 +671,8 @@ ngx_http_upstream_save_round_robin_peer_session(ngx_peer_connection_t *pc,
 
     if (old_ssl_session) {
 
-        ngx_log_debug2(NGX_LOG_DEBUG_HTTP, pc->log, 0,
-                       "old session: %p:%d",
-                       old_ssl_session, old_ssl_session->references);
+        ngx_log_debug1(NGX_LOG_DEBUG_HTTP, pc->log, 0,
+                       "old session: %p", old_ssl_session);
 
         /* TODO: may block */
 
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_upstream_round_robin.h b/vendor/nginx-1.7.4/src/http/ngx_http_upstream_round_robin.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_upstream_round_robin.h
rename to vendor/nginx-1.7.4/src/http/ngx_http_upstream_round_robin.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_variables.c b/vendor/nginx-1.7.4/src/http/ngx_http_variables.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_variables.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_variables.c
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_variables.h b/vendor/nginx-1.7.4/src/http/ngx_http_variables.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_variables.h
rename to vendor/nginx-1.7.4/src/http/ngx_http_variables.h
diff --git a/vendor/nginx-1.7.3/src/http/ngx_http_write_filter_module.c b/vendor/nginx-1.7.4/src/http/ngx_http_write_filter_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/http/ngx_http_write_filter_module.c
rename to vendor/nginx-1.7.4/src/http/ngx_http_write_filter_module.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail.c b/vendor/nginx-1.7.4/src/mail/ngx_mail.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail.h b/vendor/nginx-1.7.4/src/mail/ngx_mail.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail.h
rename to vendor/nginx-1.7.4/src/mail/ngx_mail.h
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_auth_http_module.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_auth_http_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_auth_http_module.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_auth_http_module.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_core_module.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_core_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_core_module.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_core_module.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_handler.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_handler.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_handler.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_handler.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_imap_handler.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_imap_handler.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_imap_handler.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_imap_handler.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_imap_module.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_imap_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_imap_module.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_imap_module.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_imap_module.h b/vendor/nginx-1.7.4/src/mail/ngx_mail_imap_module.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_imap_module.h
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_imap_module.h
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_parse.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_parse.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_parse.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_parse.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_pop3_handler.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_pop3_handler.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_pop3_handler.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_pop3_handler.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_pop3_module.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_pop3_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_pop3_module.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_pop3_module.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_pop3_module.h b/vendor/nginx-1.7.4/src/mail/ngx_mail_pop3_module.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_pop3_module.h
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_pop3_module.h
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_proxy_module.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_proxy_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_proxy_module.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_proxy_module.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_smtp_handler.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_smtp_handler.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_smtp_handler.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_smtp_handler.c
index 665f5ef19..46d703e2c 100644
--- a/vendor/nginx-1.7.3/src/mail/ngx_mail_smtp_handler.c
+++ b/vendor/nginx-1.7.4/src/mail/ngx_mail_smtp_handler.c
@@ -777,6 +777,9 @@ ngx_mail_smtp_starttls(ngx_mail_session_t *s, ngx_connection_t *c)
             ngx_str_null(&s->smtp_from);
             ngx_str_null(&s->smtp_to);
 
+            s->buffer->pos = s->buffer->start;
+            s->buffer->last = s->buffer->start;
+
             c->read->handler = ngx_mail_starttls_handler;
             return NGX_OK;
         }
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_smtp_module.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_smtp_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_smtp_module.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_smtp_module.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_smtp_module.h b/vendor/nginx-1.7.4/src/mail/ngx_mail_smtp_module.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_smtp_module.h
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_smtp_module.h
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_ssl_module.c b/vendor/nginx-1.7.4/src/mail/ngx_mail_ssl_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_ssl_module.c
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_ssl_module.c
diff --git a/vendor/nginx-1.7.3/src/mail/ngx_mail_ssl_module.h b/vendor/nginx-1.7.4/src/mail/ngx_mail_ssl_module.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/mail/ngx_mail_ssl_module.h
rename to vendor/nginx-1.7.4/src/mail/ngx_mail_ssl_module.h
diff --git a/vendor/nginx-1.7.3/src/misc/ngx_cpp_test_module.cpp b/vendor/nginx-1.7.4/src/misc/ngx_cpp_test_module.cpp
similarity index 90%
rename from vendor/nginx-1.7.3/src/misc/ngx_cpp_test_module.cpp
rename to vendor/nginx-1.7.4/src/misc/ngx_cpp_test_module.cpp
index 3cbc0a811..5d2f08d39 100644
--- a/vendor/nginx-1.7.3/src/misc/ngx_cpp_test_module.cpp
+++ b/vendor/nginx-1.7.4/src/misc/ngx_cpp_test_module.cpp
@@ -1,5 +1,5 @@
 
-// stub module to test header files' C++ compatibilty
+// stub module to test header files' C++ compatibility
 
 extern "C" {
   #include <ngx_config.h>
diff --git a/vendor/nginx-1.7.3/src/misc/ngx_google_perftools_module.c b/vendor/nginx-1.7.4/src/misc/ngx_google_perftools_module.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/misc/ngx_google_perftools_module.c
rename to vendor/nginx-1.7.4/src/misc/ngx_google_perftools_module.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_aio_read.c b/vendor/nginx-1.7.4/src/os/unix/ngx_aio_read.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_aio_read.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_aio_read.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_aio_read_chain.c b/vendor/nginx-1.7.4/src/os/unix/ngx_aio_read_chain.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_aio_read_chain.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_aio_read_chain.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_aio_write.c b/vendor/nginx-1.7.4/src/os/unix/ngx_aio_write.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_aio_write.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_aio_write.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_aio_write_chain.c b/vendor/nginx-1.7.4/src/os/unix/ngx_aio_write_chain.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_aio_write_chain.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_aio_write_chain.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_alloc.c b/vendor/nginx-1.7.4/src/os/unix/ngx_alloc.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_alloc.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_alloc.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_alloc.h b/vendor/nginx-1.7.4/src/os/unix/ngx_alloc.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_alloc.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_alloc.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_atomic.h b/vendor/nginx-1.7.4/src/os/unix/ngx_atomic.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_atomic.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_atomic.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_channel.c b/vendor/nginx-1.7.4/src/os/unix/ngx_channel.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_channel.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_channel.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_channel.h b/vendor/nginx-1.7.4/src/os/unix/ngx_channel.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_channel.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_channel.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_daemon.c b/vendor/nginx-1.7.4/src/os/unix/ngx_daemon.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_daemon.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_daemon.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_darwin.h b/vendor/nginx-1.7.4/src/os/unix/ngx_darwin.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_darwin.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_darwin.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_darwin_config.h b/vendor/nginx-1.7.4/src/os/unix/ngx_darwin_config.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_darwin_config.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_darwin_config.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_darwin_init.c b/vendor/nginx-1.7.4/src/os/unix/ngx_darwin_init.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_darwin_init.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_darwin_init.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_darwin_sendfile_chain.c b/vendor/nginx-1.7.4/src/os/unix/ngx_darwin_sendfile_chain.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_darwin_sendfile_chain.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_darwin_sendfile_chain.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_errno.c b/vendor/nginx-1.7.4/src/os/unix/ngx_errno.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_errno.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_errno.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_errno.h b/vendor/nginx-1.7.4/src/os/unix/ngx_errno.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_errno.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_errno.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_file_aio_read.c b/vendor/nginx-1.7.4/src/os/unix/ngx_file_aio_read.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_file_aio_read.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_file_aio_read.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_files.c b/vendor/nginx-1.7.4/src/os/unix/ngx_files.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_files.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_files.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_files.h b/vendor/nginx-1.7.4/src/os/unix/ngx_files.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_files.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_files.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_freebsd.h b/vendor/nginx-1.7.4/src/os/unix/ngx_freebsd.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_freebsd.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_freebsd.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_freebsd_config.h b/vendor/nginx-1.7.4/src/os/unix/ngx_freebsd_config.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_freebsd_config.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_freebsd_config.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_freebsd_init.c b/vendor/nginx-1.7.4/src/os/unix/ngx_freebsd_init.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_freebsd_init.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_freebsd_init.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_freebsd_rfork_thread.c b/vendor/nginx-1.7.4/src/os/unix/ngx_freebsd_rfork_thread.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_freebsd_rfork_thread.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_freebsd_rfork_thread.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_freebsd_rfork_thread.h b/vendor/nginx-1.7.4/src/os/unix/ngx_freebsd_rfork_thread.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_freebsd_rfork_thread.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_freebsd_rfork_thread.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_freebsd_sendfile_chain.c b/vendor/nginx-1.7.4/src/os/unix/ngx_freebsd_sendfile_chain.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_freebsd_sendfile_chain.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_freebsd_sendfile_chain.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_gcc_atomic_amd64.h b/vendor/nginx-1.7.4/src/os/unix/ngx_gcc_atomic_amd64.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_gcc_atomic_amd64.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_gcc_atomic_amd64.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_gcc_atomic_ppc.h b/vendor/nginx-1.7.4/src/os/unix/ngx_gcc_atomic_ppc.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_gcc_atomic_ppc.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_gcc_atomic_ppc.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_gcc_atomic_sparc64.h b/vendor/nginx-1.7.4/src/os/unix/ngx_gcc_atomic_sparc64.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_gcc_atomic_sparc64.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_gcc_atomic_sparc64.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_gcc_atomic_x86.h b/vendor/nginx-1.7.4/src/os/unix/ngx_gcc_atomic_x86.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_gcc_atomic_x86.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_gcc_atomic_x86.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_linux.h b/vendor/nginx-1.7.4/src/os/unix/ngx_linux.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_linux.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_linux.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_linux_aio_read.c b/vendor/nginx-1.7.4/src/os/unix/ngx_linux_aio_read.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_linux_aio_read.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_linux_aio_read.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_linux_config.h b/vendor/nginx-1.7.4/src/os/unix/ngx_linux_config.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_linux_config.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_linux_config.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_linux_init.c b/vendor/nginx-1.7.4/src/os/unix/ngx_linux_init.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_linux_init.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_linux_init.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_linux_sendfile_chain.c b/vendor/nginx-1.7.4/src/os/unix/ngx_linux_sendfile_chain.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_linux_sendfile_chain.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_linux_sendfile_chain.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_os.h b/vendor/nginx-1.7.4/src/os/unix/ngx_os.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_os.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_os.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_posix_config.h b/vendor/nginx-1.7.4/src/os/unix/ngx_posix_config.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_posix_config.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_posix_config.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_posix_init.c b/vendor/nginx-1.7.4/src/os/unix/ngx_posix_init.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_posix_init.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_posix_init.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_process.c b/vendor/nginx-1.7.4/src/os/unix/ngx_process.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_process.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_process.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_process.h b/vendor/nginx-1.7.4/src/os/unix/ngx_process.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_process.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_process.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_process_cycle.c b/vendor/nginx-1.7.4/src/os/unix/ngx_process_cycle.c
similarity index 99%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_process_cycle.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_process_cycle.c
index fb10d7746..3205aa555 100644
--- a/vendor/nginx-1.7.3/src/os/unix/ngx_process_cycle.c
+++ b/vendor/nginx-1.7.4/src/os/unix/ngx_process_cycle.c
@@ -121,6 +121,10 @@ ngx_master_process_cycle(ngx_cycle_t *cycle)
     }
 
     title = ngx_pnalloc(cycle->pool, size);
+    if (title == NULL) {
+        /* fatal */
+        exit(2);
+    }
 
     p = ngx_cpymem(title, master_process, sizeof(master_process) - 1);
     for (i = 0; i < ngx_argc; i++) {
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_process_cycle.h b/vendor/nginx-1.7.4/src/os/unix/ngx_process_cycle.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_process_cycle.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_process_cycle.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_pthread_thread.c b/vendor/nginx-1.7.4/src/os/unix/ngx_pthread_thread.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_pthread_thread.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_pthread_thread.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_readv_chain.c b/vendor/nginx-1.7.4/src/os/unix/ngx_readv_chain.c
similarity index 98%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_readv_chain.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_readv_chain.c
index 8836c817d..e4eb5ff32 100644
--- a/vendor/nginx-1.7.3/src/os/unix/ngx_readv_chain.c
+++ b/vendor/nginx-1.7.4/src/os/unix/ngx_readv_chain.c
@@ -10,7 +10,11 @@
 #include <ngx_event.h>
 
 
-#define NGX_IOVS  16
+#if (IOV_MAX > 64)
+#define NGX_IOVS  64
+#else
+#define NGX_IOVS  IOV_MAX
+#endif
 
 
 #if (NGX_HAVE_KQUEUE)
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_recv.c b/vendor/nginx-1.7.4/src/os/unix/ngx_recv.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_recv.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_recv.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_send.c b/vendor/nginx-1.7.4/src/os/unix/ngx_send.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_send.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_send.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_setaffinity.c b/vendor/nginx-1.7.4/src/os/unix/ngx_setaffinity.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_setaffinity.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_setaffinity.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_setaffinity.h b/vendor/nginx-1.7.4/src/os/unix/ngx_setaffinity.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_setaffinity.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_setaffinity.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_setproctitle.c b/vendor/nginx-1.7.4/src/os/unix/ngx_setproctitle.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_setproctitle.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_setproctitle.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_setproctitle.h b/vendor/nginx-1.7.4/src/os/unix/ngx_setproctitle.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_setproctitle.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_setproctitle.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_shmem.c b/vendor/nginx-1.7.4/src/os/unix/ngx_shmem.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_shmem.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_shmem.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_shmem.h b/vendor/nginx-1.7.4/src/os/unix/ngx_shmem.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_shmem.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_shmem.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_socket.c b/vendor/nginx-1.7.4/src/os/unix/ngx_socket.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_socket.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_socket.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_socket.h b/vendor/nginx-1.7.4/src/os/unix/ngx_socket.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_socket.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_socket.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_solaris.h b/vendor/nginx-1.7.4/src/os/unix/ngx_solaris.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_solaris.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_solaris.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_solaris_config.h b/vendor/nginx-1.7.4/src/os/unix/ngx_solaris_config.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_solaris_config.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_solaris_config.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_solaris_init.c b/vendor/nginx-1.7.4/src/os/unix/ngx_solaris_init.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_solaris_init.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_solaris_init.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_solaris_sendfilev_chain.c b/vendor/nginx-1.7.4/src/os/unix/ngx_solaris_sendfilev_chain.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_solaris_sendfilev_chain.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_solaris_sendfilev_chain.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_sunpro_amd64.il b/vendor/nginx-1.7.4/src/os/unix/ngx_sunpro_amd64.il
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_sunpro_amd64.il
rename to vendor/nginx-1.7.4/src/os/unix/ngx_sunpro_amd64.il
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_sunpro_atomic_sparc64.h b/vendor/nginx-1.7.4/src/os/unix/ngx_sunpro_atomic_sparc64.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_sunpro_atomic_sparc64.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_sunpro_atomic_sparc64.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_sunpro_sparc64.il b/vendor/nginx-1.7.4/src/os/unix/ngx_sunpro_sparc64.il
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_sunpro_sparc64.il
rename to vendor/nginx-1.7.4/src/os/unix/ngx_sunpro_sparc64.il
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_sunpro_x86.il b/vendor/nginx-1.7.4/src/os/unix/ngx_sunpro_x86.il
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_sunpro_x86.il
rename to vendor/nginx-1.7.4/src/os/unix/ngx_sunpro_x86.il
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_thread.h b/vendor/nginx-1.7.4/src/os/unix/ngx_thread.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_thread.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_thread.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_time.c b/vendor/nginx-1.7.4/src/os/unix/ngx_time.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_time.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_time.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_time.h b/vendor/nginx-1.7.4/src/os/unix/ngx_time.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_time.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_time.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_udp_recv.c b/vendor/nginx-1.7.4/src/os/unix/ngx_udp_recv.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_udp_recv.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_udp_recv.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_user.c b/vendor/nginx-1.7.4/src/os/unix/ngx_user.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_user.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_user.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_user.h b/vendor/nginx-1.7.4/src/os/unix/ngx_user.h
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_user.h
rename to vendor/nginx-1.7.4/src/os/unix/ngx_user.h
diff --git a/vendor/nginx-1.7.3/src/os/unix/ngx_writev_chain.c b/vendor/nginx-1.7.4/src/os/unix/ngx_writev_chain.c
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/ngx_writev_chain.c
rename to vendor/nginx-1.7.4/src/os/unix/ngx_writev_chain.c
diff --git a/vendor/nginx-1.7.3/src/os/unix/rfork_thread.S b/vendor/nginx-1.7.4/src/os/unix/rfork_thread.S
similarity index 100%
rename from vendor/nginx-1.7.3/src/os/unix/rfork_thread.S
rename to vendor/nginx-1.7.4/src/os/unix/rfork_thread.S
