Bilibili__openssl
commit 9545eac45bc79496763d2ded02629f88a8629fb9
Author:     Matt Caswell <matt@openssl.org>
AuthorDate: Wed Jun 10 09:32:34 2015 +0100
Commit:     Matt Caswell <matt@openssl.org>
CommitDate: Wed Jun 10 10:03:42 2015 +0100

    Fix Kerberos issue in ssl_session_dup
    
    The fix for CVE-2015-1791 introduced an error in ssl_session_dup for
    Kerberos.
    
    Reviewed-by: Tim Hudson <tjh@openssl.org>
    (cherry picked from commit dcad51bc13c9b716d9a66248bcc4038c071ff158)

diff --git a/ssl/ssl_sess.c b/ssl/ssl_sess.c
index 98b9107b5a..1fb682a9b3 100644
--- a/ssl/ssl_sess.c
+++ b/ssl/ssl_sess.c
@@ -239,7 +239,7 @@ SSL_SESSION *ssl_session_dup(SSL_SESSION *src, int ticket)
     memcpy(dest, src, sizeof(*dest));
 
 #ifndef OPENSSL_NO_KRB5
-    dest->krb5_client_princ_len = dest->krb5_client_princ_len;
+    dest->krb5_client_princ_len = src->krb5_client_princ_len;
     if (src->krb5_client_princ_len > 0)
         memcpy(dest->krb5_client_princ, src->krb5_client_princ,
                src->krb5_client_princ_len);
