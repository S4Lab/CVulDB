Bilibili__openssl
commit 106cb9505746ddb69dc07ef45232084e620940ec
Author:     Dr. Stephen Henson <steve@openssl.org>
AuthorDate: Sat Apr 23 13:52:43 2016 +0100
Commit:     Matt Caswell <matt@openssl.org>
CommitDate: Tue May 3 13:06:15 2016 +0100

    Add test for CVE-2016-2018
    
    Reviewed-by: Emilia KÃ¤sper <emilia@openssl.org>

diff --git a/test/d2i-tests/high_tag.der b/test/d2i-tests/high_tag.der
new file mode 100644
index 0000000000..5c523ecde5
Binary files /dev/null and b/test/d2i-tests/high_tag.der differ
diff --git a/test/recipes/25-test_d2i.t b/test/recipes/25-test_d2i.t
index 9e1a643aaf..d50de0431b 100644
--- a/test/recipes/25-test_d2i.t
+++ b/test/recipes/25-test_d2i.t
@@ -15,7 +15,7 @@ use OpenSSL::Test qw/:DEFAULT srctop_file/;
 
 setup("test_d2i");
 
-plan tests => 3;
+plan tests => 4;
 
 ok(run(test(["d2i_test", "X509", "decode",
              srctop_file('test','d2i-tests','bad_cert.der')])),
@@ -28,3 +28,12 @@ ok(run(test(["d2i_test", "GENERAL_NAME", "decode",
 ok(run(test(["d2i_test", "ASN1_ANY", "BIO",
              srctop_file('test','d2i-tests','bad_bio.der')])),
    "Running d2i_test bad_bio.der");
+# This test checks CVE-2016-2108. The data consists of an tag 258 and
+# two zero content octets. This is parsed as an ASN1_ANY type. If the
+# type is incorrectly interpreted as an ASN.1 INTEGER the two zero content
+# octets will be reject as invalid padding and this test will fail.
+# If the type is correctly interpreted it will by treated as an ASN1_STRING
+# type and the content octets copied verbatim.
+ok(run(test(["d2i_test", "ASN1_ANY", "OK",
+             srctop_file('test','d2i-tests','high_tag.der')])),
+   "Running d2i_test high_tag.der");
