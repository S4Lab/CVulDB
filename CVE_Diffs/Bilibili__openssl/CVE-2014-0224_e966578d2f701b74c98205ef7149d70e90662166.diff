Bilibili__openssl
commit e966578d2f701b74c98205ef7149d70e90662166
Author:     Dr. Stephen Henson <steve@openssl.org>
AuthorDate: Sat Jun 7 15:21:13 2014 +0100
Commit:     Dr. Stephen Henson <steve@openssl.org>
CommitDate: Sat Jun 7 15:27:21 2014 +0100

    Make tls_session_secret_cb work with CVE-2014-0224 fix.
    
    If application uses tls_session_secret_cb for session resumption
    set the CCS_OK flag.
    (cherry picked from commit 953c592572e8811b7956cc09fbd8e98037068b58)

diff --git a/ssl/s3_clnt.c b/ssl/s3_clnt.c
index 83d6ede3f7..2b1d2b8c57 100644
--- a/ssl/s3_clnt.c
+++ b/ssl/s3_clnt.c
@@ -815,6 +815,7 @@ int ssl3_get_server_hello(SSL *s)
 			{
 			s->session->cipher = pref_cipher ?
 				pref_cipher : ssl_get_cipher_by_char(s, p+j);
+	    		s->s3->flags |= SSL3_FLAGS_CCS_OK;
 			}
 		}
 #endif /* OPENSSL_NO_TLSEXT */
