Bilibili__openssl
commit 8d65fdb62e517281350372775b5f93fcc8489681
Author:     Dr. Stephen Henson <steve@openssl.org>
AuthorDate: Tue Jan 7 15:37:35 2014 +0000
Commit:     Dr. Stephen Henson <steve@openssl.org>
CommitDate: Tue Jan 7 15:39:21 2014 +0000

    Add fix for CVE-2013-4353
    (cherry picked from commit 6b42ed4e7104898f4b5b69337589719913b36404)

diff --git a/ssl/s3_both.c b/ssl/s3_both.c
index 8de149aaa6..0a259b1f4f 100644
--- a/ssl/s3_both.c
+++ b/ssl/s3_both.c
@@ -203,7 +203,11 @@ static void ssl3_take_mac(SSL *s)
 	{
 	const char *sender;
 	int slen;
-
+	/* If no new cipher setup return immediately: other functions will
+	 * set the appropriate error.
+	 */
+	if (s->s3->tmp.new_cipher == NULL)
+		return;
 	if (s->state & SSL_ST_CONNECT)
 		{
 		sender=s->method->ssl3_enc->server_finished_label;
