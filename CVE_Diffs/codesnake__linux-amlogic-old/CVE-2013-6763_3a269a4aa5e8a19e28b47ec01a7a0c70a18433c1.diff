codesnake__linux-amlogic-old
commit 3a269a4aa5e8a19e28b47ec01a7a0c70a18433c1
Author:     jian.xu <jian.xu@amlogic.com>
AuthorDate: Wed Sep 3 10:30:32 2014 +0000
Commit:     Alex Deryskyba <alex@codesnake.com>
CommitDate: Wed Dec 24 22:37:02 2014 +0200

    PD#97119 :fix CVE-2013-6763 ,Fix a few incorrectly checked [io_]remap_pfn_range() calls when mapping size smaller than mmap calls size
    
    Change-Id: Ie1bec830f096d0e8727044af89a5c3a61ad490dd

diff --git a/drivers/amlogic/amports/adec.c b/drivers/amlogic/amports/adec.c
index f7fcf410..2851adc5 100755
--- a/drivers/amlogic/amports/adec.c
+++ b/drivers/amlogic/amports/adec.c
@@ -154,25 +154,31 @@ static struct uio_info astream_uio_info = {
             .name = "AIFIFO",			
             .memtype = UIO_MEM_PHYS,
             .addr = (IO_CBUS_PHY_BASE + CBUS_REG_OFFSET(AIU_AIFIFO_CTRL)),
-            .size = (AIU_MEM_AIFIFO_LEVEL - AIU_AIFIFO_CTRL + 1) * 4,
+            .size = PAGE_SIZE,
         },
         [1] = {
             .memtype = UIO_MEM_PHYS,
             .addr = (IO_CBUS_PHY_BASE + CBUS_REG_OFFSET(VCOP_CTRL_REG)),
-            .size = (VC1_BITPLANE_CTL - VCOP_CTRL_REG + 1)*4,
+            .size = PAGE_SIZE,
         },
         [2] = {
             .name = "SECBUS",
             .memtype = UIO_MEM_PHYS,
             .addr = (IO_SECBUS_PHY_BASE ),
-            .size = (EFUSE_CNTL4 - EFUSE_CNTL0 + 1)*4,
+            .size = PAGE_SIZE,
         },  
         [3] = {
             .name = "CBUS",
             .memtype = UIO_MEM_PHYS,
             .addr = (IO_CBUS_PHY_BASE+ CBUS_REG_OFFSET(ASSIST_HW_REV)),
-            .size = (4 - 0 + 1)*4,
-        },           
+            .size = PAGE_SIZE,
+        },  
+        [4] = {
+            .name = "CBUS-START",
+            .memtype = UIO_MEM_PHYS,
+            .addr = (IO_CBUS_PHY_BASE+ CBUS_REG_OFFSET(0x1000)),
+            .size = PAGE_SIZE*4,
+        },                  
     },
 };
 #endif
