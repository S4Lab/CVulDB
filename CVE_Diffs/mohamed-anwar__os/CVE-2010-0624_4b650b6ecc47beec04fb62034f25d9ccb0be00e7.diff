mohamed-anwar__os
commit 4b650b6ecc47beec04fb62034f25d9ccb0be00e7
Author:     delphij <delphij@FreeBSD.org>
AuthorDate: Thu Mar 25 20:07:30 2010 +0000
Commit:     delphij <delphij@FreeBSD.org>
CommitDate: Thu Mar 25 20:07:30 2010 +0000

    MFC r205654:
    
    The rmt client in GNU cpio could have a heap overflow when a malicious
    remote tape service returns deliberately crafted packets containing
    more data than requested.
    
    Fix this by checking the returned amount of data and bail out when it
    is more than what we requested.
    
    PR:             gnu/145010
    Submitted by:   naddy
    Reviewed by:    imp
    Security:       CVE-2010-0624

diff --git a/contrib/cpio/lib/rtapelib.c b/contrib/cpio/lib/rtapelib.c
index af19b04c5d4..d73d1364e84 100644
--- a/contrib/cpio/lib/rtapelib.c
+++ b/contrib/cpio/lib/rtapelib.c
@@ -570,7 +570,8 @@ rmt_read__ (int handle, char *buffer, size_t length)
 
   sprintf (command_buffer, "R%lu\n", (unsigned long) length);
   if (do_command (handle, command_buffer) == -1
-      || (status = get_status (handle)) == SAFE_READ_ERROR)
+      || (status = get_status (handle)) == SAFE_READ_ERROR
+      || status > length)
     return SAFE_READ_ERROR;
 
   for (counter = 0; counter < status; counter += rlen, buffer += rlen)
