arduino__linino
commit 066f028f26f57d5a1ccc9ff254c65c5f2f84366d
Author:     jogo <jogo@3c298f89-4303-0410-b956-a3cf2f4a3e73>
AuthorDate: Fri Jan 13 12:03:47 2012 +0000
Commit:     jogo <jogo@3c298f89-4303-0410-b956-a3cf2f4a3e73>
CommitDate: Fri Jan 13 12:03:47 2012 +0000

    packages: znc: fix crash in bouncedcc module
    
    Add upstream fix for CVE-2012-0033.
    
    git-svn-id: svn://svn.openwrt.org/openwrt@29724 3c298f89-4303-0410-b956-a3cf2f4a3e73

diff --git a/packages/net/znc/Makefile b/packages/net/znc/Makefile
index a820f2286d..36b3effcc8 100644
--- a/packages/net/znc/Makefile
+++ b/packages/net/znc/Makefile
@@ -9,7 +9,7 @@ include $(TOPDIR)/rules.mk
 
 PKG_NAME:=znc
 PKG_VERSION:=0.202
-PKG_RELEASE:=1
+PKG_RELEASE:=2
 
 PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.gz
 PKG_SOURCE_URL:=http://znc.in/releases \
diff --git a/packages/net/znc/patches/004-fix_bouncedcc_crash.patch b/packages/net/znc/patches/004-fix_bouncedcc_crash.patch
new file mode 100644
index 0000000000..20e3a12c6e
--- /dev/null
+++ b/packages/net/znc/patches/004-fix_bouncedcc_crash.patch
@@ -0,0 +1,20 @@
+--- a/modules/bouncedcc.cpp
++++ b/modules/bouncedcc.cpp
+@@ -238,7 +238,7 @@ class CBounceDCCMod : public CModule {
+ 					CDCCBounce* pSock = (CDCCBounce*) *it;
+ 
+ 					if (pSock->GetLocalPort() == uResumePort) {
+-						m_pUser->PutUser(":" + Nick.GetNickMask() + " PRIVMSG " + m_pClient->GetNick() + " :\001DCC " + sType + " " + sFile + " " + CString(pSock->GetUserPort()) + " " + sMessage.Token(4) + "\001");
++						m_pUser->PutUser(":" + Nick.GetNickMask() + " PRIVMSG " + m_pUser->GetNick() + " :\001DCC " + sType + " " + sFile + " " + CString(pSock->GetUserPort()) + " " + sMessage.Token(4) + "\001");
+ 					}
+ 				}
+ 			} else if (sType.Equals("ACCEPT")) {
+@@ -248,7 +248,7 @@ class CBounceDCCMod : public CModule {
+ 					CDCCBounce* pSock = (CDCCBounce*) *it;
+ 
+ 					if (pSock->GetUserPort() == sMessage.Token(3).ToUShort()) {
+-						m_pUser->PutUser(":" + Nick.GetNickMask() + " PRIVMSG " + m_pClient->GetNick() + " :\001DCC " + sType + " " + sFile + " " + CString(pSock->GetLocalPort()) + " " + sMessage.Token(4) + "\001");
++						m_pUser->PutUser(":" + Nick.GetNickMask() + " PRIVMSG " + m_pUser->GetNick() + " :\001DCC " + sType + " " + sFile + " " + CString(pSock->GetLocalPort()) + " " + sMessage.Token(4) + "\001");
+ 					}
+ 				}
+ 			}
