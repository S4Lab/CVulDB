arduino__linino
commit 4c1b57b2c42f3652d1778612ce2bf5067b024df5
Author:     nico <nico@3c298f89-4303-0410-b956-a3cf2f4a3e73>
AuthorDate: Wed Aug 19 11:28:50 2009 +0000
Commit:     nico <nico@3c298f89-4303-0410-b956-a3cf2f4a3e73>
CommitDate: Wed Aug 19 11:28:50 2009 +0000

    [kernel] fix possible NULL pointer dereference in sock_sendpage()
     - CVE-2009-2692
    
    
    git-svn-id: svn://svn.openwrt.org/openwrt@17308 3c298f89-4303-0410-b956-a3cf2f4a3e73

diff --git a/branches/8.09/target/linux/generic-2.4/patches/901-CVE-2009-2692.patch b/branches/8.09/target/linux/generic-2.4/patches/901-CVE-2009-2692.patch
new file mode 100644
index 0000000000..641c87ddff
--- /dev/null
+++ b/branches/8.09/target/linux/generic-2.4/patches/901-CVE-2009-2692.patch
@@ -0,0 +1,14 @@
+http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-2692
+
+--- a/net/socket.c
++++ b/net/socket.c
+@@ -607,6 +607,9 @@ ssize_t sock_sendpage(struct file *file,
+ 	if (more)
+ 		flags |= MSG_MORE;
+ 
++	if (!sock->ops->sendpage)
++		return sock_no_sendpage(sock, page, offset, size, flags);
++
+ 	return sock->ops->sendpage(sock, page, offset, size, flags);
+ }
+ 
diff --git a/branches/8.09/target/linux/generic-2.6/patches-2.6.23/996-cve-2009-2692.patch b/branches/8.09/target/linux/generic-2.6/patches-2.6.23/996-cve-2009-2692.patch
new file mode 100644
index 0000000000..faf5ec35fc
--- /dev/null
+++ b/branches/8.09/target/linux/generic-2.6/patches-2.6.23/996-cve-2009-2692.patch
@@ -0,0 +1,13 @@
+http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-2692
+
+--- a/net/socket.c
++++ b/net/socket.c
+@@ -687,7 +687,7 @@ static ssize_t sock_sendpage(struct file
+ 	if (more)
+ 		flags |= MSG_MORE;
+ 
+-	return sock->ops->sendpage(sock, page, offset, size, flags);
++	return kernel_sendpage(sock, page, offset, size, flags);
+ }
+ 
+ static struct sock_iocb *alloc_sock_iocb(struct kiocb *iocb,
diff --git a/branches/8.09/target/linux/generic-2.6/patches-2.6.24/996-cve-2009-2692.patch b/branches/8.09/target/linux/generic-2.6/patches-2.6.24/996-cve-2009-2692.patch
new file mode 100644
index 0000000000..19214b8316
--- /dev/null
+++ b/branches/8.09/target/linux/generic-2.6/patches-2.6.24/996-cve-2009-2692.patch
@@ -0,0 +1,13 @@
+http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-2692
+
+--- a/net/socket.c
++++ b/net/socket.c
+@@ -688,7 +688,7 @@ static ssize_t sock_sendpage(struct file
+ 	if (more)
+ 		flags |= MSG_MORE;
+ 
+-	return sock->ops->sendpage(sock, page, offset, size, flags);
++	return kernel_sendpage(sock, page, offset, size, flags);
+ }
+ 
+ static struct sock_iocb *alloc_sock_iocb(struct kiocb *iocb,
diff --git a/branches/8.09/target/linux/generic-2.6/patches-2.6.25/996-cve-2009-2692.patch b/branches/8.09/target/linux/generic-2.6/patches-2.6.25/996-cve-2009-2692.patch
new file mode 100644
index 0000000000..1910c36740
--- /dev/null
+++ b/branches/8.09/target/linux/generic-2.6/patches-2.6.25/996-cve-2009-2692.patch
@@ -0,0 +1,13 @@
+http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-2692
+
+--- a/net/socket.c
++++ b/net/socket.c
+@@ -692,7 +692,7 @@ static ssize_t sock_sendpage(struct file
+ 	if (more)
+ 		flags |= MSG_MORE;
+ 
+-	return sock->ops->sendpage(sock, page, offset, size, flags);
++	return kernel_sendpage(sock, page, offset, size, flags);
+ }
+ 
+ static ssize_t sock_splice_read(struct file *file, loff_t *ppos,
diff --git a/branches/8.09/target/linux/generic-2.6/patches-2.6.26/996-cve-2009-2692.patch b/branches/8.09/target/linux/generic-2.6/patches-2.6.26/996-cve-2009-2692.patch
new file mode 100644
index 0000000000..1910c36740
--- /dev/null
+++ b/branches/8.09/target/linux/generic-2.6/patches-2.6.26/996-cve-2009-2692.patch
@@ -0,0 +1,13 @@
+http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-2692
+
+--- a/net/socket.c
++++ b/net/socket.c
+@@ -692,7 +692,7 @@ static ssize_t sock_sendpage(struct file
+ 	if (more)
+ 		flags |= MSG_MORE;
+ 
+-	return sock->ops->sendpage(sock, page, offset, size, flags);
++	return kernel_sendpage(sock, page, offset, size, flags);
+ }
+ 
+ static ssize_t sock_splice_read(struct file *file, loff_t *ppos,
