php__php-src
commit 6a8ae7cf8db3ec8dabfd027e01cdbcbb52654c90
Author:     Remi Collet <remi@php.net>
AuthorDate: Tue May 30 15:38:17 2017 +0200
Commit:     Remi Collet <remi@php.net>
CommitDate: Tue May 30 15:38:17 2017 +0200

    Patch from the upstream git
    https://github.com/kkos/oniguruma/issues/58 (CVE-2017-9227)
    
    Thanks to Mamoru TASAKA <mtasaka@fedoraproject.org>

diff --git a/ext/mbstring/oniguruma/regexec.c b/ext/mbstring/oniguruma/regexec.c
index 5e26896e36..97d5f32d28 100644
--- a/ext/mbstring/oniguruma/regexec.c
+++ b/ext/mbstring/oniguruma/regexec.c
@@ -3123,6 +3123,8 @@ forward_search_range(regex_t* reg, const UChar* str, const UChar* end, UChar* s,
     }
     else {
       UChar *q = p + reg->dmin;
+
+      if (q >= end) return 0; /* fail */
       while (p < q) p += enclen(reg->enc, p);
     }
   }
