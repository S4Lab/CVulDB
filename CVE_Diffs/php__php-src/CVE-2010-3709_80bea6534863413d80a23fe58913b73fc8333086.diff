php__php-src
commit 80bea6534863413d80a23fe58913b73fc8333086
Author:     Pierre Joye <pajoye@php.net>
AuthorDate: Tue Oct 19 09:55:36 2010 +0000
Commit:     Pierre Joye <pajoye@php.net>
CommitDate: Tue Oct 19 09:55:36 2010 +0000

    - fix Fixed NULL pointer dereference in ZipArchive::getArchiveComment, (CVE-2010-3709), report&patch from Maksymilian Arciemowicz

diff --git a/ext/zip/php_zip.c b/ext/zip/php_zip.c
index c2adccf8a1..a6d317de0f 100644
--- a/ext/zip/php_zip.c
+++ b/ext/zip/php_zip.c
@@ -1954,6 +1954,9 @@ static ZIPARCHIVE_METHOD(getCommentIndex)
 
 	PHP_ZIP_STAT_INDEX(intern, index, 0, sb);
 	comment = zip_get_file_comment(intern, index, &comment_len, (int)flags);
+	if(comment==NULL) {
+		RETURN_FALSE;
+	}
 	RETURN_STRINGL((char *)comment, (long)comment_len, 1);
 }
 /* }}} */
