php__php-src
commit 703be4f77e662837b64499b0d046a5c8d06a98b9
Author:     Remi Collet <remi@php.net>
AuthorDate: Tue May 30 15:40:32 2017 +0200
Commit:     Remi Collet <remi@php.net>
CommitDate: Wed Jul 5 09:26:06 2017 +0200

    Patch from the upstream git
    https://github.com/kkos/oniguruma/issues/60 (CVE-2017-9228)
    
    Thanks to Mamoru TASAKA <mtasaka@fedoraproject.org>

diff --git a/ext/mbstring/oniguruma/regparse.c b/ext/mbstring/oniguruma/regparse.c
index c6822e6267..d2925f1e81 100644
--- a/ext/mbstring/oniguruma/regparse.c
+++ b/ext/mbstring/oniguruma/regparse.c
@@ -4068,7 +4068,9 @@ next_state_class(CClassNode* cc, OnigCodePoint* vs, enum CCVALTYPE* type,
     }
   }
 
-  *state = CCS_VALUE;
+  if (*state != CCS_START)
+    *state = CCS_VALUE;
+
   *type  = CCV_CLASS;
   return 0;
 }
