FreeRDP__FreeRDP
commit f1d6afca6ae620f9855a33280bdc6f3ad9153be0
Author:     Hardening <rdp.effort@gmail.com>
AuthorDate: Wed Jan 8 16:12:51 2014 +0100
Commit:     Hardening <rdp.effort@gmail.com>
CommitDate: Wed Jan 8 16:57:56 2014 +0100

    Fix CVE-2014-0791
    
    This patch fixes CVE-2014-0791, the remaining length in the stream is checked
    before doing some malloc().

diff --git a/libfreerdp/core/license.c b/libfreerdp/core/license.c
index e26e5e0fd..17e1520c7 100644
--- a/libfreerdp/core/license.c
+++ b/libfreerdp/core/license.c
@@ -669,6 +669,8 @@ BOOL license_read_scope_list(wStream* s, SCOPE_LIST* scopeList)
 		return FALSE;
 
 	Stream_Read_UINT32(s, scopeCount); /* ScopeCount (4 bytes) */
+	if (scopeCount > Stream_GetRemainingLength(s) / 4)  /* every blob is at least 4 bytes */
+		return FALSE;
 
 	scopeList->count = scopeCount;
 	scopeList->array = (LICENSE_BLOB*) malloc(sizeof(LICENSE_BLOB) * scopeCount);
