etlegacy__etlegacy
commit 503cd7bf09a6f299bc36132a2f5ce0472094d1ba
Author:     IR4T4 <gutzu@gmx.ch>
AuthorDate: Fri Jul 27 12:12:59 2012 +0200
Commit:     IR4T4 <gutzu@gmx.ch>
CommitDate: Fri Jul 27 12:12:59 2012 +0200

    security fix for CVE-2012-3345

diff --git a/src/qcommon/qcommon.h b/src/qcommon/qcommon.h
index af612b94..f6e3b254 100644
--- a/src/qcommon/qcommon.h
+++ b/src/qcommon/qcommon.h
@@ -1187,7 +1187,6 @@ char *Sys_Cwd(void);
 char *Sys_DefaultBasePath(void);
 char *Sys_DefaultInstallPath(void);
 char *Sys_DefaultHomePath(void);
-const char *Sys_TempPath(void);
 const char *Sys_Dirname(char *path);
 const char *Sys_Basename(char *path);
 char *Sys_ConsoleInput(void);
diff --git a/src/sys/sys_main.c b/src/sys/sys_main.c
index 949e2f3b..103b6457 100644
--- a/src/sys/sys_main.c
+++ b/src/sys/sys_main.c
@@ -155,7 +155,7 @@ Sys_PIDFileName
 */
 static char *Sys_PIDFileName(void)
 {
-	return va("%s/%s", Sys_TempPath(), PID_FILENAME);
+	return va("%s/%s", Sys_DefaultHomePath(), PID_FILENAME);
 }
 
 /*
diff --git a/src/sys/sys_osx.m b/src/sys/sys_osx.m
index 148826ab..5de97c25 100644
--- a/src/sys/sys_osx.m
+++ b/src/sys/sys_osx.m
@@ -45,27 +45,6 @@
 #import <Carbon/Carbon.h>
 #import <Cocoa/Cocoa.h>
 
-/*
-================
-Sys_TempPath
-================
-*/
-const char *Sys_TempPath(void)
-{
-	static UInt8 posixPath[MAX_OSPATH];
-	FSRef        ref;
-	if (FSFindFolder(kOnAppropriateDisk,
-	                 kTemporaryFolderType, kCreateFolder, &ref) == noErr)
-	{
-		if (FSRefMakePath(&ref, posixPath,
-		                  sizeof(posixPath) - 1) == noErr)
-		{
-			return (const char *)posixPath;
-		}
-	}
-
-	return "/tmp";
-}
 
 /*
 ==============
diff --git a/src/sys/sys_platform.c b/src/sys/sys_platform.c
index 5fa80f7c..6499203a 100644
--- a/src/sys/sys_platform.c
+++ b/src/sys/sys_platform.c
@@ -115,28 +115,6 @@ char *Sys_DefaultHomePath(void)
 	return homePath;
 }
 
-/*
-================
-Sys_TempPath
-================
-*/
-const char *Sys_TempPath(void)
-{
-	static TCHAR path[MAX_PATH];
-	DWORD        length;
-
-	length = GetTempPath(sizeof(path), path);
-
-	if (length > sizeof(path) || length == 0)
-	{
-		return Sys_DefaultHomePath();
-	}
-	else
-	{
-		return path;
-	}
-}
-
 /*
 ================
 Sys_Milliseconds
@@ -1008,27 +986,6 @@ char *Sys_DefaultHomePath(void)
 	return homePath;
 }
 
-#ifndef MACOS_X
-/*
-================
-Sys_TempPath
-================
-*/
-const char *Sys_TempPath(void)
-{
-	const char *TMPDIR = getenv("TMPDIR");
-
-	if (TMPDIR == NULL || TMPDIR[0] == '\0')
-	{
-		return "/tmp";
-	}
-	else
-	{
-		return TMPDIR;
-	}
-}
-#endif
-
 /*
 ==================
 chmod OR on a file
