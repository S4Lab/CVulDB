bminor__glibc
commit a39e9f7a233799f28a79c0a562b66c250e2cd4b2
Author:     Stan Shebs <stanshebs@google.com>
AuthorDate: Mon May 9 13:54:38 2016 -0700
Commit:     Stan Shebs <stanshebs@google.com>
CommitDate: Mon May 9 13:54:38 2016 -0700

    fix where getaddrinfo() writes DNS queries to random file descriptors under high load (BZ15946, CVE-2013-7423)

diff --git a/README.google b/README.google
index 57adcb4ab40..b65b4eef002 100644
--- a/README.google
+++ b/README.google
@@ -574,4 +574,10 @@ nptl/sysdeps/unix/sysv/linux/register-atfork.c
 resolv/nss_dns/dns-network.c
   For b/27917753, fix stack overflow in _nss_dns_getnetbyname_r (BZ19879)
   https://sourceware.org/git/gitweb.cgi?p=glibc.git;h=317b199b4aff8cfa27f2302ab404d2bb5032b9a4
-  (stanshebs, google-local)
+  (stanshebs, backport)
+
+resolv/res_send.c
+  For b/28166767, fix where getaddrinfo() writes DNS queries to random file descriptors
+  under high load (BZ15946, CVE-2013-7423)
+  https://sourceware.org/git/gitweb.cgi?p=glibc.git;h=f9d2d03254a58d92635a311a42253eeed5a40a47
+  (stanshebs, backport)
diff --git a/resolv/res_send.c b/resolv/res_send.c
index 6d8fb08bccc..3eb6cbf58b2 100644
--- a/resolv/res_send.c
+++ b/resolv/res_send.c
@@ -1414,6 +1414,7 @@ send_dg(res_state statp,
 					retval = reopen (statp, terrno, ns);
 					if (retval <= 0)
 						return retval;
+					pfd[0].fd = EXT(statp).nssocks[ns];
 				}
 			}
 			goto wait;
