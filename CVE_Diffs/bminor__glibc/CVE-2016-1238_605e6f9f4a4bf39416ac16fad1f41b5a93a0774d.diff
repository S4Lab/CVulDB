bminor__glibc
commit 605e6f9f4a4bf39416ac16fad1f41b5a93a0774d
Author:     Aurelien Jarno <aurelien@aurel32.net>
AuthorDate: Mon Sep 5 22:53:22 2016 +0200
Commit:     Florian Weimer <fw@deneb.enyo.de>
CommitDate: Thu Jul 6 15:14:47 2017 +0200

    conform tests: call perl with '-I.'
    
    Historically perl includes the current directory in the module search
    path. Over the time this has been considered as a security issue and
    the recent vulnerabilities [1] made people to reconsider this behaviour.
    It is almost sure that this will be removed in the future [2], possibly
    for the 5.26 release, although this is not yet firmly decided.
    
    Debian has decided to backport the patches [3], so the perl binary in
    unstable do not have '.' in @INC anymore.
    
    This behaviour is used in the conform perl scripts to include the
    GlibcConform module. This patch fixes that by calling perl with '-I.'.
    This is not a security issue in this case as make ensures that the
    current directory is $(srcdir)/conform/ when the scripts are called.
    Passing the full path would do exactly the same.
    
    [1] CVE-2016-1238 CVE-2016-6185
    [2] https://rt.perl.org/Public/Bug/Display.html?id=127810
    [3] https://lists.debian.org/debian-devel-announce/2016/08/msg00013.html
    
    Changelog:
            * conform/Makefile (conformtest-header-tests): Pass -I. to $(PERL).
            (linknamespace-symlists-tests): Likewise.
            (linknamespace-header-tests): Likewise.
    
    (cherry picked from commit 6d5336211d2e823d4d431a01e62a80d9be4cbc9d)

diff --git a/ChangeLog b/ChangeLog
index 12067b9ea20..f58debbfc9f 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,9 @@
+2016-09-05  Aurelien Jarno  <aurelien@aurel32.net>
+
+	* conform/Makefile (conformtest-header-tests): Pass -I. to $(PERL).
+	(linknamespace-symlists-tests): Likewise.
+	(linknamespace-header-tests): Likewise.
+
 2017-07-06  Florian Weimer  <fweimer@redhat.com>
 	    H.J. Lu  <hongjiu.lu@intel.com>
 
diff --git a/conform/Makefile b/conform/Makefile
index 762aac98fcb..7883624c813 100644
--- a/conform/Makefile
+++ b/conform/Makefile
@@ -196,13 +196,13 @@ $(conformtest-header-tests): $(objpfx)%/conform.out: \
 			     conformtest.pl $(conformtest-headers-data)
 	(set -e; std_hdr=$*; std=$${std_hdr%%/*}; hdr=$${std_hdr#*/}; \
 	 mkdir -p $(@D)/scratch; \
-	 $(PERL) conformtest.pl --tmpdir=$(@D)/scratch --cc='$(CC)' \
+	 $(PERL) -I. conformtest.pl --tmpdir=$(@D)/scratch --cc='$(CC)' \
 		 --flags='$(conformtest-cc-flags)' --standard=$$std \
 		 --headers=$$hdr > $@); \
 	$(evaluate-test)
 
 $(linknamespace-symlists-tests): $(objpfx)symlist-%: list-header-symbols.pl
-	$(PERL) -w $< --tmpdir=$(objpfx) --cc='$(CC)' \
+	$(PERL) -I. -w $< --tmpdir=$(objpfx) --cc='$(CC)' \
 		--flags='$(conformtest-cc-flags)' --standard=$* \
 		--headers="$(strip $(conformtest-headers-$*))" \
 		> $@ 2> $@.err; \
@@ -233,7 +233,7 @@ $(linknamespace-header-tests): $(objpfx)%/linknamespace.out: \
 			       $(linknamespace-symlist-stdlibs-tests)
 	(set -e; std_hdr=$*; std=$${std_hdr%%/*}; hdr=$${std_hdr#*/}; \
 	 mkdir -p $(@D)/scratch; \
-	 $(PERL) -w $< --tmpdir=$(@D)/scratch --cc='$(CC)' \
+	 $(PERL) -I. -w $< --tmpdir=$(@D)/scratch --cc='$(CC)' \
 		 --flags='$(conformtest-cc-flags)' --standard=$$std \
 		 --stdsyms=$(objpfx)symlist-$$std --header=$$hdr \
 		 --libsyms=$(objpfx)symlist-stdlibs-$$std \
