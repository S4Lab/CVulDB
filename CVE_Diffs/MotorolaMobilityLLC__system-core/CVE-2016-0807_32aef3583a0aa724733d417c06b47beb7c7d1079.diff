MotorolaMobilityLLC__system-core
commit 32aef3583a0aa724733d417c06b47beb7c7d1079
Author:     Christopher Ferris <cferris@google.com>
AuthorDate: Thu Oct 22 13:34:48 2015 -0700
Commit:     Charles Barros <charlesb@motorola.com>
CommitDate: Tue Mar 8 11:41:14 2016 -0300

    Fix incorrect check of descsz value.
    
    MOT_Fixed_CR: (CR)
    Elevation of Privilege Vulnerability in the Debuggerd
    CVE-2016-0807
    ANDROID-25187394
    
    Bug: 25187394
    
    (cherry picked from commit 1fa55234d6773e09e3bb934419b5b6cc0df981c9)
    
    Change-Id: Idbc9071e8b2b25a062c4e94118808d6e19d443d9
    (cherry picked from commit d917514bd6b270df431ea4e781a865764d406120)
    
    Signed-off-by: Andy Seah <dntc46@motorola.com>
    Change-Id: I3ae8be3f023f64939bb7e6296c215dc45d24b168
    Reviewed-on: http://gerrit.mot.com/810801
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Choon Lee Seah <andyseah@motorola.com>
    Reviewed-by: Christopher Fries <cfries@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/debuggerd/elf_utils.cpp b/debuggerd/elf_utils.cpp
index 5ea03e752..65c190479 100644
--- a/debuggerd/elf_utils.cpp
+++ b/debuggerd/elf_utils.cpp
@@ -63,10 +63,10 @@ static bool get_build_id(
         if (nhdr.n_type == NT_GNU_BUILD_ID) {
           // Skip the name (which is the owner and should be "GNU").
           addr += NOTE_ALIGN(nhdr.n_namesz);
-          uint8_t build_id_data[128];
-          if (nhdr.n_namesz > sizeof(build_id_data)) {
-            ALOGE("Possible corrupted note, name size value is too large: %u",
-                  nhdr.n_namesz);
+          uint8_t build_id_data[160];
+          if (nhdr.n_descsz > sizeof(build_id_data)) {
+            ALOGE("Possible corrupted note, desc size value is too large: %u",
+                  nhdr.n_descsz);
             return false;
           }
           if (backtrace->Read(addr, build_id_data, nhdr.n_descsz) != nhdr.n_descsz) {
