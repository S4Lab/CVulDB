MotorolaMobilityLLC__system-core
commit 4e7babf2ce0fc1fa519dcf66e326d0284734731b
Author:     Nick Kralevich <nnk@google.com>
AuthorDate: Fri Aug 25 12:55:52 2017 -0700
Commit:     Amarendra Reddy <amarenr@motorola.com>
CommitDate: Mon Nov 20 00:34:50 2017 -0600

    init.rc: Lock down access to /proc/net/fib_trie
    
    Make /proc/net/fib_trie only readable to root.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-13165
    Bug: 31269937
    
    Test: Device boots, file has appropriate permissions.
    Change-Id: I0d01ce5c043d576344a6732b0b9ff93d62fcaa34
    Reviewed-on: https://gerrit.mot.com/1089947
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/rootdir/init.rc b/rootdir/init.rc
index 9b3f7c5fe..3d964610d 100644
--- a/rootdir/init.rc
+++ b/rootdir/init.rc
@@ -144,6 +144,9 @@ on init
     write /proc/sys/net/ipv4/conf/all/accept_redirects 0
     write /proc/sys/net/ipv6/conf/all/accept_redirects 0
 
+    # /proc/net/fib_trie leaks interface IP addresses
+    chmod 0400 /proc/net/fib_trie
+
     # Create cgroup mount points for process groups
     mkdir /dev/cpuctl
     mount cgroup none /dev/cpuctl cpu
