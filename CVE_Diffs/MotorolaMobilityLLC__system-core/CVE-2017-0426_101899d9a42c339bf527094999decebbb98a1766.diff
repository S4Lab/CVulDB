MotorolaMobilityLLC__system-core
commit 101899d9a42c339bf527094999decebbb98a1766
Author:     Nick Kralevich <nnk@google.com>
AuthorDate: Sat Nov 19 12:09:33 2016 -0800
Commit:     Charles Barros <charlesb@motorola.com>
CommitDate: Fri Jun 2 17:30:59 2017 -0300

    change /data/bugreports to /bugreports
    
    CVE-2017-0426 : Information disclosure vulnerability in Filesystem
    A-32799236
    Mot-CRs-fixed: (CR)
    
    It's 5 characters shorter, has no runtime costs, can be stored on a
    read-only partition, and avoids problems like b/27262109 and b/27204904.
    It allows makes some security hardening easier.
    
    (cherry picked from commit c4084c669495fd1b41ce8b6568c71b1f46d26969)
    
    Bug: 27262109
    Bug: 27204904
    Bug: 32799236
    Test: verified new symlink created and old one not present
    Change-Id: Ief362e13569ad9c868a7f0f9c4dbd6a328c96c6b
    (cherry picked from commit 04bbd5c6dd0455af43e96efbc45399bf6fd70d40)
    Reviewed-on: https://gerrit.mot.com/938146
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/rootdir/Android.mk b/rootdir/Android.mk
old mode 100644
new mode 100755
index f7d416d3c..4b4806453
--- a/rootdir/Android.mk
+++ b/rootdir/Android.mk
@@ -56,6 +56,7 @@ endif
 LOCAL_POST_INSTALL_CMD := mkdir -p $(addprefix $(TARGET_ROOT_OUT)/, \
     sbin dev proc sys system data oem acct cache config storage mnt root modem $(BOARD_ROOT_EXTRA_FOLDERS)); \
     ln -sf /system/etc $(TARGET_ROOT_OUT)/etc; \
+    ln -sf /data/user_de/0/com.android.shell/files/bugreports $(TARGET_ROOT_OUT)/bugreports; \
     ln -sf /sys/kernel/debug $(TARGET_ROOT_OUT)/d; \
     ln -sf /storage/self/primary $(TARGET_ROOT_OUT)/sdcard
 ifdef BOARD_VENDORIMAGE_FILE_SYSTEM_TYPE
diff --git a/rootdir/init.rc b/rootdir/init.rc
old mode 100644
new mode 100755
index c259754fb..f5751c26e
--- a/rootdir/init.rc
+++ b/rootdir/init.rc
@@ -412,10 +412,6 @@ on post-fs-data
 
     mkdir /data/anr 0775 system system
 
-    # symlink to bugreport storage location
-    rm /data/bugreports
-    symlink /data/user_de/0/com.android.shell/files/bugreports /data/bugreports
-
     # Separate location for storing security policy files on data
     mkdir /data/security 0711 system system
 
