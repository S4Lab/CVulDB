MotorolaMobilityLLC__system-core
commit a96f58572fc42b2961893bc9931cdcc1dc6058f3
Author:     Daniel Rosenberg <drosen@google.com>
AuthorDate: Tue Apr 12 16:30:28 2016 -0700
Commit:     Igor Kovalenko <igork@motorola.com>
CommitDate: Thu May 12 19:42:07 2016 -0500

    Fix overflow in path building
    
    ANDROID-28085658: Elevation of Privilege Vulnerability in SD Card Emulation Layer
    CVE-2016-2494
    
    Mot-CRs-fixed: (CR)
    
    An incorrect size was causing an unsigned value
    to wrap, causing it to write past the end of
    the buffer.
    
    Bug: 28085658
    Change-Id: Ie9625c729cca024d514ba2880ff97209d435a165
    (cherry picked from commit 6ea6c04ca695e0f0b6bcf3ea4529b9fd74fee8e4)
    
    Signed-off-by: Andy Seah <dntc46@motorola.com>
    Change-Id: I8546189a06b99930c08046b4ef6cd062b8fa0bfa
    Reviewed-on: http://gerrit.mot.com/851825
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Choon Lee Seah <andyseah@motorola.com>
    Reviewed-by: Jason Hrycay <jason.hrycay@motorola.com>
    Reviewed-by: Christopher Fries <cfries@motorola.com>

diff --git a/sdcard/sdcard.c b/sdcard/sdcard.c
index eedf3451f..5ccf40fae 100644
--- a/sdcard/sdcard.c
+++ b/sdcard/sdcard.c
@@ -338,7 +338,7 @@ static ssize_t get_node_path_locked(struct node* node, char* buf, size_t bufsize
 
     ssize_t pathlen = 0;
     if (node->parent && node->graft_path == NULL) {
-        pathlen = get_node_path_locked(node->parent, buf, bufsize - namelen - 2);
+        pathlen = get_node_path_locked(node->parent, buf, bufsize - namelen - 1);
         if (pathlen < 0) {
             return -1;
         }
