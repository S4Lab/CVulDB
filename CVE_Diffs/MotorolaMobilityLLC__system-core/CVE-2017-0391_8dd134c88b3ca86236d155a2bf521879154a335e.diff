MotorolaMobilityLLC__system-core
commit 8dd134c88b3ca86236d155a2bf521879154a335e
Author:     lulu2 <lulu2@lenovo.com>
AuthorDate: Wed Jun 14 14:50:56 2017 +0800
Commit:     lulu2 <lulu2@lenovo.com>
CommitDate: Wed Jun 14 17:16:53 2017 +0800

    [PIS-062][lulu2]ALPS03350274(For_lenovo6737m_35_n1_alps-mp-n1.mp1-V1_P62)
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03350274
    Severity:
    
    Description:
      [Patch Request] [PMS] LENOVO, Project: LENOVO6737M_35_N1, SW Version: alps-mp-n1.mp1-V1N/A
    
    Associated Files:
      device/lenovo/lenovo6737m_35_n1/ProjectConfig.mk
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03267850
    Severity:
      Critical
    Description:
      【***】【***】【TIT-L01C576】Security vulnerabilities：I***o***ation Disclosure *** AEE extension to debuggerd
      [[Title for Customer]]
      AEE db security enh***ement.
      [[Problem Description]]
      user load may leak sensitive i***o***atio***y of db files.
      [[Potential Impa*** of the solution]]
      need to update GAT tool to extra*** the new version DB;
      mobilelog or "aee -m" can not change aee mode any longer on user/userdebug load ***efault co***ig, so AEE only c***h fatal DB, and customer c***hange this default co***ig to fo***er behavior by set property "ro.aee.e***orcing" to "no" in vendor\mediatek\proprietary\external\aee\co***ig_external\init.aee.customer.rc before build load.
      [[Modules to be verified after taking p***h]]
      AEE
      [[問題標題]]
      加强AEE db安全防护
      [[問題現象]]
      user load上可能会泄露一些与process相关的信息。
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      DB文件加解密做了加强，须要更新GAT tool才能解开新版本的DB文件;
      在user和userdebug load上，默认情况下mobilelog和"aee -m"命令将不能再切换AEE mode,因此AEE将只抓取fatal DB；但是客户可以把这个默认设置改回到AEE原来的行为，只须build load前在vendor\mediatek\proprietary\external\aee\co***ig_external\init.aee.customer.rc中设置property "ro.aee.e***orcing" 为 "no"即可。
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      AEEN/A
    
    Associated Files:
      vendor/lenovo/libs/libdrmmtkutil/arm/libdrmmtkutil.so
      vendor/lenovo/libs/libwvdrmengine/NOTICE
      vendor/lenovo/libs/libwvdrmengine/README
      vendor/mediatek/proprietary/external/aee/binary/Version.txt
      vendor/mediatek/proprietary/external/aee/binary/bin/aee
      vendor/mediatek/proprietary/external/aee/binary/bin/aee_archive
      vendor/mediatek/proprietary/external/aee/binary/bin/aee_archive64
      vendor/mediatek/proprietary/external/aee/binary/bin/aee_core_forwarder
      vendor/mediatek/proprietary/external/aee/binary/bin/aee_dumpstate
      vendor/mediatek/proprietary/external/aee/binary/bin/debuggerd
      vendor/mediatek/proprietary/external/aee/binary/bin/debuggerd64
      vendor/mediatek/proprietary/external/aee/binary/bin/rtt
      vendor/mediatek/proprietary/external/aee/binary/lib/libaed.so
      vendor/mediatek/proprietary/external/aee/binary/lib64/libaed.so
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283068
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0637]Remote code execution vulnerability in Mediaserver
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0637]Remote code execution vulnerability in Mediaserver
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0637]Remote code execution vulnerability in Mediaserver
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-0637]Remote code execution vulnerability in Mediaserver
      [[問題現象]]
      [Google Security P***h][CVE-2017-0637]Remote code execution vulnerability in Mediaserver
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libhevc/decoder/ihevcd_parse_headers.c
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283086
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2016-5131]Remote code execution vulnerability in libxml2
      [[Title for Customer]]
      [Google Security P***h][CVE-2016-5131]Remote code execution vulnerability in libxml2
      [[Problem Description]]
      [Google Security P***h][CVE-2016-5131]Remote code execution vulnerability in libxml2
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2016-5131]Remote code execution vulnerability in libxml2
      [[問題現象]]
      [Google Security P***h][CVE-2016-5131]Remote code execution vulnerability in libxml2
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libxml2/test/XPath/xptr/vidbase
      external/libxml2/xpath.c
      external/libxml2/xpointer.c
      vendor/lenovo/libs/libdrmmtkutil/arm/libdrmmtkutil.so
      vendor/lenovo/libs/mtk_agpsd/arm/mtk_agpsd
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283089
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2016-4658]Remote code execution vulnerability in libxml2
      [[Title for Customer]]
      [Google Security P***h][CVE-2016-4658]Remote code execution vulnerability in libxml2
      [[Problem Description]]
      [Google Security P***h][CVE-2016-4658]Remote code execution vulnerability in libxml2
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2016-4658]Remote code execution vulnerability in libxml2
      [[問題現象]]
      [Google Security P***h][CVE-2016-4658]Remote code execution vulnerability in libxml2
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libxml2/xpointer.c
      vendor/lenovo/libs/libdrmmtkutil/arm/libdrmmtkutil.so
      vendor/lenovo/libs/mtk_agpsd/arm/mtk_agpsd
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283093
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0663]Remote code execution vulnerability in libxml2
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0663]Remote code execution vulnerability in libxml2
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0663]Remote code execution vulnerability in libxml2
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-0663]Remote code execution vulnerability in libxml2
      [[問題現象]]
      [Google Security P***h][CVE-2017-0663]Remote code execution vulnerability in libxml2
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libxml2/valid.c
      vendor/lenovo/libs/libdrmmtkutil/arm/libdrmmtkutil.so
      vendor/lenovo/libs/mtk_agpsd/arm/mtk_agpsd
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283096
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-7376]Remote code execution vulnerability in libxml2
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-7376]Remote code execution vulnerability in libxml2
      [[Problem Description]]
      [Google Security P***h][CVE-2017-7376]Remote code execution vulnerability in libxml2
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-7376]Remote code execution vulnerability in libxml2
      [[問題現象]]
      [Google Security P***h][CVE-2017-7376]Remote code execution vulnerability in libxml2
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libxml2/uri.c
      vendor/lenovo/libs/libdrmmtkutil/arm/libdrmmtkutil.so
      vendor/lenovo/libs/mtk_agpsd/arm/mtk_agpsd
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283099
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0638]Remote code execution vulnerability in Sys*** UI
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0638]Remote code execution vulnerability in Sys*** UI
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0638]Remote code execution vulnerability in Sys*** UI
      [[Potential Impa*** of the solution]]
      Google Security P***h
      [[Modules to be verified after taking p***h]]
      Google Security P***h
      [[問題標題]]
      [Google Security P***h][CVE-2017-0638]Remote code execution vulnerability in Sys*** UI
      [[問題現象]]
      [Google Security P***h][CVE-2017-0638]Remote code execution vulnerability in Sys*** UI
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      Google Security P***h
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      Google Security P***hN/A
    
    Associated Files:
      external/libgdx/gdx/jni/gdx2d/stb_image.h
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283107
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0391]Denial of service vulnerability in Mediaserver
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0391]Denial of service vulnerability in Mediaserver
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0391]Denial of service vulnerability in Mediaserver
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-0391]Denial of service vulnerability in Mediaserver
      [[問題現象]]
      [Google Security P***h][CVE-2017-0391]Denial of service vulnerability in Mediaserver
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libhevc/decoder/ihevcd_parse_slice_header.c
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283109
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0640]Denial of service vulnerability in Mediaserver
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0640]Denial of service vulnerability in Mediaserver
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0640]Denial of service vulnerability in Mediaserver
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-0640]Denial of service vulnerability in Mediaserver
      [[問題現象]]
      [Google Security P***h][CVE-2017-0640]Denial of service vulnerability in Mediaserver
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libavc/decoder/ih264d_api.c
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283113
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0641]Denial of service vulnerability in Mediaserver
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0641]Denial of service vulnerability in Mediaserver
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0641]Denial of service vulnerability in Mediaserver
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-0641]Denial of service vulnerability in Mediaserver
      [[問題現象]]
      [Google Security P***h][CVE-2017-0641]Denial of service vulnerability in Mediaserver
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/A
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0641]Denial of service vulnerability in Mediaserver
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0641]Denial of service vulnerability in Mediaserver
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-0641]Denial of service vulnerability in Mediaserver
      [[問題現象]]
      [Google Security P***h][CVE-2017-0641]Denial of service vulnerability in Mediaserver
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libvpx/config/arm-neon/vpx_config.asm
      external/libvpx/config/arm-neon/vpx_config.c
      external/libvpx/config/arm-neon/vpx_config.h
      external/libvpx/config/arm/vpx_config.asm
      external/libvpx/config/arm/vpx_config.c
      external/libvpx/config/arm/vpx_config.h
      external/libvpx/config/arm64/vpx_config.asm
      external/libvpx/config/arm64/vpx_config.c
      external/libvpx/config/arm64/vpx_config.h
      external/libvpx/config/generic/vpx_config.asm
      external/libvpx/config/generic/vpx_config.c
      external/libvpx/config/generic/vpx_config.h
      external/libvpx/config/mips32-dspr2/vpx_config.c
      external/libvpx/config/mips32-dspr2/vpx_config.h
      external/libvpx/config/mips32/vpx_config.c
      external/libvpx/config/mips32/vpx_config.h
      external/libvpx/config/mips64/vpx_config.c
      external/libvpx/config/mips64/vpx_config.h
      external/libvpx/config/x86/vpx_config.asm
      external/libvpx/config/x86/vpx_config.c
      external/libvpx/config/x86/vpx_config.h
      external/libvpx/config/x86_64/vpx_config.asm
      external/libvpx/config/x86_64/vpx_config.c
      external/libvpx/config/x86_64/vpx_config.h
      external/libvpx/generate_config.sh
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283115
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0642]Denial of service vulnerability in Mediaserver
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0642]Denial of service vulnerability in Mediaserver
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0642]Denial of service vulnerability in Mediaserver
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-0642]Denial of service vulnerability in Mediaserver
      [[問題現象]]
      [Google Security P***h][CVE-2017-0642]Denial of service vulnerability in Mediaserver
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libhevc/decoder/ihevcd_parse_slice_header.c
      external/libhevc/decoder/ihevcd_ref_list.c
      external/libhevc/decoder/ihevcd_structs.h
      external/libhevc/decoder/ihevcd_utils.c
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283119
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0643]Denial of service vulnerability in Mediaserver
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0643]Denial of service vulnerability in Mediaserver
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0643]Denial of service vulnerability in Mediaserver
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-0643]Denial of service vulnerability in Mediaserver
      [[問題現象]]
      [Google Security P***h][CVE-2017-0643]Denial of service vulnerability in Mediaserver
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      sampletable.cppN/A
    
    Associated Files:
      frameworks/av/media/libstagefright/SampleTable.cpp
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283127
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-5056]Remote code execution vulnerability in libxml2
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-5056]Remote code execution vulnerability in libxml2
      [[Problem Description]]
      [Google Security P***h][CVE-2017-5056]Remote code execution vulnerability in libxml2
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-5056]Remote code execution vulnerability in libxml2
      [[問題現象]]
      [Google Security P***h][CVE-2017-5056]Remote code execution vulnerability in libxml2
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libxml2/xpath.c
      vendor/lenovo/libs/libdrmmtkutil/arm/libdrmmtkutil.so
      vendor/lenovo/libs/mtk_agpsd/arm/mtk_agpsd
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283130
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-7375]Remote code execution vulnerability in libxml2
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-7375]Remote code execution vulnerability in libxml2
      [[Problem Description]]
      [Google Security P***h][CVE-2017-7375]Remote code execution vulnerability in libxml2
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-7375]Remote code execution vulnerability in libxml2
      [[問題現象]]
      [Google Security P***h][CVE-2017-7375]Remote code execution vulnerability in libxml2
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libxml2/parser.c
      vendor/lenovo/libs/libdrmmtkutil/arm/libdrmmtkutil.so
      vendor/lenovo/libs/mtk_agpsd/arm/mtk_agpsd
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283131
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0645]Elevation of privilege vulnerability i***luetooth
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0645]Elevation of privilege vulnerability i***luetooth
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0645]Elevation of privilege vulnerability i***luetooth
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-0645]Elevation of privilege vulnerability i***luetooth
      [[問題現象]]
      [Google Security P***h][CVE-2017-0645]Elevation of privilege vulnerability i***luetooth
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      packages/apps/Bluetooth/src/com/android/bluetooth/opp/BluetoothOppUtility.java
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283135
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0646]I***o***ation disclosure vulnerability i***luetooth
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0646]I***o***ation disclosure vulnerability i***luetooth
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0646]I***o***ation disclosure vulnerability i***luetooth
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-0646]I***o***ation disclosure vulnerability i***luetooth
      [[問題現象]]
      [Google Security P***h][CVE-2017-0646]I***o***ation disclosure vulnerability i***luetooth
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      system/bt/stack/btm/btm_ble_gap.c
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283137
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0647]I***o***ation disclosure vulnerability in libziparchive
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0647]I***o***ation disclosure vulnerability in libziparchive
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0647]I***o***ation disclosure vulnerability in libziparchive
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2017-0647]I***o***ation disclosure vulnerability in libziparchive
      [[問題現象]]
      [Google Security P***h][CVE-2017-0647]I***o***ation disclosure vulnerability in libziparchive
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      system/core/libziparchive/zip_archive.cc
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03283142
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2016-1839]Denial of service vulnerability in libxml2
      [[Title for Customer]]
      [Google Security P***h][CVE-2016-1839]Denial of service vulnerability in libxml2
      [[Problem Description]]
      [Google Security P***h][CVE-2016-1839]Denial of service vulnerability in libxml2
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2016-1839]Denial of service vulnerability in libxml2
      [[問題現象]]
      [Google Security P***h][CVE-2016-1839]Denial of service vulnerability in libxml2
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/libxml2/parser.c
      vendor/lenovo/libs/libdrmmtkutil/arm/libdrmmtkutil.so
      vendor/lenovo/libs/mtk_agpsd/arm/mtk_agpsd
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03284167
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2017-0636]Elevation of privilege vulnerability in MediaTek command queue driver (device specific)
      [[Title for Customer]]
      [Google Security P***h][CVE-2017-0636]Elevation of privilege vulnerability in MediaTek command queue driver (device specific)
      [[Problem Description]]
      [Google Security P***h][CVE-2017-0636]Elevation of privilege vulnerability in MediaTek command queue driver (device specific)
      [[Potential Impa*** of the solution]]
      Camera failure
      [[Modules to be verified after taking p***h]]
      camera
      [[問題標題]]
      [Google Security P***h][CVE-2017-0636]Elevation of privilege vulnerability in MediaTek command queue driver (device specific)
      [[問題現象]]
      [Google Security P***h][CVE-2017-0636]Elevation of privilege vulnerability in MediaTek command queue driver (device specific)
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      Camera 不正常
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      cameraN/A
    
    Associated Files:
      kernel-3.18/drivers/misc/mediatek/cmdq/hv1/Makefile
      kernel-3.18/drivers/misc/mediatek/cmdq/hv1/cmdq_test.c
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03284331
    Severity:
      Critical
    Description:
      [Google Security P***h][AN***D-37204197]Change Security P***h Level in Settings
      [[Title for Customer]]
      [Google Security P***h][AN***D-37204197]Change Security P***h Level in Settings
      [[Problem Description]]
      [Google Security P***h][AN***D-37204197]Change Security P***h Level in Settings
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][AN***D-37204197]Change Security P***h Level in Settings
      [[問題現象]]
      [Google Security P***h][AN***D-37204197]Change Security P***h Level in Settings
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      build/core/version_defaults.mk
      vendor/lenovo/libs/libcdm_protos/NOTICE
      vendor/lenovo/libs/libcdm_protos/README
      vendor/lenovo/libs/libdrmmtkutil/arm/libdrmmtkutil.so
      vendor/lenovo/libs/libwvdrmengine/NOTICE
      vendor/lenovo/libs/libwvdrmengine/README
      vendor/lenovo/libs/mtk_agpsd/arm/mtk_agpsd
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03288635
    Severity:
      Critical
    Description:
      [Buganizer]Security Vulnerability- Memory leak in alsps_fa***ory_unlocked_io***l in Mediatek mt6795 (such as *** RedMi Note2)
      [[Title for Customer]]
      [Buganizer]Security Vulnerability- Memory leak in alsps_fa***ory_unlocked_io***l in Mediatek mt6795 (such as *** RedMi Note2)
      [[Problem Description]]
      [Buganizer]Security Vulnerability- Memory leak in alsps_fa***ory_unlocked_io***l in Mediatek mt6795 (such as *** RedMi Note2)
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Buganizer]Security Vulnerability- Memory leak in alsps_fa***ory_unlocked_io***l in Mediatek mt6795 (such as *** RedMi Note2)
      [[問題現象]]
      [Buganizer]Security Vulnerability- Memory leak in alsps_fa***ory_unlocked_io***l in Mediatek mt6795 (such as *** RedMi Note2)
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      kernel-3.18/drivers/misc/mediatek/alsps/alsps_factory.c
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03299257
    Severity:
      Critical
    Description:
      [Google Security P***h][CVE-2015-7555]Remote code execution vulnerability in GIFLIB
      [[Title for Customer]]
      [Google Security P***h][CVE-2015-7555]Remote code execution vulnerability in GIFLIB
      [[Problem Description]]
      [Google Security P***h][CVE-2015-7555]Remote code execution vulnerability in GIFLIB
      [[Potential Impa*** of the solution]]
      N/A
      [[Modules to be verified after taking p***h]]
      N/A
      [[問題標題]]
      [Google Security P***h][CVE-2015-7555]Remote code execution vulnerability in GIFLIB
      [[問題現象]]
      [Google Security P***h][CVE-2015-7555]Remote code execution vulnerability in GIFLIB
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      N/A
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      N/AN/A
    
    Associated Files:
      external/giflib/Android.mk
      external/giflib/dgif_lib.c
      external/giflib/egif_lib.c
      external/giflib/gif_font.c
      external/giflib/gif_lib.h
      external/giflib/gifalloc.c
      external/giflib/openbsd-reallocarray.c
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03323925
    Severity:
      Critical
    Description:
      闪迪16+2FLASH（SDADL2AP_16G）无法休眠且重启
      [[問題標題]]
      系统休眠后无法唤醒
    
      [[問題現象]]
      使用Sandisk eMMC, 系统休眠后无法唤醒, 概率100%
    
      [[問題影響]]
      系统休眠后无法唤醒, 進而導致手機重啟
    
      [[問題復現步驟]]
      讓手機進入休眠
    
      [[建議驗證模塊]]
      系統可進入休眠並再喚醒
    
      [[注意: 請勿刪除此行]]
    
      [[Title for Customer]]
      Unable to suspend/resume sys***
    
      [[Problem Description]]
      When Sandisk eMMC is used, unable to suspend/resume phone and then phone reboots, probability 100%
    
      [[Impa***]]
      Unable to suspend/resume phone and then phone reboots
    
      [[Reproduced Steps]]
      Let phone enter suspend state
    
      [[Modules to be verified after taking p***h]]
      Sys*** can suspend and then wake-up
    
      [[Notice: Please don't dele***his line]]N/A
    
    Associated Files:
      kernel-3.18/drivers/mmc/core/mmc.c
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS03330870
    Severity:
      Critical
    Description:
      [St***ge][File Sys***] sdcardfs: fix available space bug
      [[Title for Customer]]
      The available space of sdcard is not updated.
      [[Problem Description]]
      When ***ng sdcardfs, the available space of sdcard is not updated after create and delete some files.
      [[Potential Impa*** of the solution]]
      None
      [[Modules to be verified after taking p***h]]
      File sys*** and St***ge
      [[問題標題]]
      內外或外卡, 可用空間未更新
      [[問題現象]]
      使用 sdcardfs, 於內外或外卡, 刪除文件後, 可用空間沒有增加
      [[解法可能帶來的影響]]
      (請填寫於此行下方，並描述如果合入這個p***h可能會有什麼trade off的改變，如perfo******e降低、UI改變等等)
      無
      [[建議驗證模塊]]
      (請填寫於此行下方，並建議客戶合了此p***h後要驗證哪些module或feature)
      文件系統N/A
    
    Associated Files:
      kernel-3.18/fs/sdcardfs/inode.c
    
    Change-Id: I2dd025eabe547e352a2db63a971dbe8c5f7b80e9

diff --git a/libziparchive/zip_archive.cc b/libziparchive/zip_archive.cc
index 986ee7208..49097ce9b 100644
--- a/libziparchive/zip_archive.cc
+++ b/libziparchive/zip_archive.cc
@@ -386,6 +386,14 @@ static int32_t ParseZipArchive(ZipArchive* archive) {
   const uint8_t* const cd_end = cd_ptr + cd_length;
   const uint8_t* ptr = cd_ptr;
   for (uint16_t i = 0; i < num_entries; i++) {
+    if (ptr > cd_end - sizeof(CentralDirectoryRecord)) {
+      ALOGW("Zip: ran off the end (at %" PRIu16 ")", i);
+#if defined(__ANDROID__)
+      android_errorWriteLog(0x534e4554, "36392138");
+#endif
+      return -1;
+    }
+
     const CentralDirectoryRecord* cdr =
         reinterpret_cast<const CentralDirectoryRecord*>(ptr);
     if (cdr->record_signature != CentralDirectoryRecord::kSignature) {
@@ -393,11 +401,6 @@ static int32_t ParseZipArchive(ZipArchive* archive) {
       return -1;
     }
 
-    if (ptr + sizeof(CentralDirectoryRecord) > cd_end) {
-      ALOGW("Zip: ran off the end (at %" PRIu16 ")", i);
-      return -1;
-    }
-
     const off64_t local_header_offset = cdr->local_file_header_offset;
     if (local_header_offset >= archive->directory_offset) {
       ALOGW("Zip: bad LFH offset %" PRId64 " at entry %" PRIu16,
