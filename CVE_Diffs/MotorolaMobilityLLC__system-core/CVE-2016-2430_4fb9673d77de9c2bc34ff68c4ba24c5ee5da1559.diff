MotorolaMobilityLLC__system-core
commit 4fb9673d77de9c2bc34ff68c4ba24c5ee5da1559
Author:     lulu2 <lulu2@lenovo.com>
AuthorDate: Thu Jun 23 10:29:02 2016 +0800
Commit:     路璐 <lulu2@lenovo.com>
CommitDate: Thu Jun 23 10:32:12 2016 +0800

    [lulu2]ALPS02766638(For_mt6735m_65t_alps-mp-m0.mp1-V2.39.1_P42)
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS02766638
    Severity:
    
    Description:
      [Patch Request] [PMS] LENOVO, Project: LENOVO6735M_65T, SW Version: alps-mp-m0.mp1-V2.39.1N/A
    
    Associated Files:
      device/mt/mt6735m_35t/ProjectConfig.mk
      device/mt/mt6735m_35u/ProjectConfig.mk
      device/mt/mt6735m_65t/ProjectConfig.mk
      device/mt/mt6735m_65u/ProjectConfig.mk
      vendor/mt/libs/mt6735m/libcdm_protos/libcdm_protos.a
    
    Patch Type:
      Customer Request
    CR ID:
      ALPS02664197
    Severity:
      Critical
    Description:
      [Google Security Patch][CVE-2016-2430]Elevation of Privilege Vulnerability in Debuggerd
      [[問題標題]]
      [Google Security P***h][CVE-2016-2430]Elevation of Privilege Vulnerability in Debuggerd
      [[問題現象]]
      [Google Security P***h][CVE-2016-2430]Elevation of Privilege Vulnerability in Debuggerd
      [[問題影響]]
      maybe security concern
      [[問題復現步驟]]
      when process crash, will dump tombstone, and it will dump ba***race/stack fun***ion, will call demangle symbol names for fun***ion name
    
      [[建議驗證模塊]]
      need test proccess crash flow and get the tombstone, you will get fun***ion name differnet as below
      before p***h
          #07 pc 00059694  /sys***/lib/libc.so (__pthread_start(void*)+48)
      after p***h Don-t-demangle-symbol-names
          #07 pc 00059694  /sys***/lib/libc.so (_ZL15__pthread_star***+48)
    
      [[Title for Customer]]
      [Google Security P***h][CVE-2016-2430]Elevation of Privilege Vulnerability in Debuggerd
      [[Problem Description]]
      [Google Security P***h][CVE-2016-2430]Elevation of Privilege Vulnerability in Debuggerd
      [[Impa***]]
      maybe security concern
      [[Reproduced Steps]]
      when process crash, will dump tombstone, and it will dump ba***race/stack fun***ion, will call demangle symbol names for fun***ion name
      [[Modules to be verified after taking p***h]]
      need test proccess crash flow and get the tombstone, you will get fun***ion name differnet as below
      before p***h
          #07 pc 00059694  /sys***/lib/libc.so (__pthread_start(void*)+48)
      after p***h Don-t-demangle-symbol-names
          #07 pc 00059694  /sys***/lib/libc.so (_ZL15__pthread_star***+48)N/A
    
    Associated Files:
      system/core/libbacktrace/Backtrace.cpp
    
    Change-Id: I5af6f6fd17bb57c69dbef49ef8ef242fd651d488
    (cherry picked from commit 928dabe530bbd59325828abfd74eb062fef4530d)

diff --git a/libbacktrace/Backtrace.cpp b/libbacktrace/Backtrace.cpp
index 97f0ef445..42769ed90 100644
--- a/libbacktrace/Backtrace.cpp
+++ b/libbacktrace/Backtrace.cpp
@@ -54,24 +54,8 @@ Backtrace::~Backtrace() {
   }
 }
 
-extern "C" char* __cxa_demangle(const char* mangled, char* buf, size_t* len,
-                                int* status);
-
 std::string Backtrace::GetFunctionName(uintptr_t pc, uintptr_t* offset) {
   std::string func_name = GetFunctionNameRaw(pc, offset);
-  if (!func_name.empty()) {
-#if defined(__APPLE__)
-    // Mac OS' __cxa_demangle demangles "f" as "float"; last tested on 10.7.
-    if (func_name[0] != '_') {
-      return func_name;
-    }
-#endif
-    char* name = __cxa_demangle(func_name.c_str(), 0, 0, 0);
-    if (name) {
-      func_name = name;
-      free(name);
-    }
-  }
   return func_name;
 }
 
