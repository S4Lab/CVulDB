mpc-hc__FFmpeg
commit 849b9d34c7ef70b370c53e7af3940f51cbc07d0f
Author:     Michael Niedermayer <michaelni@gmx.at>
AuthorDate: Fri Feb 7 15:07:23 2014 +0100
Commit:     Anton Khirnov <anton@khirnov.net>
CommitDate: Tue Aug 5 14:58:03 2014 +0000

    wmalosslessdec: fix mclms_coeffs* array size
    
    Fixes corruption of context
    
    Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
    CC:libav-stable@libav.org
    Bug-Id: CVE-2014-2098
    Signed-off-by: Anton Khirnov <anton@khirnov.net>

diff --git a/libavcodec/wmalosslessdec.c b/libavcodec/wmalosslessdec.c
index 6ee27d3ddf..b8a1776e59 100644
--- a/libavcodec/wmalosslessdec.c
+++ b/libavcodec/wmalosslessdec.c
@@ -129,8 +129,8 @@ typedef struct WmallDecodeCtx {
 
     int8_t  mclms_order;
     int8_t  mclms_scaling;
-    int16_t mclms_coeffs[128];
-    int16_t mclms_coeffs_cur[4];
+    int16_t mclms_coeffs[WMALL_MAX_CHANNELS * WMALL_MAX_CHANNELS * 32];
+    int16_t mclms_coeffs_cur[WMALL_MAX_CHANNELS * WMALL_MAX_CHANNELS];
     int16_t mclms_prevvalues[WMALL_MAX_CHANNELS * 2 * 32];
     int16_t mclms_updates[WMALL_MAX_CHANNELS * 2 * 32];
     int     mclms_recent;
