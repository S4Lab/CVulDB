mpc-hc__FFmpeg
commit 0af49a63c7f87876486ab09482d5b26b95abce60
Author:     Anton Khirnov <anton@khirnov.net>
AuthorDate: Fri Sep 28 15:42:29 2012 +0200
Commit:     Anton Khirnov <anton@khirnov.net>
CommitDate: Sat Sep 29 09:27:59 2012 +0200

    avidec: use actually read size instead of requested size
    
    Fixes CVE-2012-2788

diff --git a/libavformat/avidec.c b/libavformat/avidec.c
index b70367fb30..b2a06edd8c 100644
--- a/libavformat/avidec.c
+++ b/libavformat/avidec.c
@@ -1116,7 +1116,7 @@ resync:
             }
             ast->frame_offset += get_duration(ast, pkt->size);
         }
-        ast->remaining -= size;
+        ast->remaining -= err;
         if(!ast->remaining){
             avi->stream_index= -1;
             ast->packet_size= 0;
