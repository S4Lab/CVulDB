mpc-hc__FFmpeg
commit 0181ae9af2de1526464d23209b82e6674d362f5d
Author:     Luca Barbato <lu_zero@gentoo.org>
AuthorDate: Mon May 25 22:30:10 2015 +0200
Commit:     Luca Barbato <lu_zero@gentoo.org>
CommitDate: Sat May 30 16:28:32 2015 +0200

    h264: Make sure reinit failures mark the context as not initialized
    
    Bug-Id: CVE-2015-3417
    CC: libav-stable@libav.org

diff --git a/libavcodec/h264_slice.c b/libavcodec/h264_slice.c
index 1cee6346de..a63f45ad20 100644
--- a/libavcodec/h264_slice.c
+++ b/libavcodec/h264_slice.c
@@ -1171,6 +1171,7 @@ int ff_h264_decode_slice_header(H264Context *h, H264SliceContext *sl)
     }
 
     if (h->context_initialized && needs_reinit) {
+        h->context_initialized = 0;
         if (sl != h->slice_ctx) {
             av_log(h->avctx, AV_LOG_ERROR,
                    "changing width %d -> %d / height %d -> %d on "
