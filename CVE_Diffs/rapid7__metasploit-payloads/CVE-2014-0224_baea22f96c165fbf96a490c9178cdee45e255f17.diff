rapid7__metasploit-payloads
commit baea22f96c165fbf96a490c9178cdee45e255f17
Author:     Tod Beardsley <tod_beardsley@rapid7.com>
AuthorDate: Thu Jun 5 11:57:31 2014 -0500
Commit:     Tod Beardsley <tod_beardsley@rapid7.com>
CommitDate: Thu Jun 5 11:57:31 2014 -0500

    Bump to 0.9.8za (CVE-2014-0224 and friends)
    
    Meterpreter's build scripts dynamically pull in OpenSSL from the
    canonical remote site, https://openssl.org.
    
    This ensures that we pull in 0.9.8za, which is patched against the
    various OpenSSL vulns described at
    
    https://www.openssl.org/news/secadv_20140605.txt
    
    The SHA1sum should be:
    
    adca1eb1a103a5536b24e1ed7e45051e2939731  openssl-0.9.8za.tar.gz
    
    The MD5sum should be:
    
    2f989915f8fea49aa1bc37aa58500cce  openssl-0.9.8za.tar.gz

diff --git a/c/meterpreter/Makefile b/c/meterpreter/Makefile
index f59752d4..7265dff4 100644
--- a/c/meterpreter/Makefile
+++ b/c/meterpreter/Makefile
@@ -106,17 +106,17 @@ $(COMPILED)/libdl.so:
 	$(MAKE) -C $(BIONIC)/libdl && [ -f $(BIONIC)/libdl/libdl.so ]
 	cp $(BIONIC)/libdl/libdl.so $(COMPILED)/libdl.so
 
-$(COMPILED)/libcrypto.so: $(build_tmp)/openssl-0.9.8o/libssl.so
-	cp $(build_tmp)/openssl-0.9.8o/libcrypto.so source/bionic/compiled/libcrypto.so
+$(COMPILED)/libcrypto.so: $(build_tmp)/openssl-0.9.8za/libssl.so
+	cp $(build_tmp)/openssl-0.9.8za/libcrypto.so source/bionic/compiled/libcrypto.so
 
-$(COMPILED)/libssl.so: $(build_tmp)/openssl-0.9.8o/libssl.so
-	cp $(build_tmp)/openssl-0.9.8o/libssl.so source/bionic/compiled/libssl.so
+$(COMPILED)/libssl.so: $(build_tmp)/openssl-0.9.8za/libssl.so
+	cp $(build_tmp)/openssl-0.9.8za/libssl.so source/bionic/compiled/libssl.so
 
-$(build_tmp)/openssl-0.9.8o/libssl.so:
+$(build_tmp)/openssl-0.9.8za/libssl.so:
 	[ -d $(build_tmp) ] || mkdir $(build_tmp)
-	[ -f $(build_tmp)/openssl-0.9.8o.tar.gz ] || wget -O $(build_tmp)/openssl-0.9.8o.tar.gz https://www.openssl.org/source/openssl-0.9.8o.tar.gz
-	[ -d $(build_tmp)/openssl-0.9.8o ] || tar -C $(build_tmp)/ -xzf $(build_tmp)/openssl-0.9.8o.tar.gz
-	(cd $(build_tmp)/openssl-0.9.8o &&                                                       \
+	[ -f $(build_tmp)/openssl-0.9.8za.tar.gz ] || wget -O $(build_tmp)/openssl-0.9.8za.tar.gz https://www.openssl.org/source/openssl-0.9.8za.tar.gz
+	[ -d $(build_tmp)/openssl-0.9.8za ] || tar -C $(build_tmp)/ -xzf $(build_tmp)/openssl-0.9.8za.tar.gz
+	(cd $(build_tmp)/openssl-0.9.8za &&                                                       \
 		cat Configure | grep -v 'linux-msf' | \
 		sed -e 's#my %table=(#my %table=(     \
 			"linux-msf", "gcc:$(OSSL_CFLAGS) -DL_ENDIAN -DTERMIO -Wall::-D_REENTRANT::$(OSSL_CFLAGS) -ldl:BN_LLONG $${x86_gcc_des} $${x86_gcc_opts}:$${x86_elf_asm}:dlfcn:linux-shared:$(OSSL_CFLAGS) -fPIC::.so.\\$$\\$$(SHLIB_MAJOR).\\$$\\$$(SHLIB_MINOR)",\
@@ -125,7 +125,7 @@ $(build_tmp)/openssl-0.9.8o/libssl.so:
 		grep linux-msf Configure && \
 		./Configure --prefix=/tmp/out threads shared no-hw no-dlfcn no-zlib no-krb5 no-idea 386 linux-msf \
 	)
-	(cd $(build_tmp)/openssl-0.9.8o && $(MAKE) depend all ; [ -f libssl.so.0.9.8 -a -f libcrypto.so.0.9.8 ] )
+	(cd $(build_tmp)/openssl-0.9.8za && $(MAKE) depend all ; [ -f libssl.so.0.9.8 -a -f libcrypto.so.0.9.8 ] )
 
 $(COMPILED)/libpcap.so: $(build_tmp)/libpcap-1.1.1/libpcap.so.1.1.1
 	cp $(build_tmp)/libpcap-1.1.1/libpcap.so.1.1.1 $(COMPILED)/libpcap.so
@@ -208,7 +208,7 @@ clean-pcap:
 	rm -r $(build_tmp)/libpcap-1.1.1 || true
 
 clean-ssl:
-	make -C $(build_tmp)/openssl-0.9.8o/ clean
+	make -C $(build_tmp)/openssl-0.9.8za/ clean
 
 really-clean: clean clean-ssl clean-pcap depclean
 
diff --git a/c/meterpreter/source/openssl/build.sh b/c/meterpreter/source/openssl/build.sh
index 8babe2dc..6423724f 100755
--- a/c/meterpreter/source/openssl/build.sh
+++ b/c/meterpreter/source/openssl/build.sh
@@ -2,8 +2,8 @@
 
 set -e
 
-#OSSL=openssl-0.9.8o
-OSSL=openssl-0.9.8n
+#OSSL=openssl-0.9.8n
+OSSL=openssl-0.9.8za
 
 cd $OSSL
 
