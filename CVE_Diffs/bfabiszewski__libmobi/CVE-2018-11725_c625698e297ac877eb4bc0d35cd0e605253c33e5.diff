bfabiszewski__libmobi
commit c625698e297ac877eb4bc0d35cd0e605253c33e5
Author:     Bartek Fabiszewski <github@fabiszewski.net>
AuthorDate: Wed Jun 20 11:55:53 2018 +0200
Commit:     Bartek Fabiszewski <github@fabiszewski.net>
CommitDate: Wed Jun 20 11:55:53 2018 +0200

    Fix: read beyond buffer (CVE-2018-11725)

diff --git a/src/index.c b/src/index.c
index 22a0289..289706b 100644
--- a/src/index.c
+++ b/src/index.c
@@ -352,7 +352,7 @@ static MOBI_RET mobi_parse_index_entry(MOBIIndx *indx, const MOBIIdxt idxt, cons
     }
     /* save original record maxlen */
     const size_t buf_maxlen = buf->maxlen;
-    if (buf->offset + entry_length > buf_maxlen) {
+    if (buf->offset + entry_length >= buf_maxlen) {
         debug_print("Entry length too long: %zu\n", entry_length);
         return MOBI_DATA_CORRUPT;
     }
