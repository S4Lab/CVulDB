chunkeey__apm82181-lede
commit 0bcff6b0db4bd214edc7df5df1ce5d47f424c424
Author:     Koen Vandeputte <koen.vandeputte@ncentric.com>
AuthorDate: Thu Oct 4 11:26:19 2018 +0200
Commit:     Koen Vandeputte <koen.vandeputte@ncentric.com>
CommitDate: Thu Oct 4 16:15:03 2018 +0200

    kernel: bump 4.9 to 4.9.131
    
    Refreshed all patches.
    
    Fixes CVE:
    
    - CVE-2018-10880
    - CVE-2018-7755
    
    Compile-tested on: ar71xx
    Runtime-tested on: ar71xx
    
    Signed-off-by: Koen Vandeputte <koen.vandeputte@ncentric.com>

diff --git a/include/kernel-version.mk b/include/kernel-version.mk
index 9c0a54bdf1..861b4c5a7a 100644
--- a/include/kernel-version.mk
+++ b/include/kernel-version.mk
@@ -3,12 +3,12 @@
 LINUX_RELEASE?=1
 
 LINUX_VERSION-3.18 = .123
-LINUX_VERSION-4.9 = .130
 LINUX_VERSION-4.14 = .73
+LINUX_VERSION-4.9 = .131
 
 LINUX_KERNEL_HASH-3.18.123 = c10de32c9b31fb619b016a00d77afc394db5a4542e258e927f06a5ead86f8c64
-LINUX_KERNEL_HASH-4.9.130 = 60db3e6a8b00230d5a7c0c8907ef6876702e99c89980bb624f7b649b638b0a7f
 LINUX_KERNEL_HASH-4.14.73 = 999e38141ccc447df7bf7ce10b8803c12b32274b76d3d5400bf3fd88eee0e31e
+LINUX_KERNEL_HASH-4.9.131 = 57db3295469d3990af93703a97b07f1e8a14920bf3f5b68ce0330a02e7aa5d60
 
 remove_uri_prefix=$(subst git://,,$(subst http://,,$(subst https://,,$(1))))
 sanitize_uri=$(call qstrip,$(subst @,_,$(subst :,_,$(subst .,_,$(subst -,_,$(subst /,_,$(1)))))))
diff --git a/target/linux/layerscape/patches-4.9/816-tty-serial-support-layerscape.patch b/target/linux/layerscape/patches-4.9/816-tty-serial-support-layerscape.patch
index dd28ef6c04..3271563f7f 100644
--- a/target/linux/layerscape/patches-4.9/816-tty-serial-support-layerscape.patch
+++ b/target/linux/layerscape/patches-4.9/816-tty-serial-support-layerscape.patch
@@ -24,7 +24,7 @@ Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
  struct lpuart_port {
  	struct uart_port	port;
  	struct clk		*clk;
-@@ -1348,6 +1350,18 @@ lpuart_set_termios(struct uart_port *por
+@@ -1349,6 +1351,18 @@ lpuart_set_termios(struct uart_port *por
  	/* ask the core to calculate the divisor */
  	baud = uart_get_baud_rate(port, termios, old, 50, port->uartclk / 16);
  
@@ -43,7 +43,7 @@ Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
  	spin_lock_irqsave(&sport->port.lock, flags);
  
  	sport->port.read_status_mask = 0;
-@@ -1397,22 +1411,11 @@ lpuart_set_termios(struct uart_port *por
+@@ -1398,22 +1412,11 @@ lpuart_set_termios(struct uart_port *por
  	/* restore control register */
  	writeb(old_cr2, sport->port.membase + UARTCR2);
  
@@ -69,7 +69,7 @@ Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
  	}
  
  	spin_unlock_irqrestore(&sport->port.lock, flags);
-@@ -1640,6 +1643,13 @@ lpuart_console_write(struct console *co,
+@@ -1641,6 +1644,13 @@ lpuart_console_write(struct console *co,
  {
  	struct lpuart_port *sport = lpuart_ports[co->index];
  	unsigned char  old_cr2, cr2;
@@ -83,7 +83,7 @@ Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
  
  	/* first save CR2 and then disable interrupts */
  	cr2 = old_cr2 = readb(sport->port.membase + UARTCR2);
-@@ -1654,6 +1664,9 @@ lpuart_console_write(struct console *co,
+@@ -1655,6 +1665,9 @@ lpuart_console_write(struct console *co,
  		barrier();
  
  	writeb(old_cr2, sport->port.membase + UARTCR2);
@@ -93,7 +93,7 @@ Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
  }
  
  static void
-@@ -1661,6 +1674,13 @@ lpuart32_console_write(struct console *c
+@@ -1662,6 +1675,13 @@ lpuart32_console_write(struct console *c
  {
  	struct lpuart_port *sport = lpuart_ports[co->index];
  	unsigned long  old_cr, cr;
@@ -107,7 +107,7 @@ Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
  
  	/* first save CR2 and then disable interrupts */
  	cr = old_cr = lpuart32_read(sport->port.membase + UARTCTRL);
-@@ -1675,6 +1695,9 @@ lpuart32_console_write(struct console *c
+@@ -1676,6 +1696,9 @@ lpuart32_console_write(struct console *c
  		barrier();
  
  	lpuart32_write(old_cr, sport->port.membase + UARTCTRL);
@@ -117,7 +117,7 @@ Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
  }
  
  /*
-@@ -1899,13 +1922,13 @@ static int lpuart_probe(struct platform_
+@@ -1900,13 +1923,13 @@ static int lpuart_probe(struct platform_
  
  	ret = of_alias_get_id(np, "serial");
  	if (ret < 0) {
@@ -137,7 +137,7 @@ Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
  	sport->port.line = ret;
  	sport->lpuart32 = of_device_is_compatible(np, "fsl,ls1021a-lpuart");
  
-@@ -1987,6 +2010,7 @@ static int lpuart_remove(struct platform
+@@ -1988,6 +2011,7 @@ static int lpuart_remove(struct platform
  	struct lpuart_port *sport = platform_get_drvdata(pdev);
  
  	uart_remove_one_port(&lpuart_reg, &sport->port);
@@ -145,7 +145,7 @@ Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
  
  	clk_disable_unprepare(sport->clk);
  
-@@ -2071,12 +2095,10 @@ static int lpuart_resume(struct device *
+@@ -2072,12 +2096,10 @@ static int lpuart_resume(struct device *
  
  	if (sport->lpuart_dma_rx_use) {
  		if (sport->port.irq_wake) {
