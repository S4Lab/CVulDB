chunkeey__apm82181-lede
commit bbd02c6fb75cbe7b533deee2045a3ffaa60e9c8f
Author:     Jonas Gorski <jogo@openwrt.org>
AuthorDate: Sun May 12 10:55:12 2013 +0000
Commit:     Jonas Gorski <jogo@openwrt.org>
CommitDate: Sun May 12 10:55:12 2013 +0000

    kernel: fix CVE-2013-1763 in older kernels
    
    Newer kernels were already fixed by upstream.
    
    Signed-off-by: Jonas Gorski <jogo@openwrt.org>
    
    SVN-Revision: 36607

diff --git a/target/linux/generic/patches-3.3/090-CVE-2013-1763.patch b/target/linux/generic/patches-3.3/090-CVE-2013-1763.patch
new file mode 100644
index 0000000000..6c0c2236dd
--- /dev/null
+++ b/target/linux/generic/patches-3.3/090-CVE-2013-1763.patch
@@ -0,0 +1,27 @@
+From 6e601a53566d84e1ffd25e7b6fe0b6894ffd79c0 Mon Sep 17 00:00:00 2001
+From: Mathias Krause <minipli@googlemail.com>
+Date: Sat, 23 Feb 2013 01:13:47 +0000
+Subject: sock_diag: Fix out-of-bounds access to sock_diag_handlers[]
+
+Userland can send a netlink message requesting SOCK_DIAG_BY_FAMILY
+with a family greater or equal then AF_MAX -- the array size of
+sock_diag_handlers[]. The current code does not test for this
+condition therefore is vulnerable to an out-of-bound access opening
+doors for a privilege escalation.
+
+Signed-off-by: Mathias Krause <minipli@googlemail.com>
+Acked-by: Eric Dumazet <edumazet@google.com>
+Signed-off-by: David S. Miller <davem@davemloft.net>
+---
+--- a/net/core/sock_diag.c
++++ b/net/core/sock_diag.c
+@@ -126,6 +126,9 @@ static int __sock_diag_rcv_msg(struct sk
+ 	if (nlmsg_len(nlh) < sizeof(*req))
+ 		return -EINVAL;
+ 
++	if (req->sdiag_family >= AF_MAX)
++		return -EINVAL;
++
+ 	hndl = sock_diag_lock_handler(req->sdiag_family);
+ 	if (hndl == NULL)
+ 		err = -ENOENT;
diff --git a/target/linux/generic/patches-3.6/090-CVE-2013-1763.patch b/target/linux/generic/patches-3.6/090-CVE-2013-1763.patch
new file mode 100644
index 0000000000..8fe1884320
--- /dev/null
+++ b/target/linux/generic/patches-3.6/090-CVE-2013-1763.patch
@@ -0,0 +1,27 @@
+From 6e601a53566d84e1ffd25e7b6fe0b6894ffd79c0 Mon Sep 17 00:00:00 2001
+From: Mathias Krause <minipli@googlemail.com>
+Date: Sat, 23 Feb 2013 01:13:47 +0000
+Subject: sock_diag: Fix out-of-bounds access to sock_diag_handlers[]
+
+Userland can send a netlink message requesting SOCK_DIAG_BY_FAMILY
+with a family greater or equal then AF_MAX -- the array size of
+sock_diag_handlers[]. The current code does not test for this
+condition therefore is vulnerable to an out-of-bound access opening
+doors for a privilege escalation.
+
+Signed-off-by: Mathias Krause <minipli@googlemail.com>
+Acked-by: Eric Dumazet <edumazet@google.com>
+Signed-off-by: David S. Miller <davem@davemloft.net>
+---
+--- a/net/core/sock_diag.c
++++ b/net/core/sock_diag.c
+@@ -121,6 +121,9 @@ static int __sock_diag_rcv_msg(struct sk
+ 	if (nlmsg_len(nlh) < sizeof(*req))
+ 		return -EINVAL;
+ 
++	if (req->sdiag_family >= AF_MAX)
++		return -EINVAL;
++
+ 	hndl = sock_diag_lock_handler(req->sdiag_family);
+ 	if (hndl == NULL)
+ 		err = -ENOENT;
