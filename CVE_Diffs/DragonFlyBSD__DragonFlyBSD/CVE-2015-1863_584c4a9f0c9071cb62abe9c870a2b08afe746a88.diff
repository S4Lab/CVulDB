DragonFlyBSD__DragonFlyBSD
commit 584c4a9f0c9071cb62abe9c870a2b08afe746a88
Author:     Matthew Dillon <dillon@apollo.backplane.com>
AuthorDate: Thu Apr 23 16:56:54 2015 -0700
Commit:     Matthew Dillon <dillon@apollo.backplane.com>
CommitDate: Thu Apr 23 16:56:54 2015 -0700

    wpa_supplicant - CVE-2015-1863 (dead code in DFly so not an issue)
    
    * Correct buffer overflow from CVE-2015-1863.
    
    * Note that this code is NOT compiled into DragonFly's wpa_supplicant anyway,
      so the security advisory is not applicable to DragonFly.  Fix the code
      anyway so it isn't accidently enabled with the security hole before the
      next vendor update.

diff --git a/contrib/wpa_supplicant/src/p2p/p2p.c b/contrib/wpa_supplicant/src/p2p/p2p.c
index 957dee5bd9..44db0388b4 100644
--- a/contrib/wpa_supplicant/src/p2p/p2p.c
+++ b/contrib/wpa_supplicant/src/p2p/p2p.c
@@ -671,6 +671,7 @@ int p2p_add_device(struct p2p_data *p2p, const u8 *addr, int freq,
 	if (os_memcmp(addr, p2p_dev_addr, ETH_ALEN) != 0)
 		os_memcpy(dev->interface_addr, addr, ETH_ALEN);
 	if (msg.ssid &&
+	    msg.ssid[1] <= sizeof(dev->oper_ssid) &&
 	    (msg.ssid[1] != P2P_WILDCARD_SSID_LEN ||
 	     os_memcmp(msg.ssid + 2, P2P_WILDCARD_SSID, P2P_WILDCARD_SSID_LEN)
 	     != 0)) {
