DragonFlyBSD__DragonFlyBSD
commit a3104a5c6b09f7b68e15e99b0d7ed9c0847e2675
Author:     Sepherosa Ziehau <sephe@dragonflybsd.org>
AuthorDate: Fri Mar 16 13:24:03 2007 +0000
Commit:     Sepherosa Ziehau <sephe@dragonflybsd.org>
CommitDate: Fri Mar 16 13:24:03 2007 +0000

    Add a fix for CVE-2007-1218
    
    Obtained-from: tcpdump.org

diff --git a/usr.sbin/tcpdump/tcpdump/Makefile b/usr.sbin/tcpdump/tcpdump/Makefile
index dcd9d1d05e..cb99667111 100644
--- a/usr.sbin/tcpdump/tcpdump/Makefile
+++ b/usr.sbin/tcpdump/tcpdump/Makefile
@@ -1,5 +1,5 @@
 # $FreeBSD: src/usr.sbin/tcpdump/tcpdump/Makefile,v 1.25.2.6 2002/07/05 11:30:32 fenner Exp $
-# $DragonFly: src/usr.sbin/tcpdump/tcpdump/Makefile,v 1.7 2006/12/25 00:42:01 pavalos Exp $
+# $DragonFly: src/usr.sbin/tcpdump/tcpdump/Makefile,v 1.7.2.1 2007/03/16 13:24:03 sephe Exp $
 
 
 TCPDUMP_DISTDIR?= ${.CURDIR}/../../../contrib/tcpdump-3.9
@@ -45,7 +45,7 @@ SRCS+=	print-ip6.c print-ip6opts.c print-mobility.c \
 	print-ospf6.c print-dhcp6.c
 
 CONTRIBDIR= ${TCPDUMP_DISTDIR}
-SRCS+=  print-ospf6.c.patch
+SRCS+=  print-ospf6.c.patch print-802_11.c.patch
 CFLAGS+=	-DINET6
 .endif
 .if ${MACHINE_ARCH} != "i386"
diff --git a/usr.sbin/tcpdump/tcpdump/print-802_11.c.patch b/usr.sbin/tcpdump/tcpdump/print-802_11.c.patch
new file mode 100644
index 0000000000..87f92dd348
--- /dev/null
+++ b/usr.sbin/tcpdump/tcpdump/print-802_11.c.patch
@@ -0,0 +1,17 @@
+$DragonFly: src/usr.sbin/tcpdump/tcpdump/Attic/print-802_11.c.patch,v 1.1.2.2 2007/03/16 13:24:03 sephe Exp $
+Index: print-802_11.c
+===================================================================
+RCS file: /opt/df_cvs/src/contrib/tcpdump-3.9/print-802_11.c,v
+retrieving revision 1.1.1.1
+diff -u -r1.1.1.1 print-802_11.c
+--- print-802_11.c	25 Dec 2006 00:17:38 -0000	1.1.1.1
++++ print-802_11.c	16 Mar 2007 12:50:08 -0000
+@@ -264,7 +264,7 @@
+ 
+ 			if (pbody->tim.length <= 3)
+ 				break;
+-			if (pbody->rates.length > sizeof pbody->tim.bitmap)
++			if (pbody->tim.length - 3 > sizeof pbody->tim.bitmap)
+ 				return;
+ 			if (!TTEST2(*(p + offset), pbody->tim.length - 3))
+ 				return;
