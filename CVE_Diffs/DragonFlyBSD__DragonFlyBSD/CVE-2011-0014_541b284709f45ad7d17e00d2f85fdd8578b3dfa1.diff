DragonFlyBSD__DragonFlyBSD
commit 541b284709f45ad7d17e00d2f85fdd8578b3dfa1
Author:     Peter Avalos <pavalos@dragonflybsd.org>
AuthorDate: Tue Feb 8 19:16:20 2011 -1000
Commit:     Peter Avalos <pavalos@dragonflybsd.org>
CommitDate: Tue Feb 8 19:16:20 2011 -1000

    openssl:  Fix CVE-2011-0014.

diff --git a/crypto/openssl/ssl/t1_lib.c b/crypto/openssl/ssl/t1_lib.c
index eea59163aa..99ab190c0e 100644
--- a/crypto/openssl/ssl/t1_lib.c
+++ b/crypto/openssl/ssl/t1_lib.c
@@ -917,6 +917,7 @@ int ssl_parse_clienthello_tlsext(SSL *s, unsigned char **p, unsigned char *d, in
 						}
 					n2s(data, idsize);
 					dsize -= 2 + idsize;
+					size -= 2 + idsize;
 					if (dsize < 0)
 						{
 						*al = SSL_AD_DECODE_ERROR;
@@ -955,9 +956,14 @@ int ssl_parse_clienthello_tlsext(SSL *s, unsigned char **p, unsigned char *d, in
 					}
 
 				/* Read in request_extensions */
+				if (size < 2)
+					{
+					*al = SSL_AD_DECODE_ERROR;
+					return 0;
+					}
 				n2s(data,dsize);
 				size -= 2;
-				if (dsize > size) 
+				if (dsize != size)
 					{
 					*al = SSL_AD_DECODE_ERROR;
 					return 0;
