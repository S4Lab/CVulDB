DragonFlyBSD__DragonFlyBSD
commit ea24d4f2298bf4838ac6437d7cc653a60fa97d91
Author:     Matthew Dillon <dillon@apollo.backplane.com>
AuthorDate: Thu Jan 14 09:06:23 2016 -0800
Commit:     Matthew Dillon <dillon@apollo.backplane.com>
CommitDate: Thu Jan 14 09:06:23 2016 -0800

    ssh - Remove undocumented roaming support CVE-2016-0777 CVE-2016-0778
    
    * Remove client-side 'roaming' feature as per openbsd patch.
    
    * CVE-2016-0777 CVE-2016-0778.  A malicious server can trick the client
      into potentially leaking key material.

diff --git a/crypto/openssh/readconf.c b/crypto/openssh/readconf.c
index 9c24952130..c339873149 100644
--- a/crypto/openssh/readconf.c
+++ b/crypto/openssh/readconf.c
@@ -1658,7 +1658,7 @@ initialize_options(Options * options)
 	options->tun_remote = -1;
 	options->local_command = NULL;
 	options->permit_local_command = -1;
-	options->use_roaming = -1;
+	options->use_roaming = 0;	/* default off CVE-2016-0777,0778 */
 	options->visual_host_key = -1;
 	options->ip_qos_interactive = -1;
 	options->ip_qos_bulk = -1;
@@ -1864,8 +1864,7 @@ fill_default_options(Options * options)
 		options->tun_remote = SSH_TUNID_ANY;
 	if (options->permit_local_command == -1)
 		options->permit_local_command = 0;
-	if (options->use_roaming == -1)
-		options->use_roaming = 1;
+	options->use_roaming = 0;	/* force off CVE-2016-0777,0778 */
 	if (options->visual_host_key == -1)
 		options->visual_host_key = 0;
 	if (options->ip_qos_interactive == -1)
diff --git a/crypto/openssh/ssh.c b/crypto/openssh/ssh.c
index 9aeaf49149..6973b23de3 100644
--- a/crypto/openssh/ssh.c
+++ b/crypto/openssh/ssh.c
@@ -1878,9 +1878,6 @@ ssh_session2(void)
 			fork_postauth();
 	}
 
-	if (options.use_roaming)
-		request_roaming();
-
 	return client_loop(tty_flag, tty_flag ?
 	    options.escape_char : SSH_ESCAPECHAR_NONE, id);
 }
