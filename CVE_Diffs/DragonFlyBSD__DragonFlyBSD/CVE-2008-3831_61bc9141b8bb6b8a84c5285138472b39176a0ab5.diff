DragonFlyBSD__DragonFlyBSD
commit 61bc9141b8bb6b8a84c5285138472b39176a0ab5
Author:     Hasso Tepper <hasso@dragonflybsd.org>
AuthorDate: Mon Oct 27 03:42:33 2008 +0000
Commit:     Hasso Tepper <hasso@dragonflybsd.org>
CommitDate: Mon Oct 27 03:42:33 2008 +0000

    Fix CVE-2008-3831. Affects the Intel G33 series and newer only.
    
    Obtained-from: DRM git

diff --git a/sys/dev/drm/i915_dma.c b/sys/dev/drm/i915_dma.c
index 6e743b5e8f..6e7be66122 100644
--- a/sys/dev/drm/i915_dma.c
+++ b/sys/dev/drm/i915_dma.c
@@ -24,7 +24,7 @@
  * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
  * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  *
- * $DragonFly: src/sys/dev/drm/i915_dma.c,v 1.1 2008/04/05 18:12:29 hasso Exp $
+ * $DragonFly: src/sys/dev/drm/i915_dma.c,v 1.2 2008/10/27 03:42:33 hasso Exp $
  */
 
 #include "drmP.h"
@@ -1435,7 +1435,7 @@ struct drm_ioctl_desc i915_ioctls[] = {
 	DRM_IOCTL_DEF(DRM_I915_GET_VBLANK_PIPE,  i915_vblank_pipe_get, DRM_AUTH ),
 	DRM_IOCTL_DEF(DRM_I915_VBLANK_SWAP, i915_vblank_swap, DRM_AUTH),
 	DRM_IOCTL_DEF(DRM_I915_MMIO, i915_mmio, DRM_AUTH),
-	DRM_IOCTL_DEF(DRM_I915_HWS_ADDR, i915_set_status_page, DRM_AUTH),
+	DRM_IOCTL_DEF(DRM_I915_HWS_ADDR, i915_set_status_page, DRM_AUTH|DRM_MASTER|DRM_ROOT_ONLY),
 #ifdef I915_HAVE_BUFFER
 	DRM_IOCTL_DEF(DRM_I915_EXECBUFFER, i915_execbuffer, DRM_AUTH),
 #endif
