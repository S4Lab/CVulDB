DragonFlyBSD__DragonFlyBSD
commit 0d8e774286c15f265b9dd724e0e4a52b5b5f11ea
Author:     Sepherosa Ziehau <sephe@dragonflybsd.org>
AuthorDate: Wed Aug 22 13:47:18 2007 +0000
Commit:     Sepherosa Ziehau <sephe@dragonflybsd.org>
CommitDate: Wed Aug 22 13:47:18 2007 +0000

    MFC: ieee80211_output.c rev 1.23
      Fix for CVE-2006-7180
    
      Obtained-from: MadWifi via Sam Leffler

diff --git a/sys/netproto/802_11/wlan/ieee80211_output.c b/sys/netproto/802_11/wlan/ieee80211_output.c
index cbe4d61b78..c87ae177df 100644
--- a/sys/netproto/802_11/wlan/ieee80211_output.c
+++ b/sys/netproto/802_11/wlan/ieee80211_output.c
@@ -30,7 +30,7 @@
  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  *
  * $FreeBSD: src/sys/net80211/ieee80211_output.c,v 1.26.2.8 2006/09/02 15:06:04 sam Exp $
- * $DragonFly: src/sys/netproto/802_11/wlan/ieee80211_output.c,v 1.21 2007/05/07 14:12:16 sephe Exp $
+ * $DragonFly: src/sys/netproto/802_11/wlan/ieee80211_output.c,v 1.21.2.1 2007/08/22 13:47:18 sephe Exp $
  */
 
 #include "opt_inet.h"
@@ -528,6 +528,7 @@ ieee80211_encap(struct ieee80211com *ic, struct mbuf *m,
 			    eh.ether_dhost, ":", __func__,
 			    ic->ic_def_txkey);
 			ic->ic_stats.is_tx_nodefkey++;
+			goto bad;
 		}
 	} else
 		key = NULL;
