postgres__postgres
commit aed766ab55c7d0f25653427789f78a6e12c2ae7b
Author:     Noah Misch <noah@leadboat.com>
AuthorDate: Mon Aug 8 10:07:46 2016 -0400
Commit:     Noah Misch <noah@leadboat.com>
CommitDate: Mon Aug 8 10:07:53 2016 -0400

    Sort out paired double quotes in \connect, \password and \crosstabview.
    
    In arguments, these meta-commands wrongly treated each pair as closing
    the double quoted string.  Make the behavior match the documentation.
    This is a compatibility break, but I more expect to find software with
    untested reliance on the documented behavior than software reliant on
    today's behavior.  Back-patch to 9.1 (all supported versions).
    
    Reviewed by Tom Lane and Peter Eisentraut.
    
    Security: CVE-2016-5424

diff --git a/src/bin/psql/psqlscan.l b/src/bin/psql/psqlscan.l
index 8cef0f248f..303ce4d3b9 100644
--- a/src/bin/psql/psqlscan.l
+++ b/src/bin/psql/psqlscan.l
@@ -1616,7 +1616,8 @@ psql_scan_slash_option(PsqlScanState state,
 							/* Keep the first quote, remove the second */
 							cp++;
 						}
-						inquotes = !inquotes;
+						else
+							inquotes = !inquotes;
 						/* Collapse out quote at *cp */
 						memmove(cp, cp + 1, strlen(cp));
 						mybuf.len--;
