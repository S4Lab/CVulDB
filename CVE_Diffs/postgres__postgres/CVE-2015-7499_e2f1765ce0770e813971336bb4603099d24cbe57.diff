postgres__postgres
commit e2f1765ce0770e813971336bb4603099d24cbe57
Author:     Kevin Grittner <kgrittn@postgresql.org>
AuthorDate: Mon Dec 14 11:37:26 2015 -0600
Commit:     Kevin Grittner <kgrittn@postgresql.org>
CommitDate: Mon Dec 14 11:37:26 2015 -0600

    Remove xmlparse(document '') test
    
    This one test was behaving differently between the ubuntu fix for
    CVE-2015-7499 and the base "expected" file.  It's not worth having
    yet another version of the expected file for this test, so drop it.
    Perhaps at some point when all distros have settled down to the
    same behavior on this test, it can be restored.
    
    Problem found by me on libxml2 (2.9.1+dfsg1-3ubuntu4.6).
    Solution suggested by Tom Lane.
    Backpatch to 9.5, where the test was added.

diff --git a/src/test/regress/expected/xml.out b/src/test/regress/expected/xml.out
index 5691e4740d..f21e119f1e 100644
--- a/src/test/regress/expected/xml.out
+++ b/src/test/regress/expected/xml.out
@@ -263,17 +263,6 @@ SELECT xmlparse(content '<nosuchprefix:tag/>');
  <nosuchprefix:tag/>
 (1 row)
 
-SELECT xmlparse(document '');
-ERROR:  invalid XML document
-DETAIL:  line 1: switching encoding : no input
-
-^
-line 1: Document is empty
-
-^
-line 1: Start tag expected, '<' not found
-
-^
 SELECT xmlparse(document '   ');
 ERROR:  invalid XML document
 DETAIL:  line 1: Start tag expected, '<' not found
diff --git a/src/test/regress/expected/xml_1.out b/src/test/regress/expected/xml_1.out
index c7fa526f9c..d7027030c3 100644
--- a/src/test/regress/expected/xml_1.out
+++ b/src/test/regress/expected/xml_1.out
@@ -204,10 +204,6 @@ SELECT xmlparse(content '<nosuchprefix:tag/>');
 ERROR:  unsupported XML feature
 DETAIL:  This functionality requires the server to be built with libxml support.
 HINT:  You need to rebuild PostgreSQL using --with-libxml.
-SELECT xmlparse(document '');
-ERROR:  unsupported XML feature
-DETAIL:  This functionality requires the server to be built with libxml support.
-HINT:  You need to rebuild PostgreSQL using --with-libxml.
 SELECT xmlparse(document '   ');
 ERROR:  unsupported XML feature
 DETAIL:  This functionality requires the server to be built with libxml support.
diff --git a/src/test/regress/expected/xml_2.out b/src/test/regress/expected/xml_2.out
index c2e929eb09..530faf5daf 100644
--- a/src/test/regress/expected/xml_2.out
+++ b/src/test/regress/expected/xml_2.out
@@ -251,10 +251,6 @@ SELECT xmlparse(content '<nosuchprefix:tag/>');
  <nosuchprefix:tag/>
 (1 row)
 
-SELECT xmlparse(document '');
-ERROR:  invalid XML document
-DETAIL:  line 1: switching encoding : no input
-line 1: Document is empty
 SELECT xmlparse(document '   ');
 ERROR:  invalid XML document
 DETAIL:  line 1: Start tag expected, '<' not found
diff --git a/src/test/regress/sql/xml.sql b/src/test/regress/sql/xml.sql
index 88764c88cd..08a0b30067 100644
--- a/src/test/regress/sql/xml.sql
+++ b/src/test/regress/sql/xml.sql
@@ -71,7 +71,6 @@ SELECT xmlparse(content '<relativens xmlns=''relative''/>');
 SELECT xmlparse(content '<twoerrors>&idontexist;</unbalanced>');
 SELECT xmlparse(content '<nosuchprefix:tag/>');
 
-SELECT xmlparse(document '');
 SELECT xmlparse(document '   ');
 SELECT xmlparse(document 'abc');
 SELECT xmlparse(document '<abc>x</abc>');
