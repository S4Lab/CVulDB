sleuthkit__sleuthkit
commit 5173430f2f224c6238547058b4ee4a0c8b316eed
Author:     Timo Warns <warns@pre-sense.de>
AuthorDate: Wed Dec 12 11:52:19 2012 +0100
Commit:     Timo Warns <timow+github@DiningPhilosopher.DE>
CommitDate: Fri Jan 25 15:04:17 2013 +0100

    limit special handling of files named "." and ".."
    
    A file named "." or ".." shall only be specially handled if it is a directory
    and is among the first two directory entries. Otherwise, renaming a file to
    "." or ".." could hide the file from TSK. Fixes CVE-2012-5619.

diff --git a/tsk3/fs/fatfs_dent.cpp b/tsk3/fs/fatfs_dent.cpp
index b76b9e33..aa0a4e26 100644
--- a/tsk3/fs/fatfs_dent.cpp
+++ b/tsk3/fs/fatfs_dent.cpp
@@ -439,7 +439,9 @@ static TSK_RETVAL_ENUM
             * slot in the cluster, but it needs to refer to the original
             * slot
             */
-            if (TSK_FS_ISDOT(fs_name->name)) {
+            if (TSK_FS_ISDOT(fs_name->name)
+                    && (fs_name->type == TSK_FS_NAME_TYPE_DIR)
+                    && idx < 2) {
                 if (fs_name->name[1] == '\0') {
                     fs_name->meta_addr =
                         a_fs_dir->fs_file->meta->addr;
