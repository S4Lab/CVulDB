sleuthkit__sleuthkit
commit 8242588f4354339d9cb1ad82622e7c16c55391c9
Author:     Jordy Zomer <zome8499@student.alfa-college.nl>
AuthorDate: Sat Nov 24 12:47:23 2018 +0100
Commit:     GitHub <noreply@github.com>
CommitDate: Sat Nov 24 12:47:23 2018 +0100

    UPDATE on CVE-2018-19497.
    
    make it >= because if keylen == nodesize - rec_off it's already past it's destination.
    Also fix the sprintf

diff --git a/tsk/fs/hfs.c b/tsk/fs/hfs.c
index 4f7c0679..bb3819ad 100644
--- a/tsk/fs/hfs.c
+++ b/tsk/fs/hfs.c
@@ -957,11 +957,11 @@ hfs_cat_traverse(HFS_INFO * hfs,
 
                 keylen = 2 + tsk_getu16(hfs->fs_info.endian, key->key_len);
                
-                if (keylen > nodesize - rec_off) {
+                if (keylen >= nodesize - rec_off) {
                     tsk_error_set_errno(TSK_ERR_FS_GENFS);
                     tsk_error_set_errstr
                         ("hfs_cat_traverse: length of key %d in index node %d too large (%d vs %"
-                        PRIu16 ")", rec, cur_node, keylen, nodesize - rec_off);
+                        PRIu16 ")", rec, cur_node, keylen, (nodesize - rec_off));
                     free(node);
                     return 1;
                 }
