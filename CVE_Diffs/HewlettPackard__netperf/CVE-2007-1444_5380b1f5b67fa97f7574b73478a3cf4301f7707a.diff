HewlettPackard__netperf
commit 5380b1f5b67fa97f7574b73478a3cf4301f7707a
Author:     Grant Grundler <grundler@chromium.org>
AuthorDate: Wed Feb 7 17:21:57 2018 -0800
Commit:     Grant Grundler <grundler@chromium.org>
CommitDate: Wed Feb 7 17:21:57 2018 -0800

    netserver: use mkstemp to create/open debug file
    
    This is another attempt to address the primary issue:
        https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=413658
    
    similar to the original patch proposed:
        https://bugs.debian.org/cgi-bin/bugreport.cgi?att=1;bug=413658;filename=CVE-2007-1444.patch;msg=35

diff --git a/src/netserver.c b/src/netserver.c
index 03e987c..0d0d5d4 100644
--- a/src/netserver.c
+++ b/src/netserver.c
@@ -254,20 +254,23 @@ open_debug_file()
   FILE *rd_null_fp;
 
   if (where != NULL) fflush(where);
-
-  snprintf(FileName,
-	   sizeof(FileName),
+  if (suppress_debug) {
+    FileName = NETPERF_NULL;
+    where = fopen(Filename, "w");
+  } else {
+    snprintf(FileName, sizeof(FileName),
 #if defined(WIN32)
-	   "%s\\%s_%d",
-	   getenv("TEMP"),
+	     "%s\\%s_XXXXXX", getenv("TEMP"),
 #else
-	   "%s_%d",
+	     "%s_XXXXXX",
 #endif
-	   DEBUG_LOG_FILE,
-	   getpid());
-  if ((where = fopen((suppress_debug) ? NETPERF_NULL : FileName,
-		     "w")) == NULL) {
-    perror("netserver: debug file");
+	     DEBUG_LOG_FILE);
+    where = mkstemp(FileName);
+  }
+
+  if (where == NULL) {
+    fprintf(stderr, "netserver: %s debug file : %s",
+	    FileName, strerror(errno));
     exit(1);
   }
 
