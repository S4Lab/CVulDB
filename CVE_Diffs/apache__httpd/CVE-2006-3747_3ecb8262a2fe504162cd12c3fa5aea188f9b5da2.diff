apache__httpd
commit 3ecb8262a2fe504162cd12c3fa5aea188f9b5da2
Author:     Mark J. Cox <mjc@apache.org>
AuthorDate: Thu Jul 27 17:05:41 2006 +0000
Commit:     Mark J. Cox <mjc@apache.org>
CommitDate: Thu Jul 27 17:05:41 2006 +0000

    SECURITY: CVE-2006-3747 (cve.mitre.org)
    mod_rewrite: Fix an off-by-one security problem in the ldap scheme
    handling.  For some RewriteRules this could lead to a pointer being
    written out of bounds.  Reported by Mark Dowd of McAfee.
    
    Ack: trawick, lars, jorton, wrowe, benl
    
    
    
    git-svn-id: https://svn.apache.org/repos/asf/httpd/httpd/branches/2.2.x@426141 13f79535-47bb-0310-9956-ffa450edef68

diff --git a/CHANGES b/CHANGES
index 1e13aaecf7..9ea66a88df 100644
--- a/CHANGES
+++ b/CHANGES
@@ -1,6 +1,12 @@
                                                         -*- coding: utf-8 -*-
 Changes with Apache 2.2.3
 
+  *) SECURITY: CVE-2006-3747 (cve.mitre.org)
+     mod_rewrite: Fix an off-by-one security problem in the ldap scheme
+     handling.  For some RewriteRules this could lead to a pointer being
+     written out of bounds.  Reported by Mark Dowd of McAfee.
+     [Mark Cox]
+  
   *) mod_authn_alias: Add a check to make sure that the base provider and the
      alias names are different and also that the alias has not been registered
      before. PR 40051. [Brad Nicholes]
diff --git a/modules/mappers/mod_rewrite.c b/modules/mappers/mod_rewrite.c
index aa54ffba9a..58f348a622 100644
--- a/modules/mappers/mod_rewrite.c
+++ b/modules/mappers/mod_rewrite.c
@@ -667,7 +667,7 @@ static char *escape_absolute_uri(apr_pool_t *p, char *uri, unsigned scheme)
             int c = 0;
 
             token[0] = cp = apr_pstrdup(p, cp);
-            while (*cp && c < 5) {
+            while (*cp && c < 4) {
                 if (*cp == '?') {
                     token[++c] = cp + 1;
                     *cp = '\0';
