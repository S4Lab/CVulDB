coreos__grub
commit 451d80e52d851432e109771bb8febafca7a5f1f2
Author:     Hector Marco-Gisbert <hecmargi@upv.es>
AuthorDate: Wed Dec 16 07:57:18 2015 +0300
Commit:     Andrei Borzenkov <arvidjaar@gmail.com>
CommitDate: Wed Dec 16 07:57:18 2015 +0300

    Fix security issue when reading username and password
    
    This patch fixes two integer underflows at:
      * grub-core/lib/crypto.c
      * grub-core/normal/auth.c
    
    CVE-2015-8370
    
    Signed-off-by: Hector Marco-Gisbert <hecmargi@upv.es>
    Signed-off-by: Ismael Ripoll-Ripoll <iripoll@disca.upv.es>
    Also-By: Andrey Borzenkov <arvidjaar@gmail.com>

diff --git a/grub-core/lib/crypto.c b/grub-core/lib/crypto.c
index 010e550d1..683a8aaa7 100644
--- a/grub-core/lib/crypto.c
+++ b/grub-core/lib/crypto.c
@@ -470,7 +470,8 @@ grub_password_get (char buf[], unsigned buf_size)
 
       if (key == '\b')
 	{
-	  cur_len--;
+	  if (cur_len)
+	    cur_len--;
 	  continue;
 	}
 
diff --git a/grub-core/normal/auth.c b/grub-core/normal/auth.c
index c6bd96e28..8615c48c3 100644
--- a/grub-core/normal/auth.c
+++ b/grub-core/normal/auth.c
@@ -174,8 +174,11 @@ grub_username_get (char buf[], unsigned buf_size)
 
       if (key == '\b')
 	{
-	  cur_len--;
-	  grub_printf ("\b");
+	  if (cur_len)
+	    {
+	      cur_len--;
+	      grub_printf ("\b");
+	    }
 	  continue;
 	}
 
