smokin-guns__SmokinGuns
commit 641a433e61bb2a1e309d1d414d7afe376c9849a4
Author:     sg_tequila <sg_tequila@07eb42f0-b032-4355-afd3-42b1f3832223>
AuthorDate: Tue Jan 1 18:59:00 2013 +0000
Commit:     sg_tequila <sg_tequila@07eb42f0-b032-4355-afd3-42b1f3832223>
CommitDate: Tue Jan 1 18:59:00 2013 +0000

    Fixes CVE-2012-3345 symlink attack in ioQuake3 based engines
    See: http://ioquake3.org/2012/06/14/cve-2012-3345-symlink-attack-in-ioquake3-r1773/
    
    git-svn-id: https://smokinguns.svn.sourceforge.net/svnroot/smokinguns/trunk@667 07eb42f0-b032-4355-afd3-42b1f3832223

diff --git a/code/qcommon/qcommon.h b/code/qcommon/qcommon.h
index 675023d..0a5a6a5 100644
--- a/code/qcommon/qcommon.h
+++ b/code/qcommon/qcommon.h
@@ -1133,7 +1133,6 @@ char    *Sys_DefaultAppPath(void);
 
 void  Sys_SetDefaultHomePath(const char *path);
 char	*Sys_DefaultHomePath(void);
-const char	*Sys_TempPath(void);
 const char *Sys_Dirname( char *path );
 const char *Sys_Basename( char *path );
 char *Sys_ConsoleInput(void);
diff --git a/code/sys/sys_main.c b/code/sys/sys_main.c
index cab8819..4d390d2 100644
--- a/code/sys/sys_main.c
+++ b/code/sys/sys_main.c
@@ -155,7 +155,7 @@ Sys_PIDFileName
 */
 static char *Sys_PIDFileName( void )
 {
-	return va( "%s/%s", Sys_TempPath( ), PID_FILENAME );
+	return va( "%s/%s", Sys_DefaultHomePath( ), PID_FILENAME );
 }
 
 /*
diff --git a/code/sys/sys_osx.m b/code/sys/sys_osx.m
index a26d8a2..30bf932 100644
--- a/code/sys/sys_osx.m
+++ b/code/sys/sys_osx.m
@@ -34,28 +34,6 @@ Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 #import <Carbon/Carbon.h>
 #import <Cocoa/Cocoa.h>
 
-/*
-================
-Sys_TempPath
-================
-*/
-const char *Sys_TempPath( void )
-{
-	static UInt8 posixPath[ MAX_OSPATH ];
-	FSRef ref;
-	if( FSFindFolder( kOnAppropriateDisk,
-				kTemporaryFolderType, kCreateFolder, &ref ) == noErr )
-	{
-		if( FSRefMakePath( &ref, posixPath,
-					sizeof( posixPath ) - 1 ) == noErr )
-		{
-			return (const char *)posixPath;
-		}
-	}
-
-	return "/tmp";
-}
-
 /*
 ==============
 Sys_Dialog
diff --git a/code/sys/sys_unix.c b/code/sys/sys_unix.c
index a23287f..fc2e120 100644
--- a/code/sys/sys_unix.c
+++ b/code/sys/sys_unix.c
@@ -80,23 +80,6 @@ char *Sys_DefaultHomePath(void)
 	return homePath;
 }
 
-#ifndef MACOS_X
-/*
-================
-Sys_TempPath
-================
-*/
-const char *Sys_TempPath( void )
-{
-	const char *TMPDIR = getenv( "TMPDIR" );
-
-	if( TMPDIR == NULL || TMPDIR[ 0 ] == '\0' )
-		return "/tmp";
-	else
-		return TMPDIR;
-}
-#endif
-
 /*
 =================
 Sys_TestSysInstallPath
diff --git a/code/sys/sys_win32.c b/code/sys/sys_win32.c
index 8d84100..c6b98cc 100644
--- a/code/sys/sys_win32.c
+++ b/code/sys/sys_win32.c
@@ -102,24 +102,6 @@ char *Sys_DefaultHomePath( void )
 	return homePath;
 }
 
-/*
-================
-Sys_TempPath
-================
-*/
-const char *Sys_TempPath( void )
-{
-	static TCHAR path[ MAX_PATH ];
-	DWORD length;
-
-	length = GetTempPath( sizeof( path ), path );
-
-	if( length > sizeof( path ) || length == 0 )
-		return Sys_DefaultHomePath( );
-	else
-		return path;
-}
-
 /*
 ==================
 Sys_GetSystemInstallPath
