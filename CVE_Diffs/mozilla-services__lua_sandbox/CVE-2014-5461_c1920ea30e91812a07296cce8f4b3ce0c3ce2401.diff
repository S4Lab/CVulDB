mozilla-services__lua_sandbox
commit c1920ea30e91812a07296cce8f4b3ce0c3ce2401
Author:     Mathieu Parent <math.parent@gmail.com>
AuthorDate: Sat Dec 31 14:56:57 2016 +0100
Commit:     Mathieu Parent <math.parent@gmail.com>
CommitDate: Sat Dec 31 14:56:57 2016 +0100

    Fix CVE-2014-5461 in embedded lua
    
    See http://www.lua.org/bugs.html#5.2.2-1

diff --git a/src/lua/ldo.c b/src/lua/ldo.c
index d1bf786..30333bf 100644
--- a/src/lua/ldo.c
+++ b/src/lua/ldo.c
@@ -274,7 +274,7 @@ int luaD_precall (lua_State *L, StkId func, int nresults) {
     CallInfo *ci;
     StkId st, base;
     Proto *p = cl->p;
-    luaD_checkstack(L, p->maxstacksize);
+    luaD_checkstack(L, p->maxstacksize + p->numparams);
     func = restorestack(L, funcr);
     if (!p->is_vararg) {  /* no varargs? */
       base = func + 1;
