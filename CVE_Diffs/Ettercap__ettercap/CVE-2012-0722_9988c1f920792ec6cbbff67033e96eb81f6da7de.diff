Ettercap__ettercap
commit 9988c1f920792ec6cbbff67033e96eb81f6da7de
Author:     Gianfranco Costamagna <costamagnagianfranco@yahoo.it>
AuthorDate: Fri Jan 11 12:09:03 2013 +0100
Commit:     Gianfranco Costamagna <costamagnagianfranco@yahoo.it>
CommitDate: Fri Jan 11 12:09:03 2013 +0100

    Fix for CVE-2012-0722, patch provided by Sajjad Pourali http://www.securation.com/

diff --git a/include/ec.h b/include/ec.h
index 463e36fd..069e3f1f 100644
--- a/include/ec.h
+++ b/include/ec.h
@@ -81,6 +81,11 @@
 
 #define SAFE_FREE(x) do{ if(x) { free(x); x = NULL; } }while(0)
 
+
+/* convert to string */
+#define EC_STRINGIFY(in) #in
+#define EC_TOSTRING(in) EC_STRINGIFY(in)
+
 #ifdef OS_LINUX
 #define __init       __attribute__((constructor(101)))
 #define __init_last  __attribute__((constructor(200))
diff --git a/include/ec_inet.h b/include/ec_inet.h
index 43b0ca5f..379192da 100644
--- a/include/ec_inet.h
+++ b/include/ec_inet.h
@@ -24,24 +24,22 @@
    #endif
 #endif
 
-enum {
-   NS_IN6ADDRSZ            = 16,
-   NS_INT16SZ              = 2,
-
-   ETH_ADDR_LEN            = 6,
-   TR_ADDR_LEN             = 6,
-   FDDI_ADDR_LEN           = 6,
-   MEDIA_ADDR_LEN          = 6,
+#define	NS_IN6ADDRSZ 16
+#define 	NS_INT16SZ = 2
+
+#define	ETH_ADDR_LEN 6
+#define	TR_ADDR_LEN 6
+#define	FDDI_ADDR_LEN 6
+#define	MEDIA_ADDR_LEN 6
    
-   IP_ADDR_LEN             = 4,
-   IP6_ADDR_LEN            = 16,
-   MAX_IP_ADDR_LEN         = IP6_ADDR_LEN,
-
-   ETH_ASCII_ADDR_LEN      = sizeof("ff:ff:ff:ff:ff:ff")+1,
-   IP_ASCII_ADDR_LEN       = sizeof("255.255.255.255")+1,
-   IP6_ASCII_ADDR_LEN      = sizeof("ffff:ffff:ffff:ffff:ffff:ffff:255.255.255.255")+1,
-   MAX_ASCII_ADDR_LEN      = IP6_ASCII_ADDR_LEN,                  
-};
+#define	IP_ADDR_LEN 4
+#define	IP6_ADDR_LEN 16
+#define	MAX_IP_ADDR_LEN IP6_ADDR_LEN
+
+#define	ETH_ASCII_ADDR_LEN 19 // sizeof("ff:ff:ff:ff:ff:ff")+1
+#define	IP_ASCII_ADDR_LEN 17 // sizeof("255.255.255.255")+1
+#define	IP6_ASCII_ADDR_LEN 47 // sizeof("ffff:ffff:ffff:ffff:ffff:ffff:255.255.255.255")+1
+#define	MAX_ASCII_ADDR_LEN IP6_ASCII_ADDR_LEN
 
 /*
  * Some predefined addresses here
diff --git a/src/ec_scan.c b/src/ec_scan.c
index cce36725..9455c3eb 100644
--- a/src/ec_scan.c
+++ b/src/ec_scan.c
@@ -630,7 +630,7 @@ int scan_load_hosts(char *filename)
    for (nhosts = 0; !feof(hf); nhosts++) {
       int proto;
 
-      if (fscanf(hf, "%s %s %s\n", ip, mac, name) != 3 ||
+      if (fscanf(hf, "%"EC_TOSTRING(MAX_ASCII_ADDR_LEN)"s %"EC_TOSTRING(ETH_ASCII_ADDR_LEN)"s %"EC_TOSTRING(MAX_HOSTNAME_LEN)"s\n", ip, mac, name) != 3 ||
          *ip == '#' || *mac == '#' || *name == '#')
          continue;
 
