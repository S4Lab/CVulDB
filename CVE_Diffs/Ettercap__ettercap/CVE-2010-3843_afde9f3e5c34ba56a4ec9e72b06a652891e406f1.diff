Ettercap__ettercap
commit afde9f3e5c34ba56a4ec9e72b06a652891e406f1
Author:     Gianfranco Costamagna <costamagnagianfranco@yahoo.it>
AuthorDate: Thu Oct 4 21:45:16 2012 +0200
Commit:     Gianfranco Costamagna <costamagnagianfranco@yahoo.it>
CommitDate: Thu Oct 4 21:45:16 2012 +0200

    Imported commit https://github.com/drizzt/ettercap/commit/7f8a7a8cc18fd852c795f3f531d98ca8b58f5cbc
    in order to fix lp bug 656347 and gentoo bug 340897
    CVE-2010-3843
            modified:   src/interfaces/gtk/ec_gtk_conf.c

diff --git a/src/interfaces/gtk/ec_gtk_conf.c b/src/interfaces/gtk/ec_gtk_conf.c
index aea4e72b..fe9ef4be 100644
--- a/src/interfaces/gtk/ec_gtk_conf.c
+++ b/src/interfaces/gtk/ec_gtk_conf.c
@@ -69,13 +69,8 @@ void gtkui_conf_read(void) {
    char line[100], name[30];
    short value;
 
-#ifdef OS_WINDOWS
-   path = ec_win_get_user_dir();
-#else
-   path = g_get_home_dir();
-#endif
-
-   filename = g_build_filename(path, ".ettercap_gtk", NULL);
+   path = g_get_user_config_dir();
+   filename = g_build_filename(path, "ettercap_gtk", NULL);
 
    DEBUG_MSG("gtkui_conf_read: %s", filename);
 
@@ -84,9 +79,14 @@ void gtkui_conf_read(void) {
       return;
 
    while(fgets(line, 100, fd)) {
-      if(sscanf(line, "%s = %hd", name, &value) != 2)
-		ERROR_MSG("Invalid line in GTK configuration: %s\n", line);
-
+      char *p = strchr(line, '=');
+     if(!p)
+         continue;
+      *p = '\0';
+      snprintf(name, sizeof(name), "%s", line);
+      strlcpy(name, line, sizeof(name) - 1);
+      g_strstrip(name);
+      value = atoi(p + 1);
       gtkui_conf_set(name, value);
    }
    fclose(fd);
