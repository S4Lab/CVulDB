linux-test-project__ltp
commit fe002060deda24b632fa443838c554bc868be6b6
Author:     Sandeep Patil <sspatil@google.com>
AuthorDate: Fri Aug 3 08:22:25 2018 -0700
Commit:     Jan Stancek <jstancek@redhat.com>
CommitDate: Fri Aug 3 17:30:41 2018 +0200

    mknod03: Skip S_ISGID check on files created by non-group members.
    
    0fa3ecd87848 ("Fix up non-directory creation in SGID directories") fixes
    problem described in CVE-2018-13405. This commit is backported to older
    streams as well.
    
    This patch removes S_ISGID check for files created by non-group members
    in LTP tests mknod03. Basically, does the same thing as commit
    '3c87ef2961' for mknod03 test.
    
    Signed-off-by: Sandeep Patil <sspatil@google.com>
    Acked-by: Jan Stancek <jstancek@redhat.com>

diff --git a/testcases/kernel/syscalls/mknod/mknod03.c b/testcases/kernel/syscalls/mknod/mknod03.c
index 2af66f78c..7ecadb5b3 100644
--- a/testcases/kernel/syscalls/mknod/mknod03.c
+++ b/testcases/kernel/syscalls/mknod/mknod03.c
@@ -142,14 +142,11 @@ int main(int ac, char **av)
 			fflag = 0;
 		}
 
-		/* Verify mode permissions of node */
-		if (!(buf.st_mode & S_ISGID)) {
-			tst_resm(TFAIL,
-				 "%s: Incorrect modes, setgid bit not "
-				 "set", node_name);
-			/* unset flag as functionality fails */
-			fflag = 0;
-		}
+		/*
+		 * Skip S_ISGID check
+		 * 0fa3ecd87848 ("Fix up non-directory creation in SGID directories")
+		 * clears S_ISGID for files created by non-group members
+		 */
 
 		/* Verify group ID */
 		if (buf.st_gid != group2_gid) {
