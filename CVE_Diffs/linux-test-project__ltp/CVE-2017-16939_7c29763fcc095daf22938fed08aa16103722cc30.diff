linux-test-project__ltp
commit 7c29763fcc095daf22938fed08aa16103722cc30
Author:     Cai Zhenglong <caizhenglong_cm@deepin.com>
AuthorDate: Tue Dec 24 10:46:19 2019 +0800
Commit:     Petr Vorel <petr.vorel@gmail.com>
CommitDate: Thu Dec 26 10:20:32 2019 +0100

    cve-2017-16939.c: Use SOL_SOCKET instead of fixed value
    
    MIPS platform failed on cve-2017-16939 test, got below result:
    
    safe_net.c:186: BROK: cve-2017-16939.c:69: setsockopt(6, 1, 4098, 0xfffbaff810, 4) failed: ENOPROTOOPT (99)
    Commonly, SOL_SOCKET value is 1, but on MIPS architecture SOL_SOCKET is 0xffff
    
    Fixes: 9c8017cee ("Add regression test for CVE-2017-16939")
    
    Signed-off-by: Zhenglong Cai <caizhenglong_cm@deepin.com>
    Acked-by: Yang Xu <xuyang2018.jy@cn.fujitsu.com>
    Signed-off-by: Petr Vorel <petr.vorel@gmail.com>

diff --git a/testcases/cve/cve-2017-16939.c b/testcases/cve/cve-2017-16939.c
index 9ab1eb2c3..d8c09014c 100644
--- a/testcases/cve/cve-2017-16939.c
+++ b/testcases/cve/cve-2017-16939.c
@@ -66,7 +66,7 @@ static void run(void)
 {
 	int var = 0x100;
 
-	SAFE_SETSOCKOPT(fd, 1, SO_RCVBUF, &var, sizeof(int));
+	SAFE_SETSOCKOPT(fd, SOL_SOCKET, SO_RCVBUF, &var, sizeof(int));
 	SAFE_SENDTO(1, fd, (void *) &p->msg, p->msg.nlmsg_len, 0,
 		    (struct sockaddr *) &addr,
 		    sizeof(struct sockaddr_nl));
