linux-test-project__ltp
commit dd985b3e54b433637c1cc91a8fb128494d4f1e46
Author:     Petr Vorel <pvorel@suse.cz>
AuthorDate: Wed Mar 14 09:55:51 2018 +0100
Commit:     Petr Vorel <pvorel@suse.cz>
CommitDate: Wed Mar 14 09:55:51 2018 +0100

    cve: Fix compilation for non x86 architectures
    
    CVE-2017-17053 requires asm/ldt.h which is available be only for i386
    and x86_64.
    
    Fixes: 3f2ff1490 ("Add regression test for CVE-2017-17053")
    
    Signed-off-by: Petr Vorel <pvorel@suse.cz>

diff --git a/testcases/cve/cve-2017-17053.c b/testcases/cve/cve-2017-17053.c
index 523ee53c3..e01db3d4f 100644
--- a/testcases/cve/cve-2017-17053.c
+++ b/testcases/cve/cve-2017-17053.c
@@ -21,6 +21,10 @@
  * Be careful! This test may crash your kernel!
  */
 
+#include "config.h"
+#include "tst_test.h"
+
+#ifdef HAVE_ASM_LDT_H
 #include <asm/ldt.h>
 #include <pthread.h>
 #include <signal.h>
@@ -30,7 +34,6 @@
 #include <unistd.h>
 #include <stdio.h>
 
-#include "tst_test.h"
 #include "tst_taint.h"
 #include "lapi/syscalls.h"
 
@@ -164,3 +167,7 @@ static struct tst_test test = {
 	.cleanup = cleanup,
 	.test_all = run,
 };
+
+#else
+TST_TEST_TCONF("no asm/ldt.h header (only for i386 or x86_64)");
+#endif
