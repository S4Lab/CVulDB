Canonical-kernel__Ubuntu-kernel
commit 1eb8f04dc1c9f9832376c34ff872ef2c403bc878
Author:     Dan Rosenberg <drosenberg@vsecurity.com>
AuthorDate: Thu May 19 17:21:44 2011 -0300
Commit:     Herton Ronaldo Krzesinski <herton.krzesinski@canonical.com>
CommitDate: Tue May 31 09:31:44 2011 -0300

    ALSA: sound/pci/asihpi: check adapter index in hpi_ioctl, CVE-2011-1169
    
    CVE-2011-1169
    
    BugLink: http://bugs.launchpad.net/bugs/785331
    
    Released until now with stable versions 2.6.37.5, 2.6.38.1
    
    The user-supplied index into the adapters array needs to be checked, or
    an out-of-bounds kernel pointer could be accessed and used, leading to
    potentially exploitable memory corruption.
    
    Signed-off-by: Dan Rosenberg <drosenberg@vsecurity.com>
    Cc: <stable@kernel.org>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    (backported from commit 4a122c10fbfe9020df469f0f669da129c5757671 upstream)
    Signed-off-by: Herton Krzesinski <herton.krzesinski@canonical.com>
    Signed-off-by: John Johansen <john.johansen@canonical.com>
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>

diff --git a/sound/pci/asihpi/hpioctl.c b/sound/pci/asihpi/hpioctl.c
index 7396ac54e99f..7b600f7d78af 100644
--- a/sound/pci/asihpi/hpioctl.c
+++ b/sound/pci/asihpi/hpioctl.c
@@ -146,6 +146,11 @@ long asihpi_hpi_ioctl(struct file *file, unsigned int cmd, unsigned long arg)
 		goto out;
 	}
 
+	if (hm->h.adapter_index >= HPI_MAX_ADAPTERS) {
+		err = -EINVAL;
+		goto out;
+	}
+
 	pa = &adapters[hm->h.adapter_index];
 	hr->h.size = 0;
 	if (hm->h.object == HPI_OBJ_SUBSYSTEM) {
