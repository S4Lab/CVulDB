Canonical-kernel__Ubuntu-kernel
commit 5b03e4432aef24b713349fd4d96255eaf9069e5b
Author:     Chris Wilson <chris@chris-wilson.co.uk>
AuthorDate: Sun Sep 26 21:19:36 2010 +0100
Commit:     Leann Ogasawara <leann.ogasawara@canonical.com>
CommitDate: Fri Oct 1 11:44:57 2010 -0700

    drm/i915: Rephrase pwrite bounds checking to avoid any potential overflow
    
    CVE-2010-2962
    
    ... and do the same for pread.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    (cherry-picked from email)
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>

diff --git a/drivers/gpu/drm/i915/i915_gem.c b/drivers/gpu/drm/i915/i915_gem.c
index 5aa747fc25a9..d76f5d82739a 100644
--- a/drivers/gpu/drm/i915/i915_gem.c
+++ b/drivers/gpu/drm/i915/i915_gem.c
@@ -459,12 +459,8 @@ i915_gem_pread_ioctl(struct drm_device *dev, void *data,
 		return -EBADF;
 	obj_priv = to_intel_bo(obj);
 
-	/* Bounds check source.
-	 *
-	 * XXX: This could use review for overflow issues...
-	 */
-	if (args->offset > obj->size || args->size > obj->size ||
-	    args->offset + args->size > obj->size) {
+	/* Bounds check source.  */
+	if (args->offset > obj->size || args->size > obj->size - args->offset) {
 		drm_gem_object_unreference_unlocked(obj);
 		return -EINVAL;
 	}
@@ -922,12 +918,8 @@ i915_gem_pwrite_ioctl(struct drm_device *dev, void *data,
 		return -EBADF;
 	obj_priv = to_intel_bo(obj);
 
-	/* Bounds check destination.
-	 *
-	 * XXX: This could use review for overflow issues...
-	 */
-	if (args->offset > obj->size || args->size > obj->size ||
-	    args->offset + args->size > obj->size) {
+	/* Bounds check destination. */
+	if (args->offset > obj->size || args->size > obj->size - args->offset) {
 		drm_gem_object_unreference_unlocked(obj);
 		return -EINVAL;
 	}
