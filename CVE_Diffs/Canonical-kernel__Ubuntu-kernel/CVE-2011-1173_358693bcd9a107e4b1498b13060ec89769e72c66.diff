Canonical-kernel__Ubuntu-kernel
commit 358693bcd9a107e4b1498b13060ec89769e72c66
Author:     Vasiliy Kulikov <segoon@openwall.com>
AuthorDate: Mon Jul 4 17:22:44 2011 +0100
Commit:     Herton Ronaldo Krzesinski <herton.krzesinski@canonical.com>
CommitDate: Mon Jul 18 12:29:35 2011 -0300

    econet: 4 byte infoleak to the network CVE-2011-1173
    
    BugLink: http://bugs.launchpad.net/bugs/801484
    
    commit upstream 67c5c6cb8129c595f21e88254a3fc6b3b841ae8e
    
    struct aunhdr has 4 padding bytes between 'pad' and 'handle' fields on
    x86_64.  These bytes are not initialized in the variable 'ah' before
    sending 'ah' to the network.  This leads to 4 bytes kernel stack
    infoleak.
    
    This bug was introduced before the git epoch.
    
    CVE-2011-1173
    
    Signed-off-by: Vasiliy Kulikov <segoon@openwall.com>
    Acked-by: Phil Blundell <philb@gnu.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Paolo Pisati <paolo.pisati@canonical.com>
    Acked-by: Andy Whitcroft <apw@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Andy Whitcroft <apw@canonical.com>

diff --git a/net/econet/af_econet.c b/net/econet/af_econet.c
index 59092f4a8248..bda42d323f51 100644
--- a/net/econet/af_econet.c
+++ b/net/econet/af_econet.c
@@ -434,10 +434,10 @@ static int econet_sendmsg(struct kiocb *iocb, struct socket *sock,
 		udpdest.sin_addr.s_addr = htonl(network | addr.station);
 	}
 
+	memset(&ah, 0, sizeof(ah));
 	ah.port = port;
 	ah.cb = cb & 0x7f;
 	ah.code = 2;		/* magic */
-	ah.pad = 0;
 
 	/* tack our header on the front of the iovec */
 	size = sizeof(struct aunhdr);
