Canonical-kernel__Ubuntu-kernel
commit 8e721b1c14f3f9b7bc32ec1f92d47ae6c76fb3a0
Author:     Mathias Krause <minipli@googlemail.com>
AuthorDate: Tue Mar 26 17:18:32 2013 +0000
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Tue Mar 26 11:38:15 2013 -0600

    atm: fix info leak via getsockname()
    
    CVE-2012-6546
    
    BugLink: http://bugs.launchpad.net/bugs/1156759
    
    The ATM code fails to initialize the two padding bytes of struct
    sockaddr_atmpvc inserted for alignment. Add an explicit memset(0)
    before filling the structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (back ported from commit 3c0c5cfdcd4d69ffc4b9c0907cec99039f30a50a)
    
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    
    Conflicts:
            net/atm/pvc.c
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/net/atm/pvc.c b/net/atm/pvc.c
index d4c024504f99..523c21a5b0fc 100644
--- a/net/atm/pvc.c
+++ b/net/atm/pvc.c
@@ -93,6 +93,7 @@ static int pvc_getname(struct socket *sock,struct sockaddr *sockaddr,
 	if (!vcc->dev || !test_bit(ATM_VF_ADDR,&vcc->flags)) return -ENOTCONN;
 	*sockaddr_len = sizeof(struct sockaddr_atmpvc);
 	addr = (struct sockaddr_atmpvc *) sockaddr;
+	memset(addr, 0, sizeof(*addr));
 	addr->sap_family = AF_ATMPVC;
 	addr->sap_addr.itf = vcc->dev->number;
 	addr->sap_addr.vpi = vcc->vpi;
