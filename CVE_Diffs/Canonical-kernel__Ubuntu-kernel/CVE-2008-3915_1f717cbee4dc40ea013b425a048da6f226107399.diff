Canonical-kernel__Ubuntu-kernel
commit 1f717cbee4dc40ea013b425a048da6f226107399
Author:     J. Bruce Fields <bfields@citi.umich.edu>
AuthorDate: Fri Aug 29 19:18:45 2008 -0400
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Fri Oct 10 10:44:22 2008 -0400

    nfsd: fix buffer overrun decoding NFSv4 acl
    
    CVE-2008-3915
    
    commit 91b80969ba466ba4b915a4a1d03add8c297add3f upstream
    
    The array we kmalloc() here is not large enough.
    
    Thanks to Johann Dahm and David Richter for bug report and testing.
    
    Signed-off-by: J. Bruce Fields <bfields@citi.umich.edu>
    Cc: David Richter <richterd@citi.umich.edu>
    Tested-by: Johann Dahm <jdahm@umich.edu>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/fs/nfsd/nfs4acl.c b/fs/nfsd/nfs4acl.c
index b6ed38380ab8..54b8b4140c8f 100644
--- a/fs/nfsd/nfs4acl.c
+++ b/fs/nfsd/nfs4acl.c
@@ -443,7 +443,7 @@ init_state(struct posix_acl_state *state, int cnt)
 	 * enough space for either:
 	 */
 	alloc = sizeof(struct posix_ace_state_array)
-		+ cnt*sizeof(struct posix_ace_state);
+		+ cnt*sizeof(struct posix_user_ace_state);
 	state->users = kzalloc(alloc, GFP_KERNEL);
 	if (!state->users)
 		return -ENOMEM;
