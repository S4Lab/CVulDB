Canonical-kernel__Ubuntu-kernel
commit a0bacb28ed6373f20871befed827ab7e01880602
Author:     H. Peter Anvin <hpa@zytor.com>
AuthorDate: Fri Mar 2 10:43:49 2012 -0800
Commit:     Luis Henriques <luis.henriques@canonical.com>
CommitDate: Mon Mar 26 10:26:33 2012 +0100

    regset: Return -EFAULT, not -EIO, on host-side memory fault
    
    BugLink: http://bugs.launchpad.net/bugs/949905
    
    There is only one error code to return for a bad user-space buffer
    pointer passed to a system call in the same address space as the
    system call is executed, and that is EFAULT.  Furthermore, the
    low-level access routines, which catch most of the faults, return
    EFAULT already.
    
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>
    Reviewed-by: Oleg Nesterov <oleg@redhat.com>
    Acked-by: Roland McGrath <roland@hack.frob.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    (cherry picked from commit 5189fa19a4b2b4c3bec37c3a019d446148827717)
    CVE-2012-1097
    Acked-by: Seth Forshee <seth.forshee@canonical.com>
    Acked-by: Colin King <colin.king@canonical.com>
    Signed-off-by: Andy Whitcroft <andy.whitcroft@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/include/linux/regset.h b/include/linux/regset.h
index 5150fd16ef93..686f37327a49 100644
--- a/include/linux/regset.h
+++ b/include/linux/regset.h
@@ -339,7 +339,7 @@ static inline int copy_regset_to_user(struct task_struct *target,
 		return -EOPNOTSUPP;
 
 	if (!access_ok(VERIFY_WRITE, data, size))
-		return -EIO;
+		return -EFAULT;
 
 	return regset->get(target, regset, offset, size, NULL, data);
 }
@@ -365,7 +365,7 @@ static inline int copy_regset_from_user(struct task_struct *target,
 		return -EOPNOTSUPP;
 
 	if (!access_ok(VERIFY_READ, data, size))
-		return -EIO;
+		return -EFAULT;
 
 	return regset->set(target, regset, offset, size, NULL, data);
 }
