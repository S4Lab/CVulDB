Canonical-kernel__Ubuntu-kernel
commit 46e7ae1bd89352b4ac34dd05962471a7fe44a7a7
Author:     Sachin Prabhu <sprabhu@redhat.com>
AuthorDate: Thu Mar 22 16:46:28 2012 +0000
Commit:     Luis Henriques <luis.henriques@canonical.com>
CommitDate: Tue Jun 12 10:43:29 2012 +0100

    Fix length of buffer copied in __nfs4_get_acl_uncached
    
    BugLink: http://bugs.launchpad.net/bugs/1002505
    
    CVE-2012-2375
    
    _copy_from_pages() used to copy data from the temporary buffer to the
    user passed buffer is passed the wrong size parameter when copying
    data. res.acl_len contains both the bitmap and acl lenghts while
    acl_len contains the acl length after adjusting for the bitmap size.
    
    Signed-off-by: Sachin Prabhu <sprabhu@redhat.com>
    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
    (cherry picked from commit 20e0fa98b751facf9a1101edaefbc19c82616a68)
    
    Signed-off-by: Brad Figg <brad.figg@canonical.com>
    Acked-by: Herton Krzesinski <herton.krzesinski@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.c
index 037c81620b8a..a081703ad1a6 100644
--- a/fs/nfs/nfs4proc.c
+++ b/fs/nfs/nfs4proc.c
@@ -3409,7 +3409,7 @@ static ssize_t __nfs4_get_acl_uncached(struct inode *inode, void *buf, size_t bu
 		if (acl_len > buflen)
 			goto out_free;
 		_copy_from_pages(buf, pages, res.acl_data_offset,
-				res.acl_len);
+				acl_len);
 	}
 	ret = acl_len;
 out_free:
