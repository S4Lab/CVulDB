Canonical-kernel__Ubuntu-kernel
commit 5ecabc3b55c7bab3f36c64c6a72c7b6b1b41f97c
Author:     Marcelo Tosatti <mtosatti@redhat.com>
AuthorDate: Thu Oct 1 19:28:39 2009 -0300
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Tue May 25 14:00:56 2010 +0200

    KVM: x86: disable paravirt mmu reporting
    
    CVE-2010-0306
    CVE-2010-0298
    
    Disable paravirt MMU capability reporting, so that new (or rebooted)
    guests switch to native operation.
    
    Paravirt MMU is a burden to maintain and does not bring significant
    advantages compared to shadow anymore.
    
    Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
    Signed-off-by: Avi Kivity <avi@redhat.com>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>
    (backported from commit a68a6a7282373bedba8a2ed751b6384edb983a64 upstream)
    Signed-off-by: Surbhi Palande <surbhi.palande@canonical.com>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/arch/x86/kvm/x86.c b/arch/x86/kvm/x86.c
index 62c1393bf7cd..4515f9a5f972 100644
--- a/arch/x86/kvm/x86.c
+++ b/arch/x86/kvm/x86.c
@@ -1096,8 +1096,8 @@ int kvm_dev_ioctl_check_extension(long ext)
 	case KVM_CAP_NR_MEMSLOTS:
 		r = KVM_MEMORY_SLOTS;
 		break;
-	case KVM_CAP_PV_MMU:
-		r = !tdp_enabled;
+	case KVM_CAP_PV_MMU:	/* obsolete */
+		r = 0;
 		break;
 	case KVM_CAP_IOMMU:
 		r = iommu_found();
