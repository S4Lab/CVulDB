Canonical-kernel__Ubuntu-kernel
commit f056dad9dc8205d11e477d7640e832c20c6fdb76
Author:     Zhu Yi <yi.zhu@intel.com>
AuthorDate: Fri Jul 22 18:42:39 2011 +0100
Commit:     Andy Whitcroft <apw@canonical.com>
CommitDate: Mon Aug 8 12:40:51 2011 +0100

    x25: use limited socket backlog CVE-2010-4251
    
    BugLink: http://bugs.launchpad.net/bugs/807462
    
    Make x25 adapt to the limited socket backlog change.
    
    Cc: Andrew Hendry <andrew.hendry@gmail.com>
    Signed-off-by: Zhu Yi <yi.zhu@intel.com>
    Acked-by: Eric Dumazet <eric.dumazet@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (cherry picked from commit 2499849ee8f513e795b9f2c19a42d6356e4943a4)
    
    Signed-off-by: Paolo Pisati <paolo.pisati@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>
    Signed-off-by: Andy Whitcroft <apw@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/net/x25/x25_dev.c b/net/x25/x25_dev.c
index 3e1efe534645..a9da0dc26f4f 100644
--- a/net/x25/x25_dev.c
+++ b/net/x25/x25_dev.c
@@ -53,7 +53,7 @@ static int x25_receive_data(struct sk_buff *skb, struct x25_neigh *nb)
 		if (!sock_owned_by_user(sk)) {
 			queued = x25_process_rx_frame(sk, skb);
 		} else {
-			sk_add_backlog(sk, skb);
+			queued = !sk_add_backlog_limited(sk, skb);
 		}
 		bh_unlock_sock(sk);
 		sock_put(sk);
