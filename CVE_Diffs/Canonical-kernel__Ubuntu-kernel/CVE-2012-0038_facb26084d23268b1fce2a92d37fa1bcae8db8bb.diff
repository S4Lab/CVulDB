Canonical-kernel__Ubuntu-kernel
commit facb26084d23268b1fce2a92d37fa1bcae8db8bb
Author:     Xi Wang <xi.wang@gmail.com>
AuthorDate: Wed Jan 18 11:28:30 2012 +0000
Commit:     Brad Figg <brad.figg@canonical.com>
CommitDate: Mon Jan 23 13:43:45 2012 -0800

    xfs: fix acl count validation in xfs_acl_from_disk()
    
    Commit fa8b18ed didn't prevent the integer overflow and possible
    memory corruption.  "count" can go negative and bypass the check.
    
    Signed-off-by: Xi Wang <xi.wang@gmail.com>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Ben Myers <bpm@sgi.com>
    
    (cherry-picked from commit 093019cf1b18dd31b2c3b77acce4e000e2cbc9ce)
    CVE-2012-0038
    BugLink: http://bugs.launchpad.net/bugs/917706
    Signed-off-by: Andy Whitcroft <apw@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Acked-by: Herton Krzesinski <herton.krzesinski@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>
    
    Signed-off-by: Brad Figg <brad.figg@canonical.com>

diff --git a/fs/xfs/linux-2.6/xfs_acl.c b/fs/xfs/linux-2.6/xfs_acl.c
index 46556ee5b0d5..3423aba01f71 100644
--- a/fs/xfs/linux-2.6/xfs_acl.c
+++ b/fs/xfs/linux-2.6/xfs_acl.c
@@ -39,7 +39,7 @@ xfs_acl_from_disk(struct xfs_acl *aclp)
 	struct posix_acl_entry *acl_e;
 	struct posix_acl *acl;
 	struct xfs_acl_entry *ace;
-	int count, i;
+	unsigned int count, i;
 
 	count = be32_to_cpu(aclp->acl_cnt);
 	if (count > XFS_ACL_MAX_ENTRIES)
