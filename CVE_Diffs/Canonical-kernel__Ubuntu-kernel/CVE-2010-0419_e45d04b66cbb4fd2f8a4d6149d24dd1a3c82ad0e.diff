Canonical-kernel__Ubuntu-kernel
commit e45d04b66cbb4fd2f8a4d6149d24dd1a3c82ad0e
Author:     Leann Ogasawara <leann.ogasawara@canonical.com>
AuthorDate: Wed Apr 7 19:55:14 2010 -0700
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Tue May 25 13:59:46 2010 +0200

    UBUNTU: kvm: restrict writing of segment selectors to segment registers
    
    CVE-2010-0419
    
    The x86 emulator in KVM 83, when a guest is configured for Symmetric
    Multiprocessing (SMP), does not properly restrict writing of segment
    selectors to segment registers, which might allow guest OS users to
    cause a denial of service (guest OS crash) or gain privileges on the
    guest OS by leveraging access to a (1) IO port or (2) MMIO region, and
    replacing an instruction in between emulator entry and instruction fetch.
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/arch/x86/kvm/x86_emulate.c b/arch/x86/kvm/x86_emulate.c
index 4b12352d0399..bd13b8319785 100644
--- a/arch/x86/kvm/x86_emulate.c
+++ b/arch/x86/kvm/x86_emulate.c
@@ -152,7 +152,7 @@ static u32 opcode_table[256] = {
 	ByteOp | DstMem | SrcReg | ModRM | Mov, DstMem | SrcReg | ModRM | Mov,
 	ByteOp | DstReg | SrcMem | ModRM | Mov, DstReg | SrcMem | ModRM | Mov,
 	DstMem | SrcReg | ModRM | Mov, ModRM | DstReg,
-	DstReg | SrcMem | ModRM | Mov, Group | Group1A,
+	0, Group | Group1A,
 	/* 0x90 - 0x97 */
 	DstReg, DstReg, DstReg, DstReg,	DstReg, DstReg, DstReg, DstReg,
 	/* 0x98 - 0x9F */
@@ -196,7 +196,7 @@ static u32 opcode_table[256] = {
 	ByteOp | SrcImmUByte, SrcImmUByte,
 	/* 0xE8 - 0xEF */
 	SrcImm | Stack, SrcImm | ImplicitOps,
-	SrcImmU | Src2Imm16, SrcImmByte | ImplicitOps,
+	0, SrcImmByte | ImplicitOps,
 	SrcNone | ByteOp | ImplicitOps, SrcNone | ImplicitOps,
 	SrcNone | ByteOp | ImplicitOps, SrcNone | ImplicitOps,
 	/* 0xF0 - 0xF7 */
