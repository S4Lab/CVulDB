Canonical-kernel__Ubuntu-kernel
commit f495454e61ce2e76f81effa816ab4b34b141410c
Author:     Wim Van Sebroeck <wim@iguana.be>
AuthorDate: Wed Oct 15 08:53:06 2008 +0000
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Sat Jan 17 16:02:00 2009 +0100

    ib700wdt.c - fix buffer_underflow bug
    
    CVE-2008-5702
    
    commit 7c2500f17d65092d93345f3996cf82ebca17e9ff upstream
    
    This fixes Bug 11399:
    if ibwdt_set_heartbeat(int t) is called with value 30 then
    the check "if ((t < 0) || (t > 30))" in ibwdt_set_heartbeat
    is not going to fail because t == 30, but in the loop, the
    check wd_times[i] > t is never going to be true because
    none of the wd_times are greater than the value of t (i.e. 30).
    So we are exiting the loop with i == -1 and therefore setting
    wd_margin to -1 which is wrong.
    
    Reported-by: Zvonimir Rakamaric <zrakamar@cs.ubc.ca>
    Signed-off-by: Wim Van Sebroeck <wim@iguana.be>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/drivers/watchdog/ib700wdt.c b/drivers/watchdog/ib700wdt.c
index 4b89f401691a..457ca6e17426 100644
--- a/drivers/watchdog/ib700wdt.c
+++ b/drivers/watchdog/ib700wdt.c
@@ -155,7 +155,7 @@ ibwdt_set_heartbeat(int t)
 		return -EINVAL;
 
 	for (i = 0x0F; i > -1; i--)
-		if (wd_times[i] > t)
+		if (wd_times[i] >= t)
 			break;
 	wd_margin = i;
 	return 0;
