Canonical-kernel__Ubuntu-kernel
commit 5fda09202aefe48b29e7648520af203a1678ba1b
Author:     Dan Rosenberg <drosenberg@vsecurity.com>
AuthorDate: Mon Feb 14 13:45:28 2011 +0000
Commit:     Herton Ronaldo Krzesinski <herton.krzesinski@canonical.com>
CommitDate: Tue May 31 09:31:19 2011 -0300

    xfs: prevent leaking uninitialized stack memory in FSGEOMETRY_V1, CVE-2011-0711
    
    BugLink: http://bugs.launchpad.net/bugs/767740
    
    CVE-2011-0711
    
    The FSGEOMETRY_V1 ioctl (and its compat equivalent) calls out to
    xfs_fs_geometry() with a version number of 3.  This code path does not
    fill in the logsunit member of the passed xfs_fsop_geom_t, leading to
    the leaking of four bytes of uninitialized stack data to potentially
    unprivileged callers.
    
    v2 switches to memset() to avoid future issues if structure members
    change, on suggestion of Dave Chinner.
    
    Signed-off-by: Dan Rosenberg <drosenberg@vsecurity.com>
    Reviewed-by: Eugene Teo <eugeneteo@kernel.org>
    Signed-off-by: Alex Elder <aelder@sgi.com>
    (cherry picked from commit 3a3675b7f23f83ca8c67c9c2b6edf707fd28d1ba)
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/fs/xfs/xfs_fsops.c b/fs/xfs/xfs_fsops.c
index 37a6f62c57b6..4e7f02b22d1d 100644
--- a/fs/xfs/xfs_fsops.c
+++ b/fs/xfs/xfs_fsops.c
@@ -57,6 +57,9 @@ xfs_fs_geometry(
 	xfs_fsop_geom_t		*geo,
 	int			new_version)
 {
+
+	memset(geo, 0, sizeof(*geo));
+
 	geo->blocksize = mp->m_sb.sb_blocksize;
 	geo->rtextsize = mp->m_sb.sb_rextsize;
 	geo->agblocks = mp->m_sb.sb_agblocks;
