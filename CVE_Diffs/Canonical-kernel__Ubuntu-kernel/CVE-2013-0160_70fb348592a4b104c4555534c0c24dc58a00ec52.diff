Canonical-kernel__Ubuntu-kernel
commit 70fb348592a4b104c4555534c0c24dc58a00ec52
Author:     Signed-off-by: Wu Fengguang <fengguang.wu@intel.com>
AuthorDate: Fri Jan 24 14:17:22 2014 +0000
Commit:     rtg <tim.gardner@canonical.com>
CommitDate: Mon Jan 27 12:47:23 2014 +0000

    fanotify: FMODE_NONOTIFY and __O_SYNC in sparc conflict
    
    CVE-2013-0160
    
    BugLink: http://bugs.launchpad.net/bugs/1097680
    
    sparc used the same value as FMODE_NONOTIFY so change FMODE_NONOTIFY to be
    something unique.
    
    Signed-off-by: Wu Fengguang <fengguang.wu@intel.com>
    Signed-off-by: Eric Paris <eparis@redhat.com>
    (cherry picked from commit 12ed2e36c98aec6c41559222e311f4aa15d254b6)
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Acked-by: Andy Whitcroft <andy.whitcroft@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/include/asm-generic/fcntl.h b/include/asm-generic/fcntl.h
index c8ba13423887..aeef0576d4a3 100644
--- a/include/asm-generic/fcntl.h
+++ b/include/asm-generic/fcntl.h
@@ -5,7 +5,7 @@
 
 /*
  * FMODE_EXEC is 0x20
- * FMODE_NONOTIFY is 0x800000
+ * FMODE_NONOTIFY is 0x1000000
  * These cannot be used by userspace O_* until internal and external open
  * flags are split.
  * -Eric Paris
diff --git a/include/linux/fs.h b/include/linux/fs.h
index 42f714f98cd8..34cb8c506f21 100644
--- a/include/linux/fs.h
+++ b/include/linux/fs.h
@@ -92,7 +92,7 @@ struct inodes_stat_t {
 #define FMODE_RANDOM		((__force fmode_t)4096)
 
 /* File was opened by fanotify and shouldn't generate fanotify events */
-#define FMODE_NONOTIFY		((__force fmode_t)8388608)
+#define FMODE_NONOTIFY		((__force fmode_t)16777216) /* 0x1000000 */
 
 /*
  * The below are the various read and write types that we support. Some of
