Canonical-kernel__Ubuntu-kernel
commit b5f1236c4bd5895d096bb6c6c95f25bc7b41c711
Author:     Francois Romieu <romieu@fr.zoreil.com>
AuthorDate: Tue Aug 26 21:56:06 2008 +0200
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Tue Dec 1 19:58:50 2009 +0100

    r8169: balance pci_map / pci_unmap pair
    
    CVE-2009-3613
    
    The leak hurts with swiotlb and jumbo frames.
    
    Fix http://bugzilla.kernel.org/show_bug.cgi?id=9468.
    
    Heavily hinted by Ilpo JÃ¤rvinen <ilpo.jarvinen@helsinki.fi>.
    
    Signed-off-by: Francois Romieu <romieu@fr.zoreil.com>
    Tested-by: Alistair John Strachan <alistair@devzero.co.uk>
    Tested-by: Timothy J Fontaine <tjfontaine@atxconsulting.com>
    Cc: Edward Hsu <edward_hsu@realtek.com.tw>
    Signed-off-by: Jeff Garzik <jgarzik@redhat.com>
    (cherry picked from commit a866bbf6aacf95f849810079442a20be118ce905)
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/drivers/net/r8169.c b/drivers/net/r8169.c
index 704135d77853..8f7074759fd4 100644
--- a/drivers/net/r8169.c
+++ b/drivers/net/r8169.c
@@ -3114,7 +3114,7 @@ static int rtl8169_rx_interrupt(struct net_device *dev,
 					pkt_size, PCI_DMA_FROMDEVICE);
 				rtl8169_mark_to_asic(desc, tp->rx_buf_sz);
 			} else {
-				pci_unmap_single(pdev, addr, pkt_size,
+				pci_unmap_single(pdev, addr, tp->rx_buf_sz,
 						 PCI_DMA_FROMDEVICE);
 				tp->Rx_skbuff[entry] = NULL;
 			}
