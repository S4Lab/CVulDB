Canonical-kernel__Ubuntu-kernel
commit 5caf3ae4c4bed98bd6148021e6e934d94b5dea1d
Author:     Kees Cook <kees.cook@canonical.com>
AuthorDate: Mon Oct 11 12:23:25 2010 -0700
Commit:     Herton Ronaldo Krzesinski <herton.krzesinski@canonical.com>
CommitDate: Wed May 25 14:25:15 2011 -0300

    net: clear heap allocations for privileged ethtool actions, CVE-2010-4655
    
    BugLink: http://bugs.launchpad.net/bugs/771445
    
    CVE-2010-4655
    
    Several other ethtool functions leave heap uncleared (potentially) by
    drivers. Some interfaces appear safe (eeprom, etc), in that the sizes
    are well controlled. In some situations (e.g. unchecked error conditions),
    the heap will remain unchanged in areas before copying back to userspace.
    Note that these are less of an issue since these all require CAP_NET_ADMIN.
    
    Cc: stable@kernel.org
    Signed-off-by: Kees Cook <kees.cook@canonical.com>
    Acked-by: Ben Hutchings <bhutchings@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    (backport of commit 272b62c1f0f6f742046e45b50b6fec98860208a0)
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>
    Acked-by: Brad Figg <brad.figg@canonical.com>
    Acked-by: John Johansen <john.johansen@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/net/core/ethtool.c b/net/core/ethtool.c
index 1163eb2256d0..28eb246f6213 100644
--- a/net/core/ethtool.c
+++ b/net/core/ethtool.c
@@ -226,7 +226,7 @@ static int ethtool_get_regs(struct net_device *dev, char __user *useraddr)
 	if (regs.len > reglen)
 		regs.len = reglen;
 
-	regbuf = kmalloc(reglen, GFP_USER);
+	regbuf = kzalloc(reglen, GFP_USER);
 	if (!regbuf)
 		return -ENOMEM;
 
