Canonical-kernel__Ubuntu-kernel
commit ace2b7cd5ba4740ea72d76c7e1578fba8d2841b1
Author:     Jeff Layton <jlayton@redhat.com>
AuthorDate: Tue Oct 25 17:12:28 2011 +0100
Commit:     Herton Ronaldo Krzesinski <herton.krzesinski@canonical.com>
CommitDate: Mon Nov 7 21:52:27 2011 -0200

    cifs: check for NULL session password, CVE-2011-1585
    
    It's possible for a cifsSesInfo struct to have a NULL password, so we
    need to check for that prior to running strncmp on it.
    
    Signed-off-by: Jeff Layton <jlayton@redhat.com>
    Signed-off-by: Steve French <sfrench@us.ibm.com>
    
    (cherry picked from commit 24e6cf92fde1f140d8eb0bf7cd24c2c78149b6b2)
    CVE-2011-1585
    BugLink: http://bugs.launchpad.net/bugs/869208
    Signed-off-by: Andy Whitcroft <apw@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/fs/cifs/connect.c b/fs/cifs/connect.c
index 3cc37e0000bc..5d83038ef572 100644
--- a/fs/cifs/connect.c
+++ b/fs/cifs/connect.c
@@ -1608,6 +1608,7 @@ cifs_find_smb_ses(struct TCP_Server_Info *server, struct smb_vol *vol)
 				    MAX_USERNAME_SIZE))
 				continue;
 			if (strlen(vol->username) != 0 &&
+			    ses->password != NULL &&
 			    strncmp(ses->password,
 				    vol->password ? vol->password : "",
 				    MAX_PASSWORD_SIZE))
