Canonical-kernel__Ubuntu-kernel
commit 829706862a5fc7422344b75ef2657932a9f3f613
Author:     David S. Miller <davem@davemloft.net>
AuthorDate: Thu May 8 23:40:26 2008 -0700
Commit:     Kees Cook <kees@outflux.net>
CommitDate: Tue Jun 24 15:12:17 2008 -0700

    (CVE-2008-2136) sit: Add missing kfree_skb() on pskb_may_pull() failure.
    
    [linux-2.6: 36ca34cc3b8335eb1fe8bd9a1d0a2592980c3f02]
    
    Noticed by Paul Marks <paul@pmarks.net>.
    
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Kees Cook <kees.cook@canonical.com>

diff --git a/net/ipv6/sit.c b/net/ipv6/sit.c
index 71433d29d884..bd22f64b0ec1 100644
--- a/net/ipv6/sit.c
+++ b/net/ipv6/sit.c
@@ -395,9 +395,9 @@ static int ipip6_rcv(struct sk_buff *skb)
 	}
 
 	icmp_send(skb, ICMP_DEST_UNREACH, ICMP_PORT_UNREACH, 0);
-	kfree_skb(skb);
 	read_unlock(&ipip6_lock);
 out:
+	kfree_skb(skb);
 	return 0;
 }
 
