Canonical-kernel__Ubuntu-kernel
commit edd260d2b773ffb37d827ecd21242428a2fb9074
Author:     Kees Cook <kees.cook@canonical.com>
AuthorDate: Thu Oct 7 10:03:48 2010 +0000
Commit:     Leann Ogasawara <leann.ogasawara@canonical.com>
CommitDate: Tue Nov 30 20:26:57 2010 -0800

    net: clear heap allocation for ETHTOOL_GRXCLSRLALL
    
    CVE-2010-3861
    
    Calling ETHTOOL_GRXCLSRLALL with a large rule_cnt will allocate kernel
    heap without clearing it. For the one driver (niu) that implements it,
    it will leave the unused portion of heap unchanged and copy the full
    contents back to userspace.
    
    Signed-off-by: Kees Cook <kees.cook@canonical.com>
    Acked-by: Ben Hutchings <bhutchings@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (backported from commit ae6df5f96a51818d6376da5307d773baeece4014)
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>

diff --git a/net/core/ethtool.c b/net/core/ethtool.c
index 46924d33fc9c..2942ff9d36ef 100644
--- a/net/core/ethtool.c
+++ b/net/core/ethtool.c
@@ -257,7 +257,7 @@ static int ethtool_get_rxnfc(struct net_device *dev, u32 cmd,
 
 	if (info.cmd == ETHTOOL_GRXCLSRLALL) {
 		if (info.rule_cnt > 0) {
-			rule_buf = kmalloc(info.rule_cnt * sizeof(u32),
+			rule_buf = kzalloc(info.rule_cnt * sizeof(u32),
 					   GFP_USER);
 			if (!rule_buf)
 				return -ENOMEM;
