Canonical-kernel__Ubuntu-kernel
commit 148313ad6f3ed7d0bbe81ce3a6860a9c30af0d8f
Author:     Jeff Layton <jlayton@redhat.com>
AuthorDate: Tue Oct 25 17:12:25 2011 +0100
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Tue Oct 25 11:32:00 2011 -0600

    cifs: check for NULL session password, CVE-2011-1585
    
    It's possible for a cifsSesInfo struct to have a NULL password, so we
    need to check for that prior to running strncmp on it.
    
    Signed-off-by: Jeff Layton <jlayton@redhat.com>
    Signed-off-by: Steve French <sfrench@us.ibm.com>
    
    (cherry picked from commit 24e6cf92fde1f140d8eb0bf7cd24c2c78149b6b2)
    CVE-2011-1585
    BugLink: http://bugs.launchpad.net/bugs/869208
    Signed-off-by: Andy Whitcroft <apw@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/fs/cifs/connect.c b/fs/cifs/connect.c
index bbf1c258a7a8..fd70eed029ca 100644
--- a/fs/cifs/connect.c
+++ b/fs/cifs/connect.c
@@ -1583,6 +1583,7 @@ cifs_find_smb_ses(struct TCP_Server_Info *server, struct smb_vol *vol)
 				    MAX_USERNAME_SIZE))
 				continue;
 			if (strlen(vol->username) != 0 &&
+			    ses->password != NULL &&
 			    strncmp(ses->password,
 				    vol->password ? vol->password : "",
 				    MAX_PASSWORD_SIZE))
