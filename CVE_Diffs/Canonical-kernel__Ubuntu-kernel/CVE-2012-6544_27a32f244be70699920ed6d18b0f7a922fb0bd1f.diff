Canonical-kernel__Ubuntu-kernel
commit 27a32f244be70699920ed6d18b0f7a922fb0bd1f
Author:     Mathias Krause <minipli@googlemail.com>
AuthorDate: Tue Mar 26 17:14:47 2013 +0000
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Tue Mar 26 11:33:25 2013 -0600

    Bluetooth: L2CAP - Fix info leak via getsockname()
    
    CVE-2012-6544
    
    BugLink: http://bugs.launchpad.net/bugs/1156751
    
    The L2CAP code fails to initialize the l2_bdaddr_type member of struct
    sockaddr_l2 and the padding byte added for alignment. It that for leaks
    two bytes kernel stack via the getsockname() syscall. Add an explicit
    memset(0) before filling the structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Marcel Holtmann <marcel@holtmann.org>
    Cc: Gustavo Padovan <gustavo@padovan.org>
    Cc: Johan Hedberg <johan.hedberg@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (back ported from commit 792039c73cf176c8e39a6e8beef2c94ff46522ed)
    
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    
    Conflicts:
            net/bluetooth/l2cap_sock.c
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/net/bluetooth/l2cap.c b/net/bluetooth/l2cap.c
index 71120ee8511e..1c20bd98d16d 100644
--- a/net/bluetooth/l2cap.c
+++ b/net/bluetooth/l2cap.c
@@ -1184,6 +1184,7 @@ static int l2cap_sock_getname(struct socket *sock, struct sockaddr *addr, int *l
 
 	BT_DBG("sock %p, sk %p", sock, sk);
 
+	memset(la, 0, sizeof(struct sockaddr_l2));
 	addr->sa_family = AF_BLUETOOTH;
 	*len = sizeof(struct sockaddr_l2);
 
