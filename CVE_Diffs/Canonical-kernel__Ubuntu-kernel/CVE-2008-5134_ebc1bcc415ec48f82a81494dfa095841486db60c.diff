Canonical-kernel__Ubuntu-kernel
commit ebc1bcc415ec48f82a81494dfa095841486db60c
Author:     Johannes Berg <johannes@sipsolutions.net>
AuthorDate: Wed Oct 29 11:43:32 2008 +0100
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Wed Jan 14 18:37:37 2009 +0100

    libertas: fix buffer overrun
    
    CVE-2008-5134
    
    commit 48735d8d8bd701b1e0cd3d49c21e5e385ddcb077 upstream
    
    If somebody sends an invalid beacon/probe response, that can trash the
    whole BSS descriptor. The descriptor is, luckily, large enough so that
    it cannot scribble past the end of it; it's well above 400 bytes long.
    
    Signed-off-by: Johannes Berg <johannes@sipsolutions.net>
    Cc: stable@kernel.org [2.6.24-2.6.27, bug present in some form since driver was added (2.6.22)]
    Signed-off-by: John W. Linville <linville@tuxdriver.com>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/drivers/net/wireless/libertas/scan.c b/drivers/net/wireless/libertas/scan.c
index ad1e67d984ce..7aa576d1dc13 100644
--- a/drivers/net/wireless/libertas/scan.c
+++ b/drivers/net/wireless/libertas/scan.c
@@ -1022,8 +1022,8 @@ static int libertas_process_bss(struct bss_descriptor * bss,
 
 		switch (elem->id) {
 		case MFIE_TYPE_SSID:
-			bss->ssid_len = elem->len;
-			memcpy(bss->ssid, elem->data, elem->len);
+			bss->ssid_len = min_t(int, 32, elem->len);
+			memcpy(bss->ssid, elem->data, bss->ssid_len);
 			lbs_deb_scan("ssid '%s', ssid length %u\n",
 			             escape_essid(bss->ssid, bss->ssid_len),
 			             bss->ssid_len);
