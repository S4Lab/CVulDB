Canonical-kernel__Ubuntu-kernel
commit e6c3efdb9522e1b97eca56c23ff41057b15e15b7
Author:     Stefan Bader <stefan.bader@canonical.com>
AuthorDate: Thu Jun 18 18:36:02 2009 +0200
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Wed Jun 24 20:56:32 2009 +0200

    UBUNTU: OPENVZ: Fixup for 'kill sig -1' must only apply to caller's namespace
    
    CVE-2009-1338
    
    This fixes a FTBS caused by the CVE update.
    
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/debian/binary-custom.d/openvz/patchset/0001-2.6.24-ovz002.patch b/debian/binary-custom.d/openvz/patchset/0001-2.6.24-ovz002.patch
index 3ebc9df0470b..194a490abdf8 100644
--- a/debian/binary-custom.d/openvz/patchset/0001-2.6.24-ovz002.patch
+++ b/debian/binary-custom.d/openvz/patchset/0001-2.6.24-ovz002.patch
@@ -64413,9 +64413,9 @@ Index: kernel/kernel/signal.c
  		read_lock(&tasklist_lock);
 -		for_each_process(p) {
 +		for_each_process_ve(p) {
- 			if (p->pid > 1 && !same_thread_group(p, current)) {
+ 			if (task_pid_vnr(p) > 1 &&
+					!same_thread_group(p, current)) {
  				int err = group_send_sig_info(sig, info, p);
- 				++count;
 @@ -1446,6 +1485,14 @@
  	BUG_ON(!tsk->ptrace &&
  	       (tsk->group_leader != tsk || !thread_group_empty(tsk)));
