Canonical-kernel__Ubuntu-kernel
commit e250e13cbf96a9f7556580219074a56f67a06831
Author:     Stefan Bader <stefan.bader@canonical.com>
AuthorDate: Fri Feb 10 11:00:49 2012 +0100
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Mon Feb 13 07:47:05 2012 -0700

    UBUNTU: SAUCE: Return deny all as default in encode_share_access
    
    This used to be catched by BUG() which is not only unnecessary.
    It was changed as part of a bigger rewrite that depends on a
    typedef which does not exist before 2.6.28.
    
    CVE-2011-4324
    BugLink: http://bugs.launchpad.net/bugs/917829
    
    (very loosely backported from dc0b027dfadfcb8a5504f7d8052754bf8d501ab9)
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/debian/binary-custom.d/openvz/src/fs/nfs/nfs4xdr.c b/debian/binary-custom.d/openvz/src/fs/nfs/nfs4xdr.c
index 51dd3804866f..cc66519edca7 100644
--- a/debian/binary-custom.d/openvz/src/fs/nfs/nfs4xdr.c
+++ b/debian/binary-custom.d/openvz/src/fs/nfs/nfs4xdr.c
@@ -967,7 +967,7 @@ static void encode_share_access(struct xdr_stream *xdr, int open_flags)
 			WRITE32(NFS4_SHARE_ACCESS_BOTH);
 			break;
 		default:
-			BUG();
+			WRITE32(0);
 	}
 	WRITE32(0);		/* for linux, share_deny = 0 always */
 }
diff --git a/debian/binary-custom.d/xen/src/fs/nfs/nfs4xdr.c b/debian/binary-custom.d/xen/src/fs/nfs/nfs4xdr.c
index 51dd3804866f..cc66519edca7 100644
--- a/debian/binary-custom.d/xen/src/fs/nfs/nfs4xdr.c
+++ b/debian/binary-custom.d/xen/src/fs/nfs/nfs4xdr.c
@@ -967,7 +967,7 @@ static void encode_share_access(struct xdr_stream *xdr, int open_flags)
 			WRITE32(NFS4_SHARE_ACCESS_BOTH);
 			break;
 		default:
-			BUG();
+			WRITE32(0);
 	}
 	WRITE32(0);		/* for linux, share_deny = 0 always */
 }
diff --git a/fs/nfs/nfs4xdr.c b/fs/nfs/nfs4xdr.c
index 51dd3804866f..cc66519edca7 100644
--- a/fs/nfs/nfs4xdr.c
+++ b/fs/nfs/nfs4xdr.c
@@ -967,7 +967,7 @@ static void encode_share_access(struct xdr_stream *xdr, int open_flags)
 			WRITE32(NFS4_SHARE_ACCESS_BOTH);
 			break;
 		default:
-			BUG();
+			WRITE32(0);
 	}
 	WRITE32(0);		/* for linux, share_deny = 0 always */
 }
