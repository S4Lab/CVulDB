Canonical-kernel__Ubuntu-kernel
commit c0a0b1218faca035d5853ded2df8f0f1eab987ca
Author:     Kees Cook <kees.cook@canonical.com>
AuthorDate: Tue Apr 26 15:00:31 2011 -0700
Commit:     Herton Ronaldo Krzesinski <herton.krzesinski@canonical.com>
CommitDate: Wed May 25 14:25:15 2011 -0300

    usb: iowarrior: don't trust report_size for buffer size, CVE-2010-4656
    
    CVE-2010-4656
    
    BugLink: http://bugs.launchpad.net/bugs/711484
    
    If the iowarrior devices in this case statement support more than 8 bytes
    per report, it is possible to write past the end of a kernel heap allocation.
    This will probably never be possible, but change the allocation to be more
    defensive anyway.
    
    Signed-off-by: Kees Cook <kees.cook@canonical.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
    
    (cherry-pick of commit 3ed780117dbe5acb64280d218f0347f238dafed0)
    Signed-off-by: Brad Figg <brad.figg@canonical.com>
    Acked-by: John Johansen <john.johansen@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/drivers/usb/misc/iowarrior.c b/drivers/usb/misc/iowarrior.c
index 764696ff1e8e..cf0919db9d86 100644
--- a/drivers/usb/misc/iowarrior.c
+++ b/drivers/usb/misc/iowarrior.c
@@ -373,7 +373,7 @@ static ssize_t iowarrior_write(struct file *file,
 	case USB_DEVICE_ID_CODEMERCS_IOWPV2:
 	case USB_DEVICE_ID_CODEMERCS_IOW40:
 		/* IOW24 and IOW40 use a synchronous call */
-		buf = kmalloc(8, GFP_KERNEL);	/* 8 bytes are enough for both products */
+		buf = kmalloc(count, GFP_KERNEL);
 		if (!buf) {
 			retval = -ENOMEM;
 			goto exit;
