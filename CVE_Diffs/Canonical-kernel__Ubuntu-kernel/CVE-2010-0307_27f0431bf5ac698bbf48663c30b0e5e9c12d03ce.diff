Canonical-kernel__Ubuntu-kernel
commit 27f0431bf5ac698bbf48663c30b0e5e9c12d03ce
Author:     Stefan Bader <stefan.bader@canonical.com>
AuthorDate: Fri Mar 5 20:10:39 2010 +0100
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Wed Mar 10 17:09:45 2010 +0100

    UBUNTU: rt: Remove TIF_ABI_PENDING bit
    
    CVE-2010-0307
    
    As TIF_ABI_PENDING has been removed from the kernel the rt patchset
    needs to be modified to work.
    
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/debian/binary-custom.d/rt/patchset/0151-preempt-irqs-ppc.patch b/debian/binary-custom.d/rt/patchset/0151-preempt-irqs-ppc.patch
index ee4e1311b65c..cbbd4ad788d4 100644
--- a/debian/binary-custom.d/rt/patchset/0151-preempt-irqs-ppc.patch
+++ b/debian/binary-custom.d/rt/patchset/0151-preempt-irqs-ppc.patch
@@ -113,9 +113,9 @@ Index: linux-2.6.24.7-rt27/include/asm-powerpc/thread_info.h
 --- linux-2.6.24.7-rt27.orig/include/asm-powerpc/thread_info.h	2009-02-08 00:00:14.000000000 -0500
 +++ linux-2.6.24.7-rt27/include/asm-powerpc/thread_info.h	2009-02-08 00:01:54.000000000 -0500
 @@ -124,6 +124,9 @@ static inline struct thread_info *curren
+ #define TIF_RESTORE_SIGMASK	13	/* Restore signal mask in do_signal */
  #define TIF_FREEZE		14	/* Freezing for suspend */
  #define TIF_RUNLATCH		15	/* Is the runlatch enabled? */
- #define TIF_ABI_PENDING		16	/* 32/64 bit switch needed */
 +#define TIF_NEED_RESCHED_DELAYED \
 +				17	/* reschedule on return to userspace */
 +
@@ -123,9 +123,9 @@ Index: linux-2.6.24.7-rt27/include/asm-powerpc/thread_info.h
  /* as above, but as bit values */
  #define _TIF_SYSCALL_TRACE	(1<<TIF_SYSCALL_TRACE)
 @@ -142,6 +145,8 @@ static inline struct thread_info *curren
+ #define _TIF_RESTORE_SIGMASK	(1<<TIF_RESTORE_SIGMASK)
  #define _TIF_FREEZE		(1<<TIF_FREEZE)
  #define _TIF_RUNLATCH		(1<<TIF_RUNLATCH)
- #define _TIF_ABI_PENDING	(1<<TIF_ABI_PENDING)
 +#define _TIF_NEED_RESCHED_DELAYED (1<<TIF_NEED_RESCHED_DELAYED)
 +
  #define _TIF_SYSCALL_T_OR_A	(_TIF_SYSCALL_TRACE|_TIF_SYSCALL_AUDIT|_TIF_SECCOMP)
diff --git a/debian/binary-custom.d/rt/patchset/0175-rt-mutex-x86-64.patch b/debian/binary-custom.d/rt/patchset/0175-rt-mutex-x86-64.patch
index 8cdc2764688b..6826980da035 100644
--- a/debian/binary-custom.d/rt/patchset/0175-rt-mutex-x86-64.patch
+++ b/debian/binary-custom.d/rt/patchset/0175-rt-mutex-x86-64.patch
@@ -462,4 +462,4 @@ Index: linux-2.6.24.7-rt27/include/asm-x86/thread_info_64.h
 +#define _TIF_NEED_RESCHED_DELAYED (1<<TIF_NEED_RESCHED_DELAYED)
  #define _TIF_IA32		(1<<TIF_IA32)
  #define _TIF_FORK		(1<<TIF_FORK)
- #define _TIF_ABI_PENDING	(1<<TIF_ABI_PENDING)
+ #define _TIF_DEBUG		(1<<TIF_DEBUG)
diff --git a/debian/binary-custom.d/rt/patchset/0347-powerpc-rearrange-thread-flags-to-work-with-andi-instruction.patch b/debian/binary-custom.d/rt/patchset/0347-powerpc-rearrange-thread-flags-to-work-with-andi-instruction.patch
index 3c1483f9e580..3f73d4bcc586 100644
--- a/debian/binary-custom.d/rt/patchset/0347-powerpc-rearrange-thread-flags-to-work-with-andi-instruction.patch
+++ b/debian/binary-custom.d/rt/patchset/0347-powerpc-rearrange-thread-flags-to-work-with-andi-instruction.patch
@@ -16,30 +16,27 @@ Index: linux-2.6.24.7-rt27/include/asm-powerpc/thread_info.h
 ===================================================================
 --- linux-2.6.24.7-rt27.orig/include/asm-powerpc/thread_info.h	2009-02-08 00:02:28.000000000 -0500
 +++ linux-2.6.24.7-rt27/include/asm-powerpc/thread_info.h	2009-02-08 00:03:36.000000000 -0500
-@@ -121,11 +121,11 @@ static inline struct thread_info *curren
+@@ -121,10 +121,10 @@ static inline struct thread_info *curren
  #define TIF_RESTOREALL		11	/* Restore all regs (implies NOERROR) */
  #define TIF_NOERROR		12	/* Force successful syscall return */
  #define TIF_RESTORE_SIGMASK	13	/* Restore signal mask in do_signal */
 -#define TIF_FREEZE		14	/* Freezing for suspend */
 -#define TIF_RUNLATCH		15	/* Is the runlatch enabled? */
--#define TIF_ABI_PENDING		16	/* 32/64 bit switch needed */
  #define TIF_NEED_RESCHED_DELAYED \
 -				17	/* reschedule on return to userspace */
 +				14	/* reschedule on return to userspace */
 +#define TIF_FREEZE		15	/* Freezing for suspend */
 +#define TIF_RUNLATCH		16	/* Is the runlatch enabled? */
-+#define TIF_ABI_PENDING		17	/* 32/64 bit switch needed */
  
  
  /* as above, but as bit values */
-@@ -142,10 +142,10 @@ static inline struct thread_info *curren
+@@ -142,9 +142,9 @@ static inline struct thread_info *curren
  #define _TIF_RESTOREALL		(1<<TIF_RESTOREALL)
  #define _TIF_NOERROR		(1<<TIF_NOERROR)
  #define _TIF_RESTORE_SIGMASK	(1<<TIF_RESTORE_SIGMASK)
 +#define _TIF_NEED_RESCHED_DELAYED (1<<TIF_NEED_RESCHED_DELAYED)
  #define _TIF_FREEZE		(1<<TIF_FREEZE)
  #define _TIF_RUNLATCH		(1<<TIF_RUNLATCH)
- #define _TIF_ABI_PENDING	(1<<TIF_ABI_PENDING)
 -#define _TIF_NEED_RESCHED_DELAYED (1<<TIF_NEED_RESCHED_DELAYED)
  
  #define _TIF_SYSCALL_T_OR_A	(_TIF_SYSCALL_TRACE|_TIF_SYSCALL_AUDIT|_TIF_SECCOMP)
