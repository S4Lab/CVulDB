Canonical-kernel__Ubuntu-kernel
commit e8a1edb244ffd32f422b50e470ff76d026cee4db
Author:     Dan Rosenberg <drosenberg@vsecurity.com>
AuthorDate: Wed Sep 15 11:43:28 2010 +0000
Commit:     Leann Ogasawara <leann.ogasawara@canonical.com>
CommitDate: Tue Nov 30 20:26:55 2010 -0800

    drivers/net/usb/hso.c: prevent reading uninitialized memory
    
    CVE-2010-3298
    
    Fixed formatting (tabs and line breaks).
    
    The TIOCGICOUNT device ioctl allows unprivileged users to read
    uninitialized stack memory, because the "reserved" member of the
    serial_icounter_struct struct declared on the stack in hso_get_count()
    is not altered or zeroed before being copied back to the user.  This
    patch takes care of it.
    
    Signed-off-by: Dan Rosenberg <dan.j.rosenberg@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (cherry picked from commit 7011e660938fc44ed86319c18a5954e95a82ab3e)
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>

diff --git a/drivers/net/usb/hso.c b/drivers/net/usb/hso.c
index 9e1fc2968cf1..9ec8916bb623 100644
--- a/drivers/net/usb/hso.c
+++ b/drivers/net/usb/hso.c
@@ -1633,6 +1633,8 @@ static int hso_get_count(struct hso_serial *serial,
 	struct uart_icount cnow;
 	struct hso_tiocmget  *tiocmget = serial->tiocmget;
 
+	memset(&icount, 0, sizeof(struct serial_icounter_struct));
+
 	if (!tiocmget)
 		 return -ENOENT;
 	spin_lock_irq(&serial->serial_lock);
