Canonical-kernel__Ubuntu-kernel
commit 7398ac1eab95d297d961eb22e3e70e0ba8aed728
Author:     Luis Henriques <luis.henriques@canonical.com>
AuthorDate: Tue May 14 14:48:54 2013 +0100
Commit:     Steve Conklin <sconklin@canonical.com>
CommitDate: Tue May 14 14:13:37 2013 -0500

    perf: Treat attr.config as u64 in perf_swevent_init()
    
    BugLink: http://bugs.launchpad.net/bugs/1179943
    
    From: Tommi Rantala <tt.rantala@gmail.com>
    
    CVE-2013-2094
    
    BugLink: http://bugs.launchpad.net/bugs/1179943
    
    Trinity discovered that we fail to check all 64 bits of
    attr.config passed by user space, resulting to out-of-bounds
    access of the perf_swevent_enabled array in
    sw_perf_event_destroy().
    
    Introduced in commit b0a873ebb ("perf: Register PMU
    implementations").
    
    Signed-off-by: Tommi Rantala <tt.rantala@gmail.com>
    Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Cc: davej@redhat.com
    Cc: Paul Mackerras <paulus@samba.org>
    Cc: Arnaldo Carvalho de Melo <acme@ghostprotocols.net>
    Link: http://lkml.kernel.org/r/1365882554-30259-1-git-send-email-tt.rantala@gmail.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    (cherry picked from commit 8176cced706b5e5d15887584150764894e94e02f)
    
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Acked-by: Steve Conklin <sconklin@canonical.com>
    Acked-by: Tim Gardner <tim.gardner@canonical.com>
    Signed-off-by: Steve Conklin <sconklin@canonical.com>

diff --git a/kernel/events/core.c b/kernel/events/core.c
index 7b6646a8c067..0600d3bf1cdd 100644
--- a/kernel/events/core.c
+++ b/kernel/events/core.c
@@ -5328,7 +5328,7 @@ static void sw_perf_event_destroy(struct perf_event *event)
 
 static int perf_swevent_init(struct perf_event *event)
 {
-	int event_id = event->attr.config;
+	u64 event_id = event->attr.config;
 
 	if (event->attr.type != PERF_TYPE_SOFTWARE)
 		return -ENOENT;
