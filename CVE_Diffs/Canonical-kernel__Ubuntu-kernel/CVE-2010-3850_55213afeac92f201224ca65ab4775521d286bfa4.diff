Canonical-kernel__Ubuntu-kernel
commit 55213afeac92f201224ca65ab4775521d286bfa4
Author:     Leann Ogasawara <leann.ogasawara@canonical.com>
AuthorDate: Thu Nov 18 15:05:20 2010 -0800
Commit:     Leann Ogasawara <leann.ogasawara@canonical.com>
CommitDate: Sun Nov 21 11:47:32 2010 -0800

    UBUNTU: SAUCE: AF_ECONET SIOCSIFADDR ioctl does not check privileges
    
    CVE-2010-3850
    
    In the ec_dev_ioctl function, the SIOCSIFADDR ioctl does not check
    privileges, allowing an unprivileged user to assign econet addresses to
    arbitrary interfaces. It is possible this is intentional, but AFAIK it
    would be unusual for SIOCSIFADDR to be unprivileged, so this may be an
    accident.
    
    This patch has yet to be submitted upstream, hence marking it as SAUCE
    for now.
    
    OriginalAuthor: Phil Blundell <philb@gnu.org>
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>

diff --git a/net/econet/af_econet.c b/net/econet/af_econet.c
index a6767f45d9d0..a1181c408061 100644
--- a/net/econet/af_econet.c
+++ b/net/econet/af_econet.c
@@ -695,6 +695,9 @@ static int ec_dev_ioctl(struct socket *sock, unsigned int cmd, void __user *arg)
 	err = 0;
 	switch (cmd) {
 	case SIOCSIFADDR:
+		if (!capable(CAP_NET_ADMIN))
+			return -EPERM;
+
 		edev = dev->ec_ptr;
 		if (edev == NULL) {
 			/* Magic up a new one. */
