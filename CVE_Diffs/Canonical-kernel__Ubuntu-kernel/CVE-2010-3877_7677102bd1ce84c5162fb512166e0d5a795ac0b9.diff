Canonical-kernel__Ubuntu-kernel
commit 7677102bd1ce84c5162fb512166e0d5a795ac0b9
Author:     Kulikov Vasiliy <segooon@gmail.com>
AuthorDate: Tue Feb 1 15:53:01 2011 +0000
Commit:     Paolo Pisati <paolo.pisati@canonical.com>
CommitDate: Thu Jun 9 16:07:08 2011 +0200

    net: tipc: fix information leak to userland, CVE-2010-3877
    
    Structure sockaddr_tipc is copied to userland with padding bytes after
    "id" field in union field "name" unitialized.  It leads to leaking of
    contents of kernel stack memory.  We have to initialize them to zero.
    
    Signed-off-by: Vasiliy Kulikov <segooon@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    CVE-2010-3877
    (cherry picked from commit 88f8a5e3e7defccd3925cabb1ee4d3994e5cdb52 upstream)
    BugLink: http://bugs.launchpad.net/bugs/711291
    Signed-off-by: Andy Whitcroft <apw@canonical.com>
    Acked-by: Brad Figg <brad.figg@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>
    Signed-off-by: Paolo Pisati <paolo.pisati@canonical.com>

diff --git a/net/tipc/socket.c b/net/tipc/socket.c
index 1848693ebb82..71036fb977f3 100644
--- a/net/tipc/socket.c
+++ b/net/tipc/socket.c
@@ -393,6 +393,7 @@ static int get_name(struct socket *sock, struct sockaddr *uaddr,
 	struct sockaddr_tipc *addr = (struct sockaddr_tipc *)uaddr;
 	struct tipc_sock *tsock = tipc_sk(sock->sk);
 
+	memset(addr, 0, sizeof(*addr));
 	if (peer) {
 		if ((sock->state != SS_CONNECTED) &&
 			((peer != 2) || (sock->state != SS_DISCONNECTING)))
