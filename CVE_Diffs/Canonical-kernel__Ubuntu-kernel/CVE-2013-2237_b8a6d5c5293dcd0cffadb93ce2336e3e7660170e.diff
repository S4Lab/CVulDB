Canonical-kernel__Ubuntu-kernel
commit b8a6d5c5293dcd0cffadb93ce2336e3e7660170e
Author:     Nicolas Dichtel <nicolas.dichtel@6wind.com>
AuthorDate: Mon Feb 18 16:24:20 2013 +0100
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Mon Jul 8 07:49:49 2013 -0600

    af_key: initialize satype in key_notify_policy_flush()
    
    CVE-2013-2237
    
    BugLink: http://bugs.launchpad.net/bugs/1198296
    
    This field was left uninitialized. Some user daemons perform check against this
    field.
    
    Signed-off-by: Nicolas Dichtel <nicolas.dichtel@6wind.com>
    Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
    (cherry picked from commit 85dfb745ee40232876663ae206cba35f24ab2a40)
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/net/key/af_key.c b/net/key/af_key.c
index 03d626f693ce..9d22e4679708 100644
--- a/net/key/af_key.c
+++ b/net/key/af_key.c
@@ -2694,6 +2694,7 @@ static int key_notify_policy_flush(struct km_event *c)
 	hdr->sadb_msg_pid = c->pid;
 	hdr->sadb_msg_version = PF_KEY_V2;
 	hdr->sadb_msg_errno = (uint8_t) 0;
+	hdr->sadb_msg_satype = SADB_SATYPE_UNSPEC;
 	hdr->sadb_msg_len = (sizeof(struct sadb_msg) / sizeof(uint64_t));
 	hdr->sadb_msg_reserved = 0;
 	pfkey_broadcast(skb_out, GFP_ATOMIC, BROADCAST_ALL, NULL, c->net);
