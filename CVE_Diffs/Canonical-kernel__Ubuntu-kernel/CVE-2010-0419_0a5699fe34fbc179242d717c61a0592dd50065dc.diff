Canonical-kernel__Ubuntu-kernel
commit 0a5699fe34fbc179242d717c61a0592dd50065dc
Author:     Leann Ogasawara <leann.ogasawara@canonical.com>
AuthorDate: Wed Apr 7 19:57:21 2010 -0700
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Tue Jun 1 11:43:37 2010 +0200

    UBUNTU: kvm: restrict writing of segment selectors to segment registers
    
    CVE-2010-0419
    
    The x86 emulator in KVM 83, when a guest is configured for Symmetric
    Multiprocessing (SMP), does not properly restrict writing of segment
    selectors to segment registers, which might allow guest OS users to
    cause a denial of service (guest OS crash) or gain privileges on the
    guest OS by leveraging access to a (1) IO port or (2) MMIO region, and
    replacing an instruction in between emulator entry and instruction fetch.
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/arch/x86/kvm/emulate.c b/arch/x86/kvm/emulate.c
index 1350e43cc02f..0f2f4a1f64cf 100644
--- a/arch/x86/kvm/emulate.c
+++ b/arch/x86/kvm/emulate.c
@@ -156,7 +156,7 @@ static u32 opcode_table[256] = {
 	ByteOp | DstMem | SrcReg | ModRM | Mov, DstMem | SrcReg | ModRM | Mov,
 	ByteOp | DstReg | SrcMem | ModRM | Mov, DstReg | SrcMem | ModRM | Mov,
 	DstMem | SrcReg | ModRM | Mov, ModRM | DstReg,
-	DstReg | SrcMem | ModRM | Mov, Group | Group1A,
+	0, Group | Group1A,
 	/* 0x90 - 0x97 */
 	DstReg, DstReg, DstReg, DstReg,	DstReg, DstReg, DstReg, DstReg,
 	/* 0x98 - 0x9F */
@@ -200,7 +200,7 @@ static u32 opcode_table[256] = {
 	ByteOp | SrcImmUByte, SrcImmUByte,
 	/* 0xE8 - 0xEF */
 	SrcImm | Stack, SrcImm | ImplicitOps,
-	SrcImmU | Src2Imm16, SrcImmByte | ImplicitOps,
+	0, SrcImmByte | ImplicitOps,
 	SrcNone | ByteOp | ImplicitOps, SrcNone | ImplicitOps,
 	SrcNone | ByteOp | ImplicitOps, SrcNone | ImplicitOps,
 	/* 0xF0 - 0xF7 */
