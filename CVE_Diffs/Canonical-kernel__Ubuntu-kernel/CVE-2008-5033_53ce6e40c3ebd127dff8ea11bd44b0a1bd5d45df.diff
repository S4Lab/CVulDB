Canonical-kernel__Ubuntu-kernel
commit 53ce6e40c3ebd127dff8ea11bd44b0a1bd5d45df
Author:     Arjan van de Ven <arjan@linux.intel.com>
AuthorDate: Fri Oct 10 21:16:12 2008 -0700
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Thu Nov 20 09:44:13 2008 +0100

    security: avoid calling a NULL function pointer in drivers/video/tvaudio.c
    
    CVE-2008-5033
    
    NULL function pointers are very bad security wise. This one got caught by
    kerneloops.org quite a few times, so it's happening in the field....
    
    Fix is simple, check the function pointer for NULL, like 6 other places
    in the same function are already doing.
    
    Signed-off-by: Arjan van de Ven <arjan@linux.intel.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/drivers/media/video/tvaudio.c b/drivers/media/video/tvaudio.c
index a19cdcc17ef7..fafe17c9c74d 100644
--- a/drivers/media/video/tvaudio.c
+++ b/drivers/media/video/tvaudio.c
@@ -1765,7 +1765,7 @@ static int chip_command(struct i2c_client *client,
 	case VIDIOCSFREQ:
 	case VIDIOC_S_FREQUENCY:
 		chip->mode = 0; /* automatic */
-		if (desc->checkmode) {
+		if (desc->checkmode && desc->setmode) {
 			desc->setmode(chip,VIDEO_SOUND_MONO);
 			if (chip->prevmode != VIDEO_SOUND_MONO)
 				chip->prevmode = -1; /* reset previous mode */
