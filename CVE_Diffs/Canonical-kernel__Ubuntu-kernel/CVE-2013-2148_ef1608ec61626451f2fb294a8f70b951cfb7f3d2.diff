Canonical-kernel__Ubuntu-kernel
commit ef1608ec61626451f2fb294a8f70b951cfb7f3d2
Author:     Dan Carpenter <dan.carpenter@oracle.com>
AuthorDate: Thu Jul 25 10:22:09 2013 +0100
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Thu Jul 25 06:22:36 2013 -0600

    fanotify: info leak in copy_event_to_user()
    
    CVE-2013-2148
    
    BugLink: http://bugs.launchpad.net/bugs/1188356
    
    The ->reserved field isn't cleared so we leak one byte of stack
    information to userspace.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: Eric Paris <eparis@redhat.com>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    (cherry picked from commit de1e0c40aceb9d5bff09c3a3b97b2f1b178af53f)
    
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/fs/notify/fanotify/fanotify_user.c b/fs/notify/fanotify/fanotify_user.c
index 88630be0a688..54efadf876cd 100644
--- a/fs/notify/fanotify/fanotify_user.c
+++ b/fs/notify/fanotify/fanotify_user.c
@@ -118,6 +118,7 @@ static int fill_event_metadata(struct fsnotify_group *group,
 	metadata->event_len = FAN_EVENT_METADATA_LEN;
 	metadata->metadata_len = FAN_EVENT_METADATA_LEN;
 	metadata->vers = FANOTIFY_METADATA_VERSION;
+	metadata->reserved = 0;
 	metadata->mask = event->mask & FAN_ALL_OUTGOING_EVENTS;
 	metadata->pid = pid_vnr(event->tgid);
 	if (unlikely(event->mask & FAN_Q_OVERFLOW))
