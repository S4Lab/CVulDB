Canonical-kernel__Ubuntu-kernel
commit e8d9c44e97a19c31f84915eaa7c6cf402036086c
Author:     Kees Cook <kees@outflux.net>
AuthorDate: Tue Jun 24 10:22:46 2008 -0700
Commit:     Kees Cook <kees@outflux.net>
CommitDate: Tue Jun 24 15:12:20 2008 -0700

    (CVE-2008-1615) x86_64: fix CS corruption on iret
    
    Based on issues around linux-2.6 a57dae3aa4d00a000b5bac4238025438204c78b2
    https://bugzilla.redhat.com/attachment.cgi?id=294062
    
    Signed-off-by: Kees Cook <kees.cook@canonical.com>

diff --git a/arch/x86/kernel/entry_64.S b/arch/x86/kernel/entry_64.S
index 3a058bb16409..7539184476a9 100644
--- a/arch/x86/kernel/entry_64.S
+++ b/arch/x86/kernel/entry_64.S
@@ -779,7 +779,7 @@ paranoid_swapgs\trace:
 	swapgs
 paranoid_restore\trace:
 	RESTORE_ALL 8
-	iretq
+	jmp iret_label
 paranoid_userspace\trace:
 	GET_THREAD_INFO(%rcx)
 	movl threadinfo_flags(%rcx),%ebx
