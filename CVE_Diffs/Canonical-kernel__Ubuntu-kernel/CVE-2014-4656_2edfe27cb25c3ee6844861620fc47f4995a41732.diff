Canonical-kernel__Ubuntu-kernel
commit 2edfe27cb25c3ee6844861620fc47f4995a41732
Author:     Lars-Peter Clausen <lars@metafoo.de>
AuthorDate: Thu Jul 17 17:00:54 2014 +0100
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Thu Jul 17 12:38:23 2014 -0600

    ALSA: control: Make sure that id->index does not overflow
    
    The ALSA control code expects that the range of assigned indices to a control is
    continuous and does not overflow. Currently there are no checks to enforce this.
    If a control with a overflowing index range is created that control becomes
    effectively inaccessible and unremovable since snd_ctl_find_id() will not be
    able to find it. This patch adds a check that makes sure that controls with a
    overflowing index range can not be created.
    
    Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
    Acked-by: Jaroslav Kysela <perex@perex.cz>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    (cherry picked from commit 883a1d49f0d77d30012f114b2e19fc141beb3e8e)
    CVE-2014-4656
    BugLink: http://bugs.launchpad.net/bugs/1339306
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/sound/core/control.c b/sound/core/control.c
index 3f9e6944a8cf..c3a6bbb4aee5 100644
--- a/sound/core/control.c
+++ b/sound/core/control.c
@@ -333,6 +333,9 @@ int snd_ctl_add(struct snd_card *card, struct snd_kcontrol *kcontrol)
 	if (snd_BUG_ON(!card || !kcontrol->info))
 		goto error;
 	id = kcontrol->id;
+	if (id.index > UINT_MAX - kcontrol->count)
+		goto error;
+
 	down_write(&card->controls_rwsem);
 	if (snd_ctl_find_id(card, &id)) {
 		up_write(&card->controls_rwsem);
