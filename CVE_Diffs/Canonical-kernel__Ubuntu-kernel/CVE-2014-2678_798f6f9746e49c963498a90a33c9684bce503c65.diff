Canonical-kernel__Ubuntu-kernel
commit 798f6f9746e49c963498a90a33c9684bce503c65
Author:     Sasha Levin <sasha.levin@oracle.com>
AuthorDate: Fri Apr 4 14:32:51 2014 +0100
Commit:     Joseph Salisbury <joseph.salisbury@canonical.com>
CommitDate: Mon Apr 28 12:56:08 2014 -0400

    rds: prevent dereference of a NULL device in rds_iw_laddr_check
    
    Binding might result in a NULL device which is later dereferenced
    without checking.
    
    Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    (cherry picked from commit bf39b4247b8799935ea91d90db250ab608a58e50)
    BugLink: http://bugs.launchpad.net/bugs/1302222
    CVE-2014-2678
    Acked-by: Brad Figg <brad.figg@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Signed-off-by: Andy Whitcroft <apw@canonical.com>

diff --git a/net/rds/iw.c b/net/rds/iw.c
index db224f7c2937..bff1e4bab51b 100644
--- a/net/rds/iw.c
+++ b/net/rds/iw.c
@@ -237,7 +237,8 @@ static int rds_iw_laddr_check(__be32 addr)
 	ret = rdma_bind_addr(cm_id, (struct sockaddr *)&sin);
 	/* due to this, we will claim to support IB devices unless we
 	   check node_type. */
-	if (ret || cm_id->device->node_type != RDMA_NODE_RNIC)
+	if (ret || !cm_id->device ||
+	    cm_id->device->node_type != RDMA_NODE_RNIC)
 		ret = -EADDRNOTAVAIL;
 
 	rdsdebug("addr %pI4 ret %d node type %d\n",
