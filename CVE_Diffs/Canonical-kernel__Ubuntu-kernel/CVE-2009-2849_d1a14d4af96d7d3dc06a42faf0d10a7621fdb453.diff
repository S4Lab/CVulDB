Canonical-kernel__Ubuntu-kernel
commit d1a14d4af96d7d3dc06a42faf0d10a7621fdb453
Author:     NeilBrown <neilb@suse.de>
AuthorDate: Wed Jul 1 11:14:04 2009 +1000
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Wed Oct 14 17:22:22 2009 +0200

    md: avoid dereferencing NULL pointer when accessing suspend_* sysfs attributes.
    
    CVE-2009-2849
    
    commit b8d966efd9a46a9a35beac50cbff6e30565125ef upstream
    
    If we try to modify one of the md/ sysfs files
      suspend_lo or suspend_hi
    when the array is not active, we dereference a NULL.
    Protect against that.
    
    Cc: stable@kernel.org
    Signed-off-by: NeilBrown <neilb@suse.de>
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>

diff --git a/drivers/md/md.c b/drivers/md/md.c
index 5113e8d971af..8badca4b70f9 100644
--- a/drivers/md/md.c
+++ b/drivers/md/md.c
@@ -2869,7 +2869,8 @@ suspend_lo_store(mddev_t *mddev, const char *buf, size_t len)
 	char *e;
 	unsigned long long new = simple_strtoull(buf, &e, 10);
 
-	if (mddev->pers->quiesce == NULL)
+	if (mddev->pers == NULL || 
+	    mddev->pers->quiesce == NULL)
 		return -EINVAL;
 	if (buf == e || (*e && *e != '\n'))
 		return -EINVAL;
@@ -2897,7 +2898,8 @@ suspend_hi_store(mddev_t *mddev, const char *buf, size_t len)
 	char *e;
 	unsigned long long new = simple_strtoull(buf, &e, 10);
 
-	if (mddev->pers->quiesce == NULL)
+	if (mddev->pers == NULL ||
+	    mddev->pers->quiesce == NULL)
 		return -EINVAL;
 	if (buf == e || (*e && *e != '\n'))
 		return -EINVAL;
