Canonical-kernel__Ubuntu-kernel
commit aeec11d5bfa0e5600bfc36059e28858d9e53748f
Author:     Shaohua Li <shaohua.li@intel.com>
AuthorDate: Mon Apr 20 10:08:35 2009 +1000
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Tue Jun 16 17:23:22 2009 +0200

    agp: zero pages before sending to userspace
    
    CVE-2009-1192
    
    commit 59de2bebabc5027f93df999d59cc65df591c3e6e upstream
    
    AGP pages might be mapped into userspace finally, so the pages should be
    set to zero before userspace can use it. Otherwise there is potential
    information leakage.
    
    Signed-off-by: Shaohua Li <shaohua.li@intel.com>
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/drivers/char/agp/generic.c b/drivers/char/agp/generic.c
index 64b2f6d7059d..f7b04d1ef32c 100644
--- a/drivers/char/agp/generic.c
+++ b/drivers/char/agp/generic.c
@@ -1166,7 +1166,7 @@ void *agp_generic_alloc_page(struct agp_bridge_data *bridge)
 {
 	struct page * page;
 
-	page = alloc_page(GFP_KERNEL | GFP_DMA32);
+	page = alloc_page(GFP_KERNEL | GFP_DMA32 | __GFP_ZERO );
 	if (page == NULL)
 		return NULL;
 
