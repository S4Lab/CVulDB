Canonical-kernel__Ubuntu-kernel
commit 71b71516b3b2fea0740b6ff5b4202c532a7acf66
Author:     Luis Henriques <luis.henriques@canonical.com>
AuthorDate: Fri Jan 24 14:17:20 2014 +0000
Commit:     rtg <tim.gardner@canonical.com>
CommitDate: Mon Jan 27 12:47:22 2014 +0000

    UBUNTU: ubuntu: AUFS: fsnotify_open() now receives a file
    
    CVE-2013-0160
    
    BugLink: http://bugs.launchpad.net/bugs/1097680
    
    After upstream commit 2a12a9d7814631e918dec93abad856e692d5286d ("fsnotify:
    pass a file instead of an inode to open, read, and write"), function
    fsnotify_open() expects to receive a 'struct file *' and not a 'struct
    dentry *'.
    
    This patch fixes the AUFS call to this function.
    
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Acked-by: Andy Whitcroft <andy.whitcroft@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/ubuntu/aufs/file.c b/ubuntu/aufs/file.c
index a4f33aa0c98b..c3229b05fa94 100644
--- a/ubuntu/aufs/file.c
+++ b/ubuntu/aufs/file.c
@@ -85,7 +85,7 @@ struct file *au_h_open(struct dentry *dentry, aufs_bindex_t bindex, int flags,
 			goto out_br;
 		}
 	}
-	fsnotify_open(h_dentry);
+	fsnotify_open(h_file);
 	goto out; /* success */
 
  out_br:
