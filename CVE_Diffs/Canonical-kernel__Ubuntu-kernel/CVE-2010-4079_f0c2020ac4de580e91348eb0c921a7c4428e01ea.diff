Canonical-kernel__Ubuntu-kernel
commit f0c2020ac4de580e91348eb0c921a7c4428e01ea
Author:     Dan Rosenberg <drosenberg@vsecurity.com>
AuthorDate: Tue Jan 25 18:13:02 2011 -0800
Commit:     Steve Conklin <sconklin@canonical.com>
CommitDate: Fri Jan 28 13:44:12 2011 -0600

    V4L/DVB: ivtvfb: prevent reading uninitialized stack memory, CVE-2010-4079
    
    BugLink: http://bugs.launchpad.net/bugs/707649
    
    CVE-2010-4079
    
    Released by: 2.6.32.y stable upstream
    
    The FBIOGET_VBLANK device ioctl allows unprivileged users to read 16
    bytes of uninitialized stack memory, because the "reserved" member of
    the fb_vblank struct declared on the stack is not altered or zeroed
    before being copied back to the user.  This patch takes care of it.
    
    Signed-off-by: Dan Rosenberg <dan.j.rosenberg@gmail.com>
    Signed-off-by: Andy Walls <awalls@md.metrocast.net>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
    (cherry-picked from commit 405707985594169cfd0b1d97d29fcb4b4c6f2ac9)
    Signed-off-by: Brad Figg <brad.figg@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/drivers/media/video/ivtv/ivtvfb.c b/drivers/media/video/ivtv/ivtvfb.c
index 9ff3425891ed..4559a0a6f22f 100644
--- a/drivers/media/video/ivtv/ivtvfb.c
+++ b/drivers/media/video/ivtv/ivtvfb.c
@@ -458,6 +458,8 @@ static int ivtvfb_ioctl(struct fb_info *info, unsigned int cmd, unsigned long ar
 			struct fb_vblank vblank;
 			u32 trace;
 
+			memset(&vblank, 0, sizeof(struct fb_vblank));
+
 			vblank.flags = FB_VBLANK_HAVE_COUNT |FB_VBLANK_HAVE_VCOUNT |
 					FB_VBLANK_HAVE_VSYNC;
 			trace = read_reg(IVTV_REG_DEC_LINE_FIELD) >> 16;
