Canonical-kernel__Ubuntu-kernel
commit 09b324f80544bcb96ba46e7555c3bb33a4948cae
Author:     Kees Cook <kees.cook@canonical.com>
AuthorDate: Thu Oct 7 10:03:48 2010 +0000
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Fri Mar 25 10:45:56 2011 -0600

    net: clear heap allocation for ETHTOOL_GRXCLSRLALL, CVE-2010-3861
    
    CVE-2010-3861
    
    Calling ETHTOOL_GRXCLSRLALL with a large rule_cnt will allocate kernel
    heap without clearing it. For the one driver (niu) that implements it,
    it will leave the unused portion of heap unchanged and copy the full
    contents back to userspace.
    
    Signed-off-by: Kees Cook <kees.cook@canonical.com>
    Acked-by: Ben Hutchings <bhutchings@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (cherry picked from commit ae6df5f96a51818d6376da5307d773baeece4014)
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/net/core/ethtool.c b/net/core/ethtool.c
index 75e4ffeb8cc9..64c83c094675 100644
--- a/net/core/ethtool.c
+++ b/net/core/ethtool.c
@@ -366,7 +366,7 @@ static noinline_for_stack int ethtool_get_rxnfc(struct net_device *dev,
 	if (info.cmd == ETHTOOL_GRXCLSRLALL) {
 		if (info.rule_cnt > 0) {
 			if (info.rule_cnt <= KMALLOC_MAX_SIZE / sizeof(u32))
-				rule_buf = kmalloc(info.rule_cnt * sizeof(u32),
+				rule_buf = kzalloc(info.rule_cnt * sizeof(u32),
 						   GFP_USER);
 			if (!rule_buf)
 				return -ENOMEM;
