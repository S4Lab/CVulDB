Canonical-kernel__Ubuntu-kernel
commit 21f582d3682e6835f13b8da497421fd73ed6ebd2
Author:     Linus Torvalds <torvalds@linux-foundation.org>
AuthorDate: Sat Oct 30 16:43:10 2010 -0700
Commit:     Brad Figg <brad.figg@canonical.com>
CommitDate: Wed Feb 9 14:30:33 2011 -0800

    net: Truncate recvfrom and sendto length to INT_MAX., CVE-2010-3859
    
    BugLink: http://bugs.launchpad.net/bugs/708839
    BugLink: http://bugs.launchpad.net/bugs/711855
    
    CVE-2010-3859
    CVE-2010-4160
    
    commit 253eacc070b114c2ec1f81b067d2fed7305467b0 upstream.
    Stable backported to 2.6.32.26
    
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Acked-by: Brad Figg <brad.figg@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/net/socket.c b/net/socket.c
index 14ee367a43fc..0f0031965ca9 100644
--- a/net/socket.c
+++ b/net/socket.c
@@ -1583,6 +1583,9 @@ asmlinkage long sys_sendto(int fd, void __user *buff, size_t len,
 	int fput_needed;
 	struct file *sock_file;
 
+	if (len > INT_MAX)
+		len = INT_MAX;
+
 	sock_file = fget_light(fd, &fput_needed);
 	err = -EBADF;
 	if (!sock_file)
@@ -1644,6 +1647,9 @@ asmlinkage long sys_recvfrom(int fd, void __user *ubuf, size_t size,
 	struct file *sock_file;
 	int fput_needed;
 
+	if (size > INT_MAX)
+		size = INT_MAX;
+
 	sock_file = fget_light(fd, &fput_needed);
 	err = -EBADF;
 	if (!sock_file)
