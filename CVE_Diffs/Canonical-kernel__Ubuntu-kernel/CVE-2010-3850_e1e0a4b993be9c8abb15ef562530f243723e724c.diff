Canonical-kernel__Ubuntu-kernel
commit e1e0a4b993be9c8abb15ef562530f243723e724c
Author:     Phil Blundell <philb@gnu.org>
AuthorDate: Wed Nov 24 11:49:53 2010 -0800
Commit:     Leann Ogasawara <leann.ogasawara@canonical.com>
CommitDate: Tue Nov 30 20:59:08 2010 -0800

    econet: fix CVE-2010-3850
    
    CVE-2010-3850
    
    Add missing check for capable(CAP_NET_ADMIN) in SIOCSIFADDR operation.
    
    Signed-off-by: Phil Blundell <philb@gnu.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (cherry picked from commit 16c41745c7b92a243d0874f534c1655196c64b74)
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>

diff --git a/net/econet/af_econet.c b/net/econet/af_econet.c
index ebdb72ee151d..9b38dededd72 100644
--- a/net/econet/af_econet.c
+++ b/net/econet/af_econet.c
@@ -659,6 +659,9 @@ static int ec_dev_ioctl(struct socket *sock, unsigned int cmd, void __user *arg)
 	err = 0;
 	switch (cmd) {
 	case SIOCSIFADDR:
+		if (!capable(CAP_NET_ADMIN))
+			return -EPERM;
+
 		edev = dev->ec_ptr;
 		if (edev == NULL) {
 			/* Magic up a new one. */
