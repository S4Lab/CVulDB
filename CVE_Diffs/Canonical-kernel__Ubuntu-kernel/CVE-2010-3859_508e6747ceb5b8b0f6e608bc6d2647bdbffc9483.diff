Canonical-kernel__Ubuntu-kernel
commit 508e6747ceb5b8b0f6e608bc6d2647bdbffc9483
Author:     Linus Torvalds <torvalds@linux-foundation.org>
AuthorDate: Sat Oct 30 16:43:10 2010 -0700
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Wed Jun 8 08:07:43 2011 -0600

    net: Truncate recvfrom and sendto length to INT_MAX - CVE-2010-3859
    
    BugLink: http://bugs.launchpad.net/bugs/690730
    
    commit 253eacc070b114c2ec1f81b067d2fed7305467b0 upstream.
    
    CVE-2010-3859
    
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
    Signed-off-by: Andi Kleen <ak@linux.intel.com>
    Signed-off-by: Brad Figg <brad.figg@canonical.com>
    Signed-off-by: Paolo Pisati <paolo.pisati@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/net/socket.c b/net/socket.c
index 367d5477d00f..166ad32f9448 100644
--- a/net/socket.c
+++ b/net/socket.c
@@ -1652,6 +1652,8 @@ SYSCALL_DEFINE6(sendto, int, fd, void __user *, buff, size_t, len,
 	struct iovec iov;
 	int fput_needed;
 
+	if (len > INT_MAX)
+		len = INT_MAX;
 	sock = sockfd_lookup_light(fd, &err, &fput_needed);
 	if (!sock)
 		goto out;
@@ -1709,6 +1711,8 @@ SYSCALL_DEFINE6(recvfrom, int, fd, void __user *, ubuf, size_t, size,
 	int err, err2;
 	int fput_needed;
 
+	if (size > INT_MAX)
+		size = INT_MAX;
 	sock = sockfd_lookup_light(fd, &err, &fput_needed);
 	if (!sock)
 		goto out;
