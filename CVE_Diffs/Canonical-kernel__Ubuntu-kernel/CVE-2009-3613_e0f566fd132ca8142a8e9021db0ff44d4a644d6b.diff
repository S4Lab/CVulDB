Canonical-kernel__Ubuntu-kernel
commit e0f566fd132ca8142a8e9021db0ff44d4a644d6b
Author:     fran√ßois romieu <romieu@fr.zoreil.com>
AuthorDate: Sun Mar 15 01:09:54 2009 +0000
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Tue Dec 1 19:58:50 2009 +0100

    r8169: use hardware auto-padding.
    
    CVE-2009-3613
    
    It shortens the code and fixes the current pci_unmap leak with
    padded skb reported by Dave Jones.
    
    Signed-off-by: Francois Romieu <romieu@fr.zoreil.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (cherry picked from commit 97d477a914b146e7e6722ded21afa79886ae8ccd)
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/drivers/net/r8169.c b/drivers/net/r8169.c
index e76b7be2277c..704135d77853 100644
--- a/drivers/net/r8169.c
+++ b/drivers/net/r8169.c
@@ -2866,13 +2866,6 @@ static int rtl8169_start_xmit(struct sk_buff *skb, struct net_device *dev)
 		opts1 |= FirstFrag;
 	} else {
 		len = skb->len;
-
-		if (unlikely(len < ETH_ZLEN)) {
-			if (skb_padto(skb, ETH_ZLEN))
-				goto err_update_stats;
-			len = ETH_ZLEN;
-		}
-
 		opts1 |= FirstFrag | LastFrag;
 		tp->tx_skb[entry].skb = skb;
 	}
@@ -2910,7 +2903,6 @@ out:
 err_stop:
 	netif_stop_queue(dev);
 	ret = NETDEV_TX_BUSY;
-err_update_stats:
 	dev->stats.tx_dropped++;
 	goto out;
 }
