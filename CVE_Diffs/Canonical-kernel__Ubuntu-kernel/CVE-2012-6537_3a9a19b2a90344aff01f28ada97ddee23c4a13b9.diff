Canonical-kernel__Ubuntu-kernel
commit 3a9a19b2a90344aff01f28ada97ddee23c4a13b9
Author:     Mathias Krause <minipli@googlemail.com>
AuthorDate: Wed Sep 19 11:33:40 2012 +0000
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Fri Mar 22 08:00:31 2013 -0600

    xfrm_user: fix info leak in copy_to_user_policy()
    
    CVE-2012-6537
    
    BugLink: http://bugs.launchpad.net/bugs/1156716
    
    The memory reserved to dump the xfrm policy includes multiple padding
    bytes added by the compiler for alignment (padding bytes in struct
    xfrm_selector and struct xfrm_userpolicy_info). Add an explicit
    memset(0) before filling the buffer to avoid the heap info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Acked-by: Steffen Klassert <steffen.klassert@secunet.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (cherry picked from commit 7b789836f434c87168eab067cfbed1ec4783dffd)
    Acked-by: Colin King <colin.king@canonical.com>
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/net/xfrm/xfrm_user.c b/net/xfrm/xfrm_user.c
index ab5f23c08bc7..0926b006844e 100644
--- a/net/xfrm/xfrm_user.c
+++ b/net/xfrm/xfrm_user.c
@@ -1075,6 +1075,7 @@ static void copy_from_user_policy(struct xfrm_policy *xp, struct xfrm_userpolicy
 
 static void copy_to_user_policy(struct xfrm_policy *xp, struct xfrm_userpolicy_info *p, int dir)
 {
+	memset(p, 0, sizeof(*p));
 	memcpy(&p->sel, &xp->selector, sizeof(p->sel));
 	memcpy(&p->lft, &xp->lft, sizeof(p->lft));
 	memcpy(&p->curlft, &xp->curlft, sizeof(p->curlft));
