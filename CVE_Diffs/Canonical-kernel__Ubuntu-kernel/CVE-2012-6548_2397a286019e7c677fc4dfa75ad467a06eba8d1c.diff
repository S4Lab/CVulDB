Canonical-kernel__Ubuntu-kernel
commit 2397a286019e7c677fc4dfa75ad467a06eba8d1c
Author:     Mathias Krause <minipli@googlemail.com>
AuthorDate: Thu Jul 12 08:46:55 2012 +0200
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Tue Mar 26 11:42:04 2013 -0600

    udf: avoid info leak on export
    
    CVE-2012-6548
    
    BugLink: http://bugs.launchpad.net/bugs/1156768
    
    For type 0x51 the udf.parent_partref member in struct fid gets copied
    uninitialized to userland. Fix this by initializing it to 0.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Signed-off-by: Jan Kara <jack@suse.cz>
    (cherry picked from commit 0143fc5e9f6f5aad4764801015bc8d4b4a278200)
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/fs/udf/namei.c b/fs/udf/namei.c
index 21dad8c608f9..b75415112b48 100644
--- a/fs/udf/namei.c
+++ b/fs/udf/namei.c
@@ -1331,6 +1331,7 @@ static int udf_encode_fh(struct dentry *de, __u32 *fh, int *lenp,
 	*lenp = 3;
 	fid->udf.block = location.logicalBlockNum;
 	fid->udf.partref = location.partitionReferenceNum;
+	fid->udf.parent_partref = 0;
 	fid->udf.generation = inode->i_generation;
 
 	if (connectable && !S_ISDIR(inode->i_mode)) {
