Canonical-kernel__Ubuntu-kernel
commit e1e908209677cd6ff48b57e6488b8490d3cb8ce0
Author:     Philipp Reisner <philipp.reisner@linbit.com>
AuthorDate: Fri Oct 2 02:40:10 2009 +0000
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Wed Dec 2 10:54:20 2009 +0100

    pohmelfs/connector: Disallow unpliviged users to configure pohmelfs
    
    CVE-2009-3725
    
    Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (cherry picked from commit 98a5783af02f4c9b87b676d7bbda6258045cfc76)
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/drivers/staging/pohmelfs/config.c b/drivers/staging/pohmelfs/config.c
index 1b4d56412f7d..d8ec47a6ee06 100644
--- a/drivers/staging/pohmelfs/config.c
+++ b/drivers/staging/pohmelfs/config.c
@@ -450,6 +450,9 @@ static void pohmelfs_cn_callback(struct cn_msg *msg, struct netlink_skb_parms *n
 {
 	int err;
 
+	if (!cap_raised(nsp->eff_cap, CAP_SYS_ADMIN))
+		return;
+
 	switch (msg->flags) {
 		case POHMELFS_FLAGS_ADD:
 		case POHMELFS_FLAGS_DEL:
