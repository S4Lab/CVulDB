Canonical-kernel__Ubuntu-kernel
commit 61212a4048ccd2b73f9d0b46b0636a3b2a69e0be
Author:     Linus Torvalds <torvalds@linux-foundation.org>
AuthorDate: Thu Aug 13 08:28:36 2009 -0700
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Mon Aug 17 22:29:30 2009 +0200

    Make sock_sendpage() use kernel_sendpage()
    
    CVE-2009-2692
    
    commit e694958388c50148389b0e9b9e9e8945cf0f1b98 upstream
    
    kernel_sendpage() does the proper default case handling for when the
    socket doesn't have a native sendpage implementation.
    
    Now, arguably this might be something that we could instead solve by
    just specifying that all protocols should do it themselves at the
    protocol level, but we really only care about the common protocols.
    Does anybody really care about sendpage on something like Appletalk? Not
    likely.
    
    Acked-by: David S. Miller <davem@davemloft.net>
    Acked-by: Julien TINNES <julien@cr0.org>
    Acked-by: Tavis Ormandy <taviso@sdf.lonestar.org>
    Cc: stable@kernel.org
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

diff --git a/net/socket.c b/net/socket.c
index 74784dfe8e5b..14ee367a43fc 100644
--- a/net/socket.c
+++ b/net/socket.c
@@ -688,7 +688,7 @@ static ssize_t sock_sendpage(struct file *file, struct page *page,
 	if (more)
 		flags |= MSG_MORE;
 
-	return sock->ops->sendpage(sock, page, offset, size, flags);
+	return kernel_sendpage(sock, page, offset, size, flags);
 }
 
 static struct sock_iocb *alloc_sock_iocb(struct kiocb *iocb,
