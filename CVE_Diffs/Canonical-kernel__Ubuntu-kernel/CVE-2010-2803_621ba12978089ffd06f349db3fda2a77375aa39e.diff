Canonical-kernel__Ubuntu-kernel
commit 621ba12978089ffd06f349db3fda2a77375aa39e
Author:     Dave Airlie <airlied@linux.ie>
AuthorDate: Mon Aug 16 16:57:44 2010 +0200
Commit:     Leann Ogasawara <leann.ogasawara@canonical.com>
CommitDate: Fri Aug 20 16:03:57 2010 -0700

    drm: Initialize ioctl struct when no user data is present
    
    CVE-2010-2803
    
    If there is no user data to read in and the ioctl funtion does not
    provide output, random junk could get returned otherwise.
    
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>

diff --git a/drivers/gpu/drm/drm_drv.c b/drivers/gpu/drm/drm_drv.c
index 4a66201edaec..c9736ed5d5bf 100644
--- a/drivers/gpu/drm/drm_drv.c
+++ b/drivers/gpu/drm/drm_drv.c
@@ -502,7 +502,9 @@ long drm_ioctl(struct file *filp,
 				retcode = -EFAULT;
 				goto err_i1;
 			}
-		}
+		} else
+			memset(kdata, 0, _IOC_SIZE(cmd));
+
 		if (ioctl->flags & DRM_UNLOCKED)
 			retcode = func(dev, kdata, file_priv);
 		else {
