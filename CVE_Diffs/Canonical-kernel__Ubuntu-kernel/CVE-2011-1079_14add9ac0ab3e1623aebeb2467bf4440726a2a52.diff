Canonical-kernel__Ubuntu-kernel
commit 14add9ac0ab3e1623aebeb2467bf4440726a2a52
Author:     Vasiliy Kulikov <segoon@openwall.com>
AuthorDate: Tue Jul 26 19:51:12 2011 +0100
Commit:     Herton Ronaldo Krzesinski <herton.krzesinski@canonical.com>
CommitDate: Wed Aug 10 10:02:34 2011 -0300

    Bluetooth: bnep: fix buffer overflow, CVE-2011-1079
    
    Struct ca is copied from userspace.  It is not checked whether the "device"
    field is NULL terminated.  This potentially leads to BUG() inside of
    alloc_netdev_mqs() and/or information leak by creating a device with a name
    made of contents of kernel stack.
    
    Signed-off-by: Vasiliy Kulikov <segoon@openwall.com>
    Signed-off-by: Gustavo F. Padovan <padovan@profusion.mobi>
    
    (cherry picked from commit 43629f8f5ea32a998d06d1bb41eefa0e821ff573)
    CVE-2011-1079
    BugLink: http://bugs.launchpad.net/bugs/816544
    Signed-off-by: Andy Whitcroft <apw@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/net/bluetooth/bnep/sock.c b/net/bluetooth/bnep/sock.c
index 9ebd3c64474d..7d31198159c3 100644
--- a/net/bluetooth/bnep/sock.c
+++ b/net/bluetooth/bnep/sock.c
@@ -97,6 +97,7 @@ static int bnep_sock_ioctl(struct socket *sock, unsigned int cmd, unsigned long
 			fput(nsock->file);
 			return -EBADFD;
 		}
+		ca.device[sizeof(ca.device)-1] = 0;
 
 		err = bnep_add_connection(&ca, nsock);
 		if (!err) {
