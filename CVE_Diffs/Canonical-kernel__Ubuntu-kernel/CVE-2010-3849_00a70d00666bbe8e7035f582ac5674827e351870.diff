Canonical-kernel__Ubuntu-kernel
commit 00a70d00666bbe8e7035f582ac5674827e351870
Author:     Leann Ogasawara <leann.ogasawara@canonical.com>
AuthorDate: Thu Nov 18 15:27:54 2010 -0800
Commit:     Leann Ogasawara <leann.ogasawara@canonical.com>
CommitDate: Sun Nov 21 10:56:23 2010 -0800

    UBUNTU: SAUCE: AF_ECONET saddr->cookie prevent NULL pointer dereference
    
    CVE-2010-3849
    
    'saddr' comes from userspace and may be NULL (if non-NULL, it will have
    been copied to kernelspace), leading to a NULL-pointer dereference. This
    saddr->cookie dereference appears twice, once in the "hardware" case and
    once in the "UDP emulation" case. This is easily exploitable for an
    oops, but probably not anything more.
    
    This patch has yet to be submitted upstream, hence marking it as SAUCE
    for now.
    
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>

diff --git a/net/econet/af_econet.c b/net/econet/af_econet.c
index 8ba81fc8748d..174c106ec95a 100644
--- a/net/econet/af_econet.c
+++ b/net/econet/af_econet.c
@@ -355,6 +355,10 @@ static int econet_sendmsg(struct kiocb *iocb, struct socket *sock,
 		eb = (struct ec_cb *)&skb->cb;
 
 		/* BUG: saddr may be NULL */
+		if (!saddr) {
+			err = -EINVAL;
+			goto out_free;
+		}
 		eb->cookie = saddr->cookie;
 		eb->sec = *saddr;
 		eb->sent = ec_tx_done;
