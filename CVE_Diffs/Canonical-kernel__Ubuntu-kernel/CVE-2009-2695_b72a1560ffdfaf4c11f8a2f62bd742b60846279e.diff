Canonical-kernel__Ubuntu-kernel
commit b72a1560ffdfaf4c11f8a2f62bd742b60846279e
Author:     Leann Ogasawara <leann.ogasawara@canonical.com>
AuthorDate: Tue Oct 6 23:03:53 2009 -0700
Commit:     Stefan Bader <stefan.bader@canonical.com>
CommitDate: Wed Oct 14 17:22:48 2009 +0200

    security: define round_hint_to_min in !CONFIG_SECURITY
    
    CVE-2009-2695
    
    commit 1d9959734a1949ea4f2427bd2d8b21ede6b2441c upstream
    
    Fix the header files to define round_hint_to_min() and to define
    mmap_min_addr_handler() in the !CONFIG_SECURITY case.
    
    Built and tested with !CONFIG_SECURITY
    
    Signed-off-by: Eric Paris <eparis@redhat.com>
    Signed-off-by: James Morris <jmorris@namei.org>
    Signed-off-by: Leann Ogasawara <leann.ogasawara@canonical.com>

diff --git a/include/linux/security.h b/include/linux/security.h
index 10c9b2aa07e0..37c7901e6d13 100644
--- a/include/linux/security.h
+++ b/include/linux/security.h
@@ -115,8 +115,6 @@ struct request_sock;
 #define LSM_UNSAFE_PTRACE	2
 #define LSM_UNSAFE_PTRACE_CAP	4
 
-#ifdef CONFIG_SECURITY
-
 /*
  * If a hint addr is less than mmap_min_addr change hint to be as
  * low as possible but still greater than mmap_min_addr
@@ -133,6 +131,8 @@ static inline unsigned long round_hint_to_min(unsigned long hint)
 extern int mmap_min_addr_handler(struct ctl_table *table, int write, struct file *filp,
 				void __user *buffer, size_t *lenp, loff_t *ppos);
 
+#ifdef CONFIG_SECURITY
+
 /**
  * struct security_operations - main security structure
  *
