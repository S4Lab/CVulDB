Canonical-kernel__Ubuntu-kernel
commit 6cac561110c9fcf0f43dde0862aac409f9718536
Author:     Chris Wright <chrisw@sous-sol.org>
AuthorDate: Mon May 5 13:50:24 2008 -0700
Commit:     Kees Cook <kees@outflux.net>
CommitDate: Tue Jun 24 15:12:19 2008 -0700

    (CVE-2008-2358) dccp: return -EINVAL on invalid feature length
    
    [linux-2.6: 19443178fbfbf40db15c86012fc37df1a44ab857]
    
    dccp_feat_change() validates length and on error is returning 1.
    This happens to work since call chain is checking for 0 == success,
    but this is returned to userspace, so make it a real error value.
    
    Signed-off-by: Chris Wright <chrisw@sous-sol.org>
    Acked-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Kees Cook <kees.cook@canonical.com>

diff --git a/net/dccp/feat.c b/net/dccp/feat.c
index 5ebdd86c1b99..1cf270934b33 100644
--- a/net/dccp/feat.c
+++ b/net/dccp/feat.c
@@ -30,7 +30,7 @@ int dccp_feat_change(struct dccp_minisock *dmsk, u8 type, u8 feature,
 	}
 	if (!dccp_feat_is_valid_length(type, feature, len)) {
 		DCCP_WARN("invalid length %d\n", len);
-		return 1;
+		return -EINVAL;
 	}
 	/* XXX add further sanity checks */
 
