M-Bab__linux-kernel-amdgpu
commit 6ef49d007cdaf63cd80f365a24532ca84d5fc749
Author:     Navid Emamdoost <navid.emamdoost@gmail.com>
AuthorDate: Mon Dec 2 12:52:28 2019 +0800
Commit:     Seth Forshee <seth.forshee@canonical.com>
CommitDate: Thu Dec 5 16:30:19 2019 -0600

    crypto: user - fix memory leak in crypto_reportstat
    
    CVE-2019-19050
    
    In crypto_reportstat, a new skb is created by nlmsg_new(). This skb is
    leaked if crypto_reportstat_alg() fails. Required release for skb is
    added.
    
    Fixes: cac5818c25d0 ("crypto: user - Implement a generic crypto statistics")
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Navid Emamdoost <navid.emamdoost@gmail.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    (cherry picked from commit c03b04dcdba1da39903e23cc4d072abf8f68f2dd)
    Signed-off-by: Po-Hsu Lin <po-hsu.lin@canonical.com>
    Signed-off-by: Seth Forshee <seth.forshee@canonical.com>

diff --git a/crypto/crypto_user_stat.c b/crypto/crypto_user_stat.c
index 8bad88413de1..1be95432fa23 100644
--- a/crypto/crypto_user_stat.c
+++ b/crypto/crypto_user_stat.c
@@ -328,8 +328,10 @@ int crypto_reportstat(struct sk_buff *in_skb, struct nlmsghdr *in_nlh,
 drop_alg:
 	crypto_mod_put(alg);
 
-	if (err)
+	if (err) {
+		kfree_skb(skb);
 		return err;
+	}
 
 	return nlmsg_unicast(net->crypto_nlsk, skb, NETLINK_CB(in_skb).portid);
 }
