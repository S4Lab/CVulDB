M-Bab__linux-kernel-amdgpu
commit 43f22227497a1323030e926f4b9ef5c01e371f63
Author:     Andy Whitcroft <apw@canonical.com>
AuthorDate: Wed May 17 17:10:32 2017 +0100
Commit:     Andy Whitcroft <apw@canonical.com>
CommitDate: Wed May 17 17:12:08 2017 +0100

    UBUNTU: [Debian] (no-squash) supply perf with appropriate prefix to ensure use of local config
    
    If we do not supply an installation prefix when we are building perf
    it will assume it is designed to run relative to the builders HOME.
    This means that as built on a buildd we will check for the system
    configuration relative to the buildd users home rather than in /etc.
    This implies a local user could use this to compromise other users _if_
    there is a buildd user installed on the system and they have access to it.
    
    CVE-2013-1060
    BugLink: http://bugs.launchpad.net/bugs/1206200
    
    [apw@canonical.com: do not squash this into the primary debian directory
     commit as it needs to visible to the autotriager.]
    Signed-off-by: Andy Whitcroft <apw@canonical.com>

diff --git a/debian/rules.d/2-binary-arch.mk b/debian/rules.d/2-binary-arch.mk
index babd9ba97f25..edda3f3ba845 100644
--- a/debian/rules.d/2-binary-arch.mk
+++ b/debian/rules.d/2-binary-arch.mk
@@ -616,7 +616,7 @@ ifeq ($(do_tools_perf),true)
 	cd $(builddirpa) && $(kmake) silentoldconfig
 	cd $(builddirpa) && $(kmake) prepare
 	cd $(builddirpa)/tools/perf && \
-		$(kmake) HAVE_CPLUS_DEMANGLE=1 CROSS_COMPILE=$(CROSS_COMPILE) NO_LIBPYTHON=1 NO_LIBPERL=1 PYTHON=python2.7
+		$(kmake) prefix=/usr HAVE_CPLUS_DEMANGLE=1 CROSS_COMPILE=$(CROSS_COMPILE) NO_LIBPYTHON=1 NO_LIBPERL=1 PYTHON=python2.7
 endif
 ifeq ($(do_tools_x86),true)
 	cd $(builddirpa)/tools/power/x86/x86_energy_perf_policy && make CROSS_COMPILE=$(CROSS_COMPILE)
