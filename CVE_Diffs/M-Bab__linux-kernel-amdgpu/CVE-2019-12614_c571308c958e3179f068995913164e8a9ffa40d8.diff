M-Bab__linux-kernel-amdgpu
commit c571308c958e3179f068995913164e8a9ffa40d8
Author:     Gen Zhang <blackgod016574@gmail.com>
AuthorDate: Mon Jul 15 19:53:39 2019 +0000
Commit:     Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
CommitDate: Tue Jul 16 13:34:57 2019 -0300

    powerpc/pseries/dlpar: Fix a missing check in dlpar_parse_cc_property()
    
    In dlpar_parse_cc_property(), 'prop->name' is allocated by kstrdup().
    kstrdup() may return NULL, so it should be checked and handle error.
    And prop should be freed if 'prop->name' is NULL.
    
    Signed-off-by: Gen Zhang <blackgod016574@gmail.com>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    
    CVE-2019-12614
    
    (cherry picked from commit efa9ace68e487ddd29c2b4d6dd23242158f1f607)
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Acked-by: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
    Acked-by: Kleber Sacilotto de Souza <kleber.souza@canonical.com>
    Signed-off-by: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>

diff --git a/arch/powerpc/platforms/pseries/dlpar.c b/arch/powerpc/platforms/pseries/dlpar.c
index 437a74173db2..ee4aa1dd34c9 100644
--- a/arch/powerpc/platforms/pseries/dlpar.c
+++ b/arch/powerpc/platforms/pseries/dlpar.c
@@ -58,6 +58,10 @@ static struct property *dlpar_parse_cc_property(struct cc_workarea *ccwa)
 
 	name = (char *)ccwa + be32_to_cpu(ccwa->name_offset);
 	prop->name = kstrdup(name, GFP_KERNEL);
+	if (!prop->name) {
+		dlpar_free_cc_property(prop);
+		return NULL;
+	}
 
 	prop->length = be32_to_cpu(ccwa->prop_length);
 	value = (char *)ccwa + be32_to_cpu(ccwa->prop_offset);
