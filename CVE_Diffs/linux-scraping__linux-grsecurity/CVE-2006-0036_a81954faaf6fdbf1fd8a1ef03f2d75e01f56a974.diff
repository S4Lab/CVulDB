linux-scraping__linux-grsecurity
commit a81954faaf6fdbf1fd8a1ef03f2d75e01f56a974
Author:     Patrick McHardy <kaber@trash.net>
AuthorDate: Tue Jan 10 02:00:07 2006 +0100
Commit:     Chris Wright <chrisw@sous-sol.org>
CommitDate: Sat Jan 14 22:15:29 2006 -0800

    [PATCH] Fix crash in ip_nat_pptp (CVE-2006-0036)
    
    When an inbound PPTP_IN_CALL_REQUEST packet is received the
    PPTP NAT helper uses a NULL pointer in pointer arithmentic to
    calculate the offset in the packet which needs to be mangled
    and corrupts random memory or crashes.
    
    Signed-off-by: Patrick McHardy <kaber@trash.net>
    Signed-off-by: Chris Wright <chrisw@sous-sol.org>

diff --git a/net/ipv4/netfilter/ip_nat_helper_pptp.c b/net/ipv4/netfilter/ip_nat_helper_pptp.c
index e546203f5662..8ad7b36e242d 100644
--- a/net/ipv4/netfilter/ip_nat_helper_pptp.c
+++ b/net/ipv4/netfilter/ip_nat_helper_pptp.c
@@ -315,7 +315,7 @@ pptp_inbound_pkt(struct sk_buff **pskb,
 		break;
 	case PPTP_IN_CALL_REQUEST:
 		/* only need to nat in case PAC is behind NAT box */
-		break;
+		return NF_ACCEPT;
 	case PPTP_WAN_ERROR_NOTIFY:
 		pcid = &pptpReq->wanerr.peersCallID;
 		break;
