linux-scraping__linux-grsecurity
commit 44023d2f627574ac8a22c2ede35b7f8528bc7912
Author:     Dan Carpenter <dan.carpenter@oracle.com>
AuthorDate: Mon Nov 24 12:16:11 2014 +0000
Commit:     Willy Tarreau <w@1wt.eu>
CommitDate: Sat Dec 13 15:16:17 2014 +0100

    ttusb-dec: buffer overflow in ioctl
    
    commit dc0ab1ddeb0c5f5eb3f37a72eadb394792b3c40d upstream
    
    We need to add a limit check here so we don't overflow the buffer.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@osg.samsung.com>
    (backported from commit f2e323ec96077642d397bb1c355def536d489d16)
    CVE-2014-8884
    BugLink: http://bugs.launchpad.net/bugs/1395187
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Acked-by: Andy Whitcroft <apw@canonical.com>
    Signed-off-by: Andy Whitcroft <apw@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Willy Tarreau <w@1wt.eu>

diff --git a/drivers/media/dvb/ttusb-dec/ttusbdecfe.c b/drivers/media/dvb/ttusb-dec/ttusbdecfe.c
index 21260aad1e54..852870b80df3 100644
--- a/drivers/media/dvb/ttusb-dec/ttusbdecfe.c
+++ b/drivers/media/dvb/ttusb-dec/ttusbdecfe.c
@@ -154,6 +154,9 @@ static int ttusbdecfe_dvbs_diseqc_send_master_cmd(struct dvb_frontend* fe, struc
 		   0x00, 0x00, 0x00, 0x00,
 		   0x00, 0x00 };
 
+	if (cmd->msg_len > sizeof(b) - 4)
+		return -EINVAL;
+
 	memcpy(&b[4], cmd->msg, cmd->msg_len);
 
 	state->config->send_command(fe, 0x72,
