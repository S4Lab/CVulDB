9fans__plan9port
commit 01a29ffe9dec8f11afa6db22a6ed0218bdbe5c5c
Author:     Fazlul Shahriar <fshahriar@gmail.com>
AuthorDate: Sun Dec 8 20:20:22 2019 -0500
Commit:     Dan Cross <crossd@gmail.com>
CommitDate: Sun Dec 8 20:20:22 2019 -0500

    page: fix pdf prolog for ghostscript >= 9.27 (#296)
    
    Ghostscript 9.27 removed GS_PDF_ProcSet and pdfdict due to a security
    issue (see https://security-tracker.debian.org/tracker/CVE-2019-3839).
    
    This fix was contributed by @onyxperidot (see #279).
    
    Fixes #279

diff --git a/src/cmd/page/pdfprolog.c b/src/cmd/page/pdfprolog.c
index de51c062..3b6cbcd7 100644
--- a/src/cmd/page/pdfprolog.c
+++ b/src/cmd/page/pdfprolog.c
@@ -16,5 +16,4 @@
 "  } if\n"
 "} bind def\n"
 "\n"
-"GS_PDF_ProcSet begin\n"
-"pdfdict begin\n"
+"runpdfbegin\n"
diff --git a/src/cmd/page/pdfprolog.ps b/src/cmd/page/pdfprolog.ps
index 681e0587..a57e20b1 100644
--- a/src/cmd/page/pdfprolog.ps
+++ b/src/cmd/page/pdfprolog.ps
@@ -16,5 +16,4 @@
   } if
 } bind def
 
-GS_PDF_ProcSet begin
-pdfdict begin
+runpdfbegin
