libressl__libressl
commit f17fc1a8fc7fb33bf8ccbb643f5e5c1dc3368b79
Author:     djm <djm>
AuthorDate: Sat Sep 9 00:11:03 2006 +0000
Commit:     djm <djm>
CommitDate: Sat Sep 9 00:11:03 2006 +0000

    fix RSA signature padding vulnerability in OpenSSL libcrypto CVE-2006-4339;
    ok beck@ miod@

diff --git a/src/crypto/rsa/rsa_sign.c b/src/crypto/rsa/rsa_sign.c
index cee09ecc..db86f1ac 100644
--- a/src/crypto/rsa/rsa_sign.c
+++ b/src/crypto/rsa/rsa_sign.c
@@ -185,6 +185,23 @@ int RSA_verify(int dtype, const unsigned char *m, unsigned int m_len,
 		sig=d2i_X509_SIG(NULL,&p,(long)i);
 
 		if (sig == NULL) goto err;
+
+		/* Excess data can be used to create forgeries */
+		if(p != s+i)
+			{
+			RSAerr(RSA_F_RSA_VERIFY,RSA_R_BAD_SIGNATURE);
+			goto err;
+			}
+
+		/* Parameters to the signature algorithm can also be used to
+		   create forgeries */
+		if(sig->algor->parameter
+		   && ASN1_TYPE_get(sig->algor->parameter) != V_ASN1_NULL)
+			{
+			RSAerr(RSA_F_RSA_VERIFY,RSA_R_BAD_SIGNATURE);
+			goto err;
+			}
+
 		sigtype=OBJ_obj2nid(sig->algor->algorithm);
 
 
