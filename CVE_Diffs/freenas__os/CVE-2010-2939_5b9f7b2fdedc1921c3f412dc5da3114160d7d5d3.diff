freenas__os
commit 5b9f7b2fdedc1921c3f412dc5da3114160d7d5d3
Author:     simon <simon@FreeBSD.org>
AuthorDate: Sun Nov 14 09:33:47 2010 +0000
Commit:     simon <simon@FreeBSD.org>
CommitDate: Sun Nov 14 09:33:47 2010 +0000

    Fix double-free in OpenSSL's SSL ECDH code.
    
    It has yet to be determined if this warrants a FreeBSD Security
    Advisory, but we might as well get it fixed in the normal branches.
    
    Obtained from:  OpenSSL CVS
    Security:       CVE-2010-2939
    X-MFC after:    Not long...

diff --git a/crypto/openssl/ssl/s3_clnt.c b/crypto/openssl/ssl/s3_clnt.c
index e5138b6e5ee..aa53506d073 100644
--- a/crypto/openssl/ssl/s3_clnt.c
+++ b/crypto/openssl/ssl/s3_clnt.c
@@ -1377,6 +1377,7 @@ int ssl3_get_key_exchange(SSL *s)
 		s->session->sess_cert->peer_ecdh_tmp=ecdh;
 		ecdh=NULL;
 		BN_CTX_free(bn_ctx);
+		bn_ctx = NULL;
 		EC_POINT_free(srvr_ecpoint);
 		srvr_ecpoint = NULL;
 		}
