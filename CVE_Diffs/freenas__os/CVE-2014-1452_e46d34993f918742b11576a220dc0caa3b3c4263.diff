freenas__os
commit e46d34993f918742b11576a220dc0caa3b3c4263
Author:     delphij <delphij@FreeBSD.org>
AuthorDate: Tue Jan 14 19:17:20 2014 +0000
Commit:     delphij <delphij@FreeBSD.org>
CommitDate: Tue Jan 14 19:17:20 2014 +0000

    MFC r260636:
    
    Fix bsnmpd remote denial of service vulnerability.
    
    Reported by:    dinoex
    Submitted by:   harti
    Security:       FreeBSD-SA-14:01.bsnmpd
    Security:       CVE-2014-1452

diff --git a/contrib/bsnmp/lib/snmpagent.c b/contrib/bsnmp/lib/snmpagent.c
index 888d622514f..865b9b6f4d7 100644
--- a/contrib/bsnmp/lib/snmpagent.c
+++ b/contrib/bsnmp/lib/snmpagent.c
@@ -499,6 +499,11 @@ snmp_getbulk(struct snmp_pdu *pdu, struct asn_buf *resp_b,
 	for (cnt = 0; cnt < pdu->error_index; cnt++) {
 		eomib = 1;
 		for (i = non_rep; i < pdu->nbindings; i++) {
+
+			if (resp->nbindings == SNMP_MAX_BINDINGS)
+				/* PDU is full */
+				goto done;
+
 			if (cnt == 0) 
 				result = do_getnext(&context, &pdu->bindings[i],
 				    &resp->bindings[resp->nbindings], pdu);
