freenas__os
commit bbf994c9e11e7fd930b929ef68a3857de7a1d99a
Author:     glebius <glebius@FreeBSD.org>
AuthorDate: Tue May 17 22:30:43 2016 +0000
Commit:     glebius <glebius@FreeBSD.org>
CommitDate: Tue May 17 22:30:43 2016 +0000

    Validate that user supplied control message length is not negative.
    
    Submitted by:   C Turt <cturt hardenedbsd.org>
    Security:       SA-16:19
    Security:       CVE-2016-1887

diff --git a/sys/kern/uipc_syscalls.c b/sys/kern/uipc_syscalls.c
index fa36849acd4..97ca1156acd 100644
--- a/sys/kern/uipc_syscalls.c
+++ b/sys/kern/uipc_syscalls.c
@@ -1787,6 +1787,9 @@ sockargs(mp, buf, buflen, type)
 	struct mbuf *m;
 	int error;
 
+	if (buflen < 0)
+		return (EINVAL);
+
 	if (buflen > MLEN) {
 #ifdef COMPAT_OLDSOCK
 		if (type == MT_SONAME && buflen <= 112)
