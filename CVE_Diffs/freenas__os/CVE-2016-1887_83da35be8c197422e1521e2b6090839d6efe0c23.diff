freenas__os
commit 83da35be8c197422e1521e2b6090839d6efe0c23
Author:     glebius <glebius@ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f>
AuthorDate: Tue May 17 22:28:53 2016 +0000
Commit:     glebius <glebius@ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f>
CommitDate: Tue May 17 22:28:53 2016 +0000

    Validate that user supplied control message length is not negative.
    
    Submitted by:   C Turt <cturt hardenedbsd.org>
    Security:       SA-16:19
    Security:       CVE-2016-1887
    
    
    git-svn-id: svn+ssh://svn.freebsd.org/base/head@300090 ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f

diff --git a/sys/kern/uipc_syscalls.c b/sys/kern/uipc_syscalls.c
index 05703ef65c1..7184e47ba62 100644
--- a/sys/kern/uipc_syscalls.c
+++ b/sys/kern/uipc_syscalls.c
@@ -1699,6 +1699,9 @@ sockargs(mp, buf, buflen, type)
 	struct mbuf *m;
 	int error;
 
+	if (buflen < 0)
+		return (EINVAL);
+
 	if (buflen > MLEN) {
 #ifdef COMPAT_OLDSOCK
 		if (type == MT_SONAME && buflen <= 112)
