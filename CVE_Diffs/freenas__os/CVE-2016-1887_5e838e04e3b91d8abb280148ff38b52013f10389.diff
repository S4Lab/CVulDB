freenas__os
commit 5e838e04e3b91d8abb280148ff38b52013f10389
Author:     glebius <glebius@FreeBSD.org>
AuthorDate: Tue May 17 22:28:53 2016 +0000
Commit:     glebius <glebius@FreeBSD.org>
CommitDate: Tue May 17 22:28:53 2016 +0000

    Validate that user supplied control message length is not negative.
    
    Submitted by:   C Turt <cturt hardenedbsd.org>
    Security:       SA-16:19
    Security:       CVE-2016-1887

diff --git a/sys/kern/uipc_syscalls.c b/sys/kern/uipc_syscalls.c
index 05703ef65c1..7184e47ba62 100644
--- a/sys/kern/uipc_syscalls.c
+++ b/sys/kern/uipc_syscalls.c
@@ -1699,6 +1699,9 @@ sockargs(mp, buf, buflen, type)
 	struct mbuf *m;
 	int error;
 
+	if (buflen < 0)
+		return (EINVAL);
+
 	if (buflen > MLEN) {
 #ifdef COMPAT_OLDSOCK
 		if (type == MT_SONAME && buflen <= 112)
