freenas__os
commit 5f10eb564d15f24a9ad14492eef7a979fd250901
Author:     delphij <delphij@ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f>
AuthorDate: Tue Jan 14 18:58:57 2014 +0000
Commit:     delphij <delphij@ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f>
CommitDate: Tue Jan 14 18:58:57 2014 +0000

    Fix bsnmpd remote denial of service vulnerability.
    
    Reported by:    dinoex
    Submitted by:   harti
    Security:       FreeBSD-SA-14:01.bsnmpd
    Security:       CVE-2014-1452
    
    
    git-svn-id: svn+ssh://svn.freebsd.org/base/head@260636 ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f

diff --git a/contrib/bsnmp/lib/snmpagent.c b/contrib/bsnmp/lib/snmpagent.c
index e2aa2647dd4..a425c376d62 100644
--- a/contrib/bsnmp/lib/snmpagent.c
+++ b/contrib/bsnmp/lib/snmpagent.c
@@ -510,6 +510,11 @@ snmp_getbulk(struct snmp_pdu *pdu, struct asn_buf *resp_b,
 	for (cnt = 0; cnt < pdu->error_index; cnt++) {
 		eomib = 1;
 		for (i = non_rep; i < pdu->nbindings; i++) {
+
+			if (resp->nbindings == SNMP_MAX_BINDINGS)
+				/* PDU is full */
+				goto done;
+
 			if (cnt == 0) 
 				result = do_getnext(&context, &pdu->bindings[i],
 				    &resp->bindings[resp->nbindings], pdu);
