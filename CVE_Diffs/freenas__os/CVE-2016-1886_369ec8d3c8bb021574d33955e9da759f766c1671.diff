freenas__os
commit 369ec8d3c8bb021574d33955e9da759f766c1671
Author:     glebius <glebius@FreeBSD.org>
AuthorDate: Tue May 17 22:28:36 2016 +0000
Commit:     Josh Paetzel <josh@ixsystems.com>
CommitDate: Thu May 19 12:48:49 2016 -0700

    - Use unsigned version of min() when handling arguments of SETFKEY ioctl.
    - Validate that user supplied control message length in sendmsg(2)
      is not negative.
    
    Security:       SA-16:18
    Security:       CVE-2016-1886
    Security:       SA-16:19
    Security:       CVE-2016-1887
    Submitted by:   C Turt <cturt hardenedbsd.org>
    Approved by:    so
    
    Ticket: #15431
    (cherry picked from commit 70eabc230b001bdbc11a1708ae3baa49a29ea6df)

diff --git a/UPDATING b/UPDATING
index 33e6fc26307..de4d8ec85b8 100644
--- a/UPDATING
+++ b/UPDATING
@@ -11,6 +11,78 @@ handbook:
 Items affecting the ports and packages system can be found in
 /usr/ports/UPDATING.  Please read that file before running portupgrade.
 
+20160517	p42	FreeBSD-SA-16:18.atkbd
+
+	Fix buffer overflow in keyboard driver. [SA-16:18]
+
+20160504	p41	FreeBSD-SA-16:17.openssl
+			FreeBSD-EN-16:08.zfs
+
+	Fix multiple OpenSSL vulnerabilitites. [SA-16:17]
+
+	Fix memory leak in ZFS. [EN-16:08]
+
+20160429	p40	FreeBSD-SA-16:16.ntp
+
+	Fix multiple vulnerabilities of ntp.
+
+20160316	p39	FreeBSD-SA-16:14.openssh-xauth
+			FreeBSD-SA-16:15.sysarch
+
+	Fix OpenSSH xauth(1) command injection. [SA-16:14]
+	Fix incorrect argument validation in sysarch(2). [SA-16:15]
+
+20160310	p38	FreeBSD-SA-16:13.bind
+			FreeBSD-SA-16:12.openssl [revised]
+
+	Fix multiple vulnerabilities of BIND. [SA-16:13]
+
+	Fix a regression with OpenSSL patch. [SA-16:12]
+
+20160303	p37	FreeBSD-SA-16:12.openssl
+
+	Fix multiple vulnerabilities of OpenSSL.
+
+20160130	p36	FreeBSD-SA-16:11.openssl
+
+	Fix OpenSSL SSLv2 ciphersuite downgrade vulnerability. [SA-16:11]
+
+20160127	p35	FreeBSD-SA-16:08.bind
+			FreeBSD-SA-16:09.ntp
+			FreeBSD-SA-16:10.linux
+
+	Fix BIND remote denial of service vulnerability. [SA-16:08]
+
+	Fix multiple vulnerabilities of ntp. [SA-16:09]
+
+	Fix Linux compatibility layer issetugid(2) system call
+	vulnerability. [SA-16:10]
+
+20160114	p34	FreeBSD-SA-16:07.openssh
+
+	Fix OpenSSH client information leak. [SA-16:07]
+
+20160114	p33	FreeBSD-EN-16:02.pf
+			FreeBSD-EN-16:03.yplib
+			FreeBSD-SA-16:01.sctp
+			FreeBSD-SA-16:02.ntp
+			FreeBSD-SA-16:03.linux
+			FreeBSD-SA-16:04.linux
+			FreeBSD-SA-16:05.tcp
+			FreeBSD-SA-16:06.bsnmpd
+
+	Fix pf(4) generating bad TCP checksums. [EN-16:02]
+	Fix infinite loop in YP/NIS client library. [EN-16:03]
+	Fix remote denial of service in SCTP. [SA-16:01]
+	Update NTP to 4.2.8p5. [SA-16:02]
+	Fix kernel memory diclosure in Linux compatibility layer. [SA-16:03]
+	Fix kernel memory overwrite in Linux compatibility layer. [SA-16:04]
+	Fix crash in TCP MD5 signatures. [SA-16:05]
+	Fix insecure default permissions for snmpd.config. [SA-16:06]
+
+20151216	p32	FreeBSD-SA-15:27.bind
+	Fix BIND remote denial of service vulnerability. [SA-15:27]
+
 20151205	p31	FreeBSD-SA-15:26.openssl
 
 	Fix OpenSSL X509_ATTRIBUTE memory leak. [SA-15:26]
diff --git a/sys/conf/newvers.sh b/sys/conf/newvers.sh
index 7152c11ca58..cdbce1481a1 100644
--- a/sys/conf/newvers.sh
+++ b/sys/conf/newvers.sh
@@ -32,7 +32,7 @@
 
 TYPE="FreeBSD"
 REVISION="9.3"
-BRANCH="RELEASE-p31"
+BRANCH="RELEASE-p42"
 if [ "X${BRANCH_OVERRIDE}" != "X" ]; then
 	BRANCH=${BRANCH_OVERRIDE}
 fi
diff --git a/sys/dev/kbd/kbd.c b/sys/dev/kbd/kbd.c
index 80367628888..f1a1b29ab22 100644
--- a/sys/dev/kbd/kbd.c
+++ b/sys/dev/kbd/kbd.c
@@ -996,7 +996,7 @@ genkbd_commonioctl(keyboard_t *kbd, u_long cmd, caddr_t arg)
 			splx(s);
 			return (error);
 		}
-		kbd->kb_fkeytab[fkeyp->keynum].len = imin(fkeyp->flen, MAXFK);
+		kbd->kb_fkeytab[fkeyp->keynum].len = min(fkeyp->flen, MAXFK);
 		bcopy(fkeyp->keydef, kbd->kb_fkeytab[fkeyp->keynum].str,
 		    kbd->kb_fkeytab[fkeyp->keynum].len);
 		break;
