freenas__os
commit c19a6102b2955d6e4d45fdb6789bd1d57f809623
Author:     delphij <delphij@ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f>
AuthorDate: Wed Nov 2 06:49:25 2016 +0000
Commit:     delphij <delphij@ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f>
CommitDate: Wed Nov 2 06:49:25 2016 +0000

    MFV r308196:
    
    Fix OpenSSH remote Denial of Service vulnerability.
    
    Security:       CVE-2016-8858
    
    
    git-svn-id: svn+ssh://svn.freebsd.org/base/head@308197 ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f

diff --git a/crypto/openssh/kex.c b/crypto/openssh/kex.c
index d371f47c48d..9c9f56228ea 100644
--- a/crypto/openssh/kex.c
+++ b/crypto/openssh/kex.c
@@ -468,6 +468,7 @@ kex_input_kexinit(int type, u_int32_t seq, void *ctxt)
 	if (kex == NULL)
 		return SSH_ERR_INVALID_ARGUMENT;
 
+	ssh_dispatch_set(ssh, SSH2_MSG_KEXINIT, NULL);
 	ptr = sshpkt_ptr(ssh, &dlen);
 	if ((r = sshbuf_put(kex->peer, ptr, dlen)) != 0)
 		return r;
