freenas__os
commit 8232f09126232b55615a8677600a452bbc09a143
Author:     dteske <dteske@ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f>
AuthorDate: Mon Apr 6 18:03:35 2015 +0000
Commit:     dteske <dteske@ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f>
CommitDate: Mon Apr 6 18:03:35 2015 +0000

    Fix permissions on ZFS root encryption key (644 -> 600).
    
    MFC after:      3 days
    X-MFC-to:       stable/10 stable/9
    Security:       CVE-2015-1415
    Reported by:    Pierre Kim
    
    
    git-svn-id: svn+ssh://svn.freebsd.org/base/head@281160 ccf9f872-aa2e-dd11-9fc8-001c23d0bc1f

diff --git a/usr.sbin/bsdinstall/scripts/zfsboot b/usr.sbin/bsdinstall/scripts/zfsboot
index edd9f596cd6..08d1f0a6b12 100755
--- a/usr.sbin/bsdinstall/scripts/zfsboot
+++ b/usr.sbin/bsdinstall/scripts/zfsboot
@@ -1128,6 +1128,9 @@ zfs_create_boot()
 			f_eval_catch $funcname dd "$DD_WITH_OPTIONS" \
 			             /dev/random "$bootpool/$zroot_key" \
 			             "bs=4096 count=1" || return $FAILURE
+			f_eval_catch $funcname "$CHMOD_MODE" \
+			             go-wrx "$bootpool/$zroot_key" ||
+			             return $FAILURE
 		else
 			# Clean up
 			f_eval_catch $funcname zfs "$ZFS_UNMOUNT" \
