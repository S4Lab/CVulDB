freenas__os
commit c5461d7d838ecf010f9a551e548b1330f2201aaa
Author:     roberto <roberto@FreeBSD.org>
AuthorDate: Sun Apr 19 23:34:52 2009 +0000
Commit:     roberto <roberto@FreeBSD.org>
CommitDate: Sun Apr 19 23:34:52 2009 +0000

    Prevent a buffer overflow in ntpq.  Patch taken from the PR database
    after being committed to the official ntp tree and present in 4.2.4p7-rc2.
    
    It will be MFH to the upcoming 7.2 pending re approval.
    
    Obtained from:  https://support.ntp.org/bugs/show_bug.cgi?id=1144
    MFC after:          3 days
    Security:           http://www.securityfocus.com/bid/34481
                    CVE-2009-0159

diff --git a/ntpq/ntpq.c b/ntpq/ntpq.c
index 91379408ff7..4835d7e3546 100644
--- a/ntpq/ntpq.c
+++ b/ntpq/ntpq.c
@@ -3185,9 +3185,9 @@ cookedprint(
 				if (!decodeuint(value, &uval))
 				    output_raw = '?';
 				else {
-					char b[10];
+					char b[12];
 
-					(void) sprintf(b, "%03lo", uval);
+					(void) snprintf(b, sizeof(b), "%03lo", uval);
 					output(fp, name, b);
 				}
 				break;
