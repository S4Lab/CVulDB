iPuTTY__iPuTTY
commit bc6c15ab5f636e05b7e91883f0031a7e06117947
Author:     Simon Tatham <anakin@pobox.com>
AuthorDate: Wed Feb 24 20:13:10 2016 +0000
Commit:     Simon Tatham <anakin@pobox.com>
CommitDate: Mon Feb 29 19:59:37 2016 +0000

    Fix vulnerability CVE-2016-2563 in old scp protocol.
    
    There was a rogue sscanf("%s") with no field width limit, targeting a
    stack-based buffer, and scanning a string containing untrusted data.
    It occurs in the 'sink' side of the protocol, i.e. when downloading
    files *from* the server.
    
    Our own bug id for this vulnerability is 'vuln-pscp-sink-sscanf'.

diff --git a/pscp.c b/pscp.c
index 3e41454d..dc9e1f50 100644
--- a/pscp.c
+++ b/pscp.c
@@ -1528,7 +1528,7 @@ int scp_get_sink_action(struct scp_sink_action *act)
 	{
 	    char sizestr[40];
 	
-	    if (sscanf(act->buf, "%lo %s %n", &act->permissions,
+            if (sscanf(act->buf, "%lo %39s %n", &act->permissions,
                        sizestr, &i) != 2)
 		bump("Protocol error: Illegal file descriptor format");
 	    act->size = uint64_from_decimal(sizestr);
