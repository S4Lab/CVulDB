ouya__ouya_1_1-kernel
commit c8e08839e4cf5aa96ac243ccbbab3c24e52399db
Author:     Greg Leach <gleach@ouya.tv>
AuthorDate: Wed Nov 12 18:36:04 2014 -0800
Commit:     Greg Leach <gleach@ouya.tv>
CommitDate: Wed Nov 12 18:36:04 2014 -0800

    1.2.1187 to 1.2.1353
    
    * CVE-2014-5206 - Preserve mount flags that are not user-settable.

diff --git a/fs/namespace.c b/fs/namespace.c
index 5e7f2e9a..3f7c195f 100644
--- a/fs/namespace.c
+++ b/fs/namespace.c
@@ -1841,7 +1841,7 @@ static int do_remount(struct path *path, int flags, int mnt_flags,
 		err = do_remount_sb(sb, flags, data, 0);
 	if (!err) {
 		br_write_lock(vfsmount_lock);
-		mnt_flags |= path->mnt->mnt_flags & MNT_PROPAGATION_MASK;
+		mnt_flags |= path->mnt->mnt_flags & ~MNT_USER_SETTABLE_MASK;
 		path->mnt->mnt_flags = mnt_flags;
 		br_write_unlock(vfsmount_lock);
 	}
diff --git a/include/linux/mount.h b/include/linux/mount.h
index 33fe53d7..5a51e93d 100644
--- a/include/linux/mount.h
+++ b/include/linux/mount.h
@@ -42,8 +42,9 @@ struct mnt_namespace;
  * flag, consider how it interacts with shared mounts.
  */
 #define MNT_SHARED_MASK	(MNT_UNBINDABLE)
-#define MNT_PROPAGATION_MASK	(MNT_SHARED | MNT_UNBINDABLE)
-
+#define MNT_USER_SETTABLE_MASK  (MNT_NOSUID | MNT_NODEV | MNT_NOEXEC \
+								 | MNT_NOATIME | MNT_NODIRATIME | MNT_RELATIME \
+								 | MNT_READONLY)
 
 #define MNT_INTERNAL	0x4000
 
