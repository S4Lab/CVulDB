libav__libav
commit b1ad5a21da7ac56b853b6a21ed08a075ecbb89c6
Author:     Janne Grunau <janne-libav@jannau.net>
AuthorDate: Fri Mar 23 22:30:38 2012 +0100
Commit:     Anton Khirnov <anton@khirnov.net>
CommitDate: Sat Oct 6 08:43:42 2012 +0200

    rv34: error out on size changes with frame threading
    
    Fixes CVE-2012-2772
    
    (cherry picked from commit cb7190cd2c691fd93e4d3664f3fce6c19ee001dd)
    
    Signed-off-by: Anton Khirnov <anton@khirnov.net>

diff --git a/libavcodec/rv34.c b/libavcodec/rv34.c
index 859ea50f5..c05b71b14 100644
--- a/libavcodec/rv34.c
+++ b/libavcodec/rv34.c
@@ -1677,6 +1677,13 @@ int ff_rv34_decode_frame(AVCodecContext *avctx,
         if (s->width != si.width || s->height != si.height) {
             int err;
 
+            if (HAVE_THREADS &&
+                (s->avctx->active_thread_type & FF_THREAD_FRAME)) {
+                av_log_missing_feature(s->avctx, "Width/height changing with "
+                                       "frame threading is", 0);
+                return AVERROR_PATCHWELCOME;
+            }
+
             av_log(s->avctx, AV_LOG_WARNING, "Changing dimensions to %dx%d\n",
                    si.width, si.height);
             MPV_common_end(s);
