libav__libav
commit 3b69f245dbe6e2016659a45c4bfe284f6c5ac57e
Author:     Luca Barbato <lu_zero@gentoo.org>
AuthorDate: Mon May 25 22:30:10 2015 +0200
Commit:     Luca Barbato <lu_zero@gentoo.org>
CommitDate: Sat May 30 16:32:02 2015 +0200

    h264: Make sure reinit failures mark the context as not initialized
    
    Bug-Id: CVE-2015-3417
    CC: libav-stable@libav.org

diff --git a/libavcodec/h264_slice.c b/libavcodec/h264_slice.c
index e47a4484e..c2c3e9ff1 100644
--- a/libavcodec/h264_slice.c
+++ b/libavcodec/h264_slice.c
@@ -1319,6 +1319,7 @@ int ff_h264_decode_slice_header(H264Context *h, H264Context *h0)
     }
 
     if (h->context_initialized && needs_reinit) {
+        h->context_initialized = 0;
         if (h != h0) {
             av_log(h->avctx, AV_LOG_ERROR,
                    "changing width %d -> %d / height %d -> %d on "
