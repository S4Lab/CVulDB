libav__libav
commit d1729c3715af6901788058be46e8a73372e434bf
Author:     Anton Khirnov <anton@khirnov.net>
AuthorDate: Fri Sep 28 15:42:29 2012 +0200
Commit:     Reinhard Tartler <siretart@tauware.de>
CommitDate: Sun Feb 10 18:01:15 2013 +0100

    avidec: use actually read size instead of requested size
    
    Fixes CVE-2012-2788
    (cherry picked from commit 0af49a63c7f87876486ab09482d5b26b95abce60)
    
    Signed-off-by: Reinhard Tartler <siretart@tauware.de>

diff --git a/libavformat/avidec.c b/libavformat/avidec.c
index 78e5051e1..74edebf41 100644
--- a/libavformat/avidec.c
+++ b/libavformat/avidec.c
@@ -780,7 +780,7 @@ resync:
             else
                 ast->frame_offset++;
         }
-        ast->remaining -= size;
+        ast->remaining -= err;
         if(!ast->remaining){
             avi->stream_index= -1;
             ast->packet_size= 0;
