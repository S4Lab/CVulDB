libav__libav
commit e050af9a809bd4e223c89e280ebd94da0e1034b5
Author:     Michael Niedermayer <michaelni@gmx.at>
AuthorDate: Fri Jan 11 00:54:12 2013 +0100
Commit:     Reinhard Tartler <siretart@tauware.de>
CommitDate: Sat Mar 9 18:54:28 2013 +0100

    vorbisdec: Error on bark_map_size equal to 0.
    
    The value is used to calculate output LSP curve and a division by zero
    and out of array accesses would occur.
    
    CVE-2013-0894
    
    CC: libav-stable@libav.org
    
    Reported-by: Dale Curtis <dalecurtis@chromium.org>
    Found-by: inferno@chromium.org
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>
    Signed-off-by: Luca Barbato <lu_zero@gentoo.org>
    (cherry picked from commit 11dcecfcca0eca1a571792c4fa3c21fb2cfddddc)
    
    Signed-off-by: Reinhard Tartler <siretart@tauware.de>
    (cherry picked from commit 494ddd377ada76ed555f7a3f49391455daa099c9)
    
    Signed-off-by: Reinhard Tartler <siretart@tauware.de>

diff --git a/libavcodec/vorbisdec.c b/libavcodec/vorbisdec.c
index 3c139478e..5a0a4a4a9 100644
--- a/libavcodec/vorbisdec.c
+++ b/libavcodec/vorbisdec.c
@@ -587,6 +587,11 @@ static int vorbis_parse_setup_hdr_floors(vorbis_context *vc)
             floor_setup->data.t0.order          = get_bits(gb,  8);
             floor_setup->data.t0.rate           = get_bits(gb, 16);
             floor_setup->data.t0.bark_map_size  = get_bits(gb, 16);
+            if (floor_setup->data.t0.bark_map_size == 0) {
+                av_log(vc->avccontext, AV_LOG_ERROR,
+                       "Floor 0 bark map size is 0.\n");
+                return AVERROR_INVALIDDATA;
+            }
             floor_setup->data.t0.amplitude_bits = get_bits(gb,  6);
             /* zero would result in a div by zero later *
              * 2^0 - 1 == 0                             */
