libav__libav
commit dcc68de942f06d358192a57057adb133f7c40dd7
Author:     Michael Niedermayer <michaelni@gmx.at>
AuthorDate: Mon Aug 4 01:06:51 2014 +0100
Commit:     Vittorio Giovara <vittorio.giovara@gmail.com>
CommitDate: Fri Aug 8 15:04:18 2014 +0100

    vp3: Copy all 3 frames for thread updates
    
    Fixes a double release of the current frame on deinit.
    
    Bug-Id: CVE-2011-3934
    Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
    Signed-off-by: Vittorio Giovara <vittorio.giovara@gmail.com>

diff --git a/libavcodec/vp3.c b/libavcodec/vp3.c
index d8e16505a..2fa10c1e1 100644
--- a/libavcodec/vp3.c
+++ b/libavcodec/vp3.c
@@ -1865,7 +1865,7 @@ static int vp3_update_thread_context(AVCodecContext *dst, const AVCodecContext *
         ||s->width != s1->width
         ||s->height!= s1->height) {
         if (s != s1)
-            copy_fields(s, s1, golden_frame, current_frame);
+            copy_fields(s, s1, golden_frame, keyframe);
         return -1;
     }
 
