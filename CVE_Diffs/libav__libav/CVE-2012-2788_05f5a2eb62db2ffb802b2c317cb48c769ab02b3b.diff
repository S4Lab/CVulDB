libav__libav
commit 05f5a2eb62db2ffb802b2c317cb48c769ab02b3b
Author:     Anton Khirnov <anton@khirnov.net>
AuthorDate: Fri Sep 28 15:42:29 2012 +0200
Commit:     Reinhard Tartler <siretart@tauware.de>
CommitDate: Fri Jan 4 07:43:37 2013 +0100

    avidec: use actually read size instead of requested size
    
    Fixes CVE-2012-2788
    (cherry picked from commit 0af49a63c7f87876486ab09482d5b26b95abce60)
    
    Signed-off-by: Reinhard Tartler <siretart@tauware.de>

diff --git a/libavformat/avidec.c b/libavformat/avidec.c
index 85fc79436..a35290b19 100644
--- a/libavformat/avidec.c
+++ b/libavformat/avidec.c
@@ -984,7 +984,7 @@ resync:
             }
             ast->frame_offset += get_duration(ast, pkt->size);
         }
-        ast->remaining -= size;
+        ast->remaining -= err;
         if(!ast->remaining){
             avi->stream_index= -1;
             ast->packet_size= 0;
