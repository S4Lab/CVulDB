libav__libav
commit 48c7fe5b5834a197f10a6eb56cbe7cda8ee32407
Author:     Luca Barbato <lu_zero@gentoo.org>
AuthorDate: Mon May 25 21:53:26 2015 +0200
Commit:     Reinhard Tartler <siretart@tauware.de>
CommitDate: Sun May 31 11:23:54 2015 -0400

    msrle: Use FFABS to determine the frame size in msrle_decode_pal4
    
    As done in msrle_decode_8_16_24_32.
    
    Bug-Id: CVE-2015-3395
    CC: libav-stable@libav.org

diff --git a/libavcodec/msrledec.c b/libavcodec/msrledec.c
index af2a2478b..370d9bdfc 100644
--- a/libavcodec/msrledec.c
+++ b/libavcodec/msrledec.c
@@ -39,7 +39,7 @@ static int msrle_decode_pal4(AVCodecContext *avctx, AVPicture *pic,
     unsigned int pixel_ptr = 0;
     int row_dec = pic->linesize[0];
     int row_ptr = (avctx->height - 1) * row_dec;
-    int frame_size = row_dec * avctx->height;
+    int frame_size = FFABS(row_dec) * avctx->height;
     int i;
 
     while (row_ptr >= 0) {
