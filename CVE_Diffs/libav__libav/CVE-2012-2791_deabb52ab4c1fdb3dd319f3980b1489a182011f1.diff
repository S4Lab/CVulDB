libav__libav
commit deabb52ab4c1fdb3dd319f3980b1489a182011f1
Author:     Anton Khirnov <anton@khirnov.net>
AuthorDate: Thu Dec 13 19:38:20 2012 +0100
Commit:     Anton Khirnov <anton@khirnov.net>
CommitDate: Fri Dec 14 07:10:53 2012 +0100

    ivi_common: check that scan pattern is set before using it.
    
    Fixes CVE-2012-2791.
    
    CC: libav-stable@libav.org

diff --git a/libavcodec/ivi_common.c b/libavcodec/ivi_common.c
index 9b8109441..76782e517 100644
--- a/libavcodec/ivi_common.c
+++ b/libavcodec/ivi_common.c
@@ -460,6 +460,11 @@ static int ivi_decode_blocks(GetBitContext *gb, IVIBandDesc *band, IVITile *tile
             }
 
             if (cbp & 1) { /* block coded ? */
+                if (!band->scan) {
+                    av_log(avctx, AV_LOG_ERROR, "Scan pattern is not set.\n");
+                    return AVERROR_INVALIDDATA;
+                }
+
                 scan_pos = -1;
                 memset(trvec, 0, num_coeffs*sizeof(trvec[0])); /* zero transform vector */
                 memset(col_flags, 0, sizeof(col_flags));      /* zero column flags */
