libguestfs__libguestfs
commit 6e3638d3d5dfe8a3a9b3d93bda9e1914360e7488
Author:     Richard W.M. Jones <rjones@redhat.com>
AuthorDate: Fri May 31 08:37:44 2013 +0100
Commit:     Richard W.M. Jones <rjones@redhat.com>
CommitDate: Mon Jun 3 14:27:44 2013 +0100

    inspection: Don't segfault if /etc/SuSE-release is an empty file.
    
    Related to CVE-2013-2124.
    
    Thanks: Olaf Hering.
    (cherry picked from commit ae8bb84ecd46d7b6ef557a87725923ac8d09dce0)
    (cherry picked from commit 70ca2117de84a221c72ffb7660b35c8550a2b1b0)

diff --git a/src/inspect-fs-unix.c b/src/inspect-fs-unix.c
index d3dae37d6..d1e573a2f 100644
--- a/src/inspect-fs-unix.c
+++ b/src/inspect-fs-unix.c
@@ -339,10 +339,11 @@ parse_suse_release (guestfs_h *g, struct inspect_fs *fs, const char *filename)
   if (lines == NULL)
     return -1;
 
+  if (lines[0] != NULL)
+    goto out;
+
   /* First line is dist release name */
   fs->product_name = safe_strdup (g, lines[0]);
-  if (fs->product_name == NULL)
-    goto out;
 
   /* Match SLES first because openSuSE regex overlaps some SLES release strings */
   if (match (g, fs->product_name, re_sles) || match (g, fs->product_name, re_nld)) {
