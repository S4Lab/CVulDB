libguestfs__libguestfs
commit 08b811afb99e4998f25445e4a6d04d939da4f8a3
Author:     Richard W.M. Jones <rjones@redhat.com>
AuthorDate: Sat Jun 1 14:11:40 2013 +0100
Commit:     Richard W.M. Jones <rjones@redhat.com>
CommitDate: Mon Jun 3 14:27:44 2013 +0100

    inspection: Correct fix for segfault if /etc/SuSE-release is an empty file.
    
    The test was the wrong way round.
    
    See: CVE-2013-2124.
    
    This fixes commit ae8bb84ecd46d7b6ef557a87725923ac8d09dce0.
    (cherry picked from commit 1c9dfd079aa6d7893f72c5fd17656c847f72c8d6)
    (cherry picked from commit 0e65c43292f31da61f2102269a511b98a0f531bd)

diff --git a/src/inspect-fs-unix.c b/src/inspect-fs-unix.c
index d1e573a2f..c2f8dba25 100644
--- a/src/inspect-fs-unix.c
+++ b/src/inspect-fs-unix.c
@@ -339,7 +339,7 @@ parse_suse_release (guestfs_h *g, struct inspect_fs *fs, const char *filename)
   if (lines == NULL)
     return -1;
 
-  if (lines[0] != NULL)
+  if (lines[0] == NULL)
     goto out;
 
   /* First line is dist release name */
