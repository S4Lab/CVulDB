libstorage__libstoragemgmt
commit 9ebe4c0a476eedfae96425a4bda1a624ec1f9055
Author:     Gris Ge <fge@redhat.com>
AuthorDate: Wed Jan 8 15:29:25 2014 +0800
Commit:     Tony Asleson <tasleson@redhat.com>
CommitDate: Thu Jan 9 22:25:34 2014 -0600

    smis.py: new option to allow skip SSL check
    
     * Since CVE-2013-6418 was fixed in pywbem [1], SSL check will stop any
       'smis+ssl://' connection if SSL check failed.
     * Introduce a new URI parameter "no_ssl_verify=yes" to skip SSL check.
       But by default, we follow that SSL check and suggest user to setup their
       self-signed SSL environment.
    
    [1] Fedora fix is: pywbem-0.7.0-23.20131121svn626.fc20.noarch.rpm
    
    Signed-off-by: Gris Ge <fge@redhat.com>

diff --git a/lsm/lsm/smis.py b/lsm/lsm/smis.py
index fec0817..e8bee71 100644
--- a/lsm/lsm/smis.py
+++ b/lsm/lsm/smis.py
@@ -479,9 +479,20 @@ def startup(self, uri, password, timeout, flags=0):
         if 'systems' in u['parameters']:
             self.system_list = split(u['parameters']["systems"], ":")
 
-        self.tmo = timeout
         self._c = pywbem.WBEMConnection(url, (u['username'], password),
                                         u['parameters']["namespace"])
+        if "no_ssl_verify" in u["parameters"] \
+           and u["parameters"]["no_ssl_verify"] == 'yes':
+            try:
+                self._c = pywbem.WBEMConnection(url, (u['username'], password),
+                                                u['parameters']["namespace"],
+                                                no_verification=True)
+            except TypeError:
+                # pywbem is not holding fix from
+                # https://bugzilla.redhat.com/show_bug.cgi?id=1039801
+                pass
+
+        self.tmo = timeout
 
     def set_time_out(self, ms, flags=0):
         self.tmo = ms
