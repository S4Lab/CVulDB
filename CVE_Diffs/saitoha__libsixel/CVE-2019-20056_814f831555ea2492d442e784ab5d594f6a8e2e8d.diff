saitoha__libsixel
commit 814f831555ea2492d442e784ab5d594f6a8e2e8d
Author:     Hayaki Saito <saitoha@me.com>
AuthorDate: Mon Dec 30 17:04:52 2019 +0900
Commit:     Hayaki Saito <saitoha@me.com>
CommitDate: Wed Jan 1 04:04:01 2020 +0900

    Fix for CVE-2019-20056, assertion failure problem(#126). Thanks to @sleicasper

diff --git a/src/stb_image.h b/src/stb_image.h
index 25ba2e4..d65f66a 100644
--- a/src/stb_image.h
+++ b/src/stb_image.h
@@ -5045,13 +5045,13 @@ static int stbi__shiftsigned(int v, int shift, int bits)
    static unsigned int shift_table[9] = {
       0, 0,0,1,0,2,4,6,0,
    };
+   if (bits < 0 || bits > 8) return (0);  /* error */
    if (shift < 0)
       v <<= -shift;
    else
       v >>= shift;
-   STBI_ASSERT(v >= 0 && v < 256);
+   if (v < 0 || v >= 256) return (0);
    v >>= (8-bits);
-   if (bits < 0 || bits > 8) return (0);  /* error */
    return (int) ((unsigned) v * mul_table[bits]) >> shift_table[bits];
 }
 
