xen-project__xen
commit 58db71c5cdd48126b9380c230dc5b61554bad7d8
Author:     Andrew Cooper <andrew.cooper3@citrix.com>
AuthorDate: Tue Apr 21 09:25:03 2015 +0200
Commit:     Jan Beulich <jbeulich@suse.com>
CommitDate: Tue Apr 21 09:25:03 2015 +0200

    domctl/sysctl: don't leak hypervisor stack to toolstacks
    
    This is CVE-2015-3340 / XSA-132.
    
    Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
    Reviewed-by: Jan Beulich <jbeulich@suse.com>
    Acked-by: Ian Campbell <ian.campbell@citrix.com>
    master commit: 4ff3449f0e9d175ceb9551d3f2aecb59273f639d
    master date: 2015-04-21 09:03:15 +0200

diff --git a/xen/arch/x86/domctl.c b/xen/arch/x86/domctl.c
index 07000de4b1..a115278c74 100644
--- a/xen/arch/x86/domctl.c
+++ b/xen/arch/x86/domctl.c
@@ -944,7 +944,7 @@ long arch_do_domctl(
 
     case XEN_DOMCTL_gettscinfo:
     {
-        xen_guest_tsc_info_t info;
+        xen_guest_tsc_info_t info = { 0 };
 
         ret = -EINVAL;
         if ( d == current->domain ) /* no domain_pause() */
diff --git a/xen/common/sysctl.c b/xen/common/sysctl.c
index 0cb6ee15fb..70202e8b05 100644
--- a/xen/common/sysctl.c
+++ b/xen/common/sysctl.c
@@ -76,7 +76,7 @@ long do_sysctl(XEN_GUEST_HANDLE_PARAM(xen_sysctl_t) u_sysctl)
     case XEN_SYSCTL_getdomaininfolist:
     { 
         struct domain *d;
-        struct xen_domctl_getdomaininfo info;
+        struct xen_domctl_getdomaininfo info = { 0 };
         u32 num_domains = 0;
 
         rcu_read_lock(&domlist_read_lock);
