xen-project__xen
commit d7f7c5c6559ac3fa52dba5d8fe952b2c00f962db
Author:     Jan Beulich <jbeulich@suse.com>
AuthorDate: Thu Oct 29 14:27:02 2015 +0100
Commit:     Jan Beulich <jbeulich@suse.com>
CommitDate: Thu Oct 29 14:27:02 2015 +0100

    free domain's vcpu array
    
    This was overlooked in fb442e2171 ("x86_64: allow more vCPU-s per
    guest").
    
    This is CVE-2015-7969 / XSA-149.
    
    Reported-by: Ian Campbell <ian.campbell@citrix.com>
    Signed-off-by: Jan Beulich <jbeulich@suse.com>
    Reviewed-by: Ian Campbell <ian.campbell@citrix.com>
    master commit: d46896ebbb23f3a9fef2eb6066ae614fd1acfd96
    master date: 2015-10-29 13:35:40 +0100

diff --git a/xen/common/domain.c b/xen/common/domain.c
index fefef402a4..fa6d939227 100644
--- a/xen/common/domain.c
+++ b/xen/common/domain.c
@@ -734,6 +734,7 @@ static void complete_domain_destroy(struct rcu_head *head)
 
     xsm_free_security_domain(d);
     free_cpumask_var(d->domain_dirty_cpumask);
+    xfree(d->vcpu);
     free_domain_struct(d);
 
     send_global_virq(VIRQ_DOM_EXC);
