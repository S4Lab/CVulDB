xen-project__xen
commit 22e7a63ee4f8d693a23558fe684893ba1f2b4dee
Author:     Jan Beulich <jbeulich@suse.com>
AuthorDate: Wed Jan 9 17:16:00 2013 +0100
Commit:     Jan Beulich <jbeulich@suse.com>
CommitDate: Wed Jan 9 17:16:00 2013 +0100

    VT-d: fix interrupt remapping source validation for devices behind legacy bridges
    
    Using SVT_VERIFY_BUS here doesn't make sense; native Linux also
    uses SVT_VERIFY_SID_SQ here instead.
    
    This is XSA-33 / CVE-2012-5634.
    
    Signed-off-by: Jan Beulich <jbeulich@suse.com>
    xen-unstable changeset: 26340:19fd1237ff0d
    xen-unstable date: Wed Jan  9 16:13:26 UTC 2013

diff --git a/xen/drivers/passthrough/vtd/intremap.c b/xen/drivers/passthrough/vtd/intremap.c
index 5fe4246568..e7d51580a0 100644
--- a/xen/drivers/passthrough/vtd/intremap.c
+++ b/xen/drivers/passthrough/vtd/intremap.c
@@ -462,7 +462,7 @@ static void set_msi_source_id(struct pci_dev *pdev, struct iremap_entry *ire)
                 set_ire_sid(ire, SVT_VERIFY_BUS, SQ_ALL_16,
                             (bus << 8) | pdev->bus);
             else if ( pdev_type(seg, bus, devfn) == DEV_TYPE_LEGACY_PCI_BRIDGE )
-                set_ire_sid(ire, SVT_VERIFY_BUS, SQ_ALL_16,
+                set_ire_sid(ire, SVT_VERIFY_SID_SQ, SQ_ALL_16,
                             PCI_BDF2(bus, devfn));
         }
         break;
