xen-project__xen
commit 3cd10fd21220f2b814324e6e732004f8f0487d0a
Author:     Matthew Daley <mattjd@gmail.com>
AuthorDate: Tue Sep 10 23:12:45 2013 +1200
Commit:     Ian Jackson <Ian.Jackson@eu.citrix.com>
CommitDate: Thu Oct 10 15:49:40 2013 +0100

    tools/ocaml: fix erroneous free of cpumap in stub_xc_vcpu_getaffinity
    
    Not sure how it got there...
    
    Coverity-ID: 1056196
    
    This is CVE-2013-4370 / XSA-69
    
    Signed-off-by: Matthew Daley <mattjd@gmail.com>
    Acked-by: Ian Campbell <ian.campbell@citrix.com>

diff --git a/tools/ocaml/libs/xc/xenctrl_stubs.c b/tools/ocaml/libs/xc/xenctrl_stubs.c
index df756ad539..f5cf0edb24 100644
--- a/tools/ocaml/libs/xc/xenctrl_stubs.c
+++ b/tools/ocaml/libs/xc/xenctrl_stubs.c
@@ -461,8 +461,6 @@ CAMLprim value stub_xc_vcpu_getaffinity(value xch, value domid,
 
 	retval = xc_vcpu_getaffinity(_H(xch), _D(domid),
 	                             Int_val(vcpu), c_cpumap);
-	free(c_cpumap);
-
 	if (retval < 0) {
 		free(c_cpumap);
 		failwith_xc(_H(xch));
