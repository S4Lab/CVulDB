xen-project__xen
commit 60172eff1eacf9fff67ee80857f8735a3664c831
Author:     Ian Campbell <ian.campbell@citrix.com>
AuthorDate: Tue Sep 11 14:06:30 2012 +0200
Commit:     Ian Campbell <ian.campbell@citrix.com>
CommitDate: Tue Sep 11 14:06:30 2012 +0200

    tmem: only allow tmem control operations from privileged domains
    
    This is part of XSA-15 / CVE-2012-3497.
    
    Signed-off-by: Ian Campbell <ian.campbell@citrix.com>
    Committed-by: Jan Beulich <jbeulich@suse.com>

diff --git a/xen/common/tmem.c b/xen/common/tmem.c
index 1a8777c284..aedac551d3 100644
--- a/xen/common/tmem.c
+++ b/xen/common/tmem.c
@@ -2541,10 +2541,8 @@ static NOINLINE int do_tmem_control(struct tmem_op *op)
     OID *oidp = (OID *)(&op->u.ctrl.oid[0]);
 
     if (!tmh_current_is_privileged())
-    {
-        /* don't fail... mystery: sometimes dom0 fails here */
-        /* return -EPERM; */
-    }
+        return -EPERM;
+
     switch(subop)
     {
     case TMEMC_THAW:
