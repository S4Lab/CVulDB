xen-project__xen
commit 0bc9f98b0296932dd4ea611a9885354156ea9faf
Author:     Andrew Cooper <andrew.cooper3@citrix.com>
AuthorDate: Thu Jun 11 14:57:38 2015 +0200
Commit:     Jan Beulich <jbeulich@suse.com>
CommitDate: Thu Jun 11 14:57:38 2015 +0200

    x86/traps: loop in the correct direction in compat_iret()
    
    This is CVE-2015-4164 / XSA-136.
    
    Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
    Reviewed-by: Jan Beulich <jbeulich@suse.com>
    master commit: 1f0721377952fc038b48f175d7061ec701359aac
    master date: 2015-06-11 14:44:47 +0200

diff --git a/xen/arch/x86/x86_64/compat/traps.c b/xen/arch/x86/x86_64/compat/traps.c
index b6c2563f28..875d82e130 100644
--- a/xen/arch/x86/x86_64/compat/traps.c
+++ b/xen/arch/x86/x86_64/compat/traps.c
@@ -119,7 +119,7 @@ unsigned int compat_iret(void)
         }
         else if ( ksp > regs->_esp )
         {
-            for (i = 9; i > 0; ++i)
+            for ( i = 9; i > 0; --i )
             {
                 rc |= __get_user(x, (u32 *)regs->rsp + i);
                 rc |= __put_user(x, (u32 *)(unsigned long)ksp + i);
