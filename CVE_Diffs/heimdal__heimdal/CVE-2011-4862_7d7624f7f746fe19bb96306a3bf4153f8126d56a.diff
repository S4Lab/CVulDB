heimdal__heimdal
commit 7d7624f7f746fe19bb96306a3bf4153f8126d56a
Author:     Nicolas Williams <nico@cryptonector.com>
AuthorDate: Wed Dec 28 17:50:30 2011 -0600
Commit:     Nicolas Williams <nico@cryptonector.com>
CommitDate: Wed Dec 28 17:50:30 2011 -0600

    Fix CVE-2011-4862 Buffer overflow in libtelnet/encrypt.c in telnetd
    
        http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-4862
        http://security.freebsd.org/advisories/FreeBSD-SA-11:08.telnetd.asc
        http://security.freebsd.org/patches/SA-11:08/telnetd.patch

diff --git a/appl/telnet/libtelnet/encrypt.c b/appl/telnet/libtelnet/encrypt.c
index 68e8bd686..58e081d42 100644
--- a/appl/telnet/libtelnet/encrypt.c
+++ b/appl/telnet/libtelnet/encrypt.c
@@ -736,6 +736,9 @@ encrypt_keyid(struct key_info *kp, unsigned char *keyid, int len)
     int dir = kp->dir;
     int ret = 0;
 
+    if (len > MAXKEYLEN)
+	len = MAXKEYLEN;
+
     if (!(ep = (*kp->getcrypt)(*kp->modep))) {
 	if (len == 0)
 	    return;
