libming__libming
commit 1a1d2704cb19f2d3299f042bb3a4783c960b0a9a
Author:     Hugo Lefeuvre <hle@debian.org>
AuthorDate: Fri Oct 13 11:07:17 2017 +0200
Commit:     Hugo Lefeuvre <hle@debian.org>
CommitDate: Fri Oct 13 11:07:17 2017 +0200

    Change type of size variable in readBytes
    
    size should have type unsigned long instead of int in order
    to avoid overflows and lossy casts when passing U30 integers.
    
    This commit fixes CVE-2017-9989 (fixes #86).

diff --git a/NEWS b/NEWS
index 54075569..b9e8abfe 100644
--- a/NEWS
+++ b/NEWS
@@ -9,6 +9,8 @@
     issue #83).
   * Add checks to avoid null pointer dereference in util/parser.c
     (CVE-2017-9988, issue #85)
+  * Change type of size variable in readBytes (int->unsigned long) to
+    avoid overflow when passing U30 integers (CVE-2017-9989, issue #86).
 
 0.4.8 - 2017-04-07
 
diff --git a/util/read.c b/util/read.c
index 97e78d9e..80399ca0 100644
--- a/util/read.c
+++ b/util/read.c
@@ -224,17 +224,17 @@ float readFloat(FILE *f)
 }
 
 
-char *readBytes(FILE *f,int size)
+char *readBytes(FILE *f, unsigned long size)
 {
 
   if (size < 1) {
 #if DEBUG
-    SWF_warn("readBytes: want to read %i < 1 bytes: Handling a 0\n", size);
+    SWF_warn("readBytes: want to read %lu < 1 bytes: Handling a 0\n", size);
 #endif
     size = 0;
   }
 
-  int i;
+  unsigned long i;
   char *buf;
 
   buf = (char *)malloc(sizeof(char)*size);
diff --git a/util/read.h b/util/read.h
index e8d485fd..70a47717 100644
--- a/util/read.h
+++ b/util/read.h
@@ -20,7 +20,7 @@ long readSInt32(FILE *f);
 unsigned long readEncUInt32(FILE *f);
 unsigned long readEncUInt30(FILE *f);
 long readEncSInt32(FILE *f);
-char *readBytes(FILE *f,int size);
+char *readBytes(FILE *f,unsigned long size);
 char *readString(FILE *f);
 char *readSizedString(FILE *f,int size);
 double readDouble(FILE *f);
