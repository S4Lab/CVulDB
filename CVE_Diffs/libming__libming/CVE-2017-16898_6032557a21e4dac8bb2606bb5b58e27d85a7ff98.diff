libming__libming
commit 6032557a21e4dac8bb2606bb5b58e27d85a7ff98
Author:     Hugo Lefeuvre <hle@debian.org>
AuthorDate: Wed Jan 10 09:58:57 2018 +0100
Commit:     Hugo Lefeuvre <hle@debian.org>
CommitDate: Wed Jan 10 09:58:57 2018 +0100

    Fix global buffer overflow in printMP3Headers.
    
    The printMP3Headers function in util/listmp3.c processes mp3 files
    without checking their bitrate values. This leads to bitrate_idx = 15
    being used as index in mp2l23_bitrate_table[bitrate_idx] while
    mp2l23_bitrate_table has only 14 elements.
    
    In this commit we add a check rejecting mp3 files declaring invalid
    bitrates.
    
    This commit fixes CVE-2017-16898 (fixes: #75).

diff --git a/NEWS b/NEWS
index 58ba8e41..16333c31 100644
--- a/NEWS
+++ b/NEWS
@@ -22,6 +22,8 @@
     issue #94)
   * Fix heap buffer overflow in dcputs (global buffer missing \0 character)
     (CVE-2017-11732, issue #80)
+  * Fix global buffer overflow in printMP3Headers (invalid bitrate 15 not
+    detected) (CVE-2017-16898, issue #75).
 
 0.4.8 - 2017-04-07
 
diff --git a/util/listmp3.c b/util/listmp3.c
index de9d9f73..3564ff92 100644
--- a/util/listmp3.c
+++ b/util/listmp3.c
@@ -119,6 +119,11 @@ void printMP3Headers(FILE *f)
       error("invalid samplerate index");
     }
 
+    if (bitrate_idx == 15)
+    {
+      error("invalid bitrate 15");
+    }
+
     channels = ((flags & MP3_CHANNEL) == MP3_CHANNEL_MONO) ? 1 : 2;
 
     switch(flags & MP3_VERSION)
