libming__libming
commit c14d07ef20c3f403fcfa59502b74c66933473431
Author:     Hugo Lefeuvre <hle@debian.org>
AuthorDate: Wed Jan 17 10:49:41 2018 +0100
Commit:     Hugo Lefeuvre <hle@debian.org>
CommitDate: Wed Jan 17 10:49:41 2018 +0100

    Fix integer overflow vulnerability in util/read.c.
    
    This vulnerability is caused by a regression introduced in
    d468907.
    
    In this commit we cast the result of readUInt8(f) before left
    shifting by 24 in order to avoid out of range shift.
    
    This commit fixes CVE-2018-5251 (fixes #98).

diff --git a/NEWS b/NEWS
index 16333c31..35c02852 100644
--- a/NEWS
+++ b/NEWS
@@ -24,6 +24,8 @@
     (CVE-2017-11732, issue #80)
   * Fix global buffer overflow in printMP3Headers (invalid bitrate 15 not
     detected) (CVE-2017-16898, issue #75).
+  * Fix integer overflow vulnerability in util/read.c (out-of-range left
+    shift in readUInt32) (CVE-2018-5251, issue #98)
 
 0.4.8 - 2017-04-07
 
diff --git a/util/read.c b/util/read.c
index ed59052a..32f4c673 100644
--- a/util/read.c
+++ b/util/read.c
@@ -168,7 +168,7 @@ long readSInt32(FILE *f)
   result |= readUInt8(f);
   result |= readUInt8(f) << 8;
   result |= readUInt8(f) << 16;
-  result |= readUInt8(f) << 24;
+  result |= (long) readUInt8(f) << 24;
   return result;
 }
 
@@ -178,7 +178,7 @@ unsigned long readUInt32(FILE *f)
   result |= readUInt8(f);
   result |= readUInt8(f) << 8;
   result |= readUInt8(f) << 16;
-  result |= readUInt8(f) << 24;
+  result |= (unsigned long) readUInt8(f) << 24;
   return result;
 }
 
