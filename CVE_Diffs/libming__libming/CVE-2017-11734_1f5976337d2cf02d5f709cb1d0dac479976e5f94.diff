libming__libming
commit 1f5976337d2cf02d5f709cb1d0dac479976e5f94
Author:     Hugo Lefeuvre <hle@debian.org>
AuthorDate: Fri Oct 6 13:35:33 2017 +0200
Commit:     Hugo Lefeuvre <hle@debian.org>
CommitDate: Fri Oct 6 13:49:05 2017 +0200

    Fix heap buffer overflow in decompileCALLFUNCTION
    
    Make sure that n > 0 before checking for the previous action in the
    actions array, otherwise an overflow may occur.
    
    This commit fixes CVE-2017-11734 (fixes #83).

diff --git a/NEWS b/NEWS
index 812291ff..ea51452e 100644
--- a/NEWS
+++ b/NEWS
@@ -5,6 +5,8 @@
   * Fix various overflows in OpCode and readBytes (CVE-2017-11728,
     CVE-2017-11729, CVE-2017-11730 and CVE-2017-11731, issues #79,
     #81, #81 and #84).
+  * Fix heap buffer overflow in decompileCALLFUNCTION (CVE-2017-11734,
+    issue #83).
 
 0.4.8 - 2017-04-07
 
diff --git a/util/decompile.c b/util/decompile.c
index 1c58c8d9..5f52d768 100644
--- a/util/decompile.c
+++ b/util/decompile.c
@@ -2873,7 +2873,7 @@ decompileCALLFUNCTION(int n, SWF_ACTION *actions, int maxn)
 	struct SWF_ACTIONPUSHPARAM *meth, *nparam;
 
 	SanityCheck(SWF_CALLMETHOD,
-		actions[n-1].SWF_ACTIONRECORD.ActionCode == SWFACTION_PUSH,
+		n > 0 && actions[n-1].SWF_ACTIONRECORD.ActionCode == SWFACTION_PUSH,
 		"CALLMETHOD not preceeded by PUSH")
 
 	meth=pop();
