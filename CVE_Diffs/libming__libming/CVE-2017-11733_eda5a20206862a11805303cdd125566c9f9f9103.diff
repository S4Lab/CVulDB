libming__libming
commit eda5a20206862a11805303cdd125566c9f9f9103
Author:     Hugo Lefeuvre <hle@debian.org>
AuthorDate: Mon Oct 23 11:23:10 2017 +0200
Commit:     Hugo Lefeuvre <hle@debian.org>
CommitDate: Mon Oct 23 11:23:10 2017 +0200

    Fix null-pointer dereference issue in stackswap.
    
    Avoid processing stackswap when stack only contains one element. In this
    case, print a warning if debug mode is enabled, and return cleanly.
    
    This commit fixes CVE-2017-11733 (fixes #78).

diff --git a/NEWS b/NEWS
index b9e8abfe..ebc08be0 100644
--- a/NEWS
+++ b/NEWS
@@ -11,6 +11,8 @@
     (CVE-2017-9988, issue #85)
   * Change type of size variable in readBytes (int->unsigned long) to
     avoid overflow when passing U30 integers (CVE-2017-9989, issue #86).
+  * Add checks to avoid processing stackswap when stack only contains
+    one element (CVE-2017-11733, issue #78).
 
 0.4.8 - 2017-04-07
 
diff --git a/util/decompile.c b/util/decompile.c
index 5f52d768..a85a5eee 100644
--- a/util/decompile.c
+++ b/util/decompile.c
@@ -626,6 +626,14 @@ stackswap()
 #endif
 	struct SWF_ACTIONPUSHPARAM *p = peek();		/* peek() includes error handling */
 	char type = Stack->type;
+
+        if (Stack->next == NULL) {
+#if DEBUG
+		SWF_warn("stackswap: can't swap (stack contains only one element)\n");
+#endif
+                return;
+        }
+
 	Stack->type = Stack->next->type;
 	Stack->val  = Stack->next->val;
 	Stack->next->type = type;
