libming__libming
commit f3a66c6479d1191734b5ab57d5d7e0bd7525b1a7
Author:     Hugo Lefeuvre <hle@debian.org>
AuthorDate: Mon Nov 20 10:48:36 2017 +0100
Commit:     Hugo Lefeuvre <hle@debian.org>
CommitDate: Fri Nov 24 09:57:37 2017 +0100

    Fix NULL pointer deref in outputSWF_TEXT_RECORD
    
    fip and fip_current are static pointers to a linked list containing
    fonts information. This list and the two pointers are initialized and
    filled by saveFontInfo() (called by the outputSWF_DEFINEFONTxxxx()
    functions when defining new fonts).
    
    In the case where no font is defined, saveFontInfo() is never called
    and the two list pointers are NULL.
    
    This situation may trigger a NULL pointer dereference in
    outputSWF_TEXT_RECORD. In this patch, we check for !fip_current
    before dereferencing it. In the == NULL case, we print a warning and
    continue.
    
    This commit addresses CVE-2017-16883 (fixes #77).

diff --git a/NEWS b/NEWS
index 2aef2034..e2d49080 100644
--- a/NEWS
+++ b/NEWS
@@ -18,6 +18,8 @@
     standard).
   * Un-define DEBUGSTACK in util/decompile.c (return cleanly when stack
     is NULL).
+  * Fix NULL pointer dereference in outputSWF_TEXT_RECORD (CVE-2017-16883,
+    issue #94)
 
 0.4.8 - 2017-04-07
 
diff --git a/util/outputscript.c b/util/outputscript.c
index 8479ab6a..ee168744 100644
--- a/util/outputscript.c
+++ b/util/outputscript.c
@@ -1426,7 +1426,11 @@ outputSWF_TEXT_RECORD (SWF_TEXTRECORD *trec, int level,char *tname,char *buffer,
   if (!trec->StyleFlagHasFont)				/* always check flag before use data */
   {
    fi = fip_current;					/* so cont w current font */
-   id = fi->fontcodeID;					/* trigger next if */
+
+   if (!fi)
+      SWF_warn("outputSWF_TEXT_RECORD: can't process text record: fonts information list is NULL\n");
+   else
+      id = fi->fontcodeID;					/* trigger next if */
   }
   while (fi)
   {
