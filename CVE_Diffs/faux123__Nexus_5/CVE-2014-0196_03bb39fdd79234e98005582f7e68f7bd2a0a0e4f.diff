faux123__Nexus_5
commit 03bb39fdd79234e98005582f7e68f7bd2a0a0e4f
Author:     Paul Reioux <reioux@gmail.com>
AuthorDate: Mon May 12 16:27:29 2014 -0500
Commit:     Paul Reioux <reioux@gmail.com>
CommitDate: Sun May 25 13:04:52 2014 -0700

    drivers/tty/n_tty.c: fix CVE-2014-0196
    
    Signed-off-by: Paul Reioux <reioux@gmail.com>

diff --git a/drivers/tty/n_tty.c b/drivers/tty/n_tty.c
index 94b6eda87af..2470b918aa2 100644
--- a/drivers/tty/n_tty.c
+++ b/drivers/tty/n_tty.c
@@ -1987,7 +1987,9 @@ static ssize_t n_tty_write(struct tty_struct *tty, struct file *file,
 				tty->ops->flush_chars(tty);
 		} else {
 			while (nr > 0) {
+				mutex_lock(&tty->output_lock);
 				c = tty->ops->write(tty, b, nr);
+				mutex_unlock(&tty->output_lock);
 				if (c < 0) {
 					retval = c;
 					goto break_out;
