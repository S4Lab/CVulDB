veracrypt__VeraCrypt
commit 07bb27e3b94ee26128d5c7f800cdcf3232ff281a
Author:     Mounir IDRASSI <mounir.idrassi@idrix.fr>
AuthorDate: Sun Dec 8 23:11:11 2019 +0100
Commit:     Mounir IDRASSI <mounir.idrassi@idrix.fr>
CommitDate: Sun Dec 8 23:42:54 2019 +0100

    Windows: use fix for CVE-2019-19501 only on Vista and above since it doesn't make sens under XP.

diff --git a/src/Common/Dlgcode.c b/src/Common/Dlgcode.c
index 5a837865..5e2dc39a 100644
--- a/src/Common/Dlgcode.c
+++ b/src/Common/Dlgcode.c
@@ -14238,9 +14238,10 @@ static bool RunAsDesktopUser(
 
 // This function always loads a URL in a non-privileged mode
 // If current process has admin privileges, we execute the command "rundll32 url.dll,FileProtocolHandler URL" as non-elevated
+// Use this security mechanism only starting from Windows Vista
 void SafeOpenURL (LPCWSTR szUrl)
 {
-	if (IsAdmin ())
+	if (IsAdmin () && IsOSAtLeast (WIN_VISTA))
 	{
 		WCHAR szRunDllPath[TC_MAX_PATH];
 		WCHAR szUrlDllPath[TC_MAX_PATH];
