google__boringssl
commit d06eddd15cc94023a9a3fedf7b1c28aabf159e4d
Author:     Adam Langley <agl@chromium.org>
AuthorDate: Fri Jun 20 12:00:00 2014 -0700
Commit:     Adam Langley <agl@chromium.org>
CommitDate: Fri Jun 20 13:17:41 2014 -0700

    Fix CVE-2014-3470
    
    Check session_cert is not NULL before dereferencing it.
    
    (Imported from upstream's e5f706590c7b1f19ca34415593aebdb6cbef355b)

diff --git a/ssl/s3_clnt.c b/ssl/s3_clnt.c
index e235863f8..90d425f17 100644
--- a/ssl/s3_clnt.c
+++ b/ssl/s3_clnt.c
@@ -2545,6 +2545,13 @@ int ssl3_send_client_key_exchange(SSL *s)
 			unsigned int i;
 #endif
 
+			if (s->session->sess_cert == NULL) 
+				{
+				ssl3_send_alert(s,SSL3_AL_FATAL,SSL_AD_UNEXPECTED_MESSAGE);
+				OPENSSL_PUT_ERROR(SSL, ssl3_send_client_key_exchange, SSL_R_UNEXPECTED_MESSAGE);
+				goto err;
+				}
+
 			/* Did we send out the client's
 			 * ECDH share for use in premaster
 			 * computation as part of client certificate?
