google__boringssl
commit bed2214b3ee623f0b817fddb1042f9b0d8735243
Author:     Adam Langley <agl@chromium.org>
AuthorDate: Fri Jun 20 12:00:00 2014 -0700
Commit:     Adam Langley <agl@chromium.org>
CommitDate: Fri Jun 20 13:17:41 2014 -0700

    Fix for CVE-2014-0195
    
    A buffer overrun attack can be triggered by sending invalid DTLS fragments
    to an OpenSSL DTLS client or server. This is potentially exploitable to
    run arbitrary code on a vulnerable client or server.
    
    Fixed by adding consistency check for DTLS fragments.
    
    Thanks to JÃ¼ri Aedla for reporting this issue.
    
    (Imported from upstream's eb6508d50c9a314b88ac155bd378cbd79a117c92)

diff --git a/ssl/d1_both.c b/ssl/d1_both.c
index 597d49bdd..85ea1305d 100644
--- a/ssl/d1_both.c
+++ b/ssl/d1_both.c
@@ -635,7 +635,16 @@ dtls1_reassemble_fragment(SSL *s, struct hm_header_st* msg_hdr, int *ok)
 		frag->msg_header.frag_off = 0;
 		}
 	else
+		{
 		frag = (hm_fragment*) item->data;
+		if (frag->msg_header.msg_len != msg_hdr->msg_len)
+			{
+			item = NULL;
+			frag = NULL;
+			goto err;
+			}
+		}
+
 
 	/* If message is already reassembled, this must be a
 	 * retransmit and can be dropped.
