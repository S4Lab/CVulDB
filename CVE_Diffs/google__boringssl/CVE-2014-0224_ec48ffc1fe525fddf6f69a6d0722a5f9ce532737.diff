google__boringssl
commit ec48ffc1fe525fddf6f69a6d0722a5f9ce532737
Author:     Adam Langley <agl@chromium.org>
AuthorDate: Fri Jun 20 12:00:00 2014 -0700
Commit:     Adam Langley <agl@chromium.org>
CommitDate: Fri Jun 20 13:17:41 2014 -0700

    Additional CVE-2014-0224 protection.
    
    Return a fatal error if an attempt is made to use a zero length
    master secret.
    
    (Imported from upstream's 9d2c9dd1e1a452939a733b638d180bb308ce72a9)

diff --git a/ssl/s3_pkt.c b/ssl/s3_pkt.c
index c295af40e..95e50d6cc 100644
--- a/ssl/s3_pkt.c
+++ b/ssl/s3_pkt.c
@@ -1458,7 +1458,7 @@ int ssl3_do_change_cipher_spec(SSL *s)
 
 	if (s->s3->tmp.key_block == NULL)
 		{
-		if (s->session == NULL) 
+		if (s->session == NULL || s->session->master_key_length == 0)
 			{
 			/* might happen if dtls1_read_bytes() calls this */
 			OPENSSL_PUT_ERROR(SSL, ssl3_do_change_cipher_spec, SSL_R_CCS_RECEIVED_EARLY);
