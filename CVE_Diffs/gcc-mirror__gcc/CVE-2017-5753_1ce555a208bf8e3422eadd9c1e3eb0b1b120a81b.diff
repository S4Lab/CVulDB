gcc-mirror__gcc
commit 1ce555a208bf8e3422eadd9c1e3eb0b1b120a81b
Author:     rearnsha <rearnsha@138bc75d-0d04-0410-961f-82ee72b054a4>
AuthorDate: Tue Nov 6 17:18:37 2018 +0000
Commit:     rearnsha <rearnsha@138bc75d-0d04-0410-961f-82ee72b054a4>
CommitDate: Tue Nov 6 17:18:37 2018 +0000

    aarch64 - Set the mode for the unspec in speculation_tracker insn.
    
    The speculation tracker insn in my recent patch set for CVE-2017-5753
    was missing a mode on the UNSPEC.  Although this didn't break the
    build, it did cause an unnecessary warning from the MD parsing
    mechanism that I missed at the time.  It's a trivial fix, as follows:
    
            * config/aarch64/aarch64.md (speculation_tracker): Set the mode for
            the UNSPEC.
    
    
    git-svn-id: svn+ssh://gcc.gnu.org/svn/gcc/trunk@265849 138bc75d-0d04-0410-961f-82ee72b054a4

diff --git a/gcc/ChangeLog b/gcc/ChangeLog
index 6807a686a14..98ecacf05da 100644
--- a/gcc/ChangeLog
+++ b/gcc/ChangeLog
@@ -1,9 +1,14 @@
+2018-11-06  Richard Earnshaw  <rearnsha@arm.com>
+
+	* config/aarch64/aarch64.md (speculation_tracker): Set the mode for
+	the UNSPEC.
+
 2018-11-06  Richard Biener  <rguenther@suse.de>
 
 	PR tree-optimization/86850
 	* vec.h (vec<T, va_heap, vl_ptr>::splice): Check src.length ()
 	instead of src.m_vec.
- 
+
 2018-11-06  Jan Hubicka  <jh@suse.cz>
 
 	* tree.c (fld_simplified_type_name): Break out form ...
diff --git a/gcc/config/aarch64/aarch64.md b/gcc/config/aarch64/aarch64.md
index ada623bb6f1..82af4d47f78 100644
--- a/gcc/config/aarch64/aarch64.md
+++ b/gcc/config/aarch64/aarch64.md
@@ -6687,7 +6687,7 @@
 ;; SPECULATION_TRACKER_REGNUM is reserved for this purpose when necessary.
 (define_insn "speculation_tracker"
   [(set (reg:DI SPECULATION_TRACKER_REGNUM)
-	(unspec [(reg:DI SPECULATION_TRACKER_REGNUM) (match_operand 0)]
+	(unspec:DI [(reg:DI SPECULATION_TRACKER_REGNUM) (match_operand 0)]
 	 UNSPEC_SPECULATION_TRACKER))]
   ""
   {
