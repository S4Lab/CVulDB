OpenVZ__vzkernel
commit 4d00d6c908adadc6c3a39afaec247ecff168331a
Author:     Eric Dumazet <edumazet@google.com>
AuthorDate: Wed May 17 07:16:40 2017 -0700
Commit:     Konstantin Khorenko <khorenko@virtuozzo.com>
CommitDate: Tue Jun 20 13:46:57 2017 +0400

    ms/sctp: do not inherit ipv6_{mc|ac|fl}_list from parent
    
    SCTP needs fixes similar to 83eaddab4378 ("ipv6/dccp: do not inherit
    ipv6_mc_list from parent"), otherwise bad things can happen.
    
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Reported-by: Andrey Konovalov <andreyknvl@google.com>
    Tested-by: Andrey Konovalov <andreyknvl@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (cherry picked from commit fdcee2cbb8438702ea1b328fb6e0ac5e9a40c7f8)
    
    https://jira.sw.ru/browse/PSBM-66677
    
    fixes CVE-2017-9075 net: sctp_v6_create_accept_sk function mishandles inheritance
    
    Signed-off-by: Evgenii Shatokhin <eshatokhin@virtuozzo.com>
    Signed-off-by: Konstantin Khorenko <khorenko@virtuozzo.com>

diff --git a/net/sctp/ipv6.c b/net/sctp/ipv6.c
index 6f6b5a88e947..ff01d0781b97 100644
--- a/net/sctp/ipv6.c
+++ b/net/sctp/ipv6.c
@@ -672,6 +672,9 @@ static struct sock *sctp_v6_create_accept_sk(struct sock *sk,
 	newnp = inet6_sk(newsk);
 
 	memcpy(newnp, np, sizeof(struct ipv6_pinfo));
+	newnp->ipv6_mc_list = NULL;
+	newnp->ipv6_ac_list = NULL;
+	newnp->ipv6_fl_list = NULL;
 
 	rcu_read_lock();
 	opt = rcu_dereference(np->opt);
