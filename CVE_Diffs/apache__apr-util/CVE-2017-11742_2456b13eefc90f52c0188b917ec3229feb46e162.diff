apache__apr-util
commit 2456b13eefc90f52c0188b917ec3229feb46e162
Author:     Gregg Lewis Smith <gsmith@apache.org>
AuthorDate: Thu Aug 17 19:14:45 2017 +0000
Commit:     Gregg Lewis Smith <gsmith@apache.org>
CommitDate: Thu Aug 17 19:14:45 2017 +0000

    To fix CVE-2017-11742, Expat 2.2.3 has an additional file that must be compiled in Windows.
    https://www.cvedetails.com/cve/CVE-2017-11742/
    
    
    
    git-svn-id: https://svn.apache.org/repos/asf/apr/apr-util/branches/1.6.x@1805330 13f79535-47bb-0310-9956-ffa450edef68

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 43fdf49c..400ac021 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -218,6 +218,7 @@ SET(APR_TEST_SOURCES
 )
 
 SET(EXPAT_SOURCES
+  xml/expat/lib/loadlibrary.c
   xml/expat/lib/xmlrole.c
   xml/expat/lib/xmltok.c
   xml/expat/lib/xmlparse.c
diff --git a/xml/xml.dsp b/xml/xml.dsp
index ab522533..36ff2746 100644
--- a/xml/xml.dsp
+++ b/xml/xml.dsp
@@ -137,6 +137,10 @@ LIB32=link.exe -lib
 # PROP Default_Filter "cpp;c;cxx;rc;def;r;odl;idl;hpj;bat"
 # Begin Source File
 
+SOURCE=.\expat\lib\loadlibrary.c
+# End Source File
+# Begin Source File
+
 SOURCE=.\expat\lib\xmlparse.c
 # End Source File
 # Begin Source File
diff --git a/xml/xml.mak b/xml/xml.mak
index 226a8bf4..8b9d9bf9 100644
--- a/xml/xml.mak
+++ b/xml/xml.mak
@@ -41,6 +41,7 @@ ALL : "$(OUTDIR)\xml.lib"
 CLEAN :
 	-@erase "$(INTDIR)\xml.idb"
 	-@erase "$(INTDIR)\xml.pdb"
+	-@erase "$(INTDIR)\loadlibrary.obj"
 	-@erase "$(INTDIR)\xmlparse.obj"
 	-@erase "$(INTDIR)\xmlrole.obj"
 	-@erase "$(INTDIR)\xmltok.obj"
@@ -90,6 +91,7 @@ BSC32_SBRS= \
 LIB32=link.exe -lib
 LIB32_FLAGS=/nologo /out:"$(OUTDIR)\xml.lib" 
 LIB32_OBJS= \
+	"$(INTDIR)\loadlibrary.obj" \
 	"$(INTDIR)\xmlparse.obj" \
 	"$(INTDIR)\xmlrole.obj" \
 	"$(INTDIR)\xmltok.obj"
@@ -113,6 +115,7 @@ ALL : "$(OUTDIR)\xml.lib"
 CLEAN :
 	-@erase "$(INTDIR)\xml.idb"
 	-@erase "$(INTDIR)\xml.pdb"
+	-@erase "$(INTDIR)\loadlibrary.obj"
 	-@erase "$(INTDIR)\xmlparse.obj"
 	-@erase "$(INTDIR)\xmlrole.obj"
 	-@erase "$(INTDIR)\xmltok.obj"
@@ -162,6 +165,7 @@ BSC32_SBRS= \
 LIB32=link.exe -lib
 LIB32_FLAGS=/nologo /out:"$(OUTDIR)\xml.lib" 
 LIB32_OBJS= \
+	"$(INTDIR)\loadlibrary.obj" \
 	"$(INTDIR)\xmlparse.obj" \
 	"$(INTDIR)\xmlrole.obj" \
 	"$(INTDIR)\xmltok.obj"
@@ -185,6 +189,7 @@ ALL : "$(OUTDIR)\xml.lib"
 CLEAN :
 	-@erase "$(INTDIR)\xml.idb"
 	-@erase "$(INTDIR)\xml.pdb"
+	-@erase "$(INTDIR)\loadlibrary.obj"
 	-@erase "$(INTDIR)\xmlparse.obj"
 	-@erase "$(INTDIR)\xmlrole.obj"
 	-@erase "$(INTDIR)\xmltok.obj"
@@ -234,6 +239,7 @@ BSC32_SBRS= \
 LIB32=link.exe -lib
 LIB32_FLAGS=/nologo /out:"$(OUTDIR)\xml.lib" 
 LIB32_OBJS= \
+	"$(INTDIR)\loadlibrary.obj" \
 	"$(INTDIR)\xmlparse.obj" \
 	"$(INTDIR)\xmlrole.obj" \
 	"$(INTDIR)\xmltok.obj"
@@ -257,6 +263,7 @@ ALL : "$(OUTDIR)\xml.lib"
 CLEAN :
 	-@erase "$(INTDIR)\xml.idb"
 	-@erase "$(INTDIR)\xml.pdb"
+	-@erase "$(INTDIR)\loadlibrary.obj"
 	-@erase "$(INTDIR)\xmlparse.obj"
 	-@erase "$(INTDIR)\xmlrole.obj"
 	-@erase "$(INTDIR)\xmltok.obj"
@@ -306,6 +313,7 @@ BSC32_SBRS= \
 LIB32=link.exe -lib
 LIB32_FLAGS=/nologo /out:"$(OUTDIR)\xml.lib" 
 LIB32_OBJS= \
+	"$(INTDIR)\loadlibrary.obj" \
 	"$(INTDIR)\xmlparse.obj" \
 	"$(INTDIR)\xmlrole.obj" \
 	"$(INTDIR)\xmltok.obj"
@@ -328,6 +336,12 @@ LIB32_OBJS= \
 
 
 !IF "$(CFG)" == "xml - Win32 Release" || "$(CFG)" == "xml - Win32 Debug" || "$(CFG)" == "xml - x64 Release" || "$(CFG)" == "xml - x64 Debug"
+SOURCE=.\expat\lib\loadlibrary.c
+
+"$(INTDIR)\loadlibrary.obj" : $(SOURCE) "$(INTDIR)"
+	$(CPP) $(CPP_PROJ) $(SOURCE)
+
+
 SOURCE=.\expat\lib\xmlparse.c
 
 "$(INTDIR)\xmlparse.obj" : $(SOURCE) "$(INTDIR)"
