openbsd__xenocara
commit 394a8aee5489e0124aaf66b1033db5aed819b177
Author:     matthieu <matthieu@openbsd.org>
AuthorDate: Sat Oct 14 09:32:30 2017 +0000
Commit:     matthieu <matthieu@openbsd.org>
CommitDate: Sat Oct 14 09:32:30 2017 +0000

    MFC: Xi: fix wrong extra length check in ProcXIChangeHierarchy
    (CVE-2017-12178)

diff --git a/xserver/Xi/xichangehierarchy.c b/xserver/Xi/xichangehierarchy.c
index 8d5b577b6..0f96c9164 100644
--- a/xserver/Xi/xichangehierarchy.c
+++ b/xserver/Xi/xichangehierarchy.c
@@ -421,7 +421,7 @@ ProcXIChangeHierarchy(ClientPtr client)
     if (!stuff->num_changes)
         return rc;
 
-    len = ((size_t)stuff->length << 2) - sizeof(xXIAnyHierarchyChangeInfo);
+    len = ((size_t)stuff->length << 2) - sizeof(xXIChangeHierarchyReq);
 
     any = (xXIAnyHierarchyChangeInfo *) &stuff[1];
     while (stuff->num_changes--) {
