openbsd__xenocara
commit dd8e595ee8bfaf197b710b8b1e9d129c1c1ff248
Author:     todd <todd@openbsd.org>
AuthorDate: Wed Apr 4 02:51:26 2007 +0000
Commit:     todd <todd@openbsd.org>
CommitDate: Wed Apr 4 02:51:26 2007 +0000

    fontdir CVE-2007-1352
    
    fonts.dir File Parsing Integer Overflow Vulnerability
    
    The discoverer of this vulnerability wishes to remain anonymous.
    
    from matthieu@

diff --git a/lib/libXfont/src/fontfile/fontdir.c b/lib/libXfont/src/fontfile/fontdir.c
index aae1f2e25..cf68a547c 100644
--- a/lib/libXfont/src/fontfile/fontdir.c
+++ b/lib/libXfont/src/fontfile/fontdir.c
@@ -38,9 +38,17 @@ in this Software without prior written authorization from The Open Group.
 #include    <X11/fonts/fntfilst.h>
 #include    <X11/keysym.h>
 
+#if HAVE_STDINT_H
+#include <stdint.h>
+#elif !defined(INT32_MAX)
+#define INT32_MAX 0x7fffffff
+#endif
+
 Bool
 FontFileInitTable (FontTablePtr table, int size)
 {
+    if (size < 0 || (size > INT32_MAX/sizeof(FontEntryRec))) 
+	return FALSE;
     if (size)
     {
 	table->entries = (FontEntryPtr) xalloc(sizeof(FontEntryRec) * size);
