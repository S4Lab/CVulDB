autotrace__autotrace
commit 0905b2d58112abae2d46ecd673a2267f3efb48a1
Author:     Jaroslav Å karvada <jskarvad@redhat.com>
AuthorDate: Fri Jun 28 11:11:00 2013 +0200
Commit:     Peter Lemenkov <lemenkov@gmail.com>
CommitDate: Sat Oct 12 20:05:15 2013 +0400

    Fixed buffer overflow when parsing BMP files
    
    Resolves: CVE-2013-1953

diff --git a/input-bmp.c b/input-bmp.c
index 0aaf9f2..35ebaeb 100644
--- a/input-bmp.c
+++ b/input-bmp.c
@@ -167,7 +167,7 @@ input_bmp_reader (gchar* filename,
                                                         /* 36 */
       Maps = 4;
     }
-  else if (Bitmap_File_Head.biSize <= 64) /* Probably OS/2 2.x */
+  else if (Bitmap_File_Head.biSize >= 40 && Bitmap_File_Head.biSize <= 64) /* Probably OS/2 2.x */
     {
       if (!ReadOK (fd, buffer, Bitmap_File_Head.biSize - 4))
 	{
