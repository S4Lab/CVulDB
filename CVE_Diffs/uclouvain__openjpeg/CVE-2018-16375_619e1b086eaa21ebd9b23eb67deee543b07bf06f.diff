uclouvain__openjpeg
commit 619e1b086eaa21ebd9b23eb67deee543b07bf06f
Author:     Young_X <YangX92@hotmail.com>
AuthorDate: Fri Nov 23 15:02:26 2018 +0800
Commit:     Young_X <YangX92@hotmail.com>
CommitDate: Fri Nov 23 17:08:56 2018 +0800

    [JPWL] fix CVE-2018-16375
    
    Signed-off-by: Young_X <YangX92@hotmail.com>

diff --git a/src/bin/jpwl/convert.c b/src/bin/jpwl/convert.c
index 73c1be72..04ca64ca 100644
--- a/src/bin/jpwl/convert.c
+++ b/src/bin/jpwl/convert.c
@@ -41,6 +41,7 @@
 #include <stdlib.h>
 #include <string.h>
 #include <ctype.h>
+#include <limits.h>
 
 #ifdef OPJ_HAVE_LIBTIFF
 #include <tiffio.h>
@@ -1862,6 +1863,15 @@ opj_image_t* pnmtoimage(const char *filename, opj_cparameters_t *parameters)
         return NULL;
     }
 
+    /* This limitation could be removed by making sure to use size_t below */
+    if (header_info.height != 0 &&
+            header_info.width > INT_MAX / header_info.height) {
+        fprintf(stderr, "pnmtoimage:Image %dx%d too big!\n",
+                header_info.width, header_info.height);
+        fclose(fp);
+        return NULL;
+    }
+
     format = header_info.format;
 
     switch (format) {
