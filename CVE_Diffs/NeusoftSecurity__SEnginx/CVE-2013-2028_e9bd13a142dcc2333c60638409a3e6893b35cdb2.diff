NeusoftSecurity__SEnginx
commit e9bd13a142dcc2333c60638409a3e6893b35cdb2
Author:     nginx <nginx@nginx.org>
AuthorDate: Tue May 7 11:28:58 2013 +0000
Commit:     Jon Kolb <jon@b0g.us>
CommitDate: Tue May 7 11:28:58 2013 +0000

    Changes with nginx 1.4.1                                         07 May 2013
    
    *) Security: a stack-based buffer overflow might occur in a worker
    process while handling a specially crafted request, potentially
    resulting in arbitrary code execution (CVE-2013-2028); the bug had
    appeared in 1.3.9.
    Thanks to Greg MacManus, iSIGHT Partners Labs.

diff --git a/CHANGES b/CHANGES
index 56aaf478..fd42b20e 100644
--- a/CHANGES
+++ b/CHANGES
@@ -1,4 +1,13 @@
 
+Changes with nginx 1.4.1                                         07 May 2013
+
+    *) Security: a stack-based buffer overflow might occur in a worker
+       process while handling a specially crafted request, potentially
+       resulting in arbitrary code execution (CVE-2013-2028); the bug had
+       appeared in 1.3.9.
+       Thanks to Greg MacManus, iSIGHT Partners Labs.
+
+
 Changes with nginx 1.4.0                                         24 Apr 2013
 
     *) Bugfix: nginx could not be built with the ngx_http_perl_module if the
diff --git a/CHANGES.ru b/CHANGES.ru
index cb961d08..12856d8e 100644
--- a/CHANGES.ru
+++ b/CHANGES.ru
@@ -1,4 +1,13 @@
 
+Изменения в nginx 1.4.1                                           07.05.2013
+
+    *) Безопасность: при обработке специально созданного запроса мог
+       перезаписываться стек рабочего процесса, что могло приводить к
+       выполнению произвольного кода (CVE-2013-2028); ошибка появилась в
+       1.3.9.
+       Спасибо Greg MacManus, iSIGHT Partners Labs.
+
+
 Изменения в nginx 1.4.0                                           24.04.2013
 
     *) Исправление: nginx не собирался с модулем ngx_http_perl_module, если
diff --git a/src/core/nginx.h b/src/core/nginx.h
index fec8b668..6b97454f 100644
--- a/src/core/nginx.h
+++ b/src/core/nginx.h
@@ -9,8 +9,8 @@
 #define _NGINX_H_INCLUDED_
 
 
-#define nginx_version      1004000
-#define NGINX_VERSION      "1.4.0"
+#define nginx_version      1004001
+#define NGINX_VERSION      "1.4.1"
 #define NGINX_VER          "nginx/" NGINX_VERSION
 
 #define NGINX_VAR          "NGINX"
diff --git a/src/http/ngx_http_parse.c b/src/http/ngx_http_parse.c
index 34b3b85d..3c168aaf 100644
--- a/src/http/ngx_http_parse.c
+++ b/src/http/ngx_http_parse.c
@@ -2209,6 +2209,10 @@ data:
 
     }
 
+    if (ctx->size < 0 || ctx->length < 0) {
+        goto invalid;
+    }
+
     return rc;
 
 done:
