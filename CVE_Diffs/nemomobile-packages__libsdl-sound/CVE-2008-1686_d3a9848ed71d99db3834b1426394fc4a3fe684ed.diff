nemomobile-packages__libsdl-sound
commit d3a9848ed71d99db3834b1426394fc4a3fe684ed
Author:     Ryan C. Gordon <icculus@icculus.org>
AuthorDate: Fri Apr 11 19:53:57 2008 +0000
Commit:     Ryan C. Gordon <icculus@icculus.org>
CommitDate: Fri Apr 11 19:53:57 2008 +0000

    Check if Speex header has bogus data (CVE-2008-1686).

diff --git a/CHANGELOG b/CHANGELOG
index afa5506..df8ded3 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -2,6 +2,7 @@
  * CHANGELOG.
  */
 
+04112008 - Check if Speex header has bogus data (CVE-2008-1686).
 08062007 - Updated my email address. Added -fvisibility=hidden support.
 07152007 - Minor correction in Timidity resampling code (Thanks, Sam!).
 07062007 - Fixed uninitialized buffer in mpglib. (Thanks, Phil!).
diff --git a/decoders/speex.c b/decoders/speex.c
index 5b5450a..f313945 100644
--- a/decoders/speex.c
+++ b/decoders/speex.c
@@ -136,6 +136,7 @@ static int process_header(speex_t *speex, Sound_Sample *sample)
     free(hptr);  /* lame that this forces you to malloc... */
 
     BAIL_IF_MACRO(header.mode >= SPEEX_NB_MODES, "SPEEX: Unknown mode", 0);
+    BAIL_IF_MACRO(header.mode < 0, "SPEEX: Unknown mode", 0);
     mode = speex_mode_list[header.mode];
     BAIL_IF_MACRO(header.speex_version_id > 1, "SPEEX: Unknown version", 0);
     BAIL_IF_MACRO(mode->bitstream_version < header.mode_bitstream_version,
