brong__cyrus-imapd
commit 0f8f026699829b65733c3081657b24e2174f4f4d
Author:     Bron Gondwana <brong@opera.com>
AuthorDate: Thu Sep 8 19:57:38 2011 +0200
Commit:     Bron Gondwana <brong@opera.com>
CommitDate: Thu Sep 8 20:58:20 2011 +0200

    CVE-2011-3208 - fix buffer overflow in nntpd

diff --git a/imap/nntpd.c b/imap/nntpd.c
index e184c2002..d2e122d46 100644
--- a/imap/nntpd.c
+++ b/imap/nntpd.c
@@ -4165,7 +4165,9 @@ static struct wildmat *split_wildmats(char *str)
 	else if (*c == '@') wild[n].not = -1;	/* absolute not (feeding) */
 	else wild[n].not = 0;
 
-	strcpy(p, wild[n].not ? c + 1 : c);
+	strncpy(p, wild[n].not ? c + 1 : c, pattern+sizeof(pattern) - p);
+	pattern[sizeof(pattern)-1] = '\0';
+
 	wild[n++].pat = xstrdup(pattern);
     } while (c != str);
     wild[n].pat = NULL;
