AOKP__system_core_old
commit 80b0162910f5190b237bb1811ad21f180477bf35
Author:     Vernon Tang <vt@foilhead.net>
AuthorDate: Mon Apr 25 03:13:44 2011 +1000
Commit:     Vernon Tang <vt@foilhead.net>
CommitDate: Thu Apr 28 05:16:47 2011 +1000

    libsysutils: only accept uevents from the kernel.
    
    Addresses CVE-2011-1823.
    
    Change-Id: I393c21da749a6a6491d6719767bc1ff3df647ebe

diff --git a/libsysutils/src/NetlinkListener.cpp b/libsysutils/src/NetlinkListener.cpp
index e2a354e..886899e 100644
--- a/libsysutils/src/NetlinkListener.cpp
+++ b/libsysutils/src/NetlinkListener.cpp
@@ -21,6 +21,7 @@
 
 #define LOG_TAG "NetlinkListener"
 #include <cutils/log.h>
+#include <cutils/uevent.h>
 
 #include <sysutils/NetlinkListener.h>
 #include <sysutils/NetlinkEvent.h>
@@ -34,7 +35,7 @@ bool NetlinkListener::onDataAvailable(SocketClient *cli)
     int socket = cli->getSocket();
     int count;
 
-    if ((count = recv(socket, mBuffer, sizeof(mBuffer), 0)) < 0) {
+    if ((count = uevent_checked_recv(socket, mBuffer, sizeof(mBuffer))) < 0) {
         SLOGE("recv failed (%s)", strerror(errno));
         return false;
     }
