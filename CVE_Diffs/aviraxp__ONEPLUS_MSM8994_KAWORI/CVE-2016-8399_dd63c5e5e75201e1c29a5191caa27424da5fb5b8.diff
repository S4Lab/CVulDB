aviraxp__ONEPLUS_MSM8994_KAWORI
commit dd63c5e5e75201e1c29a5191caa27424da5fb5b8
Author:     Ravi Kumar Siddojigari <rsiddoji@codeaurora.org>
AuthorDate: Wed Nov 23 16:57:47 2016 +0530
Commit:     Wang Han <416810799@qq.com>
CommitDate: Wed Apr 26 07:36:26 2017 -0700

    net: add additional args validation in ping_common_sendmsg()
    
    adding  validation of the len variable in ping_common_sendmsg()
    to check if it is less than icmph_len which canleading to
    an overflow issue.
    
    Addressing issue reported under CVE-2016-8399.
    
    Change-Id: I98f7b070b41312832b6a347ea1c11b9c700159a7
    Signed-off-by: Ravi Kumar Siddojigari <rsiddoji@codeaurora.org>

diff --git a/net/ipv4/ping.c b/net/ipv4/ping.c
index f8c8f60ad7e..aaa70dd6666 100644
--- a/net/ipv4/ping.c
+++ b/net/ipv4/ping.c
@@ -651,7 +651,7 @@ int ping_common_sendmsg(int family, struct msghdr *msg, size_t len,
 			void *user_icmph, size_t icmph_len) {
 	u8 type, code;
 
-	if (len > 0xFFFF)
+	if (len > 0xFFFF || len < icmph_len)
 		return -EMSGSIZE;
 
 	/*
