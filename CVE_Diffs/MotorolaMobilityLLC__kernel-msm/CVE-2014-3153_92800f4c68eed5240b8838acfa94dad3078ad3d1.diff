MotorolaMobilityLLC__kernel-msm
commit 92800f4c68eed5240b8838acfa94dad3078ad3d1
Author:     WANG XING <Raymond.Wangxing@huawei.com>
AuthorDate: Thu Jun 18 20:29:21 2015 +0800
Commit:     Zhao Xuewen <zhaoxuewen@huawei.com>
CommitDate: Tue Jul 7 17:52:18 2015 -0700

    futex: remove redundant code
    
    Patch for CVE-2014-3153 was merged twice: ff645d04 and 44aeb7d8
    remove redundant code.
    
    DTS2015061803692
    
    Change-Id: Ib2a257842e543b5f8fad00ce05d5ab9e32e4bcac
    Signed-off-by: w00228870 <w00228870@notesmail.huawei.com>

diff --git a/kernel/futex.c b/kernel/futex.c
index 1d552e471ab7..f0239de5f4e4 100644
--- a/kernel/futex.c
+++ b/kernel/futex.c
@@ -2453,15 +2453,6 @@ static int futex_wait_requeue_pi(u32 __user *uaddr, unsigned int flags,
 		goto out_put_keys;
 	}
 
-	/*
-	 * The check above which compares uaddrs is not sufficient for
-	 * shared futexes. We need to compare the keys:
-	 */
-	if (match_futex(&q.key, &key2)) {
-		ret = -EINVAL;
-		goto out_put_keys;
-	}
-
 	/* Queue the futex_q, drop the hb lock, wait for wakeup. */
 	futex_wait_queue_me(hb, &q, to);
 
