MotorolaMobilityLLC__kernel-msm
commit e5ca1646b8944f8d831ced11891a0273156c9830
Author:     Vineet Angadi V <vineetv@motorola.com>
AuthorDate: Thu Nov 10 14:57:47 2016 +0530
Commit:     a7301c <a7301c@motorola.com>
CommitDate: Mon Nov 21 09:47:22 2016 -0600

    net: ipv4: validate len variable to prevent overflow
    
    There is no validation of the len variable passed to the
    ping_common_sendmsg function to check if it is less than
    icmph_len leading to a potential overflow.The fix is designed to add
    additional validation to prevent the potential overflow.
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2016-8399
    
    Change-Id: Ia8c945e50e712d73ff8dcd584f286bdd2fcfa6e3
    Signed-off-by: Vineet Angadi V <vineetv@motorola.com>
    Reviewed-on: https://gerrit.mot.com/919016
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Vijayakumar Gn <vijaygn@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/net/ipv4/ping.c b/net/ipv4/ping.c
index f8c8f60ad7e2..aaa70dd66667 100644
--- a/net/ipv4/ping.c
+++ b/net/ipv4/ping.c
@@ -651,7 +651,7 @@ int ping_common_sendmsg(int family, struct msghdr *msg, size_t len,
 			void *user_icmph, size_t icmph_len) {
 	u8 type, code;
 
-	if (len > 0xFFFF)
+	if (len > 0xFFFF || len < icmph_len)
 		return -EMSGSIZE;
 
 	/*
