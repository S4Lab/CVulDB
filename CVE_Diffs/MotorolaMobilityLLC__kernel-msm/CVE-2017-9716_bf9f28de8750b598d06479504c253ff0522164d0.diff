MotorolaMobilityLLC__kernel-msm
commit bf9f28de8750b598d06479504c253ff0522164d0
Author:     Abir Ghosh <abirg@codeaurora.org>
AuthorDate: Tue May 2 22:41:06 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Tue Dec 19 20:33:56 2017 -0600

    qbt1000: Validate FP app name before qseecom_start_app
    
    Validate the name of the client app before passing it to
    qseecom_start_app.
    
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2017-9716
    CRs-Fixed: 2006695
    
    Change-Id: I9c6b16050d4f6fc94827021c7b0f2ab292452f60
    Signed-off-by: Abir Ghosh <abirg@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/1068469
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    Reviewed-on: https://gerrit.mot.com/1104555
    Tested-by: Jira Key
    Reviewed-by: Amarendra Reddy <amarenr@motorola.com>
    Reviewed-by: Sindhu C <a12924@motorola.com>
    SLTApproved: Sindhu C <a12924@motorola.com>

diff --git a/drivers/soc/qcom/qbt1000.c b/drivers/soc/qcom/qbt1000.c
index 43acd86735fe..e2609d2bb5b1 100644
--- a/drivers/soc/qcom/qbt1000.c
+++ b/drivers/soc/qcom/qbt1000.c
@@ -60,6 +60,7 @@ enum sensor_connection_types {
  * user space will provide new value upon tz app load
  */
 static uint32_t g_app_buf_size = SZ_256K;
+static char const *const FP_APP_NAME = "fingerpr";
 
 struct qbt1000_drvdata {
 	struct class	*qbt1000_class;
@@ -793,6 +794,13 @@ static long qbt1000_ioctl(struct file *file, unsigned cmd, unsigned long arg)
 			goto end;
 		}
 
+		if (strcmp(app.name, FP_APP_NAME)) {
+			dev_err(drvdata->dev, "%s: Invalid app name\n",
+				__func__);
+			rc = -EINVAL;
+			goto end;
+		}
+
 		app.name[MAX_NAME_SIZE - 1] = '\0';
 
 		/* start the TZ app */
