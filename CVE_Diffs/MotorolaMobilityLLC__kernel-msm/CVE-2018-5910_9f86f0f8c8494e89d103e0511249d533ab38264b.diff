MotorolaMobilityLLC__kernel-msm
commit 9f86f0f8c8494e89d103e0511249d533ab38264b
Author:     Harsh Sahu <hsahu@codeaurora.org>
AuthorDate: Fri Jun 1 17:27:40 2018 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Mon Aug 13 03:33:24 2018 -0500

    fbdev: msm: check buffer size before writing to user buffer
    
    Check the number of bytes to copy against the size of the
    user buffer before copy to user to avoid buffer overflow.
    
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2018-5910
    CRs-Fixed: 2175499
    
    Change-Id: Icdd3d4e755deca19fa431e903620bd9e4c701c89
    Signed-off-by: Harsh Sahu <hsahu@codeaurora.org>
    Signed-off-by: Jignesh Patel <jignesh@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1184766
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit b8e309ca7498a12d1403c4c227112cff2561093b)

diff --git a/drivers/video/fbdev/msm/mdss_debug_xlog.c b/drivers/video/fbdev/msm/mdss_debug_xlog.c
index 99f50122becc..c58588e3df84 100644
--- a/drivers/video/fbdev/msm/mdss_debug_xlog.c
+++ b/drivers/video/fbdev/msm/mdss_debug_xlog.c
@@ -1,4 +1,4 @@
-/* Copyright (c) 2014-2017, The Linux Foundation. All rights reserved.
+/* Copyright (c) 2014-2018, The Linux Foundation. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -1084,6 +1084,11 @@ static ssize_t mdss_xlog_dump_read(struct file *file, char __user *buff,
 	mutex_lock(&mdss_dbg_xlog.xlog_lock);
 	if (__mdss_xlog_dump_calc_range()) {
 		len = mdss_xlog_dump_entry(xlog_buf, MDSS_XLOG_BUF_MAX);
+		if (len < 0 || len > count) {
+			pr_err("len is more than the size of user buffer\n");
+			return 0;
+		}
+
 		if (copy_to_user(buff, xlog_buf, len)) {
 			mutex_unlock(&mdss_dbg_xlog.xlog_lock);
 			return -EFAULT;
