MotorolaMobilityLLC__kernel-msm
commit addc909aedb4aef434293a7df428118ca7ceee0c
Author:     Siva Kumar Akkireddi <sivaa@codeaurora.org>
AuthorDate: Thu Jul 5 10:55:32 2018 +0530
Commit:     chenyt9 <chenyt9@lenovo.com>
CommitDate: Tue Dec 10 15:03:48 2019 +0800

    msm: sps: Suppress bind/unbind attributes
    
    SPS driver does not support manual bind/unbind operations
    through sysfs. Suppress the bind/unbind nodes. Do not free
    SPS struct in sps_device_de_init since it is being done in
    sps_exit, and also to avoid use-after-free.
    
    Mot-CRs-fixed: (CR)
    CVE-Fixed:  CVE-2018-11960
    CRs-Fixed: 2264832
    BUG: 114042002
    
    Change-Id: If6da6c5fb9d1a44d0420c6151f7f9d0a33cb2d04
    Signed-off-by: Siva Kumar Akkireddi <sivaa@codeaurora.org>
    Signed-off-by: Jignesh Patel <jignesh@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1271804
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Ling Jin <lingjin@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/platform/msm/sps/sps.c b/drivers/platform/msm/sps/sps.c
index 03cc14aa7e29..2237db198c53 100644
--- a/drivers/platform/msm/sps/sps.c
+++ b/drivers/platform/msm/sps/sps.c
@@ -1,4 +1,4 @@
-/* Copyright (c) 2011-2017, The Linux Foundation. All rights reserved.
+/* Copyright (c) 2011-2018, The Linux Foundation. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -1006,8 +1006,6 @@ static void sps_device_de_init(void)
 				"sps:%s:BAMs are still registered", __func__);
 
 		sps_map_de_init();
-
-		kfree(sps);
 	}
 
 	sps_mem_de_init();
@@ -2989,6 +2987,7 @@ static struct platform_driver msm_sps_driver = {
 		.name	= SPS_DRV_NAME,
 		.owner	= THIS_MODULE,
 		.of_match_table = msm_sps_match,
+		.suppress_bind_attrs = true,
 	},
 	.remove		= msm_sps_remove,
 };
