MotorolaMobilityLLC__kernel-msm
commit 52a15f6da59d17f976ae28a0ad7172bec2d439a6
Author:     Tharun Kumar Merugu <mtharu@codeaurora.org>
AuthorDate: Thu Dec 21 17:21:14 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Sat Feb 3 02:35:59 2018 -0600

    msm: ADSPRPC: validate user buffers after copying from user
    
    validate user buffers before accessing in kernel driver.
    
    CVE-fixed: CVE-2017-15848
    Mot-CRs-fixed: (CR)
    Bug-Id: A-67713083
    CRs-Fixed: 2073777
    Change-Id: I7997d069d0549de03f1467c63bdb81b20fcf3d6c
    Acked-by: Chenna Kesava Raju <chennak@qti.qualcomm.com>
    Signed-off-by: Tharun Kumar Merugu <mtharu@codeaurora.org>
    
    Signed-off-by: Neeraj Kumar <neerajk@motorola.com>
    --
    
    Change-Id: I43d8eca63282d63fd3ba63dc54d19a800ee66fa0
    Reviewed-on: https://gerrit.mot.com/1107903
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Yuesheng Huang <huangys@motorola.com>
    Reviewed-by: Konstantin Makariev <kmakariev@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/char/adsprpc.c b/drivers/char/adsprpc.c
index c75f54a390ed..65130d9b4457 100644
--- a/drivers/char/adsprpc.c
+++ b/drivers/char/adsprpc.c
@@ -2088,6 +2088,10 @@ static long fastrpc_device_ioctl(struct file *file, unsigned int ioctl_num,
 						sizeof(p.init)));
 		if (err)
 			goto bail;
+		VERIFY(err, p.init.filelen >= 0 &&
+			p.init.memlen >= 0);
+		if (err)
+			goto bail;
 		VERIFY(err, 0 == fastrpc_init_process(fl, &p.init));
 		if (err)
 			goto bail;
