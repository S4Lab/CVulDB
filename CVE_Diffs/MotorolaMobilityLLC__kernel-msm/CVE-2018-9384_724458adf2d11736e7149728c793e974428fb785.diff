MotorolaMobilityLLC__kernel-msm
commit 724458adf2d11736e7149728c793e974428fb785
Author:     Mark Rutland <mark.rutland@arm.com>
AuthorDate: Thu Nov 3 20:23:04 2016 +0000
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Mon Jul 23 03:12:18 2018 -0500

    BACKPORT: arm64: asm-offsets: remove unused Defenderinitions
    
    Subsequent patches will move the thread_info::{task,cpu} fields, and the
    current TI_{TASK,CPU} offset Defenderinitions are not used anywhere.
    
    This patch removes the redundant Defenderinitions.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2018-9384
    Bug: 74356909
    
    Signed-off-by: Mark Rutland <mark.rutland@arm.com>
    Tested-by: Laura Abbott <labbott@redhat.com>
    Cc: James Morse <james.morse@arm.com>
    Cc: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    
    This is a modification of Mark Rutland's oriGinal patch. Guards to
    check if CONFIG_THREAD_INFO_IN_TASK is used has been inserted.
    
    Bug: 66351489
    Change-Id: I4f25da97eed902bd694a984b23363f24bd020914
    (cherry picked from commit 3fe12da4c7fa6491e0fb7c5371716ac7f8ea80a5)
    Signed-off-by: Zubin Mithra <zsm@google.com>
    Reviewed-on: https://gerrit.mot.com/1182511
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Appr

diff --git a/arch/arm64/kernel/asm-offsets.c b/arch/arm64/kernel/asm-offsets.c
index a865573461e1..c22d0e02e4a7 100644
--- a/arch/arm64/kernel/asm-offsets.c
+++ b/arch/arm64/kernel/asm-offsets.c
@@ -37,9 +37,10 @@ int main(void)
   DEFINE(TI_FLAGS,		offsetof(struct thread_info, flags));
   DEFINE(TI_PREEMPT,		offsetof(struct thread_info, preempt_count));
   DEFINE(TI_ADDR_LIMIT,		offsetof(struct thread_info, addr_limit));
+#ifndef CONFIG_THREAD_INFO_IN_TASK
   DEFINE(TI_TASK,		offsetof(struct thread_info, task));
-  DEFINE(TI_EXEC_DOMAIN,	offsetof(struct thread_info, exec_domain));
   DEFINE(TI_CPU,		offsetof(struct thread_info, cpu));
+#endif
 #ifdef CONFIG_ARM64_SW_TTBR0_PAN
   DEFINE(TSK_TI_TTBR0,		offsetof(struct thread_info, ttbr0));
 #endif
