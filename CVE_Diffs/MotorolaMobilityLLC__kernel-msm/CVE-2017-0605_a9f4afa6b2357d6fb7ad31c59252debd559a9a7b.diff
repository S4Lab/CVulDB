MotorolaMobilityLLC__kernel-msm
commit a9f4afa6b2357d6fb7ad31c59252debd559a9a7b
Author:     Amey Telawane <ameyt@codeaurora.org>
AuthorDate: Thu Apr 6 14:54:27 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Jul 27 00:42:31 2017 -0500

    trace: resolve stack corruption due to string copy
    
    Strcpy has no limit on string being copied which causes
    stack corruption leading to kernel panic. Use strlcpy to
    resolve the issue by providing length of string to be copied.
    
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2017-0605
    Bug: 35399704
    CRs-fixed: 1048480
    
    Change-Id: I69626a3a5ca547b8c9040559843b983260754398
    Signed-off-by: Amey Telawane <ameyt@codeaurora.org>
    Signed-off-by: Amarendra Reddy <amarenr@motorola.com>
    Reviewed-on: https://gerrit.mot.com/974732
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/kernel/trace/trace.c b/kernel/trace/trace.c
index 445f12467b6b..b12e6adc37a9 100644
--- a/kernel/trace/trace.c
+++ b/kernel/trace/trace.c
@@ -1551,7 +1551,7 @@ static void __trace_find_cmdline(int pid, char comm[])
 
 	map = savedcmd->map_pid_to_cmdline[pid];
 	if (map != NO_CMDLINE_MAP)
-		strcpy(comm, get_saved_cmdlines(map));
+		strlcpy(comm, get_saved_cmdlines(map), TASK_COMM_LEN-1);
 	else
 		strcpy(comm, "<...>");
 }
