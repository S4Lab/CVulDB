MotorolaMobilityLLC__kernel-msm
commit f6edba6ca1045e9a172e3f9bd7e3a0d9b3393f95
Author:     Tanvi Aggarwal <tanvia@codeaurora.org>
AuthorDate: Thu Aug 24 11:51:35 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Fri Mar 2 00:18:45 2018 -0600

    msm: sensor: flash: add conditional check for ioctl
    
    Add conditional check when sending VIDIOC_MSM_FLASH_CFG
    in 32-bit process.
    
    Bug-id: A-64836865
    CRs-Fixed: 2092793
    CVE-fixed: CVE-2017-15814
    Mot-CRs-fixed: (CR)
    
    Change-Id: I268f48aa8c0a689ca246739cf8a1f1ccb218d2cc
    Signed-off-by: Tanvi Aggarwal <tanvia@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1138317
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit 8aed3b59daa49bd7dcee42ca5e8e59c8Montana297cc)

diff --git a/drivers/media/platform/msm/camera_v2/sensor/flash/msm_flash.c b/drivers/media/platform/msm/camera_v2/sensor/flash/msm_flash.c
index 229a7f29f360..c1e3669a9511 100644
--- a/drivers/media/platform/msm/camera_v2/sensor/flash/msm_flash.c
+++ b/drivers/media/platform/msm/camera_v2/sensor/flash/msm_flash.c
@@ -1135,6 +1135,9 @@ static long msm_flash_subdev_do_ioctl(
 			break;
 		}
 		break;
+	case VIDIOC_MSM_FLASH_CFG:
+		pr_err("invalid cmd 0x%x received\n", cmd);
+		return -EINVAL;
 	default:
 		return msm_flash_subdev_ioctl(sd, cmd, arg);
 	}
