MotorolaMobilityLLC__kernel-msm
commit c3aff4daa473c63fd6c5c48c631aff01ab1113d1
Author:     Ashwin Pathmudi <jfxr63@motorola.com>
AuthorDate: Fri Nov 11 03:44:24 2016 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Wed Jan 11 02:30:14 2017 -0600

    IKSECURITY-1744: fbdev: Validate to->start variable
    
    There is no validation of the to->start variable to check
    if it is negative leading to a potential information
    disclosure. This fix is designed to add additional
    validation to prevent the potential information disclosure.
    
    CVE-Fixed: CVE-2016-8405
    
    Change-Id: I63d65e422698e0a09a451a43c13306a7e2d0f21d
    Signed-off-by: Ashwin Pathmudi <jfxr63@motorola.com>
    Reviewed-on: https://gerrit.mot.com/921216
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>
    (cherry picked from commit 0e4bc86eb4625e13366fa231c4b58a7c52d01a39)

diff --git a/drivers/video/fbdev/core/fbcmap.c b/drivers/video/fbdev/core/fbcmap.c
index 6bf80e43cac5..af4b267febe7 100644
--- a/drivers/video/fbdev/core/fbcmap.c
+++ b/drivers/video/fbdev/core/fbcmap.c
@@ -190,6 +190,9 @@ int fb_cmap_to_user(const struct fb_cmap *from, struct fb_cmap_user *to)
 	int tooff = 0, fromoff = 0;
 	int size;
 
+	if (!to || !from || (int)(to->start) < 0)
+		return -EINVAL;
+
 	if (to->start > from->start)
 		fromoff = to->start - from->start;
 	else
