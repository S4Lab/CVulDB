MotorolaMobilityLLC__kernel-msm
commit 4c4e90a608d0d8e89f0360fde5b37cb7eb6d12b0
Author:     Suman Mukherjee <sumam@codeaurora.org>
AuthorDate: Thu Sep 29 03:49:05 2016 +0000
Commit:     Carlos Pinho <cpinho@motorola.com>
CommitDate: Thu Mar 16 14:52:31 2017 -0500

    msm: camera: cpp: Add validation for v4l2 ioctl arguments
    
    In CPP v4l2 ioctl command is made, if _IOC_DIR(cmd) is
    _IOC_NONE, then the user-supplied argument arg is not checked
    and an information disclosure is possible
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2016-6756
    
    Change-Id: Iddb291b10cdcb5c42ab8497e06c2ce47885cd5ab
    Signed-off-by: Suman Mukherjee <sumam@codeaurora.org>
    Signed-off-by: Sunid Wilson <sunidw@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/918769
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c b/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
index ca97b73a9f5d..c363b13ea4e0 100644
--- a/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
+++ b/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
@@ -1913,6 +1913,10 @@ long msm_cpp_subdev_ioctl(struct v4l2_subdev *sd,
 		pr_err("cpp_dev is null\n");
 		return -EINVAL;
 	}
+	if (_IOC_DIR(cmd) == _IOC_NONE) {
+		pr_err("Invalid ioctl/subdev cmd %u", cmd);
+		return -EINVAL;
+	}
 	mutex_lock(&cpp_dev->mutex);
 	CPP_DBG("E cmd: 0x%x\n", cmd);
 	switch (cmd) {
