MotorolaMobilityLLC__kernel-msm
commit 89570436d67529dd2361ecfd0289b5d29c7f4176
Author:     Rashi Bindra <rbindra@codeaurora.org>
AuthorDate: Mon Mar 19 14:07:27 2018 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Fri Aug 17 05:17:20 2018 -0500

    msm: mdss: Fix for wrong length in copy_to_user
    
    The caller could have a small buf passed (less then < blen).
    Since, the length of count and blen is not checked, it can
    write beyond the end of buf.
    
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2018-5908
    CRs-Fixed: 2171758
    
    Change-Id: I9138cd742b6166937f3cc1cbf1af36f280c94bdb
    Signed-off-by: Rashi Bindra <rbindra@codeaurora.org>
    Signed-off-by: Jignesh Patel <jignesh@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1185495
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Bang Nguyen <bangnguyen@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit 119265addf98c1a35e246e1f29c4523cfd156976)

diff --git a/drivers/video/msm/mdss/mdss_dsi.c b/drivers/video/msm/mdss/mdss_dsi.c
index 3f701280402a..f99800ed39f0 100644
--- a/drivers/video/msm/mdss/mdss_dsi.c
+++ b/drivers/video/msm/mdss/mdss_dsi.c
@@ -747,7 +747,7 @@ static ssize_t mdss_dsi_cmd_state_read(struct file *file, char __user *buf,
 	if (blen < 0)
 		return 0;
 
-	if (copy_to_user(buf, buffer, blen))
+	if (copy_to_user(buf, buffer, min(count, (size_t)blen+1)))
 		return -EFAULT;
 
 	*ppos += blen;
