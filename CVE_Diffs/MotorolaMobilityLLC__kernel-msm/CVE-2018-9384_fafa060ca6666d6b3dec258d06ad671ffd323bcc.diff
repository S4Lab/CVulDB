MotorolaMobilityLLC__kernel-msm
commit fafa060ca6666d6b3dec258d06ad671ffd323bcc
Author:     Andy Lutomirski <luto@kernel.org>
AuthorDate: Thu Jul 28 15:48:20 2016 -0700
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Jun 14 06:06:34 2018 -0500

    UPSTREAM: kdb: use task_cpu() instead of task_thread_info()->cpu
    
    We'll need this cleanup to make the cpu field in thread_info be
    optional.
    
    Link: http://lkml.kernel.org/r/da298328dc77ea494576c2f20a934218e758a6fa.1468523549.git.luto@kernel.org
    Signed-off-by: Perry Lutomirski <luto@kernel.org>
    Cc: Jason Wessel <jason.wessel@windriver.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2018-9384
    Bug: 74356909
    
    Bug: 66351489
    Change-Id: I1d998cc2dcff49056aa4d1bb7bbe78d35e334f51
    (cherry picked from commit e558af65be65713ef2e8b2aa637c6263caeed172)
    Signed-off-by: Zubin Mithra <zsm@google.com>
    Reviewed-on: https://gerrit.mot.com/1182371
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit 654e2759d926f287d254555524ec22da30914cc4)

diff --git a/include/linux/kdb.h b/include/linux/kdb.h
index a19bcf9e762e..410decacff8f 100644
--- a/include/linux/kdb.h
+++ b/include/linux/kdb.h
@@ -177,7 +177,7 @@ extern int kdb_get_kbd_char(void);
 static inline
 int kdb_process_cpu(const struct task_struct *p)
 {
-	unsigned int cpu = task_thread_info(p)->cpu;
+	unsigned int cpu = task_cpu(p);
 	if (cpu > num_possible_cpus())
 		cpu = 0;
 	return cpu;
