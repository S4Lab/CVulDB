MotorolaMobilityLLC__kernel-msm
commit 15a0a3a2a5edc22efa98fcf93a4ea359988d41b4
Author:     Walter Yang <yandongy@codeaurora.org>
AuthorDate: Thu May 11 14:13:26 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Tue Jun 6 03:06:29 2017 -0500

    ASoC: Add backend user count checking
    
    Add backend user count checking to protect the index
    boundary.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-7369
    Bug-Id: A-33751424
    Change-Id: Ic1b61d1f7130252cc54da0b16553858714988dbd
    CRs-Fixed: 2009216
    Signed-off-by: Walter Yang <yandongy@codeaurora.org>
    --
    Reviewed-on: https://gerrit.mot.com/993084
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/sound/soc/soc-compress.c b/sound/soc/soc-compress.c
index 4300fe35882a..add5b9776fc0 100644
--- a/sound/soc/soc-compress.c
+++ b/sound/soc/soc-compress.c
@@ -569,6 +569,11 @@ static int soc_compr_set_params_fe(struct snd_compr_stream *cstream,
 				cstream, &async_domain);
 			} else {
 				be_list[j++] = be;
+				if (j == DPCM_MAX_BE_USERS) {
+					dev_dbg(fe->dev,
+						"ASoC: MAX backend users!\n");
+					break;
+				}
 			}
 		}
 		for (i = 0; i < j; i++) {
diff --git a/sound/soc/soc-pcm.c b/sound/soc/soc-pcm.c
index 0e928a7fcec4..8206c3f0b9b7 100644
--- a/sound/soc/soc-pcm.c
+++ b/sound/soc/soc-pcm.c
@@ -1845,6 +1845,10 @@ void dpcm_be_dai_prepare_async(struct snd_soc_pcm_runtime *fe, int stream,
 							    dpcm, domain);
 		} else {
 			dpcm_async[i++] = dpcm;
+			if (i == DPCM_MAX_BE_USERS) {
+				dev_dbg(fe->dev, "ASoC: MAX backend users!\n");
+				break;
+			}
 		}
 	}
 
