MotorolaMobilityLLC__kernel-msm
commit 646096fc523369903d8e1e01a77f92077638ad84
Author:     Andy Lutomirski <luto@kernel.org>
AuthorDate: Thu Jul 28 15:48:23 2016 -0700
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Jun 14 06:06:22 2018 -0500

    UPSTREAM: printk: when dumping regs, show the stack, not thread_info
    
    We currently show:
    
      task: <current> ti: <current_thread_info()> task.ti: <task_thread_info(current)>"
    
    "ti" and "task.ti" are redundant, and neither is actually what we want
    to show, which the the base of the thread stack.  Change the display to
    show the stack pointer explicitly.
    
    Link: http://lkml.kernel.org/r/543ac5bd66ff94000a57a02e11af7239571a3055.1468523549.git.luto@kernel.org
    Signed-off-by: Perry Lutomirski <luto@kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2018-9384
    Bug: 74356909
    Bug: 66351489
    Change-Id: I172c2a63b178bcf1a7114cc2476a8d7a34c703d6
    (cherry picked from commit 8b70ca65616b3588ea1907e87f0df6d2530350df)
    Signed-off-by: Zubin Mithra <zsm@google.com>
    Reviewed-on: https://gerrit.mot.com/1182352
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit ebdffe2e6b90b347fe5b495b15cac3226302cd58)

diff --git a/kernel/printk/printk.c b/kernel/printk/printk.c
index e03ae90b1179..c78a6625f7e6 100644
--- a/kernel/printk/printk.c
+++ b/kernel/printk/printk.c
@@ -3193,9 +3193,8 @@ void show_regs_print_info(const char *log_lvl)
 {
 	dump_stack_print_info(log_lvl);
 
-	printk("%stask: %p ti: %p task.ti: %p\n",
-	       log_lvl, current, current_thread_info(),
-	       task_thread_info(current));
+	printk("%stask: %p task.stack: %p\n",
+	       log_lvl, current, task_stack_page(current));
 }
 
 #endif
