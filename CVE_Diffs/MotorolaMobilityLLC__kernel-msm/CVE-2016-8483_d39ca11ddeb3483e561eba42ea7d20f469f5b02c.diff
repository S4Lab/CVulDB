MotorolaMobilityLLC__kernel-msm
commit d39ca11ddeb3483e561eba42ea7d20f469f5b02c
Author:     Mohammed Khajapasha <mkhaja@codeaurora.org>
AuthorDate: Tue Feb 14 17:25:03 2017 +0530
Commit:     Amarendra Reddy <amarenr@motorola.com>
CommitDate: Fri Feb 17 00:08:28 2017 -0600

    msm-core: use get_user() API to read userspace data/settings
    
    Currently userspace data is getting accessed directly
    and leading to crash, So use get_user() API to copy
    userspace data/settings to kernel space.
    
    Mot-CRs-fixed:(CR)
    CVE-Fixed:CVE-2016-8483
    Bug:33745862
    CRs-Fixed:1035099
    
    Change-Id: I3a75ec9503d8207829640bf88e1c3160bf72c9f0
    Signed-off-by: Mohammed Khajapasha <mkhaja@codeaurora.org>
    Signed-off-by: Amarendra Reddy <amarenr@motorola.com>
    Reviewed-on: https://gerrit.mot.com/950784
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/power/qcom/msm-core.c b/drivers/power/qcom/msm-core.c
index a20e73f3a722..abf764f84303 100644
--- a/drivers/power/qcom/msm-core.c
+++ b/drivers/power/qcom/msm-core.c
@@ -453,13 +453,15 @@ static long msm_core_ioctl(struct file *file, unsigned int cmd,
 	int i, cpu = num_possible_cpus();
 	int mpidr;
 	int cpumask;
+	int cluster;
 
 	if (!argp)
 		return -EINVAL;
 
-	mpidr = (argp->cluster << (MAX_CORES_PER_CLUSTER *
+	get_user(cluster, &argp->cluster);
+	mpidr = (cluster << (MAX_CORES_PER_CLUSTER *
 			MAX_NUM_OF_CLUSTERS));
-	cpumask = argp->cpumask;
+	get_user(cpumask, &argp->cpumask);
 
 	switch (cmd) {
 	case EA_LEAKAGE:
