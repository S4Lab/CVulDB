MotorolaMobilityLLC__kernel-msm
commit 877742edbf96398fc299cf21e006297b1a11f3b8
Author:     Jignesh Patel <jignesh@motorola.com>
AuthorDate: Thu Jan 11 19:52:12 2018 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Mon Feb 26 01:01:50 2018 -0600

    iovec: make sure the caller actually wants anything in memcpy_fromiovecend
    
    Based on upstream change 06ebb06d49486676272a3c030bfeef4bd969a8e6
    
    One more instance when the caller requests 0 bytes instead of running
    off and dereferencing potentially invalid iovecs.
    
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2017-13246
    Bug: 36279469
    
    Change-Id: Ib8Montana9e17c07c77357ab70bd6a2d7e305d6b27f0
    Signed-off-by: Paul Lawrence <paullawrence@google.com>
    Signed-off-by: Jignesh Patel <jignesh@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1116531
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit 6564f3968e29b6685602bec6132bddc0bbceb6fe)

diff --git a/net/core/iovec.c b/net/core/iovec.c
index 1117a26a8548..7fc51422d73c 100644
--- a/net/core/iovec.c
+++ b/net/core/iovec.c
@@ -147,6 +147,10 @@ int csum_partial_copy_fromiovecend(unsigned char *kdata, struct iovec *iov,
 	__wsum csum = *csump;
 	int partial_cnt = 0, err = 0;
 
+	/* No data? Done! */
+	if (len == 0)
+		return 0;
+
 	/* Skip over the finished iovecs */
 	while (offset >= iov->iov_len) {
 		offset -= iov->iov_len;
