MotorolaMobilityLLC__kernel-msm
commit 976850f46091b35644a2a9e6a98a64b352a1181d
Author:     Fei Zhang <feizhang@codeaurora.org>
AuthorDate: Wed May 17 14:14:54 2017 +0800
Commit:     chenyt9 <chenyt9@lenovo.com>
CommitDate: Mon Mar 12 16:31:50 2018 +0800

    msm:camera: correct stats query out of boundary
    
    fix one potential out of boundary query of stats info.
    
    Bug: 36264696
    CRs-Fixed: 2041066
    CVE-fixed: CVE-2017-9720
    Mot-CRs-fixed: (CR)
    
    Change-Id: I13e4bf8802fcce529f9268c272e4727619d5ad8f
    Signed-off-by: Fei Zhang <feizhang@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1043256
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/media/platform/msm/camera_v2/isp/msm_isp_stats_util.c b/drivers/media/platform/msm/camera_v2/isp/msm_isp_stats_util.c
index d4d2c8255984..8d2d8e7808c8 100644
--- a/drivers/media/platform/msm/camera_v2/isp/msm_isp_stats_util.c
+++ b/drivers/media/platform/msm/camera_v2/isp/msm_isp_stats_util.c
@@ -885,7 +885,7 @@ int msm_isp_update_stats_stream(struct vfe_device *vfe_dev, void *arg)
 				&update_cmd->update_info[i];
 		/*check array reference bounds*/
 		if (STATS_IDX(update_info->stream_handle)
-			> vfe_dev->hw_info->stats_hw_info->num_stats_type) {
+			>= vfe_dev->hw_info->stats_hw_info->num_stats_type) {
 			pr_err("%s: stats idx %d out of bound!", __func__,
 			STATS_IDX(update_info->stream_handle));
 			return -EINVAL;
diff --git a/drivers/media/platform/msm/camera_v2_2016/isp/msm_isp_stats_util.c b/drivers/media/platform/msm/camera_v2_2016/isp/msm_isp_stats_util.c
index 71d318a42596..0e1bfbb20765 100644
--- a/drivers/media/platform/msm/camera_v2_2016/isp/msm_isp_stats_util.c
+++ b/drivers/media/platform/msm/camera_v2_2016/isp/msm_isp_stats_util.c
@@ -872,7 +872,7 @@ int msm_isp_update_stats_stream(struct vfe_device *vfe_dev, void *arg)
 				&update_cmd->update_info[i];
 		/*check array reference bounds*/
 		if (STATS_IDX(update_info->stream_handle)
-			> vfe_dev->hw_info->stats_hw_info->num_stats_type) {
+			>= vfe_dev->hw_info->stats_hw_info->num_stats_type) {
 			pr_err("%s: stats idx %d out of bound!", __func__,
 			STATS_IDX(update_info->stream_handle));
 			return -EINVAL;
