MotorolaMobilityLLC__kernel-msm
commit 6aa1c1b1aedf5b8084487c70dce55e811eef3345
Author:     Dennis Cagle <d-cagle@codeaurora.org>
AuthorDate: Thu Jan 5 17:22:13 2017 -0800
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Wed Mar 22 04:35:15 2017 -0500

    input: misc: fix heap overflow issue in hbtp_input.c
    
    Add the boundary check for ABS code before setting ABS params,
    to avoid heap overflow.
    
    Mot-CRs-fixed:(CR)
    CVE-Fixed:CVE-2017-0516
    Bug: 32341680
    CRs-fixed: 1096301
    Change-Id: I6aad9916c92d2f775632406374dbb803063148de
    Signed-off-by: Vevek Venkatesan <vevekv@codeaurora.org>
    Signed-off-by: Dennis Cagle <d-cagle@codeaurora.org>
    Signed-off-by: Amarendra <amarenr@motorola.com>
    Reviewed-on: https://gerrit.mot.com/950730
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/input/misc/hbtp_input.c b/drivers/input/misc/hbtp_input.c
index adca5e8bddde..ee9ded91cded 100644
--- a/drivers/input/misc/hbtp_input.c
+++ b/drivers/input/misc/hbtp_input.c
@@ -415,9 +415,13 @@ static int hbtp_input_create_input_dev(struct hbtp_input_absinfo *absinfo)
 	input_mt_init_slots(input_dev, HBTP_MAX_FINGER, 0);
 	for (i = 0; i <= ABS_MT_LAST - ABS_MT_FIRST; i++) {
 		abs = absinfo + i;
-		if (abs->active)
-			input_set_abs_params(input_dev, abs->code,
+		if (abs->active) {
+			if (abs->code >= 0 && abs->code < ABS_CNT)
+				input_set_abs_params(input_dev, abs->code,
 					abs->minimum, abs->maximum, 0, 0);
+			else
+				pr_err("%s: ABS code out of bound\n", __func__);
+		}
 	}
 
 	if (hbtp->override_disp_coords) {
