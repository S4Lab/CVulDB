MotorolaMobilityLLC__kernel-msm
commit cd20658a530d2e52471677f70eb4976ebdcc6e67
Author:     Siena Richard <sienar@codeaurora.org>
AuthorDate: Fri Sep 15 14:35:57 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Dec 14 23:30:44 2017 -0600

    ASoC: msm: qdsp6v2: clear address on error
    
    Set address to NULL on error to ensure a stale address is not used.
    
    Change-Id: Ib0f4b942c705b39cb6c565ae79fac3b8709ab2b2
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-11016
    CRs-Fixed: 2038685
    Signed-off-by: Siena Richard <sienar@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/1059465
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit a622bee47735596109eb1bc14fedf403ee9e0916)

diff --git a/sound/soc/msm/qdsp6v2/audio_cal_utils.c b/sound/soc/msm/qdsp6v2/audio_cal_utils.c
index b54cde4ef0c3..636bc819f6e9 100644
--- a/sound/soc/msm/qdsp6v2/audio_cal_utils.c
+++ b/sound/soc/msm/qdsp6v2/audio_cal_utils.c
@@ -649,7 +649,9 @@ done:
 	return cal_block;
 err:
 	kfree(cal_block->cal_info);
+	cal_block->cal_info = NULL;
 	kfree(cal_block->client_info);
+	cal_block->client_info = NULL;
 	kfree(cal_block);
 	cal_block = NULL;
 	return cal_block;
