MotorolaMobilityLLC__kernel-msm
commit fb46e93d08ea1e132f0903db0e2c1bff98a00ccd
Author:     Srinivas Dasari <dasaris@qti.qualcomm.com>
AuthorDate: Fri Jul 7 01:43:41 2017 +0300
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Wed Dec 13 23:25:34 2017 -0600

    cfg80211: Define nla_policy for NL80211_ATTR_LOCAL_MESH_POWER_MODE
    
    Buffer overread may happen as nl80211_set_station() reads 4 bytes
    from the attribute NL80211_ATTR_LOCAL_MESH_POWER_MODE without
    validating the size of data received when userspace sends less
    than 4 bytes of data with NL80211_ATTR_LOCAL_MESH_POWER_MODE.
    Define nla_policy for NL80211_ATTR_LOCAL_MESH_POWER_MODE to avoid
    the buffer overread.
    
    Mot-CRs-fixed:(CR)
    CVE-Fixed:CVE-2017-11089
    
    Fixes: 3b1c5a5307f ("{cfg,nl}80211: mesh power mode primitives and userspace access")
    Cc: stable@vger.kernel.org
    Signed-off-by: Srinivas Dasari <dasaris@qti.qualcomm.com>
    Signed-off-by: Jouni Malinen <jouni@qca.qualcomm.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Git-repo: git://git.kernel.org/pub/scm/linux/kernel/git/jberg/mac80211.git
    Git-commit: 8feb69c7bd89513be80eb19198d48f154b254021
    Change-Id: Ie20993309501fd242782311b9fe787931f716116
    CRs-Fixed: 2055013
    Signed-off-by: Srinivas Dasari <dasaris@codeaurora.org>
    Signed-off-by: vineetv <vineetv@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1071499
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit 7284976335279037fc5b71f81fa823d398cbd101)

diff --git a/net/wireless/nl80211.c b/net/wireless/nl80211.c
index 1926d8d553bd..6c0643465799 100644
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@ -358,6 +358,7 @@ static const struct nla_policy nl80211_policy[NL80211_ATTR_MAX+1] = {
 	[NL80211_ATTR_SCAN_FLAGS] = { .type = NLA_U32 },
 	[NL80211_ATTR_P2P_CTWINDOW] = { .type = NLA_U8 },
 	[NL80211_ATTR_P2P_OPPPS] = { .type = NLA_U8 },
+	[NL80211_ATTR_LOCAL_MESH_POWER_MODE] = {. type = NLA_U32 },
 	[NL80211_ATTR_ACL_POLICY] = {. type = NLA_U32 },
 	[NL80211_ATTR_MAC_ADDRS] = { .type = NLA_NESTED },
 	[NL80211_ATTR_STA_CAPABILITY] = { .type = NLA_U16 },
