MotorolaMobilityLLC__kernel-msm
commit 7ee402164686fe1c0a4f5100bebda8c8f663120d
Author:     Aravind Kumar <akumark@codeaurora.org>
AuthorDate: Mon Apr 17 13:53:05 2017 +0530
Commit:     lulu2 <lulu2@lenovo.com>
CommitDate: Wed Jun 6 13:55:48 2018 +0800

    ASoC: msm8x16-wcd: prevent out of bounds access
    
    Hardcoding the third argument in strnstr function
    is resulting in out of bounds access. Set the third argument
    to sizeof the character string passed as the first argument
    to prevent out of bounds access.
    
    CVE-fixed: CVE-2017-0632
    Bug-Id: A-35392586
    CRs-Fixed: 832915
    Change-Id: I61be88701340e271fd866e0e1801722dbe7d63ac
    Signed-off-by: Aravind Kumar <akumark@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/980940
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/sound/soc/codecs/msm8x16-wcd.c b/sound/soc/codecs/msm8x16-wcd.c
index 143729f72991..01d2936c3d21 100644
--- a/sound/soc/codecs/msm8x16-wcd.c
+++ b/sound/soc/codecs/msm8x16-wcd.c
@@ -3612,7 +3612,7 @@ static int msm8x16_wcd_codec_enable_micbias(struct snd_soc_dapm_widget *w,
 			snd_soc_update_bits(codec, micb_int_reg, 0x08, 0x08);
 			msm8x16_notifier_call(codec,
 					WCD_EVENT_POST_MICBIAS_2_ON);
-		} else if (strnstr(w->name, internal3_text, 30)) {
+		} else if (strnstr(w->name, internal3_text, strlen(w->name))) {
 			snd_soc_update_bits(codec, micb_int_reg, 0x01, 0x01);
 		} else if (strnstr(w->name, external2_text, strlen(w->name))) {
 			msm8x16_notifier_call(codec,
@@ -3625,7 +3625,7 @@ static int msm8x16_wcd_codec_enable_micbias(struct snd_soc_dapm_widget *w,
 		} else if (strnstr(w->name, internal2_text, strlen(w->name))) {
 			msm8x16_notifier_call(codec,
 					WCD_EVENT_POST_MICBIAS_2_OFF);
-		} else if (strnstr(w->name, internal3_text, 30)) {
+		} else if (strnstr(w->name, internal3_text, strlen(w->name))) {
 			snd_soc_update_bits(codec, micb_int_reg, 0x2, 0x0);
 		} else if (strnstr(w->name, external2_text, strlen(w->name))) {
 			/*
