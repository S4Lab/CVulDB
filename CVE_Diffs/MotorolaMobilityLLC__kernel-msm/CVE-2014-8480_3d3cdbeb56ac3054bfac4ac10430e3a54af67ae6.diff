MotorolaMobilityLLC__kernel-msm
commit 3d3cdbeb56ac3054bfac4ac10430e3a54af67ae6
Author:     Nadav Amit <nadav.amit@gmail.com>
AuthorDate: Thu Jan 8 11:59:03 2015 +0100
Commit:     Greg Kroah-Hartman <gregkh@linuxfoundation.org>
CommitDate: Thu Jan 29 17:40:45 2015 -0800

    KVM: x86: Fix of previously incomplete fix for CVE-2014-8480
    
    commit 63ea0a49ae0b145b91ff2b070c01b66fc75854b9 upstream.
    
    STR and SLDT with rip-relative operand can cause a host kernel oops.
    Mark them as DstMem as well.
    
    Signed-off-by: Nadav Amit <namit@cs.technion.ac.il>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/arch/x86/kvm/emulate.c b/arch/x86/kvm/emulate.c
index ac640d47c28d..c7327a7761ca 100644
--- a/arch/x86/kvm/emulate.c
+++ b/arch/x86/kvm/emulate.c
@@ -3777,8 +3777,8 @@ static const struct opcode group5[] = {
 };
 
 static const struct opcode group6[] = {
-	DI(Prot,	sldt),
-	DI(Prot,	str),
+	DI(Prot | DstMem,	sldt),
+	DI(Prot | DstMem,	str),
 	II(Prot | Priv | SrcMem16, em_lldt, lldt),
 	II(Prot | Priv | SrcMem16, em_ltr, ltr),
 	N, N, N, N,
