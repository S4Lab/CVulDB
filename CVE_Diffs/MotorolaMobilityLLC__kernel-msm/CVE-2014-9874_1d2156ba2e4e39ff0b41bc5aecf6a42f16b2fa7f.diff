MotorolaMobilityLLC__kernel-msm
commit 1d2156ba2e4e39ff0b41bc5aecf6a42f16b2fa7f
Author:     Neeraj Kumar <neerajk@motorola.com>
AuthorDate: Wed Oct 5 16:07:44 2016 +0530
Commit:     lulu2 <lulu2@lenovo.com>
CommitDate: Wed Jun 6 12:08:27 2018 +0800

    misc: qcom: qdsp6v2: soc: qdsp6v2: add integer bounds checks
    
    The original fix was designed to add integer bounds checks but caused
    the audio recording during a phone call functionality to break in some
    phones.The updated fix is designed to be the proper fix. The original
    fix should be reverted and the updated fix applied.
    
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2014-9874
    
    --------------
    
    Change-Id: Idbbb8a38a06a65e6d0f671be454ae432ccfc186c
    Signed-off-by: Karthik Reddy Katta <a_katta@codeaurora.org>
    (cherry picked from commit eadf58ade5e4c657f762991f3c87133881074e3b)
    Reviewed-on: https://gerrit.mot.com/910407
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/misc/qcom/qdsp6v2/audio_utils.c b/drivers/misc/qcom/qdsp6v2/audio_utils.c
index 15d82d126df7..0fc766834d84 100644
--- a/drivers/misc/qcom/qdsp6v2/audio_utils.c
+++ b/drivers/misc/qcom/qdsp6v2/audio_utils.c
@@ -342,6 +342,10 @@ long audio_in_ioctl(struct file *file,
 			rc = -EINVAL;
 			break;
 		}
+		if (cfg.buffer_size > MAX_BUFFER_SIZE) {
+			rc = -EINVAL;
+			break;
+		}
 		audio->str_cfg.buffer_size = cfg.buffer_size;
 		audio->str_cfg.buffer_count = cfg.buffer_count;
 		if (audio->opened) {
