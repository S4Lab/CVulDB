MotorolaMobilityLLC__kernel-msm
commit 17108b87b9df04046c0922cee41e82213d4611a8
Author:     Narender Ankam <nankam@codeaurora.org>
AuthorDate: Wed Aug 23 15:55:50 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Wed Dec 20 00:01:43 2017 -0600

    msm: mdss: hdmi: validate HDMI EDID's max number of CEA blocks
    
    No upper-bound validation is performed when reading number of
    extended CEA blocks from the untrusted source (EDID). Add a check
    to limit the number of CEA extension blocks.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-11093
    
    Change-Id: I69f09ed0ad28a4c267cf3e8f7a12efe46f75e244
    Signed-off-by: Narender Ankam <nankam@codeaurora.org>
    Signed-off-by: Ashwin Pathmudi <jfxr63@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1078584
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit 8d251f5841572d43a9fc953273d6a35b915c67e6)
    (cherry picked from commit 1a67384f1e2eed1792269cd2b494132f13a27d43)

diff --git a/drivers/video/msm/mdss/mdss_hdmi_edid.c b/drivers/video/msm/mdss/mdss_hdmi_edid.c
index 11245a0a9c04..d3516bc996ee 100644
--- a/drivers/video/msm/mdss/mdss_hdmi_edid.c
+++ b/drivers/video/msm/mdss/mdss_hdmi_edid.c
@@ -2254,6 +2254,13 @@ int hdmi_edid_parser(void *input)
 		goto bail;
 	}
 
+	/* Find out if CEA extension blocks exceeding max limit */
+	if (num_of_cea_blocks >= MAX_EDID_BLOCKS) {
+		DEV_WARN("%s: HDMI EDID exceeded max CEA blocks limit\n",
+				__func__);
+		num_of_cea_blocks = MAX_EDID_BLOCKS - 1;
+	}
+
 	/* check for valid CEA block */
 	if (edid_buf[EDID_BLOCK_SIZE] != 2) {
 		DEV_ERR("%s: Invalid CEA block\n", __func__);
