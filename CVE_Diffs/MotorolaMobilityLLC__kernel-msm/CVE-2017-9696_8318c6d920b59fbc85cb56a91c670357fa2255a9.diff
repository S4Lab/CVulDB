MotorolaMobilityLLC__kernel-msm
commit 8318c6d920b59fbc85cb56a91c670357fa2255a9
Author:     Alok Kediya <kediya@codeaurora.org>
AuthorDate: Thu Mar 2 15:51:35 2017 +0530
Commit:     a7301c <a7301c@motorola.com>
CommitDate: Wed Sep 26 21:02:54 2018 -0500

    msm: camera: Bound check for num_of_stream.
    
    - num of stream comes from userspace and used without
    any bound check.It may result to overflow update_info.
    
    CRs-Fixed: 2006829, 2029867
    CVE-fixed: CVE-2017-9696
    Bug-id: A-36232584
    Mot-CRs-fixed: (CR)
    
    Change-Id: I8226e8f7081b28108dbed738ea4579e2051a85f2
    Signed-off-by: Alok Kediya <kediya@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1073101
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Coverity Analysis <coverity@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/media/platform/msm/camera_v2/isp/msm_isp_stats_util.c b/drivers/media/platform/msm/camera_v2/isp/msm_isp_stats_util.c
index 3e8220005f77..d494205ff4e6 100644
--- a/drivers/media/platform/msm/camera_v2/isp/msm_isp_stats_util.c
+++ b/drivers/media/platform/msm/camera_v2/isp/msm_isp_stats_util.c
@@ -1231,6 +1231,12 @@ int msm_isp_cfg_stats_stream(struct vfe_device *vfe_dev, void *arg)
 	if (rc)
 		return rc;
 
+	if (stream_cfg_cmd->num_streams > MSM_ISP_STATS_MAX) {
+		pr_err("%s invalid num_streams %d\n", __func__,
+			stream_cfg_cmd->num_streams);
+		return -EINVAL;
+	}
+
 	if (stream_cfg_cmd->enable) {
 		msm_isp_stats_update_cgc_override(vfe_dev, stream_cfg_cmd);
 
