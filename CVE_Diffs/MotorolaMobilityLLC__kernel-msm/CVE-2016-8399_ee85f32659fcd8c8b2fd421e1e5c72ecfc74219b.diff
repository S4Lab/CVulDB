MotorolaMobilityLLC__kernel-msm
commit ee85f32659fcd8c8b2fd421e1e5c72ecfc74219b
Author:     Vineet Angadi V <vineetv@motorola.com>
AuthorDate: Thu Nov 10 14:35:15 2016 +0530
Commit:     Vineet Angadi <vineetv@motorola.com>
CommitDate: Tue Nov 15 02:58:04 2016 -0600

    net: ipv4: validate len variable to prevent overflow
    
    There is no validation of the len variable passed to the
    ping_common_sendmsg function to check if it is less than
    icmph_len leading to a potential overflow.The fix is designed to add
    additional validation to prevent the potential overflow.
    Mot-CRs-fixed: IKSECURITY-1736
    CVE-Fixed: CVE-2016-8399
    
    Change-Id: I95726b589e2741efd037a7904bb2c9967faf1dd5
    Signed-off-by: Vineet Angadi V <vineetv@motorola.com>
    Reviewed-on: https://gerrit.mot.com/919018
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Vijayakumar Gn <vijaygn@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/net/ipv4/ping.c b/net/ipv4/ping.c
index 59f8d47bffe4..f65379c4d86d 100644
--- a/net/ipv4/ping.c
+++ b/net/ipv4/ping.c
@@ -656,7 +656,7 @@ int ping_common_sendmsg(int family, struct msghdr *msg, size_t len,
 			void *user_icmph, size_t icmph_len) {
 	u8 type, code;
 
-	if (len > 0xFFFF)
+	if (len > 0xFFFF || len < icmph_len)
 		return -EMSGSIZE;
 
 	/*
