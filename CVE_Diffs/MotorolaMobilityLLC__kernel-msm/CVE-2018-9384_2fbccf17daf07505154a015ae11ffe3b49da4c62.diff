MotorolaMobilityLLC__kernel-msm
commit 2fbccf17daf07505154a015ae11ffe3b49da4c62
Author:     Andy Lutomirski <luto@kernel.org>
AuthorDate: Thu Jul 28 15:48:20 2016 -0700
Commit:     lulu2 <lulu2@lenovo.com>
CommitDate: Mon Jun 11 16:50:07 2018 +0800

    UPSTREAM: kdb: use task_cpu() instead of task_thread_info()->cpu
    
    We'll need this cleanup to make the cpu field in thread_info be
    optional.
    
    Link: http://lkml.kernel.org/r/da298328dc77ea494576c2f20a934218e758a6fa.1468523549.git.luto@kernel.org
    Signed-off-by: Perry Lutomirski <luto@kernel.org>
    Cc: Jason Wessel <jason.wessel@windriver.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2018-9384
    Bug: 74356909
    
    Bug: 66351489
    Change-Id: I1d998cc2dcff49056aa4d1bb7bbe78d35e334f51
    (cherry picked from commit e558af65be65713ef2e8b2aa637c6263caeed172)
    Signed-off-by: Zubin Mithra <zsm@google.com>
    Reviewed-on: https://gerrit.mot.com/1182523
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/include/linux/kdb.h b/include/linux/kdb.h
index 290db1269c4c..8520ae4dbe02 100644
--- a/include/linux/kdb.h
+++ b/include/linux/kdb.h
@@ -127,7 +127,7 @@ extern int kdb_get_kbd_char(void);
 static inline
 int kdb_process_cpu(const struct task_struct *p)
 {
-	unsigned int cpu = task_thread_info(p)->cpu;
+	unsigned int cpu = task_cpu(p);
 	if (cpu > num_possible_cpus())
 		cpu = 0;
 	return cpu;
