MotorolaMobilityLLC__kernel-msm
commit 72c80afb3baf85cb3b3c4e7d88f5ed20bcc88117
Author:     Suman Mukherjee <sumam@codeaurora.org>
AuthorDate: Thu Sep 29 03:49:05 2016 +0000
Commit:     a7301c <a7301c@motorola.com>
CommitDate: Mon Nov 21 09:47:22 2016 -0600

    msm: camera: cpp: Add validation for v4l2 ioctl arguments
    
    In CPP v4l2 ioctl command is made, if _IOC_DIR(cmd) is
    _IOC_NONE, then the user-supplied argument arg is not checked
    and an information disclosure is possible
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2016-6756
    
    Change-Id: Iddb291b10cdcb5c42ab8497e06c2ce47885cd5ab
    Signed-off-by: Suman Mukherjee <sumam@codeaurora.org>
    Signed-off-by: Sunid Wilson <sunidw@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/918767
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c b/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
index fb32a81af66e..82ae3f472ca4 100644
--- a/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
+++ b/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
@@ -2289,6 +2289,10 @@ long msm_cpp_subdev_ioctl(struct v4l2_subdev *sd,
 		pr_err("cpp_dev is null\n");
 		return -EINVAL;
 	}
+	if (_IOC_DIR(cmd) == _IOC_NONE) {
+		pr_err("Invalid ioctl/subdev cmd %u", cmd);
+		return -EINVAL;
+	}
 	mutex_lock(&cpp_dev->mutex);
 	CPP_DBG("E cmd: 0x%x\n", cmd);
 	switch (cmd) {
