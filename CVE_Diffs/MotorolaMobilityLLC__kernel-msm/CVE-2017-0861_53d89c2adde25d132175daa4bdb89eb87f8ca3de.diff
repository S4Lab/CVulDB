MotorolaMobilityLLC__kernel-msm
commit 53d89c2adde25d132175daa4bdb89eb87f8ca3de
Author:     Robb Glasser <rglasser@google.com>
AuthorDate: Mon Sep 17 00:00:00 2001 +0530
Commit:     a7301c <a7301c@motorola.com>
CommitDate: Fri Dec 7 08:35:21 2018 -0600

    ALSA: pcm: prevent UAF in snd_pcm_info
    
    When the device descriptor is closed, the `substream->runtime` pointer
    is freed. But another thread may be in the ioctl handler, case
    SNDRV_CTL_IOCTL_PCM_INFO. This case calls snd_pcm_info_user() which
    calls snd_pcm_info() which accesses the now freed `substream->runtime`.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed:  CVE-2017-0861
    Bug: 36006981
    Signed-off-by: Robb Glasser <rglasser@google.com>
    Signed-off-by: Nick Desaulniers <ndesaulniers@google.com>
    Change-Id: I445d24bc21dc0af6d9522a8daabe64969042236a
    ---
    Reviewed-on: https://gerrit.mot.com/1073834
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Ravikumar Vembu <raviv@motorola.com>
    Submit-Approved: Jira Key

diff --git a/sound/core/pcm.c b/sound/core/pcm.c
index 510836920ee2..0f4f0c385954 100644
--- a/sound/core/pcm.c
+++ b/sound/core/pcm.c
@@ -160,7 +160,6 @@ static int snd_pcm_control_ioctl(struct snd_card *card,
 	case SNDRV_CTL_IOCTL_PCM_PREFER_SUBDEVICE:
 		{
 			int val;
-			
 			if (get_user(val, (int __user *)arg))
 				return -EFAULT;
 			control->prefer_pcm_subdevice = val;
