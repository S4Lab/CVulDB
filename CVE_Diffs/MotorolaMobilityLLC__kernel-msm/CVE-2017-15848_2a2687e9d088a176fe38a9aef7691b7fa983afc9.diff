MotorolaMobilityLLC__kernel-msm
commit 2a2687e9d088a176fe38a9aef7691b7fa983afc9
Author:     Tharun Kumar Merugu <mtharu@codeaurora.org>
AuthorDate: Thu Dec 21 17:21:14 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Wed Jan 31 07:22:18 2018 -0600

    msm: ADSPRPC: validate user buffers after copying from user
    
    validate user buffers before accessing in kernel driver.
    
    CVE-fixed: CVE-2017-15848
    Mot-CRs-fixed: (CR)
    Bug-Id: A-67713083
    CRs-Fixed: 2073777
    Change-Id: I7997d069d0549de03f1467c63bdb81b20fcf3d6c
    Acked-by: Chenna Kesava Raju <chennak@qti.qualcomm.com>
    Signed-off-by: Tharun Kumar Merugu <mtharu@codeaurora.org>
    
    Signed-off-by: Neeraj Kumar <neerajk@motorola.com>
    --

diff --git a/drivers/char/adsprpc.c b/drivers/char/adsprpc.c
index 29bce97af8a7..05bfae21689a 100644
--- a/drivers/char/adsprpc.c
+++ b/drivers/char/adsprpc.c
@@ -2171,6 +2171,10 @@ static long fastrpc_device_ioctl(struct file *file, unsigned int ioctl_num,
 						sizeof(p.init)));
 		if (err)
 			goto bail;
+		VERIFY(err, p.init.filelen >= 0 &&
+			p.init.memlen >= 0);
+		if (err)
+			goto bail;
 		VERIFY(err, 0 == fastrpc_init_process(fl, &p.init));
 		if (err)
 			goto bail;
