MotorolaMobilityLLC__kernel-msm
commit 18a07c16724a69abc2ba4e57b5d6e3a230898842
Author:     Ashwin Pathmudi <jfxr63@motorola.com>
AuthorDate: Tue Jan 30 16:49:44 2018 +0530
Commit:     a7301c <a7301c@motorola.com>
CommitDate: Sun Apr 15 23:23:39 2018 -0500

    input: synaptics_dsx: Free tmpbuf before releasing it
    
    CVE-fixed: CVE-2017-9723
    
    Signed-off-by: Ashwin Pathmudi <jfxr63@motorola.com>
    Change-Id: Ia1ebb1c3e0551854b8e3b6965709aa299129a600
    Reviewed-on: https://gerrit.mot.com/1128459
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Konstantin Makariev <kmakariev@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/input/touchscreen/synaptics_dsx_rmi_dev.c b/drivers/input/touchscreen/synaptics_dsx_rmi_dev.c
index 6a52a511edb4..942d417ff14e 100644
--- a/drivers/input/touchscreen/synaptics_dsx_rmi_dev.c
+++ b/drivers/input/touchscreen/synaptics_dsx_rmi_dev.c
@@ -505,6 +505,12 @@ static int rmidev_release(struct inode *inp, struct file *filp)
 
 	mutex_lock(&(dev_data->file_mutex));
 
+	if (dev_data->tmpbuf_size != 0) {
+		kfree(dev_data->tmpbuf);
+		dev_data->tmpbuf = NULL;
+		dev_data->tmpbuf_size = 0;
+	}
+
 	dev_data->ref_count--;
 	if (dev_data->ref_count < 0)
 		dev_data->ref_count = 0;
