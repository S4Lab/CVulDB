MotorolaMobilityLLC__kernel-msm
commit 7c062da2cc50d03e54fcb969b63a6300aac32f04
Author:     zhaoyuan <yzhao@codeaurora.org>
AuthorDate: Mon Feb 20 13:42:20 2017 +0800
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Wed Dec 20 00:01:58 2017 -0600

    msm: mdss: hdmi: check up-bound of CEC frame size
    
    the spec says the frame size will not be greater than
    14, but this have a security hole when somebody sends
    a message with a size greater than 14. So need check
    up-boud of the CEC frame size.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-9719
    
    Change-Id: I743208badc5e77ae911cfb2d102f758d4843138f
    Signed-off-by: zhaoyuan <yzhao@codeaurora.org>
    Signed-off-by: Ashwin Pathmudi <jfxr63@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1078658
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit 70560a2cd973bbf0589d7c529a99ff0e21ba710b)
    (cherry picked from commit 3f7d06f1591bfa492d3fd036985a471fa22f2407)

diff --git a/drivers/video/msm/mdss/mdss_hdmi_cec.c b/drivers/video/msm/mdss/mdss_hdmi_cec.c
index a424d987bb63..a4ed01210e04 100644
--- a/drivers/video/msm/mdss/mdss_hdmi_cec.c
+++ b/drivers/video/msm/mdss/mdss_hdmi_cec.c
@@ -1,4 +1,4 @@
-/* Copyright (c) 2010-2016, The Linux Foundation. All rights reserved.
+/* Copyright (c) 2010-2017, The Linux Foundation. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -196,7 +196,7 @@ static void hdmi_cec_msg_recv(struct work_struct *work)
 		msg.sender_id, msg.recvr_id,
 		msg.frame_size);
 
-	if (msg.frame_size < 1) {
+	if (msg.frame_size < 1 || msg.frame_size > MAX_CEC_FRAME_SIZE) {
 		DEV_ERR("%s: invalid message (frame length = %d)\n",
 			__func__, msg.frame_size);
 		return;
@@ -216,7 +216,7 @@ static void hdmi_cec_msg_recv(struct work_struct *work)
 		msg.operand[i] = data & 0xFF;
 	}
 
-	for (; i < 14; i++)
+	for (; i < MAX_OPERAND_SIZE; i++)
 		msg.operand[i] = 0;
 
 	DEV_DBG("%s: opcode 0x%x, wakup_en %d, device_suspend %d\n", __func__,
