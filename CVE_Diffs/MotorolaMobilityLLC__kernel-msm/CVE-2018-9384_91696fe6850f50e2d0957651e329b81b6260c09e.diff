MotorolaMobilityLLC__kernel-msm
commit 91696fe6850f50e2d0957651e329b81b6260c09e
Author:     Mark Rutland <mark.rutland@arm.com>
AuthorDate: Tue May 29 14:43:52 2018 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Jun 14 06:06:26 2018 -0500

    BACKPORT: arm64: asm-offsets: remove unused definitions
    
    Subsequent patches will move the thread_info::{task,cpu} fields, and the
    current TI_{TASK,CPU} offset definitions are not used anywhere.
    
    This patch removes the redundant definitions.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2018-9384
    Bug: 74356909
    
    Signed-off-by: Mark Rutland <mark.rutland@arm.com>
    Tested-by: Laura Abbott <labbott@redhat.com>
    Cc: James Morse <james.morse@arm.com>
    Cc: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    
    This is a modification of Mark Rutland's original patch. Guards to
    check if CONFIG_THREAD_INFO_IN_TASK is used has been inserted.
    
    Bug: 64672701
    Change-Id: I95903e0f862fc5dcf89e51926afa22389f2f7cee
    (cherry picked from commit 3fe12da4c7fa6491e0fb7c5371716ac7f8ea80a5)
    Signed-off-by: Zubin Mithra <zsm@google.com>
    Reviewed-on: https://gerrit.mot.com/1182359
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit b59abfb8161cb97ac4964e1b069afd436a79dcc0)

diff --git a/arch/arm64/kernel/asm-offsets.c b/arch/arm64/kernel/asm-offsets.c
index 350c0e99fc6b..4a326d992033 100644
--- a/arch/arm64/kernel/asm-offsets.c
+++ b/arch/arm64/kernel/asm-offsets.c
@@ -38,8 +38,10 @@ int main(void)
   DEFINE(TI_FLAGS,		offsetof(struct thread_info, flags));
   DEFINE(TI_PREEMPT,		offsetof(struct thread_info, preempt_count));
   DEFINE(TI_ADDR_LIMIT,		offsetof(struct thread_info, addr_limit));
+#ifndef CONFIG_THREAD_INFO_IN_TASK
   DEFINE(TI_TASK,		offsetof(struct thread_info, task));
   DEFINE(TI_CPU,		offsetof(struct thread_info, cpu));
+#endif
 #ifdef CONFIG_ARM64_SW_TTBR0_PAN
   DEFINE(TSK_TI_TTBR0,		offsetof(struct thread_info, ttbr0));
 #endif
