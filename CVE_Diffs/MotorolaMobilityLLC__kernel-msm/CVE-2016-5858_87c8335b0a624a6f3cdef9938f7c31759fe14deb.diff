MotorolaMobilityLLC__kernel-msm
commit 87c8335b0a624a6f3cdef9938f7c31759fe14deb
Author:     Karthikeyan Mani <kmani@codeaurora.org>
AuthorDate: Fri Apr 14 11:22:23 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Wed May 31 08:43:27 2017 -0500

    ASoC: wcd9320: Fix out of bounds for mad input value
    
    Add check in taiko_mad_input_put function to
    return error on out of bounds access using
    mad input value
    
    CVE-fixed: CVE-2016-5858
    Bug-Id: A-35400153
    CRs-fixed: 1096799
    Change-Id: I75ce9e881cf05a50e874a555b2f8bd3286cdaed4
    Signed-off-by: Karthikeyan Mani <kmani@codeaurora.org>
    
    Add check in tomtom_mad_input_put function to
    return error on out of bounds access using
    mad input value
    
    CRs-fixed: 1096799
    Change-Id: I16f8627b29c7b14a8dc0433b21aa21bf96e98905
    Signed-off-by: Karthikeyan Mani <kmani@codeaurora.org>
    --
    Reviewed-on: https://gerrit.mot.com/979899
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/sound/soc/codecs/wcd9320.c b/sound/soc/codecs/wcd9320.c
index 4a8208b24ec7..9d46819c0f9b 100644
--- a/sound/soc/codecs/wcd9320.c
+++ b/sound/soc/codecs/wcd9320.c
@@ -1204,6 +1204,13 @@ static int taiko_mad_input_put(struct snd_kcontrol *kcontrol,
 
 	taiko_mad_input = ucontrol->value.integer.value[0];
 
+	if (taiko_mad_input >= ARRAY_SIZE(taiko_conn_mad_text)) {
+		dev_err(codec->dev,
+			"%s: taiko_mad_input = %d out of bounds\n",
+			__func__, taiko_mad_input);
+		return -EINVAL;
+	}
+
 	micb_4_int_reg = taiko->resmgr.reg_addr->micb_4_int_rbias;
 	pr_debug("%s: taiko_mad_input = %s\n", __func__,
 			taiko_conn_mad_text[taiko_mad_input]);
diff --git a/sound/soc/codecs/wcd9330.c b/sound/soc/codecs/wcd9330.c
index 42e9beedc509..7b9fa9a6fcc8 100644
--- a/sound/soc/codecs/wcd9330.c
+++ b/sound/soc/codecs/wcd9330.c
@@ -1367,6 +1367,13 @@ static int tomtom_mad_input_put(struct snd_kcontrol *kcontrol,
 	tomtom_mad_input = ucontrol->value.integer.value[0];
 	micb_4_int_reg = tomtom->resmgr.reg_addr->micb_4_int_rbias;
 
+	if (tomtom_mad_input >= ARRAY_SIZE(tomtom_conn_mad_text)) {
+		dev_err(codec->dev,
+			"%s: tomtom_mad_input = %d out of bounds\n",
+			__func__, tomtom_mad_input);
+		return -EINVAL;
+	}
+
 	pr_debug("%s: tomtom_mad_input = %s\n", __func__,
 			tomtom_conn_mad_text[tomtom_mad_input]);
 
