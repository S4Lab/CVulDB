MotorolaMobilityLLC__kernel-msm
commit 0ea557bc9323ed3a17380f7d8fc2226030e987f8
Author:     Zubin Mithra <zsm@google.com>
AuthorDate: Thu May 24 19:44:06 2018 +0530
Commit:     chenyt9 <chenyt9@lenovo.com>
CommitDate: Fri Dec 6 15:30:25 2019 +0800

    ANDROID: perf: get cpu value using task_cpu(tsk)
    
    Use task_cpu(tsk) instead of task_thread_info(tsk)->cpu so that this
    works even with CONFIG_THREAD_INFO_IN_TASK enabled.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2018-9384
    Bug: 74356909
    
    Bug: 66351489
    Change-Id: If7e482084aed453e0fcb9623a0167c0e21321631
    Signed-off-by: Zubin Mithra <zsm@google.com>
    Reviewed-on: https://gerrit.mot.com/1181664
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/arch/arm64/kernel/perf_trace_counters.c b/arch/arm64/kernel/perf_trace_counters.c
index 0fb98052b586..5057ae834ced 100644
--- a/arch/arm64/kernel/perf_trace_counters.c
+++ b/arch/arm64/kernel/perf_trace_counters.c
@@ -65,7 +65,7 @@ void tracectr_notifier(void *ignore, struct task_struct *prev,
 {
 	u32 cnten_val;
 	int current_pid;
-	u32 cpu = task_thread_info(next)->cpu;
+	u32 cpu = task_cpu(next);
 
 	if (tp_pid_state != 1)
 		return;
