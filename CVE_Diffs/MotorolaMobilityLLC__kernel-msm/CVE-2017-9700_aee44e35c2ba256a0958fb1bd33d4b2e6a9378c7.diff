MotorolaMobilityLLC__kernel-msm
commit aee44e35c2ba256a0958fb1bd33d4b2e6a9378c7
Author:     Xiaoyu Ye <benyxy@codeaurora.org>
AuthorDate: Wed Jul 19 12:44:04 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Tue Dec 19 20:32:03 2017 -0600

    ASoC: msm-cpe: Fix range checking in function fw_name_store
    
    The range checking between "WCD_CPE_IMAGE_FNAME_MAX" and
    "copy_count" is off-by-one due to the size of array
    "core->dyn_fname" is "WCD_CPE_IMAGE_FNAME_MAX". Subtract
    one from the range checking to fix this issue.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-9700
    CRs-Fixed: 2043822
    Change-Id: I87fd55206f79ad7b13c3878f6642bf5579303b17
    Signed-off-by: Xiaoyu Ye <benyxy@codeaurora.org>
    
    Signed-off-by: Neeraj Kumar <neerajk@motorola.com>
    Change-Id: Ib5f2922b73669fac9f0d1b799ba8e8103ff87949
    Reviewed-on: https://gerrit.mot.com/1028498
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit c302cd5b098334f88d0a2299554217973909e016)

diff --git a/sound/soc/codecs/wcd_cpe_core.c b/sound/soc/codecs/wcd_cpe_core.c
index 04a06d1426d4..82f70ff7e39b 100644
--- a/sound/soc/codecs/wcd_cpe_core.c
+++ b/sound/soc/codecs/wcd_cpe_core.c
@@ -1739,10 +1739,10 @@ static ssize_t fw_name_store(struct wcd_cpe_core *core,
 	if (pos)
 		copy_count = pos - buf;
 
-	if (copy_count > WCD_CPE_IMAGE_FNAME_MAX) {
+	if (copy_count > (WCD_CPE_IMAGE_FNAME_MAX - 1)) {
 		dev_err(core->dev,
 			"%s: Invalid length %d, max allowed %d\n",
-			__func__, copy_count, WCD_CPE_IMAGE_FNAME_MAX);
+			__func__, copy_count, WCD_CPE_IMAGE_FNAME_MAX - 1);
 		return -EINVAL;
 	}
 
