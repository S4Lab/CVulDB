MotorolaMobilityLLC__kernel-msm
commit f7a47099bb21c4804bf10123bd908d78b3499a99
Author:     Dennis Cagle <d-cagle@codeaurora.org>
AuthorDate: Wed Feb 8 17:13:49 2017 +0530
Commit:     Amarendra Reddy <amarenr@motorola.com>
CommitDate: Fri Feb 17 00:07:52 2017 -0600

    input: misc: fix heap overflow issue in hbtp_input.c
    
    Add the boundary check for ABS code before setting ABS params,
    to avoid heap overflow.
    
    Mot-CRs-fixed:(CR)
    CVE-Fixed:CVE-2017-0516
    Bug: 32341680
    CRs-fixed: 1096301
    Change-Id: I6aad9916c92d2f775632406374dbb803063148de
    Signed-off-by: Vevek Venkatesan <vevekv@codeaurora.org>
    Signed-off-by: Dennis Cagle <d-cagle@codeaurora.org>
    Signed-off-by: amarenr <amarenr@motorola.com>
    Reviewed-on: https://gerrit.mot.com/950326
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/input/misc/hbtp_input.c b/drivers/input/misc/hbtp_input.c
index cb6c6ff7bec5..5a4330078873 100644
--- a/drivers/input/misc/hbtp_input.c
+++ b/drivers/input/misc/hbtp_input.c
@@ -129,9 +129,13 @@ static int hbtp_input_create_input_dev(struct hbtp_input_absinfo *absinfo)
 	input_mt_init_slots(input_dev, HBTP_MAX_FINGER, 0);
 	for (i = 0; i <= ABS_MT_LAST - ABS_MT_FIRST; i++) {
 		abs = absinfo + i;
-		if (abs->active)
-			input_set_abs_params(input_dev, abs->code,
+		if (abs->active) {
+			if (abs->code >= 0 && abs->code < ABS_CNT)
+				input_set_abs_params(input_dev, abs->code,
 					abs->minimum, abs->maximum, 0, 0);
+			else
+				pr_err("%s: ABS code out of bound\n", __func__);
+		}
 	}
 
 	error = input_register_device(input_dev);
