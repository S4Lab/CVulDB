MotorolaMobilityLLC__kernel-msm
commit bb05916327c83848016b91e52909e748dd45e1aa
Author:     Sahara <keun-o.park@darkmatter.ae>
AuthorDate: Sun Dec 4 12:50:18 2016 +0400
Commit:     lulu2 <lulu2@lenovo.com>
CommitDate: Wed Jun 6 12:10:53 2018 +0800

    enable ARCH_HAS_ELF_RANDOMIZE again
    
    The patch e4622e4 somehow accidentally removed ARCH_HAS_ELF_RANDOMIZE.
    Without this option, arch_mmap_rnd(), called by load_elf_binary(), does
    not work properly and just returns 0 instead even though a process has
    PF_RANDOMIZE flag. As a result, dynamic program's mmap base is not
    randomized at all.
    
    Bug: 33351919
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2017-0528
    
    Change-Id: Ice2df132dc436b647fa0312dd7453f9ed6160a2a
    Signed-off-by: Sahara <keun-o.park@darkmatter.ae>
    Signed-off-by: Varun Shrivastava <varunshrivastava@motorola.com>
    Reviewed-on: https://gerrit.mot.com/950280
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/arch/Kconfig b/arch/Kconfig
index da35741f4a1e..30e62a5d46e3 100644
--- a/arch/Kconfig
+++ b/arch/Kconfig
@@ -493,6 +493,13 @@ config HAVE_IRQ_EXIT_ON_IRQ_STACK
 	  This spares a stack switch and improves cache usage on softirq
 	  processing.
 
+config ARCH_HAS_ELF_RANDOMIZE
+	bool
+	help
+	  An architecture supports choosing randomized locations for
+	  stack, mmap, brk, and ET_DYN. Defined functions:
+	  - arch_mmap_rnd()
+
 config HAVE_ARCH_MMAP_RND_BITS
 	bool
 	help
