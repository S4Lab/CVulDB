MotorolaMobilityLLC__kernel-msm
commit e745b1612ea0ae53f9c0af539e54513f1352fa43
Author:     Harsh Sahu <hsahu@codeaurora.org>
AuthorDate: Fri Jun 1 17:27:40 2018 +0530
Commit:     Jignesh Patel <jignesh@motorola.com>
CommitDate: Wed Jun 6 23:41:53 2018 -0500

    fbdev: msm: check buffer size before writing to user buffer
    
    Check the number of bytes to copy against the size of the
    user buffer before copy to user to avoid buffer overflow.
    
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2018-5910
    CRs-Fixed: 2175499
    
    Change-Id: Icdd3d4e755deca19fa431e903620bd9e4c701c89
    Signed-off-by: Harsh Sahu <hsahu@codeaurora.org>
    Signed-off-by: Jignesh Patel <jignesh@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1184809
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Bang Nguyen <bangnguyen@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/video/fbdev/msm/mdss_debug_xlog.c b/drivers/video/fbdev/msm/mdss_debug_xlog.c
index 99f50122becc..c58588e3df84 100644
--- a/drivers/video/fbdev/msm/mdss_debug_xlog.c
+++ b/drivers/video/fbdev/msm/mdss_debug_xlog.c
@@ -1,4 +1,4 @@
-/* Copyright (c) 2014-2017, The Linux Foundation. All rights reserved.
+/* Copyright (c) 2014-2018, The Linux Foundation. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -1084,6 +1084,11 @@ static ssize_t mdss_xlog_dump_read(struct file *file, char __user *buff,
 	mutex_lock(&mdss_dbg_xlog.xlog_lock);
 	if (__mdss_xlog_dump_calc_range()) {
 		len = mdss_xlog_dump_entry(xlog_buf, MDSS_XLOG_BUF_MAX);
+		if (len < 0 || len > count) {
+			pr_err("len is more than the size of user buffer\n");
+			return 0;
+		}
+
 		if (copy_to_user(buff, xlog_buf, len)) {
 			mutex_unlock(&mdss_dbg_xlog.xlog_lock);
 			return -EFAULT;
