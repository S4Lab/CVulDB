MotorolaMobilityLLC__kernel-msm
commit 89d5cb5a1a7f20c6aae8d2c13b4acba03cf5ad8f
Author:     Krishnankutty Kolathappilly <kkolatha@codeaurora.org>
AuthorDate: Wed Nov 16 18:22:58 2016 -0800
Commit:     Srikanth A R <arsrikan@motorola.com>
CommitDate: Wed Feb 15 01:36:34 2017 -0600

    msm: cpp: Fix for buffer overflow in cpp.
    
    Fix for buffer overflow while handling ioctl.
    Instead of checking for length boundary, fix checks
    for exact length.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2016-8413
    CRs-Fixed: 518731
    
    Change-Id: I36a10501b9505036bc3bb30459b75d943f2744a2
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Signed-off-by: Krishnankutty Kolathappilly <kkolatha@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/949608
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c b/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
index 82ae3f472ca4..efd8cc040aaa 100644
--- a/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
+++ b/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
@@ -2490,8 +2490,7 @@ STREAM_BUFF_END:
 		uint32_t identity;
 		struct msm_cpp_buff_queue_info_t *buff_queue_info;
 		CPP_DBG("VIDIOC_MSM_CPP_DEQUEUE_STREAM_BUFF_INFO\n");
-		if ((ioctl_ptr->len == 0) ||
-		    (ioctl_ptr->len > sizeof(uint32_t))) {
+		if (ioctl_ptr->len != sizeof(uint32_t)) {
 			mutex_unlock(&cpp_dev->mutex);
 			return -EINVAL;
 		}
