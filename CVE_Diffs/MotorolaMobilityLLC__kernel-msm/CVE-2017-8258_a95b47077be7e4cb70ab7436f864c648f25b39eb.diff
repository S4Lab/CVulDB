MotorolaMobilityLLC__kernel-msm
commit a95b47077be7e4cb70ab7436f864c648f25b39eb
Author:     Senthil Kumar Rajagopal <skrajago@codeaurora.org>
AuthorDate: Wed Feb 15 15:08:09 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Mon Jul 17 08:44:18 2017 -0500

    msm: isp: fix for potentitial array out of bound access
    
    There is no bound check on dual_hw_ms_cmd->num_src,
    which is coming from userspace
    num_src is used as the index for the input_src array
    which has a size of 5.
    The current code did not check the num_src to make sure
    that it never exceeds the input_src array size.
    
    CRs-Fixed: 2006169, 2005647
    CVE-fixed: CVE-2017-8258
    Mot-CRs-fixed: (CR)
    
    Change-Id: If5927e06e70cce4afb0ae9f2cdfec80f76f83771
    Signed-off-by: Senthil Kumar Rajagopal <skrajago@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1011502
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Robert Kubicki <w17311@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/media/platform/msm/camera_v2_2016/isp/msm_isp_util.c b/drivers/media/platform/msm/camera_v2_2016/isp/msm_isp_util.c
index c6b92af178a2..01ca2fa46bc0 100644
--- a/drivers/media/platform/msm/camera_v2_2016/isp/msm_isp_util.c
+++ b/drivers/media/platform/msm/camera_v2_2016/isp/msm_isp_util.c
@@ -552,6 +552,11 @@ static int msm_isp_set_dual_HW_master_slave_mode(
 	}
 	ISP_DBG("%s: vfe %d num_src %d\n", __func__, vfe_dev->pdev->id,
 		dual_hw_ms_cmd->num_src);
+	if (dual_hw_ms_cmd->num_src > VFE_SRC_MAX) {
+		pr_err("%s: Error! Invalid num_src %d\n", __func__,
+			dual_hw_ms_cmd->num_src);
+		return -EINVAL;
+	}
 	/* This for loop is for non-primary intf to be marked with Master/Slave
 	 * in order for frame id sync. But their timestamp is not saved.
 	 * So no sof_info resource is allocated */
