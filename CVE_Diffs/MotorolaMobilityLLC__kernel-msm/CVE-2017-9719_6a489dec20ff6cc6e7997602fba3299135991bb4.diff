MotorolaMobilityLLC__kernel-msm
commit 6a489dec20ff6cc6e7997602fba3299135991bb4
Author:     zhaoyuan <yzhao@codeaurora.org>
AuthorDate: Mon Feb 20 13:42:20 2017 +0800
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Nov 2 05:00:57 2017 -0500

    msm: mdss: hdmi: check up-bound of CEC frame size
    
    the spec says the frame size will not be greater than
    14, but this have a security hole when somebody sends
    a message with a size greater than 14. So need check
    up-boud of the CEC frame size.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-9719
    
    Change-Id: I743208badc5e77ae911cfb2d102f758d4843138f
    Signed-off-by: zhaoyuan <yzhao@codeaurora.org>
    Signed-off-by: Bikshapathi Kothapeta <bkotha@codeaurora.org>
    Signed-off-by: Ashwin Pathmudi <jfxr63@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1078648
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/video/msm/mdss/mdss_hdmi_cec.c b/drivers/video/msm/mdss/mdss_hdmi_cec.c
index ef9324b83fa7..04614d890c5f 100644
--- a/drivers/video/msm/mdss/mdss_hdmi_cec.c
+++ b/drivers/video/msm/mdss/mdss_hdmi_cec.c
@@ -1,4 +1,4 @@
-/* Copyright (c) 2010-2015, The Linux Foundation. All rights reserved.
+/* Copyright (c) 2010-2017, The Linux Foundation. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -148,7 +148,7 @@ static void hdmi_cec_msg_recv(struct work_struct *work)
 		msg.sender_id, msg.recvr_id,
 		msg.frame_size);
 
-	if (msg.frame_size < 1) {
+	if (msg.frame_size < 1 || msg.frame_size > MAX_CEC_FRAME_SIZE) {
 		DEV_ERR("%s: invalid message (frame length = %d)\n",
 			__func__, msg.frame_size);
 		return;
@@ -168,7 +168,7 @@ static void hdmi_cec_msg_recv(struct work_struct *work)
 		msg.operand[i] = data & 0xFF;
 	}
 
-	for (; i < 14; i++)
+	for (; i < MAX_OPERAND_SIZE; i++)
 		msg.operand[i] = 0;
 
 	if (cbs && cbs->msg_recv_notify)
