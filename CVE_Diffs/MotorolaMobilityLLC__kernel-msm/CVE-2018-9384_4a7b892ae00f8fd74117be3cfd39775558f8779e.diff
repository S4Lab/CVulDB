MotorolaMobilityLLC__kernel-msm
commit 4a7b892ae00f8fd74117be3cfd39775558f8779e
Author:     amarenr <amarenr@motorola.com>
AuthorDate: Tue May 29 16:01:55 2018 +0530
Commit:     chenyt9 <chenyt9@lenovo.com>
CommitDate: Thu Nov 28 17:31:28 2019 +0800

    Fix: Solve Compilation error caused due to movement of struct thread_info
    
    The patch ""BACKPORT: arm64: split thread_info from task stack"
    moves arm64's struct thread_info from the task stack into
    task_struct. This protects thread_info from corruption in the case of
    stack overflows.
    
    This patch solves compilation error "task is not present in the struct thread_info"
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2018-9384
    Bug: 74356909
    
    Change-Id: Icd68725bf6fe179adf0c4be9c5a428b1b50478c6
    Signed-off-by: Amarendra Reddy <amarenr@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1182407
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/soc/qcom/watchdog_cpu_ctx.c b/drivers/soc/qcom/watchdog_cpu_ctx.c
index 5a01405fc09c..e4cc0332f3d1 100644
--- a/drivers/soc/qcom/watchdog_cpu_ctx.c
+++ b/drivers/soc/qcom/watchdog_cpu_ctx.c
@@ -494,7 +494,8 @@ static void msm_wdog_ctx_lnx_arch(struct msm_wdog_lnx_info *lnx)
 static void msm_wdog_ctx_lnx(struct msm_wdog_lnx_info *lnx)
 {
 	lnx->tsk_size = sizeof(struct task_struct);
-	lnx->ti_tsk_offset = offsetof(struct thread_info, task);
+	/* struct thread_info doesnot recide anymore on stack  */
+	/* lnx->ti_tsk_offset = offsetof(struct thread_info, task); */
 	lnx->aa64 = config_enabled(CONFIG_ARM64);
 	lnx->lpae = config_enabled(CONFIG_ARM_LPAE);
 	lnx->text_paddr = virt_to_phys(_text);
