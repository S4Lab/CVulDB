MotorolaMobilityLLC__kernel-msm
commit deecc58b2f47a30030a8142e4010b72b72137ba4
Author:     Shihuan Liu <chiaweic@codeaurora.org>
AuthorDate: Fri Oct 6 20:38:02 2017 -0700
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Apr 12 22:53:02 2018 -0500

    msm: ipa: add null terminator
    
    Add null terminator at the end of string
    extend_ioctl_data.u.rmnet_mux_val.vchannel_name
    to avoid potential security issue.
    
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2017-8269
    Bug: 33967002
    CRs-fixed: 2013145, 2114278
    
    Change-Id: I57fe3a9f7e3ad6a499b62a9cfc49bc6b2f3b42e0
    Acked-by: Shihuan Liu <shihuanl@qti.qualcomm.com>
    Signed-off-by: Skylar Chang <chiaweic@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/1150816
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/platform/msm/ipa/ipa_v2/rmnet_ipa.c b/drivers/platform/msm/ipa/ipa_v2/rmnet_ipa.c
index 607a18d59841..354d2bf2e5cc 100644
--- a/drivers/platform/msm/ipa/ipa_v2/rmnet_ipa.c
+++ b/drivers/platform/msm/ipa/ipa_v2/rmnet_ipa.c
@@ -1413,6 +1413,8 @@ static int ipa_wwan_ioctl(struct net_device *dev, struct ifreq *ifr, int cmd)
 				mutex_unlock(&add_mux_channel_lock);
 				return -EFAULT;
 			}
+			extend_ioctl_data.u.rmnet_mux_val.vchannel_name
+				[IFNAMSIZ-1] = '\0';
 			IPAWANDBG("ADD_MUX_CHANNEL(%d, name: %s)\n",
 			extend_ioctl_data.u.rmnet_mux_val.mux_id,
 			extend_ioctl_data.u.rmnet_mux_val.vchannel_name);
diff --git a/drivers/platform/msm/ipa/ipa_v3/rmnet_ipa.c b/drivers/platform/msm/ipa/ipa_v3/rmnet_ipa.c
index 0406ae3817bd..2001bdb86304 100644
--- a/drivers/platform/msm/ipa/ipa_v3/rmnet_ipa.c
+++ b/drivers/platform/msm/ipa/ipa_v3/rmnet_ipa.c
@@ -1433,6 +1433,8 @@ static int ipa3_wwan_ioctl(struct net_device *dev, struct ifreq *ifr, int cmd)
 					add_mux_channel_lock);
 				return -EFAULT;
 			}
+			extend_ioctl_data.u.rmnet_mux_val.vchannel_name
+				[IFNAMSIZ-1] = '\0';
 			IPAWANDBG("ADD_MUX_CHANNEL(%d, name: %s)\n",
 			extend_ioctl_data.u.rmnet_mux_val.mux_id,
 			extend_ioctl_data.u.rmnet_mux_val.vchannel_name);
