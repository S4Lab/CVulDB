MotorolaMobilityLLC__kernel-msm
commit 5df473a6724e0c23c7e4297b1ca55e70bc505549
Author:     Sahara <keun-o.park@darkmatter.ae>
AuthorDate: Sun Dec 4 12:50:18 2016 +0400
Commit:     Fan Hang <hangfan1@lenovo.com>
CommitDate: Tue Oct 17 09:27:06 2017 +0800

    enable ARCH_HAS_ELF_RANDOMIZE again
    
    The patch e4622e4 somehow accidentally removed ARCH_HAS_ELF_RANDOMIZE.
    Without this option, arch_mmap_rnd(), called by load_elf_binary(), does
    not work properly and just returns 0 instead even though a process has
    PF_RANDOMIZE flag. As a result, dynamic program's mmap base is not
    randomized at all.
    
    Bug: 33351919
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2017-0528
    
    Change-Id: Ice2df132dc436b647fa0312dd7453f9ed6160a2a
    Signed-off-by: Sahara <keun-o.park@darkmatter.ae>
    Signed-off-by: Varun Shrivastava <varunshrivastava@motorola.com>
    Reviewed-on: https://gerrit.mot.com/950280
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>
    (cherry picked from commit a32182819da7525a180435f1246369fe98caa8c3)
    Reviewed-on: https://gerrit.mot.com/971715
    Reviewed-by: jinyou liu <liujy7@motorola.com>
    SLTApproved: jinyou liu <liujy7@motorola.com>
    Submit-Approved: jinyou liu <liujy7@motorola.com>

diff --git a/arch/Kconfig b/arch/Kconfig
index 240bda0276b9..6dd709f6bb32 100644
--- a/arch/Kconfig
+++ b/arch/Kconfig
@@ -484,6 +484,13 @@ config HAVE_IRQ_EXIT_ON_IRQ_STACK
 	  This spares a stack switch and improves cache usage on softirq
 	  processing.
 
+config ARCH_HAS_ELF_RANDOMIZE
+	bool
+	help
+	  An architecture supports choosing randomized locations for
+	  stack, mmap, brk, and ET_DYN. Defined functions:
+	  - arch_mmap_rnd()
+
 config HAVE_ARCH_MMAP_RND_BITS
 	bool
 	help
