MotorolaMobilityLLC__kernel-msm
commit 933c2ea932bdafab6ba099039c0225ed71b9f1fa
Author:     Abir Ghosh <abirg@codeaurora.org>
AuthorDate: Tue May 2 22:41:06 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Dec 21 22:18:26 2017 -0600

    qbt1000: Validate FP app name before qseecom_start_app
    
    Validate the name of the client app before passing it to
    qseecom_start_app.
    
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2017-9716
    CRs-Fixed: 2006695
    
    Change-Id: I9c6b16050d4f6fc94827021c7b0f2ab292452f60
    Signed-off-by: Abir Ghosh <abirg@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/1068469
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/soc/qcom/qbt1000.c b/drivers/soc/qcom/qbt1000.c
index ee4939ab3ecd..335333098a49 100644
--- a/drivers/soc/qcom/qbt1000.c
+++ b/drivers/soc/qcom/qbt1000.c
@@ -60,6 +60,7 @@ enum sensor_connection_types {
  * user space will provide new value upon tz app load
  */
 static uint32_t g_app_buf_size = SZ_256K;
+static char const *const FP_APP_NAME = "fingerpr";
 
 struct qbt1000_drvdata {
 	struct class	*qbt1000_class;
@@ -794,6 +795,13 @@ static long qbt1000_ioctl(struct file *file, unsigned cmd, unsigned long arg)
 			goto end;
 		}
 
+		if (strcmp(app.name, FP_APP_NAME)) {
+			dev_err(drvdata->dev, "%s: Invalid app name\n",
+				__func__);
+			rc = -EINVAL;
+			goto end;
+		}
+
 		if (drvdata->app_handle) {
 			dev_err(drvdata->dev, "%s: LOAD app already loaded, unloading first\n",
 				__func__);
