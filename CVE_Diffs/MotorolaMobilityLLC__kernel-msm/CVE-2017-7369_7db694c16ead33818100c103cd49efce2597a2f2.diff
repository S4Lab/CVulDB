MotorolaMobilityLLC__kernel-msm
commit 7db694c16ead33818100c103cd49efce2597a2f2
Author:     Walter Yang <yandongy@codeaurora.org>
AuthorDate: Thu May 11 14:13:26 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Mon Jun 26 00:51:59 2017 -0500

    ASoC: Add backend user count checking
    
    Add backend user count checking to protect the index
    boundary.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-7369
    Bug-Id: A-33751424
    Change-Id: Ic1b61d1f7130252cc54da0b16553858714988dbd
    CRs-Fixed: 2009216
    Signed-off-by: Walter Yang <yandongy@codeaurora.org>
    --
    Reviewed-on: https://gerrit.mot.com/993086
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/sound/soc/soc-compress.c b/sound/soc/soc-compress.c
index 90e56dcd2fab..920bbae3dd77 100644
--- a/sound/soc/soc-compress.c
+++ b/sound/soc/soc-compress.c
@@ -569,6 +569,11 @@ static int soc_compr_set_params_fe(struct snd_compr_stream *cstream,
 				cstream, &async_domain);
 			} else {
 				be_list[j++] = be;
+				if (j == DPCM_MAX_BE_USERS) {
+					dev_dbg(fe->dev,
+						"ASoC: MAX backend users!\n");
+					break;
+				}
 			}
 		}
 		for (i = 0; i < j; i++) {
diff --git a/sound/soc/soc-pcm.c b/sound/soc/soc-pcm.c
index 7e2b2f3ac720..21e503c6d802 100644
--- a/sound/soc/soc-pcm.c
+++ b/sound/soc/soc-pcm.c
@@ -1851,6 +1851,10 @@ void dpcm_be_dai_prepare_async(struct snd_soc_pcm_runtime *fe, int stream,
 							    dpcm, domain);
 		} else {
 			dpcm_async[i++] = dpcm;
+			if (i == DPCM_MAX_BE_USERS) {
+				dev_dbg(fe->dev, "ASoC: MAX backend users!\n");
+				break;
+			}
 		}
 	}
 
