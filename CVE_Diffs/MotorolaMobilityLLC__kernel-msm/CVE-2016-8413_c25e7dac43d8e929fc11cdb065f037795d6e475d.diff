MotorolaMobilityLLC__kernel-msm
commit c25e7dac43d8e929fc11cdb065f037795d6e475d
Author:     Krishnankutty Kolathappilly <kkolatha@codeaurora.org>
AuthorDate: Wed Nov 16 18:22:58 2016 -0800
Commit:     lulu2 <lulu2@lenovo.com>
CommitDate: Wed Jun 6 12:10:53 2018 +0800

    msm: cpp: Fix for buffer overflow in cpp.
    
    Fix for buffer overflow while handling ioctl.
    Instead of checking for length boundary, fix checks
    for exact length.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2016-8413
    CRs-Fixed: 518731
    
    Change-Id: Id9fd3b0b671caa0522bd51b77f2c501ea37b3332
    Signed-off-by: Krishnankutty Kolathappilly <kkolatha@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/950699
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/media/platform/msm/camera_v2_2016/pproc/cpp/msm_cpp.c b/drivers/media/platform/msm/camera_v2_2016/pproc/cpp/msm_cpp.c
index bae99da9d030..29cb00bec897 100644
--- a/drivers/media/platform/msm/camera_v2_2016/pproc/cpp/msm_cpp.c
+++ b/drivers/media/platform/msm/camera_v2_2016/pproc/cpp/msm_cpp.c
@@ -2950,8 +2950,7 @@ STREAM_BUFF_END:
 		uint32_t identity;
 		struct msm_cpp_buff_queue_info_t *buff_queue_info;
 		CPP_DBG("VIDIOC_MSM_CPP_DEQUEUE_STREAM_BUFF_INFO\n");
-		if ((ioctl_ptr->len == 0) ||
-		    (ioctl_ptr->len > sizeof(uint32_t))) {
+		if (ioctl_ptr->len != sizeof(uint32_t)) {
 			mutex_unlock(&cpp_dev->mutex);
 			return -EINVAL;
 		}
