MotorolaMobilityLLC__kernel-msm
commit 2e782771336649641635d30a3bbd2fe9d3698c9c
Author:     Ashish Garg <ashigarg@codeaurora.org>
AuthorDate: Mon Jun 5 14:58:28 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Dec 21 22:16:10 2017 -0600

    msm: mdss: size check before writing to edid buffer
    
    To update custom edid through sysfs node, there was no check
    on the edid size passed. The user can overwrite the edid buffer.
    To prevent buffer overflow, ensure that edid size is validated
    with the edid buffer size before writing to the buffer.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-9722
    
    Change-Id: I8604ea2d25f3a4985749bd037497d242b0621519
    Signed-off-by: Ashish Garg <ashigarg@codeaurora.org>
    Signed-off-by: Ashwin Pathmudi <jfxr63@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1093936
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Shi-Yong Li <a22381@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/video/msm/mdss/mdss_hdmi_tx.c b/drivers/video/msm/mdss/mdss_hdmi_tx.c
index 99f4680c880f..d5d314d6b469 100644
--- a/drivers/video/msm/mdss/mdss_hdmi_tx.c
+++ b/drivers/video/msm/mdss/mdss_hdmi_tx.c
@@ -553,7 +553,8 @@ static ssize_t hdmi_tx_sysfs_wta_edid(struct device *dev,
 	}
 
 	mutex_lock(&hdmi_ctrl->tx_lock);
-	if (edid_size < EDID_BLOCK_SIZE) {
+	if ((edid_size < EDID_BLOCK_SIZE) ||
+		(edid_size > hdmi_ctrl->edid_buf_size)) {
 		DEV_DBG("%s: disabling custom edid\n", __func__);
 
 		ret = -EINVAL;
