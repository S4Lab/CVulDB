MotorolaMobilityLLC__kernel-msm
commit ca72a05ced5e45773922d0f43f46d6832c11de24
Author:     shunmin_wang <shunmin_wang@asus.com>
AuthorDate: Wed Jun 8 15:38:01 2016 +0800
Commit:     Carol_Jiang <carol_jiang@asus.com>
CommitDate: Mon Jun 20 10:39:24 2016 +0800

    anthias: secutiry patch for ANDROID-28447556 (CVE-2016-3811)
    
    Change-Id: I548669d4373f30cf63ec59621124a3260151dfe4
    Reviewed-on: http://mcrd1-22-pc.corpnet.asus/code-review/master/236401
    Reviewed-by: shunmin_wang <shunmin_wang@asus.com>
    Tested-by: shunmin_wang <shunmin_wang@asus.com>

diff --git a/drivers/video/adf/adf_client.c b/drivers/video/adf/adf_client.c
index 8061d8e6b9fb..75b2f0b18522 100644
--- a/drivers/video/adf/adf_client.c
+++ b/drivers/video/adf/adf_client.c
@@ -305,8 +305,10 @@ static int adf_buffer_map(struct adf_device *dev, struct adf_buffer *buf,
 	}
 
 done:
-	if (ret < 0)
+	if (ret < 0) {
 		adf_buffer_mapping_cleanup(mapping, buf);
+		memset(mapping, 0, sizeof(*mapping));
+	}
 
 	return ret;
 }
