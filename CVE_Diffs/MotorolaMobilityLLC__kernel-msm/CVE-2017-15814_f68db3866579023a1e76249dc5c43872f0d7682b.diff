MotorolaMobilityLLC__kernel-msm
commit f68db3866579023a1e76249dc5c43872f0d7682b
Author:     Tanvi Aggarwal <tanvia@codeaurora.org>
AuthorDate: Thu Aug 24 11:51:35 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Mon Jun 18 11:56:23 2018 -0500

    msm: sensor: flash: add conditional check for ioctl
    
    Add conditional check when sending VIDIOC_MSM_FLASH_CFG
    in 32-bit process.
    
    Bug-id: A-64836865
    CRs-Fixed: 2092793
    CVE-fixed: CVE-2017-15814
    Mot-CRs-fixed: (CR)
    
    Change-Id: I80ffc5989e3513c7418c24518bc19d8f6a020357
    Signed-off-by: Tanvi Aggarwal <tanvia@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1134298
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit 9941ecdc41e9addff153c400045ec4d00b17b58f)

diff --git a/drivers/media/platform/msm/camera_v2_2016/sensor/flash/msm_flash.c b/drivers/media/platform/msm/camera_v2_2016/sensor/flash/msm_flash.c
index 9cfa540e2f5a..80d13841455d 100644
--- a/drivers/media/platform/msm/camera_v2_2016/sensor/flash/msm_flash.c
+++ b/drivers/media/platform/msm/camera_v2_2016/sensor/flash/msm_flash.c
@@ -1103,6 +1103,9 @@ static long msm_flash_subdev_do_ioctl(
 			break;
 		}
 		break;
+	case VIDIOC_MSM_FLASH_CFG:
+		pr_err("invalid cmd 0x%x received\n", cmd);
+		return -EINVAL;
 	default:
 		return msm_flash_subdev_ioctl(sd, cmd, arg);
 	}
