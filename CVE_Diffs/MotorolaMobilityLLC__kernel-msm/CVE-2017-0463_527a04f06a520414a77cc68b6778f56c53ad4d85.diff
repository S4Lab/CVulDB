MotorolaMobilityLLC__kernel-msm
commit 527a04f06a520414a77cc68b6778f56c53ad4d85
Author:     Karthikeyan Ramasubramanian <kramasub@codeaurora.org>
AuthorDate: Thu Dec 15 08:13:20 2016 -0700
Commit:     Fan Hang <hangfan1@lenovo.com>
CommitDate: Tue Oct 17 09:27:01 2017 +0800

    net: ipc_router: Register services only on client port
    
    Allowing services to be registered on a non-client port will cause either
    an existing service or a control port to be over-written. This will cause
    undefined functional behavior.
    
    Allow the services to be registered only on client ports.
    
    Mot-CRs-fixed:(CR)
    CVE-Fixed:CVE-2017-0463
    
    CRs-Fixed: 1101792
    Change-Id: If6cfc75e9314204b7b44957f1598a8a2e1a45325
    Signed-off-by: Karthikeyan Ramasubramanian <kramasub@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/966110
    SME-Granted: SME Approvals Granted
    Submit-Approved: Jira Key <jirakey@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: jinyou liu <liujy7@motorola.com>
    SLTApproved: jinyou liu <liujy7@motorola.com>
    Submit-Approved: jinyou liu <liujy7@motorola.com>
    (cherry picked from commit a1b90c4e8bb34e6adeb380f60713692201f0d122)
    Reviewed-on: https://gerrit.mot.com/971699

diff --git a/net/ipc_router/ipc_router_core.c b/net/ipc_router/ipc_router_core.c
index fae41583d0e9..b0317b688d75 100644
--- a/net/ipc_router/ipc_router_core.c
+++ b/net/ipc_router/ipc_router_core.c
@@ -2808,6 +2808,9 @@ int msm_ipc_router_register_server(struct msm_ipc_port *port_ptr,
 	if (!port_ptr || !name)
 		return -EINVAL;
 
+	if (port_ptr->type != CLIENT_PORT)
+		return -EINVAL;
+
 	if (name->addrtype != MSM_IPC_ADDR_NAME)
 		return -EINVAL;
 
