MotorolaMobilityLLC__kernel-msm
commit e815f9591af55c893608e2b69d7031185a846afa
Author:     Trishansh Bhardwaj <tbhardwa@codeaurora.org>
AuthorDate: Fri Jul 6 16:08:12 2018 +0530
Commit:     chenyt9 <chenyt9@lenovo.com>
CommitDate: Tue Dec 10 15:03:48 2019 +0800

    msm: camera: Fix out-of-bounds read in string class name.
    
    jpeg driver is calling class_create with stack variable, which
    can be overwritten by other stack variables.
    
    Bug-id: A-114041685
    CRs-Fixed: 2220770
    CVE-fixed: CVE-2018-11963
    Mot-CRs-fixed: (CR)
    
    Change-Id: I3c22a5b3375b970ff6b1c6de983dd5833f4e11d0
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Signed-off-by: Trishansh Bhardwaj <tbhardwa@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/1273655
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Sumit Jamadar <xkbr38@motorola.com>
    Reviewed-by: Vijayakumar Gn <vijaygn@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/media/platform/msm/camera_v2/jpeg_10/msm_jpeg_dev.c b/drivers/media/platform/msm/camera_v2/jpeg_10/msm_jpeg_dev.c
index de27e585f63d..a2232e6cc731 100644
--- a/drivers/media/platform/msm/camera_v2/jpeg_10/msm_jpeg_dev.c
+++ b/drivers/media/platform/msm/camera_v2/jpeg_10/msm_jpeg_dev.c
@@ -1,4 +1,4 @@
-/* Copyright (c) 2012-2016, The Linux Foundation. All rights reserved.
+/* Copyright (c) 2012-2018, The Linux Foundation. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -32,6 +32,8 @@
 #define MSM_JPEG_NAME "jpeg"
 #define DEV_NAME_LEN 10
 
+static char devname[DEV_NAME_LEN];
+
 static int msm_jpeg_open(struct inode *inode, struct file *filp)
 {
 	int rc = 0;
@@ -185,7 +187,6 @@ static int msm_jpeg_init_dev(struct platform_device *pdev)
 	struct msm_jpeg_device *msm_jpeg_device_p;
 	const struct of_device_id *device_id;
 	const struct msm_jpeg_priv_data *priv_data;
-	char devname[DEV_NAME_LEN];
 
 	msm_jpeg_device_p = kzalloc(sizeof(struct msm_jpeg_device), GFP_ATOMIC);
 	if (!msm_jpeg_device_p) {
@@ -328,6 +329,7 @@ static struct platform_driver msm_jpeg_driver = {
 static int __init msm_jpeg_driver_init(void)
 {
 	int rc;
+
 	rc = platform_driver_register(&msm_jpeg_driver);
 	return rc;
 }
