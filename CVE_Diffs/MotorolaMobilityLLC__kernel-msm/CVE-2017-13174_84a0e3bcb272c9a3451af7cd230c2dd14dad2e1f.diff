MotorolaMobilityLLC__kernel-msm
commit 84a0e3bcb272c9a3451af7cd230c2dd14dad2e1f
Author:     Wei Li <sirius.liwei@huawei.com>
AuthorDate: Tue Nov 21 20:11:32 2017 +0530
Commit:     lulu2 <lulu2@lenovo.com>
CommitDate: Wed May 9 17:55:09 2018 +0800

    angler: remove 'reboot edl' interface for security.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-13174
    BUG: 63100473
    
    Change-Id: I4fcb508b4bb811b6d0af59269498efcf3d9e8b5e
    Signed-off-by: Wei Li <sirius.liwei@huawei.com>
    Signed-off-by: Amarendra Reddy <amarenr@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1093823
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/power/reset/msm-poweroff.c b/drivers/power/reset/msm-poweroff.c
index 4d5b6dcd6535..877725a0b825 100644
--- a/drivers/power/reset/msm-poweroff.c
+++ b/drivers/power/reset/msm-poweroff.c
@@ -152,6 +152,7 @@ static bool get_dload_mode(void)
 	return dload_mode_enabled;
 }
 
+#if 0
 static void enable_emergency_dload_mode(void)
 {
 	int ret;
@@ -176,6 +177,7 @@ static void enable_emergency_dload_mode(void)
 	if (ret)
 		pr_err("Failed to set secure EDLOAD mode: %d\n", ret);
 }
+#endif
 
 static int dload_set(const char *val, struct kernel_param *kp)
 {
@@ -338,8 +340,10 @@ static void msm_restart_prepare(const char *cmd)
 			if (!ret)
 				__raw_writel(0x6f656d00 | (code & 0xff),
 					     restart_reason);
+#if 0
 		} else if (!strncmp(cmd, "edl", 3)) {
 			enable_emergency_dload_mode();
+#endif
 		} else if (!strncmp(cmd, "post-wdt", 8)) {
 			/* set  flag in PMIC to nofity BL post watchdog reboot */
 			qpnp_pon_store_extra_reset_info(RESET_EXTRA_POST_REBOOT_MASK,
