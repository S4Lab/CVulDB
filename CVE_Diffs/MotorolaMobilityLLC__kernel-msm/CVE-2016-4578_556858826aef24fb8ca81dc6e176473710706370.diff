MotorolaMobilityLLC__kernel-msm
commit 556858826aef24fb8ca81dc6e176473710706370
Author:     Venkat Arcot <venkat@motorola.com>
AuthorDate: Thu Jul 21 10:51:00 2016 -0500
Commit:     Venkat Arcot <venkat@motorola.com>
CommitDate: Thu Aug 4 17:51:55 2016 +0000

    net: fix infoleak in rtnetlink
    
    CVE-2016-4578 - Android August 2016 bulletin
    
    author  Kangjie Lu <kangjielu@gmail.com> 2016-05-03 20:46:24 (GMT)
    committer       David S. Miller <davem@davemloft.net> 2016-05-04 20:19:42 (GMT)
    commit  5f8e44741f9f216e33736ea4ec65ca9ac03036e6
    
    net: fix infoleak in rtnetlink
    The stack object ?map? has a total size of 32 bytes. Its last 4
    bytes are padding generated by compiler. These padding bytes are
    not initialized and sent out via ?nla_put?.
    
    Signed-off-by: Kangjie Lu <kjlu@gatech.edu>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    (cherry picked from commit 1dfaef3791308bd8d88faabe7ff5e83d25fc6976)
    
    Change-Id: I333dcef0d0f86152cca82da86673158d1aa20f1b

diff --git a/net/core/rtnetlink.c b/net/core/rtnetlink.c
index 4c3087dffe78..b4e11e19c275 100644
--- a/net/core/rtnetlink.c
+++ b/net/core/rtnetlink.c
@@ -895,14 +895,14 @@ static int rtnl_fill_ifinfo(struct sk_buff *skb, struct net_device *dev,
 		goto nla_put_failure;
 
 	if (1) {
-		struct rtnl_link_ifmap map = {
-			.mem_start   = dev->mem_start,
-			.mem_end     = dev->mem_end,
-			.base_addr   = dev->base_addr,
-			.irq         = dev->irq,
-			.dma         = dev->dma,
-			.port        = dev->if_port,
-		};
+		struct rtnl_link_ifmap map;
+		memset(&map, 0, sizeof(map));
+		map.mem_start   = dev->mem_start;
+		map.mem_end     = dev->mem_end;
+		map.base_addr   = dev->base_addr;
+		map.irq         = dev->irq;
+		map.dma         = dev->dma;
+		map.port        = dev->if_port;
 		if (nla_put(skb, IFLA_MAP, sizeof(map), &map))
 			goto nla_put_failure;
 	}
