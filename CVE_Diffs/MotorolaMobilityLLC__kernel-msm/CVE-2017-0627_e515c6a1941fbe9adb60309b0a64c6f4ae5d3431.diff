MotorolaMobilityLLC__kernel-msm
commit e515c6a1941fbe9adb60309b0a64c6f4ae5d3431
Author:     Robb Glasser <rglasser@google.com>
AuthorDate: Tue Feb 14 13:25:46 2017 -0800
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Jul 27 00:42:38 2017 -0500

    Prevent heap overflow in uvc driver
    
    The size of uvc_control_mapping is user controlled leading to a
    potential heap overflow in the uvc driver. This adds a check to verify
    the user provided size fits within the bounds of the defined buffer
    size.
    
    Bug: 33300353
    CVE-fixed: CVE-2017-0627
    Mot-CRs-fixed: (CR)
    
    Change-Id: I2412299fc7ab55a20e5c95b5cd72fd401da5e1a6
    Signed-off-by: Robb Glasser <rglasser@google.com>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/980067
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/media/usb/uvc/uvc_ctrl.c b/drivers/media/usb/uvc/uvc_ctrl.c
index 3e59b288b8a8..57d2f89350d2 100644
--- a/drivers/media/usb/uvc/uvc_ctrl.c
+++ b/drivers/media/usb/uvc/uvc_ctrl.c
@@ -1991,6 +1991,9 @@ int uvc_ctrl_add_mapping(struct uvc_video_chain *chain,
 	if (!found)
 		return -ENOENT;
 
+	if (ctrl->info.size < mapping->size)
+		return -EINVAL;
+
 	if (mutex_lock_interruptible(&chain->ctrl_mutex))
 		return -ERESTARTSYS;
 
