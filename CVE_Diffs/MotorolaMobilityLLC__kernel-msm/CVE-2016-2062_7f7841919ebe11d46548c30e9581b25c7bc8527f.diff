MotorolaMobilityLLC__kernel-msm
commit 7f7841919ebe11d46548c30e9581b25c7bc8527f
Author:     frank2_hsieh <frank2_hsieh@asus.com>
AuthorDate: Tue May 31 11:04:53 2016 +0800
Commit:     Eric1 Lin <Eric1_Lin@asus.com>
CommitDate: Sat Jun 18 13:18:27 2016 +0800

    msm: kgsl: Cast perfcounter query count to an unsigned int (CVE-2016-2062)
    
    In adreno_perfcounter_query_group() make sure to cast the user passed
    count to an unsigned int before comparing it to the group count.
    Otherwise the user count could be interpeted as a signed int and
    hilarity ensues.
    
    Change-Id: Ie92930fa42135bf343834a3c55b31c35f7e75a8c
    Reviewed-on: http://mcrd1-22-pc.corpnet.asus/code-review/master/233950
    Reviewed-by: frank2_hsieh <frank2_hsieh@asus.com>
    Tested-by: frank2_hsieh <frank2_hsieh@asus.com>
    Reviewed-by: Eric1 Lin <Eric1_Lin@asus.com>

diff --git a/drivers/gpu/msm/adreno.c b/drivers/gpu/msm/adreno.c
index e91377ebc987..f87a014b8f95 100644
--- a/drivers/gpu/msm/adreno.c
+++ b/drivers/gpu/msm/adreno.c
@@ -517,7 +517,7 @@ int adreno_perfcounter_query_group(struct adreno_device *adreno_dev,
 		return 0;
 	}
 
-	t = min_t(int, group->reg_count, count);
+	t = min_t(unsigned int, group->reg_count, count);
 
 	buf = kmalloc(t * sizeof(unsigned int), GFP_KERNEL);
 	if (buf == NULL) {
