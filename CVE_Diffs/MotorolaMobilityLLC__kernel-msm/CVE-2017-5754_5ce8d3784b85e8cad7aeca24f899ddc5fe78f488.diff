MotorolaMobilityLLC__kernel-msm
commit 5ce8d3784b85e8cad7aeca24f899ddc5fe78f488
Author:     Will Deacon <will.deacon@arm.com>
AuthorDate: Thu Aug 10 13:04:48 2017 +0100
Commit:     chenyt9 <chenyt9@lenovo.com>
CommitDate: Wed Aug 22 10:03:03 2018 +0800

    FROMLIST: arm64: mm: Temporarily disable ARM64_SW_TTBR0_PAN
    
    We're about to rework the way ASIDs are allocated, switch_mm is
    implemented and low-level kernel entry/exit is handled, so keep the
    ARM64_SW_TTBR0_PAN code out of the way whilst we do the heavy lifting.
    
    It will be re-enabled in a subsequent patch.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-5754
    Bug: 69856074
    
    Reviewed-by: Mark Rutland <mark.rutland@arm.com>
    Tested-by: Laura Abbott <labbott@redhat.com>
    Tested-by: Shanker Donthineni <shankerd@codeaurora.org>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    (cherry picked from git://git.kernel.org/pub/scm/linux/kernel/git/arm64/linux.git
     commit 376133b7edc20f237a42e4c72415cc9e8c0a9704)
    
    Change-Id: I38d3f7a66b1Montanaabcea3e23b1e80277b03c6dbe0
    Signed-off-by: Greg Hackmann <ghackmann@google.com>
    Reviewed-on: https://gerrit.mot.com/1132549
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key
    (cherry picked from commit 455c3216c8a8a02fecc1fe272c8bf7f192f20272)

diff --git a/arch/arm64/Kconfig b/arch/arm64/Kconfig
index b89da00735bf..b972db18dd7a 100644
--- a/arch/arm64/Kconfig
+++ b/arch/arm64/Kconfig
@@ -869,6 +869,7 @@ endif
 
 config ARM64_SW_TTBR0_PAN
 	bool "Emulate Privileged Access Never using TTBR0_EL1 switching"
+	depends on BROKEN       # Temporary while switch_mm is reworked
 	help
 	  Enabling this option prevents the kernel from accessing
 	  user-space memory directly by pointing TTBR0_EL1 to a reserved
