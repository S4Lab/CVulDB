MotorolaMobilityLLC__kernel-msm
commit d515d77b0cbccf634782e086e985ed82b3406a72
Author:     Suman Mukherjee <sumam@codeaurora.org>
AuthorDate: Thu Sep 22 09:06:48 2016 +0530
Commit:     Carlos Pinho <cpinho@motorola.com>
CommitDate: Thu Mar 16 14:52:30 2017 -0500

    msm: sensor: validate the i2c table index before use
    
    Verifying the i2c table index value before accessing
    the i2c table to avoid memory corruption issues.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2016-6755
    
    Change-Id: I0e31c22f90006f27a77cd420288334b8355cee95
    Signed-off-by: Sureshnaidu Laveti <lsuresh@codeaurora.org>
    Signed-off-by: Suman Mukherjee <sumam@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    (cherry picked from commit a400ead78aef7b2a19d373d783820f9f80866afd)
    Reviewed-on: https://gerrit.mot.com/918281
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/media/platform/msm/camera_v2/sensor/actuator/msm_actuator.c b/drivers/media/platform/msm/camera_v2/sensor/actuator/msm_actuator.c
index 288cdebe087b..da4374b33a5c 100644
--- a/drivers/media/platform/msm/camera_v2/sensor/actuator/msm_actuator.c
+++ b/drivers/media/platform/msm/camera_v2/sensor/actuator/msm_actuator.c
@@ -138,6 +138,10 @@ static void msm_actuator_parse_i2c_params(struct msm_actuator_ctrl_t *a_ctrl,
 			pr_err("failed: i2c table index out of bound\n");
 			break;
 		}
+		if (a_ctrl->i2c_tbl_index > a_ctrl->total_steps) {
+			pr_err("failed: i2c table index out of bound\n");
+			break;
+		}
 		CDBG("i2c_byte1:0x%x, i2c_byte2:0x%x\n", i2c_byte1, i2c_byte2);
 		i2c_tbl[a_ctrl->i2c_tbl_index].reg_addr = i2c_byte1;
 		i2c_tbl[a_ctrl->i2c_tbl_index].reg_data = i2c_byte2;
