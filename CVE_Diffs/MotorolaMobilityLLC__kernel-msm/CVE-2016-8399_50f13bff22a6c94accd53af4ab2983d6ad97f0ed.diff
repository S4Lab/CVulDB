MotorolaMobilityLLC__kernel-msm
commit 50f13bff22a6c94accd53af4ab2983d6ad97f0ed
Author:     Vineet Angadi V <vineetv@motorola.com>
AuthorDate: Fri Jan 27 16:10:38 2017 -0200
Commit:     Marina Silva <mgsilva@motorola.com>
CommitDate: Mon Feb 13 16:43:38 2017 +0000

    net: ipv4: validate len variable to prevent overflow
    
    There is no validation of the len variable passed to the
    ping_common_sendmsg function to check if it is less than
    icmph_len leading to a potential overflow.The fix is designed to add
    additional validation to prevent the potential overflow.
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2016-8399
    
    Change-Id: I194cc4f6a988e80a40d4866a2ab0006cceacbf90

diff --git a/net/ipv4/ping.c b/net/ipv4/ping.c
index bc41d13c7b56..aa348826532f 100644
--- a/net/ipv4/ping.c
+++ b/net/ipv4/ping.c
@@ -651,7 +651,7 @@ int ping_common_sendmsg(int family, struct msghdr *msg, size_t len,
 			void *user_icmph, size_t icmph_len) {
 	u8 type, code;
 
-	if (len > 0xFFFF)
+	if (len > 0xFFFF || len < icmph_len)
 		return -EMSGSIZE;
 
 	/*
