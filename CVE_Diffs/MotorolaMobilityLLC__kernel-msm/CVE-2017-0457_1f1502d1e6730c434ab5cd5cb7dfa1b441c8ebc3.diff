MotorolaMobilityLLC__kernel-msm
commit 1f1502d1e6730c434ab5cd5cb7dfa1b441c8ebc3
Author:     Biswajit Paul <biswajitpaul@codeaurora.org>
AuthorDate: Thu Feb 16 13:45:05 2017 +0530
Commit:     Neeraj Kumar <neerajk@motorola.com>
CommitDate: Fri Feb 17 01:03:18 2017 -0600

    msm: ADSPRPC: Buffer length truncated while validation
    
    The buffer length that is being used to validate gets truncated
    due to it being assigned to wrong type causing invalid memory
    to be accessed when the actual buffer length is used to copy
    user buffer contents.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-0457
    Bug: 31695439
    CRs-Fixed: 1086123
    Change-Id: If04dee27b8bae04eef7455773d9f4327fd008a21
    Signed-off-by: Sathish Ambley <sathishambley@codeaurora.org>
    Signed-off-by: Biswajit Paul <biswajitpaul@codeaurora.org>
    ---
    Reviewed-on: https://gerrit.mot.com/951624
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Ravikumar Vembu <raviv@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/char/adsprpc.c b/drivers/char/adsprpc.c
index 8188296d7535..b6ccd4105b29 100644
--- a/drivers/char/adsprpc.c
+++ b/drivers/char/adsprpc.c
@@ -720,7 +720,8 @@ static int get_page_list(uint32_t kernel, struct smq_invoke_ctx *ctx)
 	pgstart->size = obuf->size;
 	for (i = 0; i < inbufs + outbufs; ++i) {
 		void *buf;
-		int len, num;
+		int num;
+		ssize_t len;
 
 		list[i].num = 0;
 		list[i].pgidx = 0;
