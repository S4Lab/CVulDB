MotorolaMobilityLLC__kernel-msm
commit a32d278cdf4bd8a883d9b8d910176611ae3c765f
Author:     Linus Torvalds <torvalds@linux-foundation.org>
AuthorDate: Tue Dec 12 15:12:58 2017 +0530
Commit:     Amarendra Reddy <amarenr@motorola.com>
CommitDate: Fri Dec 22 01:22:59 2017 -0600

    Sanitize 'move_pages()' permission checks
    
    The 'move_paghes()' system call was introduced long long ago with the
    same permission checks as for sending a signal (except using
    CAP_SYS_NICE instead of CAP_SYS_KILL for the overriding capability).
    
    That turns out to not be a great choice - while the system call really
    only moves physical page allocations around (and you need other
    capabilities to do a lot of it), you can check the return value to map
    out some the virtual address choices and defeat ASLR of a binary that
    still shares your uid.
    
    So change the access checks to the more common 'ptrace_may_access()'
    model instead.
    
    This tightens the access checks for the uid, and also effectively
    changes the CAP_SYS_NICE check to CAP_SYS_PTRACE, but it's unlikely that
    anybody really _uses_ this legacy system call any more (we hav ebetter
    NUMA placement models these days), so I expect nobody to notice.
    
    Famous last words.
    
    Mot-CRs-fixed: (CR)
    CVE-Fixed: CVE-2017-1414
    Bug: 65468230
    
    Change-Id: Iaee2887e899556918a4142f41d2e15b5a3382be9
    Reported-by: Otto Ebeling <otto.ebeling@iki.fi>
    Acked-by: Eric W. Biederman <ebiederm@xmission.com>
    Cc: Willy Tarreau <w@1wt.eu>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: amarenr <amarenr@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1102959
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/mm/migrate.c b/mm/migrate.c
index 864ebe2282d5..3c808a9d0919 100644
--- a/mm/migrate.c
+++ b/mm/migrate.c
@@ -40,6 +40,7 @@
 #include <linux/ptrace.h>
 #include <linux/compaction.h>
 #include <trace/events/kmem.h>
+#include <linux/ptrace.h>
 
 #include <asm/tlbflush.h>
 
