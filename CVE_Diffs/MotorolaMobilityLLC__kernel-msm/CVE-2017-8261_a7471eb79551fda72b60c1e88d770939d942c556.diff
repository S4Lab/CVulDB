MotorolaMobilityLLC__kernel-msm
commit a7471eb79551fda72b60c1e88d770939d942c556
Author:     Trishansh Bhardwaj <tbhardwa@codeaurora.org>
AuthorDate: Tue Apr 18 14:44:43 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Fri Aug 17 03:51:57 2018 -0500

    msm: camera: Fix kernel overwrite GET_BUF_BY_IDX ioctl
    
    Assign address of buf_info into ioctl_ptr.
    Previously we were copying first 8 bytes of buf_info (content)
    into ioctl_ptr. Which is dereferenced and written later causing
    kernel overwrite vulnerability.
    
    Bug-id: A-35139833
    CVE-fixed: CVE-2017-8261
    CRs-fixed: 2013631
    Mot-CRs-fixed: (CR), (CR)
    
    Change-Id: Ie5deae249da8208523027f8ec5632f960757e9bd
    Signed-off-by: Trishansh Bhardwaj <tbhardwa@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1214039
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Ravikumar Vembu <raviv@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/media/platform/msm/camera_v2_2016/msm_buf_mgr/msm_generic_buf_mgr.c b/drivers/media/platform/msm/camera_v2_2016/msm_buf_mgr/msm_generic_buf_mgr.c
index 067a45213813..89a41ed1d589 100644
--- a/drivers/media/platform/msm/camera_v2_2016/msm_buf_mgr/msm_generic_buf_mgr.c
+++ b/drivers/media/platform/msm/camera_v2_2016/msm_buf_mgr/msm_generic_buf_mgr.c
@@ -552,8 +552,7 @@ static long msm_buf_mngr_subdev_ioctl(struct v4l2_subdev *sd,
 				sizeof(struct msm_buf_mngr_info))) {
 				return -EFAULT;
 			}
-			MSM_CAM_GET_IOCTL_ARG_PTR(&k_ioctl.ioctl_ptr,
-				&buf_info, sizeof(void *));
+			k_ioctl.ioctl_ptr = (uintptr_t)&buf_info;
 			argp = &k_ioctl;
 			rc = msm_cam_buf_mgr_ops(cmd, argp);
 			}
