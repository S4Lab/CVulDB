MotorolaMobilityLLC__kernel-msm
commit 58053a7b7aae4296fb36a7a8258a0e58b0a53f0c
Author:     Sathish Ambley <sathishambley@codeaurora.org>
AuthorDate: Thu Apr 13 14:36:55 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Wed May 31 08:42:47 2017 -0500

    msm: ADSPRPC: Check for buffer overflow condition
    
    The buffer length that is being passed could result in overflow
    condition causing invalid memory to be accessed.
    
    CVE-fixed: CVE-2017-0465
    Bug-Id: A-34112914
    Change-Id: I3e23f31b8cb61f8e77d09a39fab4a2d4c222cf25
    Signed-off-by: Sathish Ambley <sathishambley@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/979412
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/char/adsprpc.c b/drivers/char/adsprpc.c
index b6ccd4105b29..815d822565a7 100644
--- a/drivers/char/adsprpc.c
+++ b/drivers/char/adsprpc.c
@@ -465,6 +465,11 @@ static int context_build_overlap(struct smq_invoke_ctx *ctx)
 	for (i = 0; i < nbufs; ++i) {
 		ctx->overs[i].start = (uintptr_t)pra[i].buf.pv;
 		ctx->overs[i].end = ctx->overs[i].start + pra[i].buf.len;
+		if (pra[i].buf.len) {
+			VERIFY(err, ctx->overs[i].end > ctx->overs[i].start);
+			if (err)
+				goto bail;
+		}
 		ctx->overs[i].raix = i;
 		ctx->overps[i] = &ctx->overs[i];
 	}
