MotorolaMobilityLLC__kernel-msm
commit 4d9b38571ff253e061c6f98d0e051832107862b2
Author:     Nicolai Stange <nstange@suse.de>
AuthorDate: Thu Jun 14 14:09:05 2018 +0530
Commit:     Varun Shrivastava <varunshrivastava@motorola.com>
CommitDate: Wed Jul 4 01:03:37 2018 -0500

    PCI: don't use snprintf() in driver_override_show()
    
    Quote from Documentation/filesystems/sysfs.txt:
    
      show() must not use snprintf() when formatting the value to be
      returned to user space. If you can guarantee that an overflow
      will never happen you can use sprintf() otherwise you must use
      scnprintf().
    
    Commit 4efe874aace5 ("PCI: Don't read past the end of sysfs
    "driver_override" buffer") introduced such a snprintf() usage from
    driver_override_show() while at the same time tweaking
    driver_override_store() such that the write buffer can't ever get
    overflowed.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2018-9415
    Bug: 69129004
    
    Reasoning:
    Since aforementioned commit, driver_override_store() only accepts to be
    written buffers less than PAGE_SIZE - 1 in size.
    
    The then kstrndup()'ed driver_override string will be at most PAGE_SIZE - 1
    in length, including the trailing '\0'.
    
    After the addition of a '\n' in driver_override_show(), the result won't
    exceed PAGE_SIZE characters in length, again including the trailing '\0'.
    
    Hence, snprintf(buf, PAGE_SIZE, ...) and sprintf(buf, ...) are equivalent
    at this point.
    
    Replace the former by the latter in order to adhere to the rules in
    Documentation/filesystems/sysfs.txt.
    
    This is a style fix only and there's no change in functionality.
    
    Change-Id: I1052e912477122d87e12f933e96d83f32d0efd0d
    Signed-off-by: Nicolai Stange <nstange@suse.de>
    Acked-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Reviewed-on: https://gerrit.mot.com/1191322
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/pci/pci-sysfs.c b/drivers/pci/pci-sysfs.c
index 318707870cb2..21c710017751 100644
--- a/drivers/pci/pci-sysfs.c
+++ b/drivers/pci/pci-sysfs.c
@@ -549,7 +549,7 @@ static ssize_t driver_override_show(struct device *dev,
 	ssize_t len;
 
 	device_lock(dev);
-	len = snprintf(buf, PAGE_SIZE, "%s\n", pdev->driver_override);
+	len = sprintf(buf, "%s\n", pdev->driver_override);
 	device_unlock(dev);
 	return len;
 }
