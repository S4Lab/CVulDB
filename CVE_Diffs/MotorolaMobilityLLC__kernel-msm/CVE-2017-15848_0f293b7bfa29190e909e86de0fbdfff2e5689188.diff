MotorolaMobilityLLC__kernel-msm
commit 0f293b7bfa29190e909e86de0fbdfff2e5689188
Author:     Tharun Kumar Merugu <mtharu@codeaurora.org>
AuthorDate: Fri Dec 22 01:27:36 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Wed Jan 3 05:16:58 2018 -0600

    msm: ADSPRPC: validate user buffers after copying from user
    
    validate user buffers before accessing in kernel driver.
    
    CVE-fixed: CVE-2017-15848
    Mot-CRs-fixed: (CR)
    Bug-Id: A-67713083
    CRs-Fixed: 2073777
    Change-Id: I7997d069d0549de03f1467c63bdb81b20fcf3d6c
    Acked-by: Chenna Kesava Raju <chennak@qti.qualcomm.com>
    Signed-off-by: Tharun Kumar Merugu <mtharu@codeaurora.org>
    
    Signed-off-by: Neeraj Kumar <neerajk@motorola.com>
    Change-Id: I8933700e8d68205fdcc7e39f2edb921e21c82027
    Reviewed-on: https://gerrit.mot.com/1108040
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Yuesheng Huang <huangys@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/char/adsprpc.c b/drivers/char/adsprpc.c
index 3fde99d8a7d4..c11c3df1e1f8 100644
--- a/drivers/char/adsprpc.c
+++ b/drivers/char/adsprpc.c
@@ -1704,6 +1704,10 @@ static long fastrpc_device_ioctl(struct file *file, unsigned int ioctl_num,
 						sizeof(p.init)));
 		if (err)
 			goto bail;
+		VERIFY(err, p.init.filelen >= 0 &&
+			p.init.memlen >= 0);
+		if (err)
+			goto bail;
 		VERIFY(err, 0 == fastrpc_init_process(fl, &p.init));
 		if (err)
 			goto bail;
