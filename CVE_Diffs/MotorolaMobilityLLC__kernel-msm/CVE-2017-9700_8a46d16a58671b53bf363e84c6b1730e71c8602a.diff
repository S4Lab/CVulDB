MotorolaMobilityLLC__kernel-msm
commit 8a46d16a58671b53bf363e84c6b1730e71c8602a
Author:     Xiaoyu Ye <benyxy@codeaurora.org>
AuthorDate: Wed Jul 19 14:08:53 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Dec 28 03:00:53 2017 -0600

    ASoC: msm-cpe: Fix range checking in function fw_name_store
    
    The range checking between "WCD_CPE_IMAGE_FNAME_MAX" and
    "copy_count" is off-by-one due to the size of array
    "core->dyn_fname" is "WCD_CPE_IMAGE_FNAME_MAX". Subtract
    one from the range checking to fix this issue.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-9700
    CRs-Fixed: 2043822
    Change-Id: I87fd55206f79ad7b13c3878f6642bf5579303b17
    Signed-off-by: Xiaoyu Ye <benyxy@codeaurora.org>
    
    Signed-off-by: Neeraj Kumar <neerajk@motorola.com>
    Change-Id: I7999bbc4a40ff119cdda16c3fb023d4a42e2c6ce
    Reviewed-on: https://gerrit.mot.com/1028579
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/sound/soc/codecs/wcd_cpe_core.c b/sound/soc/codecs/wcd_cpe_core.c
index 16582fabfb41..bceaed1e71d3 100644
--- a/sound/soc/codecs/wcd_cpe_core.c
+++ b/sound/soc/codecs/wcd_cpe_core.c
@@ -1737,10 +1737,10 @@ static ssize_t fw_name_store(struct wcd_cpe_core *core,
 	if (pos)
 		copy_count = pos - buf;
 
-	if (copy_count > WCD_CPE_IMAGE_FNAME_MAX) {
+	if (copy_count > (WCD_CPE_IMAGE_FNAME_MAX - 1)) {
 		dev_err(core->dev,
 			"%s: Invalid length %d, max allowed %d\n",
-			__func__, copy_count, WCD_CPE_IMAGE_FNAME_MAX);
+			__func__, copy_count, WCD_CPE_IMAGE_FNAME_MAX - 1);
 		return -EINVAL;
 	}
 
