MotorolaMobilityLLC__kernel-msm
commit e8ce056a75b3125bb89f4f2005a26e66ff7ea861
Author:     Suman Mukherjee <sumam@codeaurora.org>
AuthorDate: Fri Jan 27 16:17:14 2017 -0200
Commit:     Marina Silva <mgsilva@motorola.com>
CommitDate: Mon Feb 13 16:43:27 2017 +0000

    msm: camera: cpp: Add validation for v4l2 ioctl arguments
    
    In CPP v4l2 ioctl command is made, if _IOC_DIR(cmd) is
    _IOC_NONE, then the user-supplied argument arg is not checked
    and an information disclosure is possible
    
    Change-Id: I4c9d7304ecc8e9a9ac3374778bbff0b7e1323dd6
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2016-6756

diff --git a/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c b/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
index 2214a8df82b5..853aa5f8c293 100644
--- a/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
+++ b/drivers/media/platform/msm/camera_v2/pproc/cpp/msm_cpp.c
@@ -1749,6 +1749,10 @@ long msm_cpp_subdev_ioctl(struct v4l2_subdev *sd,
 		pr_err("cpp_dev is null\n");
 		return -EINVAL;
 	}
+	if (_IOC_DIR(cmd) == _IOC_NONE) {
+		pr_err("Invalid ioctl/subdev cmd %u", cmd);
+		return -EINVAL;
+	}
 	mutex_lock(&cpp_dev->mutex);
 	CPP_DBG("E cmd: 0x%x\n", cmd);
 	switch (cmd) {
