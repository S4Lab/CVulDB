MotorolaMobilityLLC__kernel-msm
commit ee84b814c8a42e9df2f8b668a4ddc4255452f3e8
Author:     Karthik Reddy Katta <a_katta@codeaurora.org>
AuthorDate: Thu Apr 13 12:29:29 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu May 4 01:02:44 2017 -0500

    IKSIMP-3680: drivers: soc: qcom: Add overflow check for sound model size
    
    Overflow check is added for sound model size to prevent
    heap overflow while allocating memory for sound model data.
    
    CVE-fixed: CVE-2016-5860
    Bug-Id: A-34623424
    CRs-Fixed: 1100682
    Change-Id: Id38523a5e79028c692670e84d5fe924a855a5a10
    Signed-off-by: Karthik Reddy Katta <a_katta@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/953710
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/sound/soc/msm/msm-cpe-lsm.c b/sound/soc/msm/msm-cpe-lsm.c
index d5b675f1e0b4..a4daf91d1e2f 100644
--- a/sound/soc/msm/msm-cpe-lsm.c
+++ b/sound/soc/msm/msm-cpe-lsm.c
@@ -1913,6 +1913,13 @@ static int msm_cpe_lsm_reg_model(struct snd_pcm_substream *substream,
 
 	lsm_ops->lsm_get_snd_model_offset(cpe->core_handle,
 			session, &offset);
+	/* Check if 'p_info->param_size + offset' crosses U32_MAX. */
+	if (p_info->param_size > U32_MAX - offset) {
+		dev_err(rtd->dev,
+			"%s: Invalid param_size %d\n",
+			__func__, p_info->param_size);
+		return -EINVAL;
+	}
 	session->snd_model_size = p_info->param_size + offset;
 
 	session->snd_model_data = vzalloc(session->snd_model_size);
