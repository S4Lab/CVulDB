MotorolaMobilityLLC__kernel-msm
commit 174fc002f7b6076c3990cc3bcb7b55829ce08f61
Author:     Srinivas Dasari <dasaris@qti.qualcomm.com>
AuthorDate: Fri Jul 7 01:43:39 2017 +0300
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Mon Dec 4 07:23:05 2017 -0600

    cfg80211: Check if PMKID attribute is of expected size
    
    nla policy checks for only maximum length of the attribute data
    when the attribute type is NLA_BINARY. If userspace sends less
    data than specified, the wireless drivers may access illegal
    memory. When type is NLA_UNSPEC, nla policy check ensures that
    userspace sends minimum specified length number of bytes.
    
    Remove type assignment to NLA_BINARY from nla_policy of
    NL80211_ATTR_PMKID to make this NLA_UNSPEC and to make sure minimum
    WLAN_PMKID_LEN bytes are received from userspace with
    NL80211_ATTR_PMKID.
    
    Mot-CRs-fixed:(CR)
    CVE-Fixed:CVE-2017-11090
    
    Fixes: 67fbb16be69d ("nl80211: PMKSA caching support")
    Cc: stable@vger.kernel.org
    Bug: 36818836
    Signed-off-by: Srinivas Dasari <dasaris@qti.qualcomm.com>
    Signed-off-by: Jouni Malinen <jouni@qca.qualcomm.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Git-repo: git://git.kernel.org/pub/scm/linux/kernel/git/jberg/mac80211.git
    Git-commit: 9361df14d1cbf966409d5d6f48bb334384fbe138
    Change-Id: I5feb729a9ef48f67c4ee460e7e133d5fc8cecd4f
    CRs-Fixed: 2061676
    Signed-off-by: Srinivas Dasari <dasaris@codeaurora.org>
    Signed-off-by: vineetv <vineetv@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1071696
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/net/wireless/nl80211.c b/net/wireless/nl80211.c
index 1926d8d553bd..b0a1e9783ddf 100644
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@ -301,8 +301,7 @@ static const struct nla_policy nl80211_policy[NL80211_ATTR_MAX+1] = {
 	[NL80211_ATTR_WPA_VERSIONS] = { .type = NLA_U32 },
 	[NL80211_ATTR_PID] = { .type = NLA_U32 },
 	[NL80211_ATTR_4ADDR] = { .type = NLA_U8 },
-	[NL80211_ATTR_PMKID] = { .type = NLA_BINARY,
-				 .len = WLAN_PMKID_LEN },
+	[NL80211_ATTR_PMKID] = { .len = WLAN_PMKID_LEN },
 	[NL80211_ATTR_DURATION] = { .type = NLA_U32 },
 	[NL80211_ATTR_COOKIE] = { .type = NLA_U64 },
 	[NL80211_ATTR_TX_RATES] = { .type = NLA_NESTED },
