MotorolaMobilityLLC__kernel-msm
commit 986ce0bfaff797e5e913d3367ff1d2217f774283
Author:     jupiter_chen <jupiter_chen@asus.com>
AuthorDate: Thu May 5 22:58:25 2016 +0800
Commit:     Wu, Meng-Hui <menghui_wu@asus.com>
CommitDate: Thu May 5 23:19:10 2016 +0800

    mm: fix prctl_set_vma_anon_name
    
    prctl_set_vma_anon_name could attempt to set the name across
    two vmas at the same time due to a typo, which might corrupt
    the vma list.  Fix it to use tmp instead of end to limit
    the name setting to a single vma at a time.
    CVE: CVE-2015-6640
    Bug: ANDROID-20017123
    
    Change-Id: I16dba24bc455001fd74de641333419b9363bf15b
    Reviewed-on: http://mcrd1-22-pc.corpnet.asus/code-review/master/228988
    Reviewed-by: Jupiter Chen <jupiter_chen@asus.com>
    Tested-by: Jupiter Chen <jupiter_chen@asus.com>
    Reviewed-by: Wu, Meng-Hui <menghui_wu@asus.com>

diff --git a/kernel/sys.c b/kernel/sys.c
index 407abeef9f6e..0b08c9f000f3 100644
--- a/kernel/sys.c
+++ b/kernel/sys.c
@@ -2187,7 +2187,7 @@ static int prctl_set_vma_anon_name(unsigned long start, unsigned long end,
 			tmp = end;
 
 		/* Here vma->vm_start <= start < tmp <= (end|vma->vm_end). */
-		error = prctl_update_vma_anon_name(vma, &prev, start, end,
+		error = prctl_update_vma_anon_name(vma, &prev, start, tmp,
 				(const char __user *)arg);
 		if (error)
 			return error;
