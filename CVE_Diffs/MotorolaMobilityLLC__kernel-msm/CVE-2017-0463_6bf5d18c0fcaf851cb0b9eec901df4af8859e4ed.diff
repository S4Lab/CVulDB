MotorolaMobilityLLC__kernel-msm
commit 6bf5d18c0fcaf851cb0b9eec901df4af8859e4ed
Author:     Karthikeyan Ramasubramanian <kramasub@codeaurora.org>
AuthorDate: Thu Dec 15 08:13:20 2016 -0700
Commit:     Vineet Angadi <vineetv@motorola.com>
CommitDate: Thu Feb 16 00:09:17 2017 -0600

    net: ipc_router: Register services only on client port
    
    Allowing services to be registered on a non-client port will cause either
    an existing service or a control port to be over-written. This will cause
    undefined functional behavior.
    
    Allow the services to be registered only on client ports.
    
    
    Mot-CRs-fixed:(CR)
    CVE-Fixed:CVE-2017-0463
    
    CRs-Fixed: 1101792
    Change-Id: If6cfc75e9314204b7b44957f1598a8a2e1a45325
    Signed-off-by: Karthikeyan Ramasubramanian <kramasub@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/948140
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Varun Shrivastava <varunshrivastava@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/net/ipc_router/ipc_router_core.c b/net/ipc_router/ipc_router_core.c
index a3043f1ac6ac..52648e7a5e4d 100644
--- a/net/ipc_router/ipc_router_core.c
+++ b/net/ipc_router/ipc_router_core.c
@@ -2633,6 +2633,9 @@ int msm_ipc_router_register_server(struct msm_ipc_port *port_ptr,
 	if (!port_ptr || !name)
 		return -EINVAL;
 
+	if (port_ptr->type != CLIENT_PORT)
+		return -EINVAL;
+
 	if (name->addrtype != MSM_IPC_ADDR_NAME)
 		return -EINVAL;
 
