MotorolaMobilityLLC__kernel-msm
commit eff8272a3468ea4c5c9df2b306d8c60189381610
Author:     Xiaoyu Ye <benyxy@codeaurora.org>
AuthorDate: Wed Jul 19 12:44:04 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Dec 21 22:18:54 2017 -0600

    ASoC: msm-cpe: Fix range checking in function fw_name_store
    
    The range checking between "WCD_CPE_IMAGE_FNAME_MAX" and
    "copy_count" is off-by-one due to the size of array
    "core->dyn_fname" is "WCD_CPE_IMAGE_FNAME_MAX". Subtract
    one from the range checking to fix this issue.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2017-9700
    CRs-Fixed: 2043822
    Change-Id: I87fd55206f79ad7b13c3878f6642bf5579303b17
    Signed-off-by: Xiaoyu Ye <benyxy@codeaurora.org>
    
    Signed-off-by: Neeraj Kumar <neerajk@motorola.com>
    Change-Id: Ib5f2922b73669fac9f0d1b799ba8e8103ff87949
    Reviewed-on: https://gerrit.mot.com/1028498
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Vrushali Prakash Bhosale <wkvq37@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/sound/soc/codecs/wcd_cpe_core.c b/sound/soc/codecs/wcd_cpe_core.c
index 276947970ed1..8209137d6e80 100644
--- a/sound/soc/codecs/wcd_cpe_core.c
+++ b/sound/soc/codecs/wcd_cpe_core.c
@@ -1731,10 +1731,10 @@ static ssize_t fw_name_store(struct wcd_cpe_core *core,
 	if (pos)
 		copy_count = pos - buf;
 
-	if (copy_count > WCD_CPE_IMAGE_FNAME_MAX) {
+	if (copy_count > (WCD_CPE_IMAGE_FNAME_MAX - 1)) {
 		dev_err(core->dev,
 			"%s: Invalid length %d, max allowed %d\n",
-			__func__, copy_count, WCD_CPE_IMAGE_FNAME_MAX);
+			__func__, copy_count, WCD_CPE_IMAGE_FNAME_MAX - 1);
 		return -EINVAL;
 	}
 
