MotorolaMobilityLLC__kernel-msm
commit 6c9dddfa3174f9acf45c1fe1ee382cb75d9b777a
Author:     Krishnankutty Kolathappilly <kkolatha@codeaurora.org>
AuthorDate: Wed Nov 16 18:22:58 2016 -0800
Commit:     Fan Hang <hangfan1@lenovo.com>
CommitDate: Tue Oct 17 09:27:03 2017 +0800

    msm: cpp: Fix for buffer overflow in cpp.
    
    Fix for buffer overflow while handling ioctl.
    Instead of checking for length boundary, fix checks
    for exact length.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2016-8413
    CRs-Fixed: 518731
    
    Change-Id: Id9fd3b0b671caa0522bd51b77f2c501ea37b3332
    Signed-off-by: Krishnankutty Kolathappilly <kkolatha@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/950699
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>
    (cherry picked from commit 55bbb7e0fb71728c87912976b17636f7d51bb1e2)
    Reviewed-on: https://gerrit.mot.com/966114
    Reviewed-by: jinyou liu <liujy7@motorola.com>
    SLTApproved: jinyou liu <liujy7@motorola.com>
    Submit-Approved: jinyou liu <liujy7@motorola.com>
    (cherry picked from commit 24e7d9afb65c824bff3ad921aab0c4b61012ba59)
    Reviewed-on: https://gerrit.mot.com/971702

diff --git a/drivers/media/platform/msm/camera_v2_2016/pproc/cpp/msm_cpp.c b/drivers/media/platform/msm/camera_v2_2016/pproc/cpp/msm_cpp.c
index 736fd42e17a7..a4752cb3a8e2 100644
--- a/drivers/media/platform/msm/camera_v2_2016/pproc/cpp/msm_cpp.c
+++ b/drivers/media/platform/msm/camera_v2_2016/pproc/cpp/msm_cpp.c
@@ -2943,8 +2943,7 @@ STREAM_BUFF_END:
 		uint32_t identity;
 		struct msm_cpp_buff_queue_info_t *buff_queue_info;
 		CPP_DBG("VIDIOC_MSM_CPP_DEQUEUE_STREAM_BUFF_INFO\n");
-		if ((ioctl_ptr->len == 0) ||
-		    (ioctl_ptr->len > sizeof(uint32_t))) {
+		if (ioctl_ptr->len != sizeof(uint32_t)) {
 			mutex_unlock(&cpp_dev->mutex);
 			return -EINVAL;
 		}
