MotorolaMobilityLLC__kernel-msm
commit 390028e44d0a9f9723080df6f17d12bbaf4cccc6
Author:     Karthikeyan Ramasubramanian <kramasub@codeaurora.org>
AuthorDate: Thu Dec 15 08:13:20 2016 -0700
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Tue May 2 05:49:56 2017 -0500

    net: ipc_router: Register services only on client port
    
    Allowing services to be registered on a non-client port will cause either
    an existing service or a control port to be over-written. This will cause
    undefined functional behavior.
    
    Allow the services to be registered only on client ports.
    
    
    Mot-CRs-fixed:IKSIMP-1521
    CVE-Fixed:CVE-2017-0463
    
    CRs-Fixed: 1101792
    Change-Id: If6cfc75e9314204b7b44957f1598a8a2e1a45325
    Signed-off-by: Karthikeyan Ramasubramanian <kramasub@codeaurora.org>
    Reviewed-on: https://gerrit.mot.com/948925
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Varun Shrivastava <varunshrivastava@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/net/ipc_router/ipc_router_core.c b/net/ipc_router/ipc_router_core.c
index 32e57c8bad8b..dcb4bab7cbce 100644
--- a/net/ipc_router/ipc_router_core.c
+++ b/net/ipc_router/ipc_router_core.c
@@ -2703,6 +2703,9 @@ int msm_ipc_router_register_server(struct msm_ipc_port *port_ptr,
 	if (!port_ptr || !name)
 		return -EINVAL;
 
+	if (port_ptr->type != CLIENT_PORT)
+		return -EINVAL;
+
 	if (name->addrtype != MSM_IPC_ADDR_NAME)
 		return -EINVAL;
 
