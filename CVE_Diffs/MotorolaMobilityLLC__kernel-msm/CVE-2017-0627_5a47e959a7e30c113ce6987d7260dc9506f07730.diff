MotorolaMobilityLLC__kernel-msm
commit 5a47e959a7e30c113ce6987d7260dc9506f07730
Author:     Robb Glasser <rglasser@google.com>
AuthorDate: Tue Feb 14 13:25:46 2017 -0800
Commit:     Srikanth A R <arsrikan@motorola.com>
CommitDate: Mon Apr 24 02:35:17 2017 -0500

    Prevent heap overflow in uvc driver
    
    The size of uvc_control_mapping is user controlled leading to a
    potential heap overflow in the uvc driver. This adds a check to verify
    the user provided size fits within the bounds of the defined buffer
    size.
    
    Bug: 33300353
    CVE-fixed: CVE-2017-0627
    Mot-CRs-fixed: (CR)
    
    Change-Id: I2412299fc7ab55a20e5c95b5cd72fd401da5e1a6
    Signed-off-by: Robb Glasser <rglasser@google.com>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/980078
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver <sltawvr@motorola.com>
    Tested-by: Jira Key <jirakey@motorola.com>
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key <jirakey@motorola.com>

diff --git a/drivers/media/usb/uvc/uvc_ctrl.c b/drivers/media/usb/uvc/uvc_ctrl.c
index a2f4501c23ca..f61d1d7ba765 100644
--- a/drivers/media/usb/uvc/uvc_ctrl.c
+++ b/drivers/media/usb/uvc/uvc_ctrl.c
@@ -1939,6 +1939,9 @@ int uvc_ctrl_add_mapping(struct uvc_video_chain *chain,
 	if (!found)
 		return -ENOENT;
 
+	if (ctrl->info.size < mapping->size)
+		return -EINVAL;
+
 	if (mutex_lock_interruptible(&chain->ctrl_mutex))
 		return -ERESTARTSYS;
 
