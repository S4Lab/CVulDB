MotorolaMobilityLLC__kernel-msm
commit a99cf648a53c58061ab429f430164162e06dc024
Author:     joe_tsai <joe_tsai@asus.com>
AuthorDate: Fri May 6 13:05:19 2016 +0800
Commit:     joe_tsai <joe_tsai@asus.com>
CommitDate: Fri May 6 13:42:29 2016 +0800

    Common: Wifi: Elevation of Privilege Vulnerability in Broadcom Wi-Fi Driver
    
    CVE-2016-2475 ANDROID-26425765 (Broadcom ref#: RB#90144)
    
    WLAN private set IOCTLs could be invoked with insufficient privileges.
    The fix is designed to add a permission check for CAP_NET_ADMIN before allowing the IOCTL calls.
    
    Bug: 28547399
    Change-Id: I5578aff43f28170a05257883dc74d63f81d65500
    Reviewed-on: http://mcrd1-22-pc.corpnet.asus/code-review/master/229069
    Reviewed-by: joe_tsai <joe_tsai@asus.com>
    Tested-by: joe_tsai <joe_tsai@asus.com>
    Reviewed-on: http://mcrd1-22-pc.corpnet.asus/code-review/master/229074

diff --git a/drivers/net/wireless/bcmdhd/wl_android.c b/drivers/net/wireless/bcmdhd/wl_android.c
index 9bd347946bb0..b1ff11c00f60 100755
--- a/drivers/net/wireless/bcmdhd/wl_android.c
+++ b/drivers/net/wireless/bcmdhd/wl_android.c
@@ -2225,6 +2225,11 @@ int wl_android_priv_cmd(struct net_device *net, struct ifreq *ifr, int cmd)
 
 	net_os_wake_lock(net);
 
+	if (!capable(CAP_NET_ADMIN)) {
+		ret = -EPERM;
+		goto exit;
+	}
+
 	if (!ifr->ifr_data) {
 		ret = -EINVAL;
 		goto exit;
