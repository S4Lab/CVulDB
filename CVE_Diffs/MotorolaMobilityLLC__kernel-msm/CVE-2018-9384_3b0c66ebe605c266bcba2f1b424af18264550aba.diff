MotorolaMobilityLLC__kernel-msm
commit 3b0c66ebe605c266bcba2f1b424af18264550aba
Author:     Zubin Mithra <zsm@google.com>
AuthorDate: Thu May 24 19:44:06 2018 +0530
Commit:     chenyt9 <chenyt9@lenovo.com>
CommitDate: Tue Dec 3 10:02:04 2019 +0800

    ANDROID: perf: get cpu value using task_cpu(tsk)
    
    Use task_cpu(tsk) instead of task_thread_info(tsk)->cpu so that this
    works even with CONFIG_THREAD_INFO_IN_TASK enabled.
    
    Mot-CRs-fixed: (CR)
    CVE-fixed: CVE-2018-9384
    Bug: 74356909
    
    Bug: 66351489
    Change-Id: If7e482084aed453e0fcb9623a0167c0e21321631
    Signed-off-by: Zubin Mithra <zsm@google.com>
    Reviewed-on: https://gerrit.mot.com/1182403
    SLTApproved: Slta Waiver
    SME-Granted: SME Approvals Granted
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/arch/arm64/kernel/perf_trace_counters.c b/arch/arm64/kernel/perf_trace_counters.c
index dc92b29ac103..7b852e36eaa2 100644
--- a/arch/arm64/kernel/perf_trace_counters.c
+++ b/arch/arm64/kernel/perf_trace_counters.c
@@ -65,7 +65,7 @@ void tracectr_notifier(void *ignore, bool preempt,
 {
 	u32 cnten_val;
 	int current_pid;
-	u32 cpu = task_thread_info(next)->cpu;
+	u32 cpu = task_cpu(next);
 
 	if (tp_pid_state != 1)
 		return;
