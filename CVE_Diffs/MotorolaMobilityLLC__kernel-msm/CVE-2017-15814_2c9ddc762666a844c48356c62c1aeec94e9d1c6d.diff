MotorolaMobilityLLC__kernel-msm
commit 2c9ddc762666a844c48356c62c1aeec94e9d1c6d
Author:     Tanvi Aggarwal <tanvia@codeaurora.org>
AuthorDate: Thu Aug 24 11:51:35 2017 +0530
Commit:     PDO SCM Team <hudsoncm@motorola.com>
CommitDate: Thu Mar 22 05:59:19 2018 -0500

    msm: sensor: flash: add conditional check for ioctl
    
    Add conditional check when sending VIDIOC_MSM_FLASH_CFG
    in 32-bit process.
    
    Bug-id: A-64836865
    CRs-Fixed: 2092793
    CVE-fixed: CVE-2017-15814
    Mot-CRs-fixed: (CR)
    
    Change-Id: Id2c2ff9137c94d9698b05cf5f655d13d37e517f9
    Signed-off-by: Tanvi Aggarwal <tanvia@codeaurora.org>
    Signed-off-by: Srikanth A R <arsrikan@motorola.com>
    Reviewed-on: https://gerrit.mot.com/1134295
    SME-Granted: SME Approvals Granted
    SLTApproved: Slta Waiver
    Tested-by: Jira Key
    Reviewed-by: Igor Kovalenko <igork@motorola.com>
    Submit-Approved: Jira Key

diff --git a/drivers/media/platform/msm/camera_v2/sensor/flash/msm_flash.c b/drivers/media/platform/msm/camera_v2/sensor/flash/msm_flash.c
index b24cf529e4e7..0c26cec76829 100644
--- a/drivers/media/platform/msm/camera_v2/sensor/flash/msm_flash.c
+++ b/drivers/media/platform/msm/camera_v2/sensor/flash/msm_flash.c
@@ -1241,6 +1241,9 @@ static long msm_flash_subdev_do_ioctl(
 			break;
 		}
 		break;
+	case VIDIOC_MSM_FLASH_CFG:
+		pr_err("invalid cmd 0x%x received\n", cmd);
+		return -EINVAL;
 	default:
 		return msm_flash_subdev_ioctl(sd, cmd, arg);
 	}
diff --git a/drivers/media/platform/msm/camera_v2_2016/sensor/flash/msm_flash.c b/drivers/media/platform/msm/camera_v2_2016/sensor/flash/msm_flash.c
index d64945cda664..6704f65c4f56 100644
--- a/drivers/media/platform/msm/camera_v2_2016/sensor/flash/msm_flash.c
+++ b/drivers/media/platform/msm/camera_v2_2016/sensor/flash/msm_flash.c
@@ -1127,6 +1127,9 @@ static long msm_flash_subdev_do_ioctl(
 			break;
 		}
 		break;
+	case VIDIOC_MSM_FLASH_CFG:
+		pr_err("invalid cmd 0x%x received\n", cmd);
+		return -EINVAL;
 	default:
 		return msm_flash_subdev_ioctl(sd, cmd, arg);
 	}
