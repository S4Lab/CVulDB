FFmpeg__FFmpeg
commit 36d8914f1b94e4731d2fc67162902839c106e72e
Author:     Michael Niedermayer <michaelni@gmx.at>
AuthorDate: Fri Feb 7 15:07:23 2014 +0100
Commit:     Anton Khirnov <anton@khirnov.net>
CommitDate: Tue Aug 5 15:05:22 2014 +0000

    wmalosslessdec: fix mclms_coeffs* array size
    
    Fixes corruption of context
    
    Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
    CC:libav-stable@libav.org
    Bug-Id: CVE-2014-2098
    Signed-off-by: Anton Khirnov <anton@khirnov.net>
    (cherry picked from commit 849b9d34c7ef70b370c53e7af3940f51cbc07d0f)
    Signed-off-by: Anton Khirnov <anton@khirnov.net>

diff --git a/libavcodec/wmalosslessdec.c b/libavcodec/wmalosslessdec.c
index 747ac37dc0..8060d279b5 100644
--- a/libavcodec/wmalosslessdec.c
+++ b/libavcodec/wmalosslessdec.c
@@ -127,8 +127,8 @@ typedef struct WmallDecodeCtx {
 
     int8_t  mclms_order;
     int8_t  mclms_scaling;
-    int16_t mclms_coeffs[128];
-    int16_t mclms_coeffs_cur[4];
+    int16_t mclms_coeffs[WMALL_MAX_CHANNELS * WMALL_MAX_CHANNELS * 32];
+    int16_t mclms_coeffs_cur[WMALL_MAX_CHANNELS * WMALL_MAX_CHANNELS];
     int16_t mclms_prevvalues[WMALL_MAX_CHANNELS * 2 * 32];
     int16_t mclms_updates[WMALL_MAX_CHANNELS * 2 * 32];
     int     mclms_recent;
