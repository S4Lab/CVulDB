FFmpeg__FFmpeg
commit 0582b8e3eabb4b7d6f637fcd294d6ae43d24b61a
Author:     Anton Khirnov <anton@khirnov.net>
AuthorDate: Fri Sep 28 15:42:29 2012 +0200
Commit:     Reinhard Tartler <siretart@tauware.de>
CommitDate: Sun Oct 14 16:03:24 2012 -0400

    avidec: use actually read size instead of requested size
    
    Fixes CVE-2012-2788
    (cherry picked from commit 0af49a63c7f87876486ab09482d5b26b95abce60)
    
    Signed-off-by: Reinhard Tartler <siretart@tauware.de>

diff --git a/libavformat/avidec.c b/libavformat/avidec.c
index b4ccfb50f8..13a39c0e11 100644
--- a/libavformat/avidec.c
+++ b/libavformat/avidec.c
@@ -1116,7 +1116,7 @@ resync:
             }
             ast->frame_offset += get_duration(ast, pkt->size);
         }
-        ast->remaining -= size;
+        ast->remaining -= err;
         if(!ast->remaining){
             avi->stream_index= -1;
             ast->packet_size= 0;
