FFmpeg__FFmpeg
commit f33b5ba63eee96c9d1c7f0e568169cb0c3694238
Author:     Luca Barbato <lu_zero@gentoo.org>
AuthorDate: Fri Dec 14 09:55:04 2012 +0100
Commit:     Luca Barbato <lu_zero@gentoo.org>
CommitDate: Fri Dec 14 13:21:59 2012 +0100

    vp56: release frames on error
    
    Fixes CVE-2012-2783
    
    CC: libav-stable@libav.org

diff --git a/libavcodec/vp56.c b/libavcodec/vp56.c
index 6779ffb6dc..5bd0a1abef 100644
--- a/libavcodec/vp56.c
+++ b/libavcodec/vp56.c
@@ -514,8 +514,14 @@ int ff_vp56_decode_frame(AVCodecContext *avctx, void *data, int *got_frame,
         s->modelp = &s->models[is_alpha];
 
         res = s->parse_header(s, buf, remaining_buf_size, &golden_frame);
-        if (res < 0)
+        if (res < 0) {
+            int i;
+            for (i = 0; i < 4; i++) {
+                if (s->frames[i].data[0])
+                    avctx->release_buffer(avctx, &s->frames[i]);
+            }
             return res;
+        }
 
         if (res == VP56_SIZE_CHANGE) {
             int i;
