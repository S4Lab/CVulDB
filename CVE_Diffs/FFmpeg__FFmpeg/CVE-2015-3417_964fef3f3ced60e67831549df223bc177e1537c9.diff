FFmpeg__FFmpeg
commit 964fef3f3ced60e67831549df223bc177e1537c9
Author:     Luca Barbato <lu_zero@gentoo.org>
AuthorDate: Mon May 25 22:30:10 2015 +0200
Commit:     Reinhard Tartler <siretart@tauware.de>
CommitDate: Sun May 31 11:35:35 2015 -0400

    h264: Make sure reinit failures mark the context as not initialized
    
    Bug-Id: CVE-2015-3417
    CC: libav-stable@libav.org
    (cherry picked from commit 3b69f245dbe6e2016659a45c4bfe284f6c5ac57e)
    Signed-off-by: Reinhard Tartler <siretart@tauware.de>
    
    Conflicts:
            libavcodec/h264_slice.c

diff --git a/libavcodec/h264.c b/libavcodec/h264.c
index 857a949e98..c32711343b 100644
--- a/libavcodec/h264.c
+++ b/libavcodec/h264.c
@@ -3489,6 +3489,7 @@ static int decode_slice_header(H264Context *h, H264Context *h0)
         (h->width  != h->avctx->coded_width   ||
          h->height != h->avctx->coded_height  ||
          needs_reinit)) {
+        h->context_initialized = 0;
         if (h != h0) {
             av_log(h->avctx, AV_LOG_ERROR, "changing width/height on "
                    "slice %d\n", h0->current_slice + 1);
