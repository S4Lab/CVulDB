FFmpeg__FFmpeg
commit 7a0ff7566b66da0b75dfaaca4347c7b41970f0ef
Author:     Michael Niedermayer <michaelni@gmx.at>
AuthorDate: Fri Apr 20 17:42:18 2012 +0200
Commit:     Reinhard Tartler <siretart@tauware.de>
CommitDate: Fri Jan 4 07:43:37 2013 +0100

    avsdec: Set dimensions instead of relying on the demuxer.
    
    The decode function assumes that the video will have those dimensions.
    
    Fixes CVE-2012-2801
    
    CC:libav-stable@libav.org
    
    Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
    Signed-off-by: Anton Khirnov <anton@khirnov.net>
    (cherry picked from commit 85f477935cd6b34e6ec2716b20e15ce748277a89)
    
    Signed-off-by: Reinhard Tartler <siretart@tauware.de>

diff --git a/libavcodec/avs.c b/libavcodec/avs.c
index 3ad3d879b5..628a6e3d68 100644
--- a/libavcodec/avs.c
+++ b/libavcodec/avs.c
@@ -158,6 +158,7 @@ avs_decode_frame(AVCodecContext * avctx,
 static av_cold int avs_decode_init(AVCodecContext * avctx)
 {
     avctx->pix_fmt = PIX_FMT_PAL8;
+    avcodec_set_dimensions(avctx, 318, 198);
     return 0;
 }
 
