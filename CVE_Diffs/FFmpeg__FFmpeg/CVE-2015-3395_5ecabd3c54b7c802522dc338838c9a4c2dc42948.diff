FFmpeg__FFmpeg
commit 5ecabd3c54b7c802522dc338838c9a4c2dc42948
Author:     Luca Barbato <lu_zero@gentoo.org>
AuthorDate: Mon May 25 21:53:26 2015 +0200
Commit:     Luca Barbato <lu_zero@gentoo.org>
CommitDate: Sat May 30 16:28:32 2015 +0200

    msrle: Use FFABS to determine the frame size in msrle_decode_pal4
    
    As done in msrle_decode_8_16_24_32.
    
    Bug-Id: CVE-2015-3395
    CC: libav-stable@libav.org

diff --git a/libavcodec/msrledec.c b/libavcodec/msrledec.c
index af2a2478b1..370d9bdfce 100644
--- a/libavcodec/msrledec.c
+++ b/libavcodec/msrledec.c
@@ -39,7 +39,7 @@ static int msrle_decode_pal4(AVCodecContext *avctx, AVPicture *pic,
     unsigned int pixel_ptr = 0;
     int row_dec = pic->linesize[0];
     int row_ptr = (avctx->height - 1) * row_dec;
-    int frame_size = row_dec * avctx->height;
+    int frame_size = FFABS(row_dec) * avctx->height;
     int i;
 
     while (row_ptr >= 0) {
