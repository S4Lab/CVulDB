FFmpeg__FFmpeg
commit 48952116352ab03565cc14805e0f1d63cf0318fe
Author:     Michael Niedermayer <michaelni@gmx.at>
AuthorDate: Sat Oct 4 22:15:07 2014 +0200
Commit:     Anton Khirnov <anton@khirnov.net>
CommitDate: Sat Dec 20 10:51:41 2014 +0100

    on2avc: check number of channels
    
    Fixes invalid memory access.
    
    CC: libav-stable@libav.org
    Bug-ID: CVE-2014-8549
    Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
    Signed-off-by: Anton Khirnov <anton@khirnov.net>
    (cherry picked from commit cee4490b521fd0d02476d46aa2598af24fb8d686)
    Signed-off-by: Anton Khirnov <anton@khirnov.net>

diff --git a/libavcodec/on2avc.c b/libavcodec/on2avc.c
index 60f451c68f..1c4b3c9ea9 100644
--- a/libavcodec/on2avc.c
+++ b/libavcodec/on2avc.c
@@ -918,6 +918,10 @@ static av_cold int on2avc_decode_init(AVCodecContext *avctx)
         av_log(avctx, AV_LOG_ERROR, "0x500 version should be mono\n");
         return AVERROR_INVALIDDATA;
     }
+    if (avctx->channels > 2) {
+        av_log(avctx, AV_LOG_ERROR, "Only 1 or 2 channels are supported.\n");
+        return AVERROR(EINVAL);
+    }
     if (avctx->channels == 2)
         av_log(avctx, AV_LOG_WARNING,
                "Stereo mode support is not good, patch is welcome\n");
