01org__qemu-lite
commit 8b98a2f07175d46c3f7217639bd5e03f2ec56343
Author:     Jason Wang <jasowang@redhat.com>
AuthorDate: Mon Nov 30 15:00:06 2015 +0800
Commit:     Jason Wang <jasowang@redhat.com>
CommitDate: Mon Dec 7 21:43:48 2015 +0800

    pcnet: fix rx buffer overflow(CVE-2015-7512)
    
    Backends could provide a packet whose length is greater than buffer
    size. Check for this and truncate the packet to avoid rx buffer
    overflow in this case.
    
    Cc: Prasad J Pandit <pjp@fedoraproject.org>
    Cc: qemu-stable@nongnu.org
    Reviewed-by: Michael S. Tsirkin <mst@redhat.com>
    Signed-off-by: Jason Wang <jasowang@redhat.com>

diff --git a/hw/net/pcnet.c b/hw/net/pcnet.c
index 309c40bc31..1f4a3dbe49 100644
--- a/hw/net/pcnet.c
+++ b/hw/net/pcnet.c
@@ -1064,6 +1064,12 @@ ssize_t pcnet_receive(NetClientState *nc, const uint8_t *buf, size_t size_)
             int pktcount = 0;
 
             if (!s->looptest) {
+                if (size > 4092) {
+#ifdef PCNET_DEBUG_RMD
+                    fprintf(stderr, "pcnet: truncates rx packet.\n");
+#endif
+                    size = 4092;
+                }
                 memcpy(src, buf, size);
                 /* no need to compute the CRC */
                 src[size] = 0;
