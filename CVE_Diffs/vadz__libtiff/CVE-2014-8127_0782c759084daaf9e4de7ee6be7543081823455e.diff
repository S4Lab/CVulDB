vadz__libtiff
commit 0782c759084daaf9e4de7ee6be7543081823455e
Author:     erouault <erouault>
AuthorDate: Sun Dec 21 20:58:29 2014 +0000
Commit:     erouault <erouault>
CommitDate: Sun Dec 21 20:58:29 2014 +0000

    * tools/tiff2bw.c: when Photometric=RGB, the utility only works if
    SamplesPerPixel = 3. Enforce that
    http://bugzilla.maptools.org/show_bug.cgi?id=2485 (CVE-2014-8127)

diff --git a/ChangeLog b/ChangeLog
index 0f070dd9..e796feb3 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,9 @@
+2014-12-21  Even Rouault  <even.rouault@spatialys.com>
+
+	* tools/tiff2bw.c: when Photometric=RGB, the utility only works if
+	SamplesPerPixel = 3. Enforce that
+	http://bugzilla.maptools.org/show_bug.cgi?id=2485 (CVE-2014-8127)
+
 2014-12-21  Even Rouault  <even.rouault@spatialys.com>
 
 	* tools/pal2rgb.c, tools/thumbnail.c: fix crash by disabling TIFFTAG_INKNAMES
diff --git a/tools/tiff2bw.c b/tools/tiff2bw.c
index 22467cd1..94b8e31e 100644
--- a/tools/tiff2bw.c
+++ b/tools/tiff2bw.c
@@ -171,6 +171,11 @@ main(int argc, char* argv[])
 		    argv[optind], samplesperpixel);
 		return (-1);
 	}
+	if( photometric == PHOTOMETRIC_RGB && samplesperpixel != 3) {
+		fprintf(stderr, "%s: Bad samples/pixel %u for PHOTOMETRIC_RGB.\n",
+		    argv[optind], samplesperpixel);
+		return (-1);
+	}
 	TIFFGetField(in, TIFFTAG_BITSPERSAMPLE, &bitspersample);
 	if (bitspersample != 8) {
 		fprintf(stderr,
