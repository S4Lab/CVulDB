NagiosEnterprises__nagioscore
commit c399086da9ec73daf9f0961b5d2cf20f04466c2e
Author:     Trevor McDonald <tmcdonald@nagios.com>
AuthorDate: Thu Jul 19 14:06:14 2018 -0500
Commit:     Bryan Heden <b.heden@gmail.com>
CommitDate: Thu Jul 19 14:06:14 2018 -0500

    Fix for CVE-2018-13441 null pointer dereference (#553)
    
    * Fix for CVE-2018-13441 null pointer dereference
    
    * update changelog for 4.4.2
    
    * Update Changelog
    
    * Fix for CVE-2018-13441 null pointer dereference

diff --git a/Changelog b/Changelog
index babc6108..26851cd5 100644
--- a/Changelog
+++ b/Changelog
@@ -7,6 +7,7 @@ Nagios Core 4 Change Log
 * Fix for duplicate comments on reload (Bryan Heden)
 * Fix for check_interval/retry_interval bug (Scott Wilkerson)
 * Fix passive checks sending recovery email when host was previously up (Scott Wilkerson)
+* Fix for CVE-2018-13441 null pointer dereference (Trevor McDonald)
 
 4.4.1 - 2018-06-25
 ------------------
diff --git a/base/query-handler.c b/base/query-handler.c
index 51069ec6..9e67a3cc 100644
--- a/base/query-handler.c
+++ b/base/query-handler.c
@@ -26,7 +26,7 @@ static int qh_echo(int sd, char *buf, unsigned int len)
 {
 	int result = 0;
 
-	if (!strcmp(buf, "help")) {
+	if (buf == NULL || !strcmp(buf, "help")) {
 
 		nsock_printf_nul(sd,
 			"Query handler that simply echoes back what you send it.");
@@ -371,7 +371,7 @@ static int qh_help(int sd, char *buf, unsigned int len)
 {
 	struct query_handler *qh = NULL;
 
-	if (!*buf || !strcmp(buf, "help")) {
+	if (buf == NULL || !strcmp(buf, "help")) {
 		nsock_printf_nul(sd,
 			"  help <name>   show help for handler <name>\n"
 			"  help list     list registered handlers\n");
@@ -405,7 +405,7 @@ static int qh_core(int sd, char *buf, unsigned int len)
 {
 	char *space;
 
-	if (*buf == 0 || !strcmp(buf, "help")) {
+	if (buf == NULL || !strcmp(buf, "help")) {
 
 		nsock_printf_nul(sd, 
 			"Query handler for manipulating nagios core.\n"
