minipli__linux-grsec
commit 624176ef511a852bacbc7c1f5503ff4db34f6201
Author:     PaX Team <pageexec@freemail.hu>
AuthorDate: Fri Jan 31 07:30:43 2014 +0100
Commit:     Mathias Krause <minipli@googlemail.com>
CommitDate: Fri Jan 31 07:30:43 2014 +0100

    [pax] Updated to patch 3.13.1-test7
    
    Updated to pax-linux-3.13.1-test7.patch
    
    PaX Team says:
      - fixed CVE-2014-0038 (direct userland provided pointer dereference via compat_sys_recvmmsg under CONFIG_X86_X32_ABI)

diff --git a/net/compat.c b/net/compat.c
index 0529c9c648a6..94fa415f7488 100644
--- a/net/compat.c
+++ b/net/compat.c
@@ -780,21 +780,16 @@ asmlinkage long compat_sys_recvmmsg(int fd, struct compat_mmsghdr __user *mmsg,
 	if (flags & MSG_CMSG_COMPAT)
 		return -EINVAL;
 
-	if (COMPAT_USE_64BIT_TIME)
-		return __sys_recvmmsg(fd, (struct mmsghdr __user *)mmsg, vlen,
-				      flags | MSG_CMSG_COMPAT,
-				      (struct timespec __force_kernel *) timeout);
-
 	if (timeout == NULL)
 		return __sys_recvmmsg(fd, (struct mmsghdr __user *)mmsg, vlen,
 				      flags | MSG_CMSG_COMPAT, NULL);
 
-	if (get_compat_timespec(&ktspec, timeout))
+	if (compat_get_timespec(&ktspec, timeout))
 		return -EFAULT;
 
 	datagrams = __sys_recvmmsg(fd, (struct mmsghdr __user *)mmsg, vlen,
 				   flags | MSG_CMSG_COMPAT, &ktspec);
-	if (datagrams > 0 && put_compat_timespec(&ktspec, timeout))
+	if (datagrams > 0 && compat_put_timespec(&ktspec, timeout))
 		datagrams = -EFAULT;
 
 	return datagrams;
