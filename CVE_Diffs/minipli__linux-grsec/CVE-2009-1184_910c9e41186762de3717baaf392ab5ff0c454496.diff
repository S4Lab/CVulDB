minipli__linux-grsec
commit 910c9e41186762de3717baaf392ab5ff0c454496
Author:     Eugene Teo <eteo@redhat.com>
AuthorDate: Mon Apr 13 10:04:41 2009 +0800
Commit:     Greg Kroah-Hartman <gregkh@suse.de>
CommitDate: Sat May 2 10:25:09 2009 -0700

    unreached code in selinux_ip_postroute_iptables_compat() (CVE-2009-1184)
    
    Not upstream in 2.6.30, as the function was removed there, making this a
    non-issue.
    
    Node and port send checks can skip in the compat_net=1 case. This bug
    was introduced in commit effad8d.
    
    Signed-off-by: Eugene Teo <eugeneteo@kernel.sg>
    Reported-by: Dan Carpenter <error27@gmail.com>
    Acked-by: James Morris <jmorris@namei.org>
    Acked-by: Paul Moore <paul.moore@hp.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/security/selinux/hooks.c b/security/selinux/hooks.c
index 03fc6a81ae32..f028f704225f 100644
--- a/security/selinux/hooks.c
+++ b/security/selinux/hooks.c
@@ -4467,6 +4467,7 @@ static int selinux_ip_postroute_iptables_compat(struct sock *sk,
 	if (err)
 		return err;
 	err = avc_has_perm(sk_sid, if_sid, SECCLASS_NETIF, netif_perm, ad);
+	if (err)
 		return err;
 
 	err = sel_netnode_sid(addrp, family, &node_sid);
