minipli__linux-grsec
commit d8a2707576c2d12dd79d797a9bff3b10b3d182f7
Author:     Linus Torvalds <torvalds@osdl.org>
AuthorDate: Fri Jul 14 23:59:02 2006 +0000
Commit:     Greg Kroah-Hartman <gregkh@suse.de>
CommitDate: Fri Jul 14 19:30:51 2006 -0700

    [PATCH] Fix nasty /proc vulnerability (CVE-2006-3626)
    
    Fix nasty /proc vulnerability
    
    We have a bad interaction with both the kernel and user space being able
    to change some of the /proc file status.  This fixes the most obvious
    part of it, but I expect we'll also make it harder for users to modify
    even their "own" files in /proc.
    
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/fs/proc/base.c b/fs/proc/base.c
index c192cb2af2c8..9d996746a1a6 100644
--- a/fs/proc/base.c
+++ b/fs/proc/base.c
@@ -1366,6 +1366,7 @@ static int pid_revalidate(struct dentry *dentry, struct nameidata *nd)
 		} else {
 			inode->i_uid = 0;
 			inode->i_gid = 0;
+			inode->i_mode = 0;
 		}
 		security_task_to_inode(task, inode);
 		return 1;
