minipli__linux-grsec
commit 91021bbf5cd38700312445e71a6cb1f1811c480c
Author:     Ingo Molnar <mingo@elte.hu>
AuthorDate: Mon Dec 17 21:17:56 2007 +0100
Commit:     Greg Kroah-Hartman <gregkh@suse.de>
CommitDate: Wed Feb 6 11:43:45 2008 -0800

    vfs: coredumping fix (CVE-2007-6206)
    
    vfs: coredumping fix
    
    patch c46f739dd39db3b07ab5deb4e3ec81e1c04a91af in mainline
    
    fix: http://bugzilla.kernel.org/show_bug.cgi?id=3043
    
    only allow coredumping to the same uid that the coredumping
    task runs under.
    
    Signed-off-by: Ingo Molnar <mingo@elte.hu>
    Acked-by: Alan Cox <alan@redhat.com>
    Acked-by: Christoph Hellwig <hch@lst.de>
    Acked-by: Al Viro <viro@ftp.linux.org.uk>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: maximilian attems <max@stro.at>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/fs/exec.c b/fs/exec.c
index 3da429d42b20..224e973514bb 100644
--- a/fs/exec.c
+++ b/fs/exec.c
@@ -1561,6 +1561,12 @@ int do_coredump(long signr, int exit_code, struct pt_regs * regs)
 	   but keep the previous behaviour for now. */
 	if (!ispipe && !S_ISREG(inode->i_mode))
 		goto close_fail;
+	/*
+	 * Dont allow local users get cute and trick others to coredump
+	 * into their pre-created files:
+	 */
+	if (inode->i_uid != current->fsuid)
+		goto close_fail;
 	if (!file->f_op)
 		goto close_fail;
 	if (!file->f_op->write)
