HighwayStar__android_kernel_xiaomi_mocha
commit e336cb093789768c1903fddd9805544dcb77c7ed
Author:     Kamal Mostafa <kamal@canonical.com>
AuthorDate: Tue Jun 17 14:42:59 2014 -0700
Commit:     Vitaliy Tomin <highwaystar.ru@gmail.com>
CommitDate: Fri Dec 16 15:21:25 2016 +0800

    media-device: fix infoleak in ioctl media_enum_entities()
    
    3.13.11.4 -stable review patch.  If anyone has any objections, please let me know.
    
    ------------------
    
    From: =?UTF-8?q?Salva=20Peir=C3=B3?= <speiro@ai2.upv.es>
    
    commit e6a623460e5fc960ac3ee9f946d3106233fd28d8 upstream.
    
    This fixes CVE-2014-1739.
    
    Signed-off-by: Salva Peir√≥ <speiro@ai2.upv.es>
    Acked-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
    Signed-off-by: Mauro Carvalho Chehab <m.chehab@samsung.com>
    Signed-off-by: Kamal Mostafa <kamal@canonical.com>

diff --git a/drivers/media/media-device.c b/drivers/media/media-device.c
index 1957c0df08f..79715f9feb0 100644
--- a/drivers/media/media-device.c
+++ b/drivers/media/media-device.c
@@ -93,6 +93,7 @@ static long media_device_enum_entities(struct media_device *mdev,
 	struct media_entity *ent;
 	struct media_entity_desc u_ent;
 
+	memset(&u_ent, 0, sizeof(u_ent));
 	if (copy_from_user(&u_ent.id, &uent->id, sizeof(u_ent.id)))
 		return -EFAULT;
 
