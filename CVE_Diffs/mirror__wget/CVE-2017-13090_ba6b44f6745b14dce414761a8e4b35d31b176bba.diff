mirror__wget
commit ba6b44f6745b14dce414761a8e4b35d31b176bba
Author:     Tim Rühsen <tim.ruehsen@gmx.de>
AuthorDate: Fri Oct 20 15:15:47 2017 +0200
Commit:     Tim Rühsen <tim.ruehsen@gmx.de>
CommitDate: Thu Oct 26 17:29:38 2017 +0200

    Fix heap overflow in HTTP protocol handling (CVE-2017-13090)
    
    * src/retr.c (fd_read_body): Stop processing on negative chunk size
    
    Reported-by: Antti Levomäki, Christian Jalio, Joonas Pihlaja from Forcepoint
    Reported-by: Juhani Eronen from Finnish National Cyber Security Centre

diff --git a/src/retr.c b/src/retr.c
index c1bc600ef..6555ed4ff 100644
--- a/src/retr.c
+++ b/src/retr.c
@@ -378,6 +378,12 @@ fd_read_body (const char *downloaded_filename, int fd, FILE *out, wgint toread,
               remaining_chunk_size = strtol (line, &endl, 16);
               xfree (line);
 
+              if (remaining_chunk_size < 0)
+                {
+                  ret = -1;
+                  break;
+                }
+
               if (remaining_chunk_size == 0)
                 {
                   ret = 0;
