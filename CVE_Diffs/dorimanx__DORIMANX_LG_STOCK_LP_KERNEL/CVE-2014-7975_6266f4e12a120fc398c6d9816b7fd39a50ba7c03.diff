dorimanx__DORIMANX_LG_STOCK_LP_KERNEL
commit 6266f4e12a120fc398c6d9816b7fd39a50ba7c03
Author:     Andy Lutomirski <luto@amacapital.net>
AuthorDate: Wed Oct 8 12:32:47 2014 -0700
Commit:     Dorimanx <yuri@bynet.co.il>
CommitDate: Tue Apr 21 18:57:43 2015 +0300

    fs: Add a missing permission check to do_umount
    
    Accessing do_remount_sb should require global CAP_SYS_ADMIN, but
    only one of the two call sites was appropriately protected.
    
    Fixes CVE-2014-7975.
    
    Signed-off-by: Andy Lutomirski <luto@amacapital.net>
    Signed-off-by: Pranav Vashi <neobuddy89@gmail.com>

diff --git a/fs/namespace.c b/fs/namespace.c
index 1dcde80e55e6..701b600e82c0 100644
--- a/fs/namespace.c
+++ b/fs/namespace.c
@@ -1155,6 +1155,8 @@ static int do_umount(struct mount *mnt, int flags)
 		 * Special case for "unmounting" root ...
 		 * we just try to remount it readonly.
 		 */
+		if (!capable(CAP_SYS_ADMIN))
+			return -EPERM;
 		down_write(&sb->s_umount);
 		if (!(sb->s_flags & MS_RDONLY))
 			retval = do_remount_sb(sb, MS_RDONLY, NULL, 0);
