NetworkBlockDevice__nbd
commit 9772b428b86ff9449c35e51aa0f4726b40afa4bd
Author:     yoe <yoe>
AuthorDate: Thu Dec 22 21:20:56 2005 +0000
Commit:     yoe <yoe>
CommitDate: Thu Dec 22 21:20:56 2005 +0000

    r138: Fix for CVE-2005-3534

diff --git a/nbd-server.c b/nbd-server.c
index c959812..80605c0 100644
--- a/nbd-server.c
+++ b/nbd-server.c
@@ -689,7 +689,7 @@ int mainloop(int net)
 
 		if (request.magic != htonl(NBD_REQUEST_MAGIC))
 			err("Not enough magic.");
-		if (len > BUFSIZE)
+		if (len > BUFSIZE-sizeof(struct nbd_reply))
 			err("Request too big!");
 #ifdef DODBG
 		printf("%s from %Lu (%Lu) len %d, ", request.type ? "WRITE" :
