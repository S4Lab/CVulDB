NetworkBlockDevice__nbd
commit 4ed24fe0d64c7cc9963c57b52cad1555ad7c6b60
Author:     yoe <yoe>
AuthorDate: Thu Dec 22 20:31:12 2005 +0000
Commit:     yoe <yoe>
CommitDate: Thu Dec 22 20:31:12 2005 +0000

    r134: CVE-2005-3534

diff --git a/nbd-server.c b/nbd-server.c
index ca8d20d..1345d9c 100644
--- a/nbd-server.c
+++ b/nbd-server.c
@@ -687,7 +687,7 @@ int mainloop(CLIENT *client) {
 
 		if (request.magic != htonl(NBD_REQUEST_MAGIC))
 			err("Not enough magic.");
-		if (len > BUFSIZE)
+		if (len > BUFSIZE-sizeof(struct nbd_reply))
 			err("Request too big!");
 #ifdef DODBG
 		printf("%s from %Lu (%Lu) len %d, ", request.type ? "WRITE" :
