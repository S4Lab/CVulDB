apple__cups
commit 46b0225baf017e7465a989c0824b03edb80f24e6
Author:     mike <mike@7a7537e8-13f0-0310-91df-b6672ffda945>
AuthorDate: Wed Jun 16 00:17:39 2010 +0000
Commit:     mike <mike@7a7537e8-13f0-0310-91df-b6672ffda945>
CommitDate: Wed Jun 16 00:17:39 2010 +0000

    Security: The fix for CVE-2009-3553 was incomplete (STR #3490)
    
    
    
    git-svn-id: svn+ssh://src.apple.com/svn/cups/cups.org/trunk@9146 7a7537e8-13f0-0310-91df-b6672ffda945

diff --git a/CHANGES-1.4.txt b/CHANGES-1.4.txt
index 66d5812db..fc89b5552 100644
--- a/CHANGES-1.4.txt
+++ b/CHANGES-1.4.txt
@@ -8,6 +8,7 @@ CHANGES IN CUPS V1.4.5
 CHANGES IN CUPS V1.4.4
 
 	- Documentation updates (STR #3453, STR #3527, STR #3528, STR #3529)
+	- Security: The fix for CVE-2009-3553 was incomplete (STR #3490)
 	- Fixed some IPP conformance issues with the scheduler's
 	  ippget-event-life, operations-supported, output-bin, and sides
 	  attributes (STR #3554)
diff --git a/scheduler/select.c b/scheduler/select.c
index 21a6edc6c..a2451a5ae 100644
--- a/scheduler/select.c
+++ b/scheduler/select.c
@@ -454,7 +454,8 @@ cupsdDoSelect(long timeout)		/* I - Timeout in seconds */
     if (fdptr->read_cb && event->filter == EVFILT_READ)
       (*(fdptr->read_cb))(fdptr->data);
 
-    if (fdptr->use > 1 && fdptr->write_cb && event->filter == EVFILT_WRITE)
+    if (fdptr->use > 1 && fdptr->write_cb && event->filter == EVFILT_WRITE &&
+        !cupsArrayFind(cupsd_inactive_fds, fdptr))
       (*(fdptr->write_cb))(fdptr->data);
 
     release_fd(fdptr);
@@ -500,7 +501,8 @@ cupsdDoSelect(long timeout)		/* I - Timeout in seconds */
 	  (*(fdptr->read_cb))(fdptr->data);
 
 	if (fdptr->use > 1 && fdptr->write_cb &&
-	    (event->events & (EPOLLOUT | EPOLLERR | EPOLLHUP)))
+            (event->events & (EPOLLOUT | EPOLLERR | EPOLLHUP)) &&
+            !cupsArrayFind(cupsd_inactive_fds, fdptr))
 	  (*(fdptr->write_cb))(fdptr->data);
 
 	release_fd(fdptr);
