apple__cups
commit 93cbfc28557cca16364470c0b3bc0483641a3b2d
Author:     mike <mike@7a7537e8-13f0-0310-91df-b6672ffda945>
AuthorDate: Thu Nov 11 17:39:57 2010 +0000
Commit:     mike <mike@7a7537e8-13f0-0310-91df-b6672ffda945>
CommitDate: Thu Nov 11 17:39:57 2010 +0000

    Security: Fixed a memory corruption bug reported in CVE-2010-2941 (STR #3648)
    
    
    
    git-svn-id: svn+ssh://src.apple.com/svn/cups/cups.org/trunk@9356 7a7537e8-13f0-0310-91df-b6672ffda945

diff --git a/CHANGES-1.4.txt b/CHANGES-1.4.txt
index 6c1e7a823..674530c5b 100644
--- a/CHANGES-1.4.txt
+++ b/CHANGES-1.4.txt
@@ -11,6 +11,8 @@ CHANGES IN CUPS V1.4.5
 
 	- Documentation fixes (STR #3542, STR #3650)
 	- Localization fixes (STR #3635, STR #3636, STR #3647, STR #3666)
+	- Security: Fixed a memory corruption bug reported in CVE-2010-2941
+	  (STR #3648)
 	- The CUPS API incorrectly mapped the HTTP_UNAUTHORIZED status to the
 	  IPP_NOT_AUTHORIZED status code, when IPP_NOT_AUTHENTICATED would be
 	  the correct mapping (STR #3684)
diff --git a/cups/ipp.c b/cups/ipp.c
index 1d90310f6..c30ed1e9a 100644
--- a/cups/ipp.c
+++ b/cups/ipp.c
@@ -1271,7 +1271,9 @@ ippReadIO(void       *src,		/* I - Data source */
 
 	      attr->value_tag = tag;
 	    }
-	    else if ((value_tag >= IPP_TAG_TEXTLANG &&
+	    else if (value_tag == IPP_TAG_TEXTLANG ||
+	             value_tag == IPP_TAG_NAMELANG ||
+		     (value_tag >= IPP_TAG_TEXT &&
 		      value_tag <= IPP_TAG_MIMETYPE))
             {
 	     /*
@@ -1279,8 +1281,9 @@ ippReadIO(void       *src,		/* I - Data source */
 	      * forms; accept sets of differing values...
 	      */
 
-	      if ((tag < IPP_TAG_TEXTLANG || tag > IPP_TAG_MIMETYPE) &&
-	          tag != IPP_TAG_NOVALUE)
+	      if (tag != IPP_TAG_TEXTLANG && tag != IPP_TAG_NAMELANG &&
+	          (tag < IPP_TAG_TEXT || tag > IPP_TAG_MIMETYPE) &&
+		  tag != IPP_TAG_NOVALUE)
 	      {
 		DEBUG_printf(("1ippReadIO: 1setOf value tag %x(%s) != %x(%s)",
 			      value_tag, ippTagString(value_tag), tag,
@@ -2762,6 +2765,7 @@ _ippFreeAttr(ipp_attribute_t *attr)	/* I - Attribute to free */
   {
     case IPP_TAG_TEXT :
     case IPP_TAG_NAME :
+    case IPP_TAG_RESERVED_STRING :
     case IPP_TAG_KEYWORD :
     case IPP_TAG_URI :
     case IPP_TAG_URISCHEME :
diff --git a/cups/ipp.h b/cups/ipp.h
index 848544309..e72cf5ace 100644
--- a/cups/ipp.h
+++ b/cups/ipp.h
@@ -93,7 +93,8 @@ typedef enum ipp_tag_e			/**** Format tags for attributes ****/
   IPP_TAG_END_COLLECTION,		/* End of collection value */
   IPP_TAG_TEXT = 0x41,			/* Text value */
   IPP_TAG_NAME,				/* Name value */
-  IPP_TAG_KEYWORD = 0x44,		/* Keyword value */
+  IPP_TAG_RESERVED_STRING,		/* Reserved for future string value @private@ */
+  IPP_TAG_KEYWORD,			/* Keyword value */
   IPP_TAG_URI,				/* URI value */
   IPP_TAG_URISCHEME,			/* URI scheme value */
   IPP_TAG_CHARSET,			/* Character set value */
