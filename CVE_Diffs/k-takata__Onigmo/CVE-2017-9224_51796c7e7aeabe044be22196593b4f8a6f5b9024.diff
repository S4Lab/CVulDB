k-takata__Onigmo
commit 51796c7e7aeabe044be22196593b4f8a6f5b9024
Author:     K.Takata <kentkt@csc.jp>
AuthorDate: Wed Jul 12 22:48:21 2017 +0900
Commit:     K.Takata <kentkt@csc.jp>
CommitDate: Wed Jul 12 22:48:21 2017 +0900

    DATA_ENSURE() check must be before data access
    
    CVE-2017-9224
    https://github.com/kkos/oniguruma/issues/57

diff --git a/regexec.c b/regexec.c
index 9e5f559..505cb83 100644
--- a/regexec.c
+++ b/regexec.c
@@ -1811,14 +1811,9 @@ match_at(regex_t* reg, const UChar* str, const UChar* end,
       NEXT;
 
     CASE(OP_EXACT1)  MOP_IN(OP_EXACT1);
-#if 0
       DATA_ENSURE(1);
       if (*p != *s) goto fail;
       p++; s++;
-#endif
-      if (*p != *s++) goto fail;
-      DATA_ENSURE(0);
-      p++;
       MOP_OUT;
       NEXT;
 
