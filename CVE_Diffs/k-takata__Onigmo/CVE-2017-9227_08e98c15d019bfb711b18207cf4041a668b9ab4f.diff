k-takata__Onigmo
commit 08e98c15d019bfb711b18207cf4041a668b9ab4f
Author:     K.Takata <kentkt@csc.jp>
AuthorDate: Wed Jul 12 22:48:26 2017 +0900
Commit:     K.Takata <kentkt@csc.jp>
CommitDate: Wed Jul 12 22:48:26 2017 +0900

    Fix access to invalid address by reg->dmin value
    
    CVE-2017-9227
    https://github.com/kkos/oniguruma/issues/58

diff --git a/regexec.c b/regexec.c
index 505cb83..ef28af2 100644
--- a/regexec.c
+++ b/regexec.c
@@ -3912,6 +3912,8 @@ forward_search_range(regex_t* reg, const UChar* str, const UChar* end, UChar* s,
     }
     else {
       UChar *q = p + reg->dmin;
+
+      if (q >= end) return 0; /* fail */
       while (p < q) p += enclen(reg->enc, p, end);
     }
   }
