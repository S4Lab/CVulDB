bitrig__bitrig-xenocara
commit ece136256f66ce189df2bb72c6e8eeccef3ac92f
Author:     todd <todd@cvs.openbsd.org>
AuthorDate: Thu Aug 11 15:29:03 2011 +0000
Commit:     todd <todd@cvs.openbsd.org>
CommitDate: Thu Aug 11 15:29:03 2011 +0000

    fix from matthieu@ as applied upstream for CVE-2011-2895
    ok deraadt@

diff --git a/lib/libXfont/src/fontfile/decompress.c b/lib/libXfont/src/fontfile/decompress.c
index b1fc37b85..c8171dd4a 100644
--- a/lib/libXfont/src/fontfile/decompress.c
+++ b/lib/libXfont/src/fontfile/decompress.c
@@ -259,6 +259,8 @@ BufCompressedFill (BufFilePtr f)
      	 */
     	while ( code >= 256 )
     	{
+	    if (stackp - de_stack >= STACK_SIZE - 1)
+		return BUFFILEEOF;
 	    *stackp++ = file->tab_suffix[code];
 	    code = file->tab_prefix[code];
     	}
