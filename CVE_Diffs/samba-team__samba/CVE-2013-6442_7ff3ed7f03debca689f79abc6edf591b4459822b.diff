samba-team__samba
commit 7ff3ed7f03debca689f79abc6edf591b4459822b
Author:     Jeremy Allison <jra@samba.org>
AuthorDate: Wed Dec 18 13:56:18 2013 -0800
Commit:     Karolin Seeger <kseeger@samba.org>
CommitDate: Tue Mar 11 12:36:55 2014 +0100

    CVE-2013-6442: s3:smbcacls - ensure we don't lose an existing ACL when setting owner or group owner.
    
    Bug: https://bugzilla.samba.org/show_bug.cgi?id=10327
    Bug 10327 - CVE-2013-6442: smbcacls --chown | --chgrp dacl regression
    
    Signed-off-by: Jeremy Allison <jra@samba.org>
    Reviewed-by: Stefan Metzmacher <metze@samba.org>

diff --git a/source3/utils/smbcacls.c b/source3/utils/smbcacls.c
index bb02aa0e34d..f1f92c87696 100644
--- a/source3/utils/smbcacls.c
+++ b/source3/utils/smbcacls.c
@@ -991,7 +991,7 @@ static int owner_set(struct cli_state *cli, enum chown_mode change_mode,
 		return EXIT_FAILED;
 	}
 
-	sd = make_sec_desc(talloc_tos(),old->revision, old->type,
+	sd = make_sec_desc(talloc_tos(),old->revision, SEC_DESC_SELF_RELATIVE,
 				(change_mode == REQUEST_CHOWN) ? &sid : NULL,
 				(change_mode == REQUEST_CHGRP) ? &sid : NULL,
 			   NULL, NULL, &sd_size);
