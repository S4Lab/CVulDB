samba-team__samba
commit 03656a7c1ea68d4cea585f0bd4a3720be7f1cc13
Author:     Jeremy Allison <jra@samba.org>
AuthorDate: Thu Jul 11 09:36:01 2013 -0700
Commit:     Karolin Seeger <kseeger@samba.org>
CommitDate: Fri Aug 2 20:02:34 2013 +0200

    Fix bug #10010 - Missing integer wrap protection in EA list reading can cause server to loop with DOS.
    
    Fix client-side parsing also. Found by David Disseldorp <ddiss@suse.de>
    CVE-2013-4124
    
    Signed-off-by: Jeremy Allison <jra@samba.org>

diff --git a/source4/libcli/raw/raweas.c b/source4/libcli/raw/raweas.c
index 5f06e7001d8..b626b316d28 100644
--- a/source4/libcli/raw/raweas.c
+++ b/source4/libcli/raw/raweas.c
@@ -243,9 +243,12 @@ NTSTATUS ea_pull_list_chained(const DATA_BLOB *blob,
 			return NT_STATUS_INVALID_PARAMETER;
 		}
 
-		ofs += next_ofs;
+		if (ofs + next_ofs < ofs) {
+			return NT_STATUS_INVALID_PARAMETER;
+		}
 
-		if (ofs+4 > blob->length) {
+		ofs += next_ofs;
+		if (ofs+4 > blob->length || ofs+4 < ofs) {
 			return NT_STATUS_INVALID_PARAMETER;
 		}
 		n++;
