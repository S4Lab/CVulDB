samba-team__samba
commit 76e5ea3a2c5f49cfc1026bd7c6b8baddb1e7dc16
Author:     Stefan Metzmacher <metze@samba.org>
AuthorDate: Tue Nov 5 14:04:20 2013 +0100
Commit:     Stefan Metzmacher <metze@samba.org>
CommitDate: Thu Mar 13 10:21:47 2014 +0100

    CVE-2013-4496:s3:auth: fix memory leak in the ACCOUNT_LOCKED_OUT case.
    
    Bug: https://bugzilla.samba.org/show_bug.cgi?id=10245
    
    Change-Id: Iabf22753effd80086d7956619a3dae830e487da8
    Signed-off-by: Stefan Metzmacher <metze@samba.org>
    Reviewed-by: Jeremy Allison <jra@samba.org>
    Signed-off-by: Andrew Bartlett <abartlet@samba.org>
    Reviewed-on: https://gerrit.samba.org/161

diff --git a/source3/auth/check_samsec.c b/source3/auth/check_samsec.c
index b6cac60dd37..7c971703289 100644
--- a/source3/auth/check_samsec.c
+++ b/source3/auth/check_samsec.c
@@ -408,6 +408,7 @@ NTSTATUS check_sam_security(const DATA_BLOB *challenge,
 	/* Quit if the account was locked out. */
 	if (pdb_get_acct_ctrl(sampass) & ACB_AUTOLOCK) {
 		DEBUG(3,("check_sam_security: Account for user %s was locked out.\n", username));
+		TALLOC_FREE(sampass);
 		return NT_STATUS_ACCOUNT_LOCKED_OUT;
 	}
 
