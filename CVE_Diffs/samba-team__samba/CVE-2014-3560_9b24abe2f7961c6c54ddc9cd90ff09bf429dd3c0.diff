samba-team__samba
commit 9b24abe2f7961c6c54ddc9cd90ff09bf429dd3c0
Author:     Volker Lendecke <vl@samba.org>
AuthorDate: Tue Jul 22 07:02:00 2014 +0200
Commit:     Ira Cooper <ira@samba.org>
CommitDate: Fri Aug 1 22:10:23 2014 +0200

    fix unstrcpy
    
    Signed-off-by: Volker Lendecke <vl@samba.org>
    Reviewed-by: Jeremy Allison <jra@samba.org>
    
    Bug: https://bugzilla.samba.org/show_bug.cgi?id=10735
    CVE-2014-3560: unstrcpy macro length is invalid
    
    Autobuild-User(master): Ira Cooper <ira@samba.org>
    Autobuild-Date(master): Fri Aug  1 22:10:23 CEST 2014 on sn-devel-104

diff --git a/lib/util/string_wrappers.h b/lib/util/string_wrappers.h
index 5f9d5684e62..243fafc27ef 100644
--- a/lib/util/string_wrappers.h
+++ b/lib/util/string_wrappers.h
@@ -51,7 +51,7 @@ do { \
 #define unstrcpy(d,s) \
 do { \
 	const char *_unstrcpy_src = (const char *)(s); \
-	strlcpy((d),_unstrcpy_src ? _unstrcpy_src : "",sizeof(fstring)); \
+	strlcpy((d),_unstrcpy_src ? _unstrcpy_src : "",sizeof(unstring)); \
 } while (0)
 
 #ifdef HAVE_COMPILER_WILL_OPTIMIZE_OUT_FNS
