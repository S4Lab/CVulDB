samba-team__samba
commit 02a76d86db0cbe79fcaf1a500630e24d961fa149
Author:     Volker Lendecke <vl@samba.org>
AuthorDate: Mon May 8 21:40:40 2017 +0200
Commit:     Karolin Seeger <kseeger@samba.org>
CommitDate: Wed May 24 14:34:30 2017 +0200

    CVE-2017-7494: rpc_server3: Refuse to open pipe names with / inside
    
    Bug: https://bugzilla.samba.org/show_bug.cgi?id=12780
    
    Signed-off-by: Volker Lendecke <vl@samba.org>
    Reviewed-by: Jeremy Allison <jra@samba.org>
    Reviewed-by: Stefan Metzmacher <metze@samba.org>
    
    Autobuild-User(master): Karolin Seeger <kseeger@samba.org>
    Autobuild-Date(master): Wed May 24 14:34:30 CEST 2017 on sn-devel-144

diff --git a/source3/rpc_server/srv_pipe.c b/source3/rpc_server/srv_pipe.c
index 39f5fb49ec3..f79fbe26abf 100644
--- a/source3/rpc_server/srv_pipe.c
+++ b/source3/rpc_server/srv_pipe.c
@@ -481,6 +481,11 @@ bool is_known_pipename(const char *pipename, struct ndr_syntax_id *syntax)
 {
 	NTSTATUS status;
 
+	if (strchr(pipename, '/')) {
+		DEBUG(1, ("Refusing open on pipe %s\n", pipename));
+		return false;
+	}
+
 	if (lp_disable_spoolss() && strequal(pipename, "spoolss")) {
 		DEBUG(10, ("refusing spoolss access\n"));
 		return false;
