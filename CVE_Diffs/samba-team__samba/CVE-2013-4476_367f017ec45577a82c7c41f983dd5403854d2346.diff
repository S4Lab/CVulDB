samba-team__samba
commit 367f017ec45577a82c7c41f983dd5403854d2346
Author:     Björn Baumbach <bb@sernet.de>
AuthorDate: Tue Oct 29 17:49:55 2013 +0100
Commit:     Karolin Seeger <kseeger@samba.org>
CommitDate: Fri Nov 8 10:14:31 2013 +0100

    CVE-2013-4476: samba-tool provision: create ${private_dir}/tls with mode 0700
    
    Bug: https://bugzilla.samba.org/show_bug.cgi?id=10234
    
    Signed-off-by: Björn Baumbach <bb@sernet.de>
    Reviewed-by: Stefan Metzmacher <metze@samba.org>

diff --git a/python/samba/provision/__init__.py b/python/samba/provision/__init__.py
index e0b3d220bcc..0a54af8ad20 100644
--- a/python/samba/provision/__init__.py
+++ b/python/samba/provision/__init__.py
@@ -2014,7 +2014,7 @@ def provision(logger, session_info, credentials, smbconf=None,
     if not os.path.exists(paths.private_dir):
         os.mkdir(paths.private_dir)
     if not os.path.exists(os.path.join(paths.private_dir, "tls")):
-        os.mkdir(os.path.join(paths.private_dir, "tls"))
+        os.makedirs(os.path.join(paths.private_dir, "tls"), 0700)
     if not os.path.exists(paths.state_dir):
         os.mkdir(paths.state_dir)
 
