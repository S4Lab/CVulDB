samba-team__samba
commit 2ad53d1c075b9ad0dae80deed4f6551f78e16c6d
Author:     Garming Sam <garming@catalyst.net.nz>
AuthorDate: Thu Jan 21 16:58:40 2016 +1300
Commit:     Stefan Metzmacher <metze@samba.org>
CommitDate: Thu Mar 10 06:52:24 2016 +0100

    CVE-2016-0771: tests/dns: prepare script for further testing
    
    BUG: https://bugzilla.samba.org/show_bug.cgi?id=11128
    BUG: https://bugzilla.samba.org/show_bug.cgi?id=11686
    
    Signed-off-by: Garming Sam <garming@catalyst.net.nz>
    Reviewed-by: Stefan Metzmacher <metze@samba.org>
    Reviewed-by: Andrew Bartlett <abartlet@samba.org>

diff --git a/python/samba/tests/dns.py b/python/samba/tests/dns.py
index 1d795fff8fc..6aeff38dbb2 100644
--- a/python/samba/tests/dns.py
+++ b/python/samba/tests/dns.py
@@ -35,6 +35,11 @@ def make_txt_record(records):
 
 class DNSTest(TestCase):
 
+    def get_loadparm(self):
+        lp = param.LoadParm()
+        lp.load(os.getenv("SMB_CONF_PATH"))
+        return lp
+
     def errstr(self, errcode):
         "Return a readable error code"
         string_codes = [
@@ -855,11 +860,6 @@ class TestInvalidQueries(DNSTest):
                 s.close()
 
 class TestZones(DNSTest):
-    def get_loadparm(self):
-        lp = param.LoadParm()
-        lp.load(os.getenv("SMB_CONF_PATH"))
-        return lp
-
     def get_credentials(self, lp):
         creds = credentials.Credentials()
         creds.guess(lp)
@@ -873,7 +873,7 @@ class TestZones(DNSTest):
         self.creds = self.get_credentials(self.lp)
         self.server = os.getenv("SERVER_IP")
         self.zone = "test.lan"
-        self.rpc_conn = dnsserver.dnsserver("ncacn_ip_tcp:%s" % (self.server),
+        self.rpc_conn = dnsserver.dnsserver("ncacn_ip_tcp:%s[sign]" % (self.server),
                                             self.lp, self.creds)
 
     def tearDown(self):
