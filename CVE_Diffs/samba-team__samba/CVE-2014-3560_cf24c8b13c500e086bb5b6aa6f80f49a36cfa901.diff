samba-team__samba
commit cf24c8b13c500e086bb5b6aa6f80f49a36cfa901
Author:     Volker Lendecke <vl@samba.org>
AuthorDate: Tue Jul 22 07:02:00 2014 +0200
Commit:     Karolin Seeger <kseeger@samba.org>
CommitDate: Fri Aug 1 13:17:46 2014 +0200

    fix unstrcpy
    
    Signed-off-by: Volker Lendecke <vl@samba.org>
    Reviewed-by: Jeremy Allison <jra@samba.org>
    
    Bug: https://bugzilla.samba.org/show_bug.cgi?id=10735
    CVE-2014-3560: unstrcpy macro length is invalid

diff --git a/lib/util/string_wrappers.h b/lib/util/string_wrappers.h
index 5f9d5684e62..243fafc27ef 100644
--- a/lib/util/string_wrappers.h
+++ b/lib/util/string_wrappers.h
@@ -51,7 +51,7 @@ do { \
 #define unstrcpy(d,s) \
 do { \
 	const char *_unstrcpy_src = (const char *)(s); \
-	strlcpy((d),_unstrcpy_src ? _unstrcpy_src : "",sizeof(fstring)); \
+	strlcpy((d),_unstrcpy_src ? _unstrcpy_src : "",sizeof(unstring)); \
 } while (0)
 
 #ifdef HAVE_COMPILER_WILL_OPTIMIZE_OUT_FNS
