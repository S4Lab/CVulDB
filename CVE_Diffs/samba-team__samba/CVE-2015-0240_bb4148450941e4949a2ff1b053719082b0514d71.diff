samba-team__samba
commit bb4148450941e4949a2ff1b053719082b0514d71
Author:     Andreas Schneider <asn@samba.org>
AuthorDate: Mon Feb 16 10:59:23 2015 +0100
Commit:     Karolin Seeger <kseeger@samba.org>
CommitDate: Mon Feb 23 17:33:07 2015 +0100

    s3-netlogon: Make sure we do not deference a NULL pointer.
    
    This is an additional patch for CVE-2015-0240.
    
    BUG: https://bugzilla.samba.org/show_bug.cgi?id=11077#c32
    
    Pair-Programmed-With: Michael Adam <obnox@samba.org>
    Pair-Programmed-With: Andreas Schneider <asn@samba.org>
    Signed-off-by: Michael Adam <obnox@samba.org>
    Signed-off-by: Andreas Schneider <asn@samba.org>
    Reviewed-by: Volker Lendecke <vl@samba.org>

diff --git a/source3/rpc_server/netlogon/srv_netlog_nt.c b/source3/rpc_server/netlogon/srv_netlog_nt.c
index f5f819118fb..b487c31e872 100644
--- a/source3/rpc_server/netlogon/srv_netlog_nt.c
+++ b/source3/rpc_server/netlogon/srv_netlog_nt.c
@@ -1274,9 +1274,14 @@ NTSTATUS _netr_ServerPasswordSet(struct pipes_struct *p,
 	unbecome_root();
 
 	if (!NT_STATUS_IS_OK(status)) {
+		const char *computer_name = "<unknown>";
+
+		if (creds != NULL && creds->computer_name != NULL) {
+			computer_name = creds->computer_name;
+		}
 		DEBUG(2,("_netr_ServerPasswordSet: netlogon_creds_server_step failed. Rejecting auth "
 			"request from client %s machine account %s\n",
-			r->in.computer_name, creds->computer_name));
+			r->in.computer_name, computer_name));
 		TALLOC_FREE(creds);
 		return status;
 	}
