samba-team__samba
commit 239c0f267cc6fd81b15c67c81bda84de65950dfa
Author:     Andrew Bartlett <abartlet@samba.org>
AuthorDate: Tue Nov 11 15:23:02 2014 +1300
Commit:     Karolin Seeger <kseeger@samba.org>
CommitDate: Thu Jan 15 20:18:07 2015 +0100

    CVE-2014-8143:auth: Force talloc type of session_info pointer to match
    
    This helps us keep things safe in LDB where we put this in a opaque pointer.
    
    Bug: https://bugzilla.samba.org/show_bug.cgi?id=10993
    
    Andrew Bartlett
    
    Change-Id: I46fe53ba655ca0810c276b72fbca524884cdf22d
    Signed-off-by: Andrew Bartlett <abartlet@samba.org>
    Reviewed-by: Garming Sam <garming@catalyst.net.nz>
    Reviewed-by: Stefan Metzmacher <metze@samba.org>

diff --git a/source4/auth/session.c b/source4/auth/session.c
index b4b4200337a..3d8714c3e1f 100644
--- a/source4/auth/session.c
+++ b/source4/auth/session.c
@@ -233,6 +233,11 @@ struct auth_session_info *auth_session_info_from_transport(TALLOC_CTX *mem_ctx,
 {
 	struct auth_session_info *session_info;
 	session_info = talloc_steal(mem_ctx, session_info_transport->session_info);
+	/*
+	 * This is to allow us to check the type of this pointer using
+	 * talloc_get_type()
+	 */
+	talloc_set_name(session_info, "struct auth_session_info");
 #ifdef HAVE_GSS_IMPORT_CRED
 	if (session_info_transport->exported_gssapi_credentials.length) {
 		struct cli_credentials *creds;
