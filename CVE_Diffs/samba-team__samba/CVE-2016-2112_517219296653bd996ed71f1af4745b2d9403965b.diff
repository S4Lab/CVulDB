samba-team__samba
commit 517219296653bd996ed71f1af4745b2d9403965b
Author:     Stefan Metzmacher <metze@samba.org>
AuthorDate: Fri Dec 18 11:56:29 2015 +0100
Commit:     Stefan Metzmacher <metze@samba.org>
CommitDate: Tue Mar 29 16:27:03 2016 +0200

    CVE-2016-2112: s4:selftest: use --option=clientldapsaslwrapping=plain for plain connections
    
    BUG: https://bugzilla.samba.org/show_bug.cgi?id=11644
    
    Signed-off-by: Stefan Metzmacher <metze@samba.org>
    Reviewed-by: GÃ¼nther Deschner <gd@samba.org>

diff --git a/source4/selftest/tests.py b/source4/selftest/tests.py
index f78f83e33e1..0bcf8173069 100755
--- a/source4/selftest/tests.py
+++ b/source4/selftest/tests.py
@@ -44,7 +44,7 @@ bbdir = os.path.join(srcdir(), "testprogs/blackbox")
 
 # Simple tests for LDAP and CLDAP
 for auth_type in ['', '-k no', '-k yes']:
-    for auth_level in ['', '--sign', '--encrypt']:
+    for auth_level in ['--option=clientldapsaslwrapping=plain', '--sign', '--encrypt']:
         creds = '-U"$USERNAME%$PASSWORD"'
         options = creds + ' ' + auth_type + ' ' + auth_level
         plantestsuite("samba4.ldb.ldap with options %r(ad_dc_ntvfs)" % options, "ad_dc_ntvfs", "%s/test_ldb.sh ldap $SERVER %s" % (bbdir, options))
