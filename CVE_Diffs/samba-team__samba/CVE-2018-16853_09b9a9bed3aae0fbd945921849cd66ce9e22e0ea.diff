samba-team__samba
commit 09b9a9bed3aae0fbd945921849cd66ce9e22e0ea
Author:     Andreas Schneider <asn@samba.org>
AuthorDate: Wed Sep 28 07:22:32 2016 +0200
Commit:     Karolin Seeger <kseeger@samba.org>
CommitDate: Fri Dec 7 11:39:37 2018 +0100

    CVE-2018-16853: Do not segfault if client is not set
    
    This can be triggered with FAST but we don't support this yet.
    
    BUG: https://bugzilla.samba.org/show_bug.cgi?id=13571
    
    Signed-off-by: Andreas Schneider <asn@samba.org>
    Reviewed-by: Stefan Metzmacher <metze@samba.org>

diff --git a/source4/kdc/mit-kdb/kdb_samba_policies.c b/source4/kdc/mit-kdb/kdb_samba_policies.c
index 4364461302c..0b1265980b1 100644
--- a/source4/kdc/mit-kdb/kdb_samba_policies.c
+++ b/source4/kdc/mit-kdb/kdb_samba_policies.c
@@ -445,6 +445,14 @@ void kdb_samba_db_audit_as_req(krb5_context context,
 {
 	struct mit_samba_context *mit_ctx;
 
+	/*
+	 * FIXME: This segfaulted with a FAST test
+	 * FIND_FAST: <unknown client> for <unknown server>, Unknown FAST armor type 0
+	 */
+	if (client == NULL) {
+		return;
+	}
+
 	mit_ctx = ks_get_context(context);
 	if (mit_ctx == NULL) {
 		return;
