samba-team__samba
commit 1da911bf29c0c712670a445943292bfb98107ffc
Author:     Stefan Metzmacher <metze@samba.org>
AuthorDate: Wed Nov 23 11:42:59 2016 +0100
Commit:     Karolin Seeger <kseeger@samba.org>
CommitDate: Mon Dec 19 10:52:14 2016 +0100

    CVE-2016-2125: s3:gse: avoid using GSS_C_DELEG_FLAG
    
    We should only use GSS_C_DELEG_POLICY_FLAG in order to let
    the KDC decide if we should send delegated credentials to
    a remote server.
    
    BUG: https://bugzilla.samba.org/show_bug.cgi?id=12445
    
    Signed-off-by: Stefan Metzmacher <metze@samba.org>
    Reviewed-by: Alexander Bokovoy <ab@samba.org>
    Reviewed-by: Simo Sorce <idra@samba.org>

diff --git a/source3/librpc/crypto/gse.c b/source3/librpc/crypto/gse.c
index 963c98a9e9d..c4c4bbc8a0c 100644
--- a/source3/librpc/crypto/gse.c
+++ b/source3/librpc/crypto/gse.c
@@ -142,7 +142,6 @@ static NTSTATUS gse_context_init(TALLOC_CTX *mem_ctx,
 	memcpy(&gse_ctx->gss_mech, gss_mech_krb5, sizeof(gss_OID_desc));
 
 	gse_ctx->gss_want_flags = GSS_C_MUTUAL_FLAG |
-				GSS_C_DELEG_FLAG |
 				GSS_C_DELEG_POLICY_FLAG |
 				GSS_C_REPLAY_FLAG |
 				GSS_C_SEQUENCE_FLAG;
