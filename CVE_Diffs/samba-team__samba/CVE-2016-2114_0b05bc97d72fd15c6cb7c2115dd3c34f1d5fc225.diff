samba-team__samba
commit 0b05bc97d72fd15c6cb7c2115dd3c34f1d5fc225
Author:     Ralph Boehme <slow@samba.org>
AuthorDate: Tue Mar 22 16:25:32 2016 +0100
Commit:     Stefan Metzmacher <metze@samba.org>
CommitDate: Wed Mar 30 04:37:55 2016 +0200

    CVE-2016-2114: libcli/smb: let mandatory signing imply allowed signing
    
    BUG: https://bugzilla.samba.org/show_bug.cgi?id=11687
    
    Pair-Programmed-With: Stefan Metzmacher <metze@samba.org>
    
    Signed-off-by: Ralph Boehme <slow@samba.org>
    Signed-off-by: Stefan Metzmacher <metze@samba.org>
    Reviewed-by: GÃ¼nther Deschner <gd@samba.org>

diff --git a/libcli/smb/smb_signing.c b/libcli/smb/smb_signing.c
index e128e8f8a0b..a7bc819f489 100644
--- a/libcli/smb/smb_signing.c
+++ b/libcli/smb/smb_signing.c
@@ -424,6 +424,10 @@ bool smb_signing_set_negotiated(struct smb_signing_state *si,
 		return true;
 	}
 
+	if (mandatory) {
+		allowed = true;
+	}
+
 	if (!si->allowed && mandatory) {
 		return false;
 	}
