samba-team__samba
commit 41d8d99d8ac9e53405868bf5e34f48a01550c1f4
Author:     Jeremy Allison <jra@samba.org>
AuthorDate: Wed Dec 18 13:56:18 2013 -0800
Commit:     Karolin Seeger <kseeger@samba.org>
CommitDate: Tue Mar 11 22:55:53 2014 +0100

    CVE-2013-6442: s3:smbcacls - ensure we don't lose an existing ACL when setting owner or group owner.
    
    Bug: https://bugzilla.samba.org/show_bug.cgi?id=10327
    Bug 10327 - CVE-2013-6442: smbcacls --chown | --chgrp dacl regression
    
    Signed-off-by: Jeremy Allison <jra@samba.org>
    Reviewed-by: Stefan Metzmacher <metze@samba.org>
    
    Autobuild-User(master): Karolin Seeger <kseeger@samba.org>
    Autobuild-Date(master): Tue Mar 11 22:55:54 CET 2014 on sn-devel-104

diff --git a/source3/utils/smbcacls.c b/source3/utils/smbcacls.c
index 11b7388303c..e3b7099f4fd 100644
--- a/source3/utils/smbcacls.c
+++ b/source3/utils/smbcacls.c
@@ -990,7 +990,7 @@ static int owner_set(struct cli_state *cli, enum chown_mode change_mode,
 		return EXIT_FAILED;
 	}
 
-	sd = make_sec_desc(talloc_tos(),old->revision, old->type,
+	sd = make_sec_desc(talloc_tos(),old->revision, SEC_DESC_SELF_RELATIVE,
 				(change_mode == REQUEST_CHOWN) ? &sid : NULL,
 				(change_mode == REQUEST_CHGRP) ? &sid : NULL,
 			   NULL, NULL, &sd_size);
