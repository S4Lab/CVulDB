SELinuxProject__selinux-kernel
commit d0239f35c7ae63dbe715b1cc66e4860c2cb33154
Author:     James Morris <jmorris@namei.org>
AuthorDate: Mon Oct 30 15:11:21 2006 -0800
Commit:     Chris Wright <chrisw@sous-sol.org>
CommitDate: Fri Nov 3 17:33:50 2006 -0800

    [PATCH] IPV6: fix lockup via /proc/net/ip6_flowlabel [CVE-2006-5619]
    
    There's a bug in the seqfile handling for /proc/net/ip6_flowlabel, where,
    after finding a flowlabel, the code will loop forever not finding any
    further flowlabels, first traversing the rest of the hash bucket then just
    looping.
    
    This patch fixes the problem by breaking after the hash bucket has been
    traversed.
    
    Note that this bug can cause lockups and oopses, and is trivially invoked
    by an unpriveleged user.
    
    Signed-off-by: James Morris <jmorris@namei.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Chris Wright <chrisw@sous-sol.org>

diff --git a/net/ipv6/ip6_flowlabel.c b/net/ipv6/ip6_flowlabel.c
index 1d672b0547f2..062e526a668c 100644
--- a/net/ipv6/ip6_flowlabel.c
+++ b/net/ipv6/ip6_flowlabel.c
@@ -587,6 +587,8 @@ static struct ip6_flowlabel *ip6fl_get_next(struct seq_file *seq, struct ip6_flo
 	while (!fl) {
 		if (++state->bucket <= FL_HASH_MASK)
 			fl = fl_ht[state->bucket];
+		else
+			break;
 	}
 	return fl;
 }
