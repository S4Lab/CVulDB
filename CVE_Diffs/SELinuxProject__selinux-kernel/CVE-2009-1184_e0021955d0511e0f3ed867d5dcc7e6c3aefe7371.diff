SELinuxProject__selinux-kernel
commit e0021955d0511e0f3ed867d5dcc7e6c3aefe7371
Author:     Eugene Teo <eteo@redhat.com>
AuthorDate: Mon Apr 13 10:04:41 2009 +0800
Commit:     Greg Kroah-Hartman <gregkh@suse.de>
CommitDate: Sat May 2 10:57:21 2009 -0700

    unreached code in selinux_ip_postroute_iptables_compat() (CVE-2009-1184)
    
    Not upstream in 2.6.30, as the function was removed there, making this a
    non-issue.
    
    Node and port send checks can skip in the compat_net=1 case. This bug
    was introduced in commit effad8d.
    
    Signed-off-by: Eugene Teo <eugeneteo@kernel.sg>
    Reported-by: Dan Carpenter <error27@gmail.com>
    Acked-by: James Morris <jmorris@namei.org>
    Acked-by: Paul Moore <paul.moore@hp.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/security/selinux/hooks.c b/security/selinux/hooks.c
index f85597a4d733..d9a5adc3986c 100644
--- a/security/selinux/hooks.c
+++ b/security/selinux/hooks.c
@@ -4550,6 +4550,7 @@ static int selinux_ip_postroute_iptables_compat(struct sock *sk,
 	if (err)
 		return err;
 	err = avc_has_perm(sk_sid, if_sid, SECCLASS_NETIF, netif_perm, ad);
+	if (err)
 		return err;
 
 	err = sel_netnode_sid(addrp, family, &node_sid);
