libgd__libgd
commit f4ee9d6c0c0cbc5f4ee976987d369e465eb97bf4
Author:     Ondřej Surý <ondrej@sury.org>
AuthorDate: Thu Apr 11 15:55:19 2013 +0200
Commit:     Ondřej Surý <ondrej@sury.org>
CommitDate: Thu Apr 11 15:57:55 2013 +0200

    CVE-2009-3546: buffer overflow or buffer over-read attacks via a crafted GD file

diff --git a/src/gd_gd.c b/src/gd_gd.c
index 93d14ef..805e862 100644
--- a/src/gd_gd.c
+++ b/src/gd_gd.c
@@ -44,6 +44,10 @@ _gdGetColors (gdIOCtx * in, gdImagePtr im, int gd2xFlag)
 	    {
 	      goto fail1;
 	    }
+	  if (im->colorsTotal > gdMaxColors)
+	    {
+	      goto fail1;
+	    }
 	}
       /* Int to accommodate truecolor single-color transparency */
       if (!gdGetInt (&im->transparent, in))
