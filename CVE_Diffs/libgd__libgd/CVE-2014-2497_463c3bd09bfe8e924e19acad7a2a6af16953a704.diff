libgd__libgd
commit 463c3bd09bfe8e924e19acad7a2a6af16953a704
Author:     Remi Collet <fedora@famillecollet.com>
AuthorDate: Mon Aug 4 10:31:25 2014 +0200
Commit:     Remi Collet <fedora@famillecollet.com>
CommitDate: Mon Aug 4 10:31:25 2014 +0200

    CVE-2014-2497, NULL pointer dereference, fix #126

diff --git a/src/gdxpm.c b/src/gdxpm.c
index ae6e336..15603a6 100644
--- a/src/gdxpm.c
+++ b/src/gdxpm.c
@@ -83,6 +83,16 @@ BGD_DECLARE(gdImagePtr) gdImageCreateFromXpm(char *filename)
 	if(overflow2(sizeof(int), number)) {
 		goto done;
 	}
+	for(i = 0; i < number; i++) {
+		/*
+		   avoid NULL pointer dereference
+		   TODO better fix need to manage monochrome/monovisual
+		   see m_color or g4_color or g_color
+		*/
+		if (!image.colorTable[i].c_color) {
+			goto done;
+		}
+	}
 
 	colors = (int *)gdMalloc(sizeof(int) * number);
 	if(colors == NULL) {
