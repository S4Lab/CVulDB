openssl__openssl
commit 8b4fd12b0d1734d281994000752c771e8cd0a103
Author:     Matt Caswell <matt@openssl.org>
AuthorDate: Wed Jun 10 09:32:34 2015 +0100
Commit:     Matt Caswell <matt@openssl.org>
CommitDate: Wed Jun 10 10:05:17 2015 +0100

    Fix Kerberos issue in ssl_session_dup
    
    The fix for CVE-2015-1791 introduced an error in ssl_session_dup for
    Kerberos.
    
    Reviewed-by: Tim Hudson <tjh@openssl.org>
    (cherry picked from commit dcad51bc13c9b716d9a66248bcc4038c071ff158)

diff --git a/ssl/ssl_sess.c b/ssl/ssl_sess.c
index 9baa090d82..d3bac0bb9f 100644
--- a/ssl/ssl_sess.c
+++ b/ssl/ssl_sess.c
@@ -150,7 +150,7 @@ SSL_SESSION *ssl_session_dup(SSL_SESSION *src, int ticket)
     memcpy(dest, src, sizeof(*dest));
 
 #ifndef OPENSSL_NO_KRB5
-    dest->krb5_client_princ_len = dest->krb5_client_princ_len;
+    dest->krb5_client_princ_len = src->krb5_client_princ_len;
     if (src->krb5_client_princ_len > 0)
         memcpy(dest->krb5_client_princ, src->krb5_client_princ,
                src->krb5_client_princ_len);
