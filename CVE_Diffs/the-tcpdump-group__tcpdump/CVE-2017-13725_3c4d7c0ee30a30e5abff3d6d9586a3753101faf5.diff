the-tcpdump-group__tcpdump
commit 3c4d7c0ee30a30e5abff3d6d9586a3753101faf5
Author:     Guy Harris <guy@alum.mit.edu>
AuthorDate: Sat Feb 4 03:18:44 2017 -0800
Commit:     Denis Ovsienko <denis@ovsienko.info>
CommitDate: Wed Sep 13 12:25:44 2017 +0100

    CVE-2017-13725/IPv6 R.H.: Check for the existence of all fields before fetching them.
    
    Don't fetch the length field from the header until after we've checked
    for the existence of a field at or after that field.
    
    (Found by code inspection, not by a capture.)

diff --git a/print-rt6.c b/print-rt6.c
index 35dbed98..0395791d 100644
--- a/print-rt6.c
+++ b/print-rt6.c
@@ -45,13 +45,13 @@ rt6_print(netdissect_options *ndo, register const u_char *bp, const u_char *bp2
 	register const struct in6_addr *addr;
 
 	dp = (const struct ip6_rthdr *)bp;
-	len = dp->ip6r_len;
 
 	/* 'ep' points to the end of available data. */
 	ep = ndo->ndo_snapend;
 
 	ND_TCHECK(dp->ip6r_segleft);
 
+	len = dp->ip6r_len;
 	ND_PRINT((ndo, "srcrt (len=%d", dp->ip6r_len));	/*)*/
 	ND_PRINT((ndo, ", type=%d", dp->ip6r_type));
 	ND_PRINT((ndo, ", segleft=%d", dp->ip6r_segleft));
