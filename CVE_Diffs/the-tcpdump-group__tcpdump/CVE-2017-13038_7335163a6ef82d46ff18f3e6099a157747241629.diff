the-tcpdump-group__tcpdump
commit 7335163a6ef82d46ff18f3e6099a157747241629
Author:     Guy Harris <guy@alum.mit.edu>
AuthorDate: Sun Jun 11 18:27:27 2017 -0700
Commit:     Denis Ovsienko <denis@ovsienko.info>
CommitDate: Wed Sep 13 12:25:44 2017 +0100

    CVE-2017-13038/PPP: Do bounds checking.
    
    This fixes a buffer over-read discovered by Brian 'geeknik' Carpenter.
    
    Add a test using the capture file supplied by Katie Holly.

diff --git a/print-ppp.c b/print-ppp.c
index d07763cb..89176172 100644
--- a/print-ppp.c
+++ b/print-ppp.c
@@ -811,6 +811,15 @@ handle_mlppp(netdissect_options *ndo,
     if (!ndo->ndo_eflag)
         ND_PRINT((ndo, "MLPPP, "));
 
+    if (length < 2) {
+        ND_PRINT((ndo, "[|mlppp]"));
+        return;
+    }
+    if (!ND_TTEST_16BITS(p)) {
+        ND_PRINT((ndo, "[|mlppp]"));
+        return;
+    }
+
     ND_PRINT((ndo, "seq 0x%03x, Flags [%s], length %u",
            (EXTRACT_16BITS(p))&0x0fff, /* only support 12-Bit sequence space for now */
            bittok2str(ppp_ml_flag_values, "none", *p & 0xc0),
diff --git a/tests/TESTLIST b/tests/TESTLIST
index 5732f8ff..bdc7ff40 100644
--- a/tests/TESTLIST
+++ b/tests/TESTLIST
@@ -554,6 +554,9 @@ radius_attr_asan	radius_attr_asan.pcap		radius_attr_asan.out	-v
 ospf6_decode_v3_asan	ospf6_decode_v3_asan.pcap	ospf6_decode_v3_asan.out -v
 ip_ts_opts_asan		ip_ts_opts_asan.pcap		ip_ts_opts_asan.out	-v
 
+# bad packets from Katie Holly
+mlppp-oobr		mlppp-oobr.pcap			mlppp-oobr.out
+
 # RTP tests
 # fuzzed pcap
 rtp-seg-fault-1  rtp-seg-fault-1.pcap  rtp-seg-fault-1.out  -v -T rtp
diff --git a/tests/mlppp-oobr.out b/tests/mlppp-oobr.out
new file mode 100644
index 00000000..9230189c
--- /dev/null
+++ b/tests/mlppp-oobr.out
@@ -0,0 +1 @@
+MLPPP, [|mlppp]
diff --git a/tests/mlppp-oobr.pcap b/tests/mlppp-oobr.pcap
new file mode 100644
index 00000000..95b1bbe3
Binary files /dev/null and b/tests/mlppp-oobr.pcap differ
