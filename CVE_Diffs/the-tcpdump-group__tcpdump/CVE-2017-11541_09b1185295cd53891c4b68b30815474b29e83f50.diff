the-tcpdump-group__tcpdump
commit 09b1185295cd53891c4b68b30815474b29e83f50
Author:     Guy Harris <guy@alum.mit.edu>
AuthorDate: Tue Feb 7 11:40:36 2017 -0800
Commit:     Denis Ovsienko <denis@ovsienko.info>
CommitDate: Sat Sep 2 19:55:00 2017 +0100

    CVE-2017-11541: In safeputs(), check the length before checking for a NUL terminator.
    
    safeputs() doesn't do packet bounds checking of its own; it assumes that
    the caller has checked the availability in the packet data of all maxlen
    bytes of data.  This means we should check that we're within the
    specified limit before looking at the byte.
    
    This fixes a buffer over-read discovered by Kamil Frankowicz.
    
    Add a test using the capture file supplied by the reporter(s).

diff --git a/tests/TESTLIST b/tests/TESTLIST
index dde3d917..1c33f0f5 100644
--- a/tests/TESTLIST
+++ b/tests/TESTLIST
@@ -437,6 +437,7 @@ isoclns-heapoverflow-2	isoclns-heapoverflow-2.pcap	isoclns-heapoverflow-2.out	-e
 isoclns-heapoverflow-3	isoclns-heapoverflow-3.pcap	isoclns-heapoverflow-3.out	-e -c1
 stp-v4-length-sigsegv	stp-v4-length-sigsegv.pcap	stp-v4-length-sigsegv.out
 hoobr_pimv1		hoobr_pimv1.pcap		hoobr_pimv1.out
+hoobr_safeputs		hoobr_safeputs.pcap		hoobr_safeputs.out
 
 # RTP tests
 # fuzzed pcap
diff --git a/tests/hoobr_safeputs.out b/tests/hoobr_safeputs.out
new file mode 100644
index 00000000..fdef40b1
--- /dev/null
+++ b/tests/hoobr_safeputs.out
@@ -0,0 +1,2 @@
+LLDP, length 808464418: 0000000000
+	[|LLDP]
diff --git a/tests/hoobr_safeputs.pcap b/tests/hoobr_safeputs.pcap
new file mode 100644
index 00000000..ce3b1249
Binary files /dev/null and b/tests/hoobr_safeputs.pcap differ
diff --git a/util-print.c b/util-print.c
index 6eb820df..281ecd76 100644
--- a/util-print.c
+++ b/util-print.c
@@ -902,7 +902,7 @@ safeputs(netdissect_options *ndo,
 {
 	u_int idx = 0;
 
-	while (*s && idx < maxlen) {
+	while (idx < maxlen && *s) {
 		safeputchar(ndo, *s);
 		idx++;
 		s++;
