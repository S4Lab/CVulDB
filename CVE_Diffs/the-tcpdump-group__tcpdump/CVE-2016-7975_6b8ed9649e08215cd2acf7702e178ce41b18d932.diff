the-tcpdump-group__tcpdump
commit 6b8ed9649e08215cd2acf7702e178ce41b18d932
Author:     Guy Harris <guy@alum.mit.edu>
AuthorDate: Fri Jul 3 16:28:25 2015 -0700
Commit:     Francois-Xavier Le Bail <fx.lebail@yahoo.com>
CommitDate: Wed Jan 18 09:16:36 2017 +0100

    CVE-2016-7975/Fix another bounds check.
    
    Fixes a heap overflow found with American Fuzzy Lop by Hanno BÃ¶ck.

diff --git a/print-tcp.c b/print-tcp.c
index a1c1dde7..3a89e8d3 100644
--- a/print-tcp.c
+++ b/print-tcp.c
@@ -541,7 +541,7 @@ tcp_print(netdissect_options *ndo,
                                 ND_PRINT((ndo, " keyid %d", *cp++));
                                 datalen = len - 3;
                                 for (i = 0; i < datalen; ++i) {
-                                        LENCHECK(i);
+                                        LENCHECK(i + 1);
                                         ND_PRINT((ndo, "%02x", cp[i]));
                                 }
                                 break;
diff --git a/tests/TESTLIST b/tests/TESTLIST
index 169750ec..99c40a46 100644
--- a/tests/TESTLIST
+++ b/tests/TESTLIST
@@ -383,3 +383,4 @@ calm-fast-mac-lookup-heapoverflow	calm-fast-mac-lookup-heapoverflow.pcap	calm-fa
 geonet-mac-lookup-heapoverflow	geonet-mac-lookup-heapoverflow.pcap	geonet-mac-lookup-heapoverflow.out	-t -v -n
 radiotap-heapoverflow	radiotap-heapoverflow.pcap	radiotap-heapoverflow.out -t -v -n
 isoclns-heapoverflow	isoclns-heapoverflow.pcap	isoclns-heapoverflow.out	-t -v -n
+tcp-auth-heapoverflow	tcp-auth-heapoverflow.pcap	tcp-auth-heapoverflow.out	-t -v -n
diff --git a/tests/tcp-auth-heapoverflow.out b/tests/tcp-auth-heapoverflow.out
new file mode 100644
index 00000000..ba115130
--- /dev/null
+++ b/tests/tcp-auth-heapoverflow.out
@@ -0,0 +1,2 @@
+IP (tos 0x30, ttl 48, id 12336, offset 0, flags [DF], proto TCP (6), length 12336, bad cksum 3030 (->29a8)!)
+    48.48.48.48.12336 > 48.48.48.48.12336: Flags [.U], seq 808464432:808476696, ack 808464432, win 12336, urg 12336, options [enhanced authkeyid 4830303030303030[|tcp]
diff --git a/tests/tcp-auth-heapoverflow.pcap b/tests/tcp-auth-heapoverflow.pcap
new file mode 100644
index 00000000..0d6fa1d5
Binary files /dev/null and b/tests/tcp-auth-heapoverflow.pcap differ
