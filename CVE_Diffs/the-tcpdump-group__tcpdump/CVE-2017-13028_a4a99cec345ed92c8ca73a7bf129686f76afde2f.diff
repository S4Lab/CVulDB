the-tcpdump-group__tcpdump
commit a4a99cec345ed92c8ca73a7bf129686f76afde2f
Author:     Francois-Xavier Le Bail <devel.fx.lebail@orange.fr>
AuthorDate: Wed Mar 22 19:37:04 2017 +0100
Commit:     Denis Ovsienko <denis@ovsienko.info>
CommitDate: Mon Sep 4 00:08:58 2017 +0100

    CVE-2017-13028/BOOTP: Add a bounds check before fetching data
    
    This fixes a buffer over-read discovered by Bhargava Shastry,
    SecT/TU Berlin.
    
    Add a test using the capture file supplied by the reporter(s), modified
    so the capture file won't cause 'tcpdump: pcap_loop: truncated dump file'

diff --git a/print-bootp.c b/print-bootp.c
index fe798a04..d87911fd 100644
--- a/print-bootp.c
+++ b/print-bootp.c
@@ -322,6 +322,7 @@ bootp_print(netdissect_options *ndo,
 	if (EXTRACT_16BITS(&bp->bp_secs))
 		ND_PRINT((ndo, ", secs %d", EXTRACT_16BITS(&bp->bp_secs)));
 
+	ND_TCHECK(bp->bp_flags);
 	ND_PRINT((ndo, ", Flags [%s]",
 		  bittok2str(bootp_flag_values, "none", EXTRACT_16BITS(&bp->bp_flags))));
 	if (ndo->ndo_vflag > 1)
diff --git a/tests/TESTLIST b/tests/TESTLIST
index 531989dc..1437348c 100644
--- a/tests/TESTLIST
+++ b/tests/TESTLIST
@@ -530,6 +530,7 @@ isis_stlv_asan-2	isis_stlv_asan-2.pcap		isis_stlv_asan-2.out	-v
 isis_stlv_asan-3	isis_stlv_asan-3.pcap		isis_stlv_asan-3.out	-v
 isis_stlv_asan-4	isis_stlv_asan-4.pcap		isis_stlv_asan-4.out	-v
 lldp_mgmt_addr_tlv_asan	lldp_mgmt_addr_tlv_asan.pcap	lldp_mgmt_addr_tlv_asan.out	-v
+bootp_asan		bootp_asan.pcap			bootp_asan.out		-v
 
 # RTP tests
 # fuzzed pcap
diff --git a/tests/bootp_asan.out b/tests/bootp_asan.out
new file mode 100644
index 00000000..d3ae8d99
--- /dev/null
+++ b/tests/bootp_asan.out
@@ -0,0 +1,2 @@
+IP (tos 0x0, ttl 252, id 40207, offset 0, flags [+, DF, rsvd], proto UDP (17), length 60951, bad cksum ff (->8336)!)
+    18.0.0.15.16896 > 107.95.83.32.68: BOOTP/DHCP, unknown (0x00), length 59384, htype 0, hlen 0, hops 13, xid 0x14000000, secs 3328 [|bootp]
diff --git a/tests/bootp_asan.pcap b/tests/bootp_asan.pcap
new file mode 100644
index 00000000..7c8a6ae1
Binary files /dev/null and b/tests/bootp_asan.pcap differ
