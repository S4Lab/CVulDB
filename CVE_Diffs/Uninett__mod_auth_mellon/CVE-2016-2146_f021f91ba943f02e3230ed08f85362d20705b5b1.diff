Uninett__mod_auth_mellon
commit f021f91ba943f02e3230ed08f85362d20705b5b1
Author:     Olav Morken <olav.morken@uninett.no>
AuthorDate: Mon Mar 7 09:29:02 2016 +0100
Commit:     Olav Morken <olav.morken@uninett.no>
CommitDate: Tue Mar 8 16:04:12 2016 +0100

    [CVE-2016-2146] Handle memory allocation failure when retrieving POST data.
    
    This is a backported version of commit 0d52e1d9.

diff --git a/auth_mellon_util.c b/auth_mellon_util.c
index d2922f3..65ccb3a 100644
--- a/auth_mellon_util.c
+++ b/auth_mellon_util.c
@@ -474,6 +474,12 @@ int am_read_post_data(request_rec *r, char **data, apr_size_t *length)
     }
 
     *data = (char *)apr_palloc(r->pool, len + 1);
+    if (*data == NULL) {
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+                      "Failed to allocate memory for %lu bytes of POST data.",
+                      (unsigned long)len);
+        return HTTP_INTERNAL_SERVER_ERROR;
+    }
 
     /* Make sure that the data is null-terminated.  */
     (*data)[len] = '\0';
