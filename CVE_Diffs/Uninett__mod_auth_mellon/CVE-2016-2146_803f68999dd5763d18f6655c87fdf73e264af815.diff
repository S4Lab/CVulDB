Uninett__mod_auth_mellon
commit 803f68999dd5763d18f6655c87fdf73e264af815
Author:     Olav Morken <olav.morken@uninett.no>
AuthorDate: Mon Mar 7 09:40:02 2016 +0100
Commit:     Olav Morken <olav.morken@uninett.no>
CommitDate: Tue Mar 8 16:04:28 2016 +0100

    [CVE-2016-2146] Limit POST data to 1 MiB.
    
    To avoid exhausting memory fetching POST data from clients,
    limit POST data to 1 MiB.
    
    This is a backported version of commit 20899037.

diff --git a/auth_mellon_util.c b/auth_mellon_util.c
index 65ccb3a..84ba5a9 100644
--- a/auth_mellon_util.c
+++ b/auth_mellon_util.c
@@ -469,6 +469,14 @@ int am_read_post_data(request_rec *r, char **data, apr_size_t *length)
         len = r->remaining;
     }
 
+    if (len >= 1024*1024) {
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+                      "Too large POST data payload (%lu bytes).",
+                      (unsigned long)len);
+        return HTTP_BAD_REQUEST;
+    }
+
+
     if (length != NULL) {
         *length = len;
     }
