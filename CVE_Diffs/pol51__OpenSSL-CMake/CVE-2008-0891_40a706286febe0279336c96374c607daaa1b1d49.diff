pol51__OpenSSL-CMake
commit 40a706286febe0279336c96374c607daaa1b1d49
Author:     Bodo Möller <bodo@openssl.org>
AuthorDate: Wed May 28 22:15:48 2008 +0000
Commit:     Bodo Möller <bodo@openssl.org>
CommitDate: Wed May 28 22:15:48 2008 +0000

    From HEAD:
    
    Fix double-free in TLS server name extensions which could lead to a remote
    crash found by Codenomicon TLS test suite (CVE-2008-0891)
    
    Reviewed by: openssl-security@openssl.org
    
    Obtained from: jorton@redhat.com

diff --git a/CHANGES b/CHANGES
index 63fa6aa97..5d6c7a8d0 100644
--- a/CHANGES
+++ b/CHANGES
@@ -690,6 +690,10 @@
 
  Changes between 0.9.8g and 0.9.8h  [xx XXX xxxx]
 
+  *) Fix double free in TLS server name extensions which could lead to
+     a remote crash found by Codenomicon TLS test suite (CVE-2008-0891) 
+     [Joe Orton]
+
   *) Clear error queue in SSL_CTX_use_certificate_chain_file()
 
      Clear the error queue to ensure that error entries left from
diff --git a/ssl/t1_lib.c b/ssl/t1_lib.c
index f3c5a16e4..bde52b126 100644
--- a/ssl/t1_lib.c
+++ b/ssl/t1_lib.c
@@ -637,6 +637,7 @@ int ssl_parse_clienthello_tlsext(SSL *s, unsigned char **p, unsigned char *d, in
 						s->session->tlsext_hostname[len]='\0';
 						if (strlen(s->session->tlsext_hostname) != len) {
 							OPENSSL_free(s->session->tlsext_hostname);
+							s->session->tlsext_hostname = NULL;
 							*al = TLS1_AD_UNRECOGNIZED_NAME;
 							return 0;
 						}
