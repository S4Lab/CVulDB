libvirt__libvirt
commit f38c8185f97720ecae7ef2291fbaa5d6b0209e17
Author:     Ján Tomko <jtomko@redhat.com>
AuthorDate: Tue Jul 2 15:17:09 2013 +0200
Commit:     Ján Tomko <jtomko@redhat.com>
CommitDate: Wed Jul 10 13:02:30 2013 +0200

    Fix crash when multiple event callbacks were registered
    
    CVE-2013-2230
    
    Don't overwrite the callback ID returned by
    virDomainEventStateRegisterID in ret by 0.
    
    Introduced by abf75aea.

diff --git a/src/qemu/qemu_driver.c b/src/qemu/qemu_driver.c
index 571d1f8c6b..b0180c9497 100644
--- a/src/qemu/qemu_driver.c
+++ b/src/qemu/qemu_driver.c
@@ -10043,9 +10043,7 @@ qemuConnectDomainEventRegisterAny(virConnectPtr conn,
                                       driver->domainEventState,
                                       dom, eventID,
                                       callback, opaque, freecb, &ret) < 0)
-        goto cleanup;
-
-    ret = 0;
+        ret = -1;
 
 cleanup:
     return ret;
