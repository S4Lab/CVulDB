libvirt__libvirt
commit ea014c9fcf19539c75a7cb6926b14858426746a7
Author:     Daniel P. Berrangé <berrange@redhat.com>
AuthorDate: Tue Apr 30 16:51:37 2019 +0100
Commit:     Daniel P. Berrangé <berrange@redhat.com>
CommitDate: Tue May 21 13:29:20 2019 +0100

    locking: restrict sockets to mode 0600
    
    The virtlockd daemon's only intended client is the libvirtd daemon. As
    such it should never allow clients from other user accounts to connect.
    The code already enforces this and drops clients from other UIDs, but
    we can get earlier (and thus stronger) protection against DoS by setting
    the socket permissions to 0600
    
    Fixes CVE-2019-10132
    
    Reviewed-by: Ján Tomko <jtomko@redhat.com>
    Signed-off-by: Daniel P. Berrangé <berrange@redhat.com>
    (cherry picked from commit f111e09468693909b1f067aa575efdafd9a262a1)

diff --git a/src/locking/virtlockd-admin.socket.in b/src/locking/virtlockd-admin.socket.in
index 2a7500f3d0..f674c492f7 100644
--- a/src/locking/virtlockd-admin.socket.in
+++ b/src/locking/virtlockd-admin.socket.in
@@ -5,6 +5,7 @@ Before=libvirtd.service
 [Socket]
 ListenStream=@localstatedir@/run/libvirt/virtlockd-admin-sock
 Service=virtlockd.service
+SocketMode=0600
 
 [Install]
 WantedBy=sockets.target
diff --git a/src/locking/virtlockd.socket.in b/src/locking/virtlockd.socket.in
index 45e0f20235..d701b27516 100644
--- a/src/locking/virtlockd.socket.in
+++ b/src/locking/virtlockd.socket.in
@@ -4,6 +4,7 @@ Before=libvirtd.service
 
 [Socket]
 ListenStream=@localstatedir@/run/libvirt/virtlockd-sock
+SocketMode=0600
 
 [Install]
 WantedBy=sockets.target
