libvirt__libvirt
commit 519a6adb135959709fefbe30b7f40de436dd2f16
Author:     Daniel P. Berrangé <berrange@redhat.com>
AuthorDate: Mon May 21 23:05:07 2018 +0100
Commit:     Daniel P. Berrangé <berrange@redhat.com>
CommitDate: Mon Jun 18 18:49:08 2018 +0100

    cpu: define the 'ssbd' CPUID feature bit (CVE-2018-3639)
    
    New microcode introduces the "Speculative Store Bypass Disable"
    CPUID feature bit. This needs to be exposed to guest OS to allow
    them to protect against CVE-2018-3639.
    
    Signed-off-by: Daniel P. Berrangé <berrange@redhat.com>
    Reviewed-by: Jiri Denemark <jdenemar@redhat.com>
    (cherry picked from commit 1dbca2eccad58d91a5fd33962854f1a653638182)

diff --git a/src/cpu/cpu_map.xml b/src/cpu/cpu_map.xml
index 00a43b172c..245aec3309 100644
--- a/src/cpu/cpu_map.xml
+++ b/src/cpu/cpu_map.xml
@@ -298,6 +298,9 @@
     <feature name='spec-ctrl'>
       <cpuid eax_in='0x07' ecx_in='0x00' edx='0x04000000'/>
     </feature>
+    <feature name='ssbd'>
+      <cpuid eax_in='0x07' ecx_in='0x00' edx='0x80000000'/>
+    </feature>
 
     <!-- Processor Extended State Enumeration sub leaf 1 -->
     <feature name='xsaveopt'>
