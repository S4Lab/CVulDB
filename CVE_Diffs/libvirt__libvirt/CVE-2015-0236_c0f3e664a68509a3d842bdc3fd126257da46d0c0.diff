libvirt__libvirt
commit c0f3e664a68509a3d842bdc3fd126257da46d0c0
Author:     Peter Krempa <pkrempa@redhat.com>
AuthorDate: Tue Jan 20 17:01:01 2015 +0100
Commit:     Eric Blake <eblake@redhat.com>
CommitDate: Thu Jan 22 09:39:17 2015 -0700

    CVE-2015-0236: qemu: Check ACLs when dumping security info from save image
    
    The ACL check didn't check the VIR_DOMAIN_XML_SECURE flag and the
    appropriate permission for it.
    
    (cherry picked from commit 03c3c0c874c84dfa51ef17556062b095c6e1c0a3)

diff --git a/src/qemu/qemu_driver.c b/src/qemu/qemu_driver.c
index 81efc7b4c8..a93ad85f5c 100644
--- a/src/qemu/qemu_driver.c
+++ b/src/qemu/qemu_driver.c
@@ -5689,7 +5689,7 @@ qemuDomainSaveImageGetXMLDesc(virConnectPtr conn, const char *path,
     if (fd < 0)
         goto cleanup;
 
-    if (virDomainSaveImageGetXMLDescEnsureACL(conn, def) < 0)
+    if (virDomainSaveImageGetXMLDescEnsureACL(conn, def, flags) < 0)
         goto cleanup;
 
     ret = qemuDomainDefFormatXML(driver, def, flags);
diff --git a/src/remote/remote_protocol.x b/src/remote/remote_protocol.x
index a5f92ae171..91d6711cce 100644
--- a/src/remote/remote_protocol.x
+++ b/src/remote/remote_protocol.x
@@ -4747,6 +4747,7 @@ enum remote_procedure {
      * @generate: both
      * @priority: high
      * @acl: domain:read
+     * @acl: domain:read_secure:VIR_DOMAIN_XML_SECURE
      */
     REMOTE_PROC_DOMAIN_SAVE_IMAGE_GET_XML_DESC = 235,
 
