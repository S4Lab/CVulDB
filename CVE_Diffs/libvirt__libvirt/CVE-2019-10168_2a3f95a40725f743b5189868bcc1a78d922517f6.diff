libvirt__libvirt
commit 2a3f95a40725f743b5189868bcc1a78d922517f6
Author:     Ján Tomko <jtomko@redhat.com>
AuthorDate: Fri Jun 14 09:17:39 2019 +0200
Commit:     Ján Tomko <jtomko@redhat.com>
CommitDate: Mon Jun 24 09:40:32 2019 +0200

    api: disallow virConnect*HypervisorCPU on read-only connections
    
    These APIs can be used to execute arbitrary emulators.
    Forbid them on read-only connections.
    
    Fixes: CVE-2019-10168
    Signed-off-by: Ján Tomko <jtomko@redhat.com>
    Reviewed-by: Daniel P. Berrangé <berrange@redhat.com>
    (cherry picked from commit bf6c2830b6c338b1f5699b095df36f374777b291)
    Signed-off-by: Ján Tomko <jtomko@redhat.com>

diff --git a/src/libvirt-host.c b/src/libvirt-host.c
index e20d6ee250..2978825d22 100644
--- a/src/libvirt-host.c
+++ b/src/libvirt-host.c
@@ -1041,6 +1041,7 @@ virConnectCompareHypervisorCPU(virConnectPtr conn,
 
     virCheckConnectReturn(conn, VIR_CPU_COMPARE_ERROR);
     virCheckNonNullArgGoto(xmlCPU, error);
+    virCheckReadOnlyGoto(conn->flags, error);
 
     if (conn->driver->connectCompareHypervisorCPU) {
         int ret;
@@ -1234,6 +1235,7 @@ virConnectBaselineHypervisorCPU(virConnectPtr conn,
 
     virCheckConnectReturn(conn, NULL);
     virCheckNonNullArgGoto(xmlCPUs, error);
+    virCheckReadOnlyGoto(conn->flags, error);
 
     if (conn->driver->connectBaselineHypervisorCPU) {
         char *cpu;
