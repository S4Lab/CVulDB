libvirt__libvirt
commit 030fdf57255f97289a407529194bf26c77548acb
Author:     Daniel P. Berrangé <berrange@redhat.com>
AuthorDate: Tue Apr 30 17:27:41 2019 +0100
Commit:     Daniel P. Berrangé <berrange@redhat.com>
CommitDate: Tue May 21 13:26:36 2019 +0100

    logging: restrict sockets to mode 0600
    
    The virtlogd daemon's only intended client is the libvirtd daemon. As
    such it should never allow clients from other user accounts to connect.
    The code already enforces this and drops clients from other UIDs, but
    we can get earlier (and thus stronger) protection against DoS by setting
    the socket permissions to 0600
    
    Fixes CVE-2019-10132
    
    Reviewed-by: Ján Tomko <jtomko@redhat.com>
    Signed-off-by: Daniel P. Berrangé <berrange@redhat.com>
    (cherry picked from commit e37bd65f9948c1185456b2cdaa3bd6e875af680f)

diff --git a/src/logging/virtlogd-admin.socket.in b/src/logging/virtlogd-admin.socket.in
index 595e6c4c4b..5c41dfeb7b 100644
--- a/src/logging/virtlogd-admin.socket.in
+++ b/src/logging/virtlogd-admin.socket.in
@@ -5,6 +5,7 @@ Before=libvirtd.service
 [Socket]
 ListenStream=@localstatedir@/run/libvirt/virtlogd-admin-sock
 Service=virtlogd.service
+SocketMode=0600
 
 [Install]
 WantedBy=sockets.target
diff --git a/src/logging/virtlogd.socket.in b/src/logging/virtlogd.socket.in
index 22b9360c8d..ae48cdab9a 100644
--- a/src/logging/virtlogd.socket.in
+++ b/src/logging/virtlogd.socket.in
@@ -4,6 +4,7 @@ Before=libvirtd.service
 
 [Socket]
 ListenStream=@localstatedir@/run/libvirt/virtlogd-sock
+SocketMode=0600
 
 [Install]
 WantedBy=sockets.target
