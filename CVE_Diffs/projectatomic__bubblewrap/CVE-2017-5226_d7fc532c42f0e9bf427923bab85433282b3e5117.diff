projectatomic__bubblewrap
commit d7fc532c42f0e9bf427923bab85433282b3e5117
Author:     Simon McVittie <smcv@debian.org>
AuthorDate: Mon Jan 9 17:46:07 2017 +0000
Commit:     Atomic Bot <atomic-devel@projectatomic.io>
CommitDate: Mon Jan 9 19:48:44 2017 +0000

    Call setsid() before executing sandboxed code (CVE-2017-5226)
    
    This prevents the sandboxed code from getting a controlling tty,
    which in turn prevents it from accessing the TIOCSTI ioctl and hence
    faking terminal input.
    
    Fixes: #142
    
    Closes: #143
    Approved by: cgwalters

diff --git a/bubblewrap.c b/bubblewrap.c
index 6e04459..4b5b8e6 100644
--- a/bubblewrap.c
+++ b/bubblewrap.c
@@ -2071,6 +2071,9 @@ main (int    argc,
   /* We want sigchild in the child */
   unblock_sigchild ();
 
+  if (setsid () == (pid_t) -1)
+    die_with_error ("setsid");
+
   if (label_exec (opt_exec_label) == -1)
     die_with_error ("label_exec %s", argv[0]);
 
