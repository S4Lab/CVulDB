multipath-tcp__mptcp
commit 3df2b5a5c56055da159f4d30514440d21917238f
Author:     Kees Cook <keescook@chromium.org>
AuthorDate: Fri Oct 19 18:45:53 2012 -0700
Commit:     Tim Gardner <tim.gardner@canonical.com>
CommitDate: Thu Nov 8 05:52:49 2012 -0700

    use clamp_t in UNAME26 fix
    
    CVE-2012-0957
    
    The min/max call needed to have explicit types on some architectures
    (e.g. mn10300). Use clamp_t instead to avoid the warning:
    
      kernel/sys.c: In function 'override_release':
      kernel/sys.c:1287:10: warning: comparison of distinct pointer types lacks a cast [enabled by default]
    
    Reported-by: Fengguang Wu <fengguang.wu@intel.com>
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    (cherry picked from commit 31fd84b95eb211d5db460a1dda85e004800a7b52)
    Acked-by: Herton Krzesinski <herton.krzesinski@canonical.com>
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

diff --git a/kernel/sys.c b/kernel/sys.c
index 1b66408edaa5..b6fe5598c7a1 100644
--- a/kernel/sys.c
+++ b/kernel/sys.c
@@ -1284,7 +1284,7 @@ static int override_release(char __user *release, size_t len)
 			rest++;
 		}
 		v = ((LINUX_VERSION_CODE >> 8) & 0xff) + 40;
-		copy = min(sizeof(buf), max_t(size_t, 1, len));
+		copy = clamp_t(size_t, len, 1, sizeof(buf));
 		copy = scnprintf(buf, copy, "2.6.%u%s", v, rest);
 		ret = copy_to_user(release, buf, copy + 1);
 	}
