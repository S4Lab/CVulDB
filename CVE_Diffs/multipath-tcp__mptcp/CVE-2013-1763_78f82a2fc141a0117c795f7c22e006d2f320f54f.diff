multipath-tcp__mptcp
commit 78f82a2fc141a0117c795f7c22e006d2f320f54f
Author:     Mathias Krause <minipli@googlemail.com>
AuthorDate: Mon Feb 25 08:30:26 2013 -0800
Commit:     Brad Figg <brad.figg@canonical.com>
CommitDate: Mon Feb 25 10:19:09 2013 -0800

    sock_diag: Fix out-of-bounds access to sock_diag_handlers[]
    
    Userland can send a netlink message requesting SOCK_DIAG_BY_FAMILY
    with a family greater or equal then AF_MAX -- the array size of
    sock_diag_handlers[]. The current code does not test for this
    condition therefore is vulnerable to an out-of-bound access opening
    doors for a privilege escalation.
    
    CVE-2013-1763
    
    BugLink: http://bugs.launchpad.net/bugs/1132896
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    
    Signed-off-by: Brad Figg <brad.figg@canonical.com>
    Signed-off-by: Steve Conklin <sconklin@canonical.com>
    Signed-off-by: John Johansen <john.johansen@canonical.com>

diff --git a/net/core/sock_diag.c b/net/core/sock_diag.c
index 5fd146720f39..964a92c4e202 100644
--- a/net/core/sock_diag.c
+++ b/net/core/sock_diag.c
@@ -126,6 +126,9 @@ static int __sock_diag_rcv_msg(struct sk_buff *skb, struct nlmsghdr *nlh)
 	if (nlmsg_len(nlh) < sizeof(*req))
 		return -EINVAL;
 
+	if (req->sdiag_family >= AF_MAX)
+		return -EINVAL;
+
 	hndl = sock_diag_lock_handler(req->sdiag_family);
 	if (hndl == NULL)
 		err = -ENOENT;
