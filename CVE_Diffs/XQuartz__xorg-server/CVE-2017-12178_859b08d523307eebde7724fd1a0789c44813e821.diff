XQuartz__xorg-server
commit 859b08d523307eebde7724fd1a0789c44813e821
Author:     Nathan Kidd <nkidd@opentext.com>
AuthorDate: Wed Dec 24 16:22:18 2014 -0500
Commit:     Julien Cristau <jcristau@debian.org>
CommitDate: Tue Oct 10 23:33:44 2017 +0200

    Xi: fix wrong extra length check in ProcXIChangeHierarchy (CVE-2017-12178)
    
    Reviewed-by: Alan Coopersmith <alan.coopersmith@oracle.com>
    Reviewed-by: Jeremy Huddleston Sequoia <jeremyhu@apple.com>
    Reviewed-by: Julien Cristau <jcristau@debian.org>
    Signed-off-by: Nathan Kidd <nkidd@opentext.com>
    Signed-off-by: Julien Cristau <jcristau@debian.org>

diff --git a/Xi/xichangehierarchy.c b/Xi/xichangehierarchy.c
index 87f191ffa..cbdd91258 100644
--- a/Xi/xichangehierarchy.c
+++ b/Xi/xichangehierarchy.c
@@ -423,7 +423,7 @@ ProcXIChangeHierarchy(ClientPtr client)
     if (!stuff->num_changes)
         return rc;
 
-    len = ((size_t)stuff->length << 2) - sizeof(xXIAnyHierarchyChangeInfo);
+    len = ((size_t)stuff->length << 2) - sizeof(xXIChangeHierarchyReq);
 
     any = (xXIAnyHierarchyChangeInfo *) &stuff[1];
     while (stuff->num_changes--) {
