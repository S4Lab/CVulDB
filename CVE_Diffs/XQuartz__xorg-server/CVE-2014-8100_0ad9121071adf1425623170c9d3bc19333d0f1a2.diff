XQuartz__xorg-server
commit 0ad9121071adf1425623170c9d3bc19333d0f1a2
Author:     Julien Cristau <jcristau@debian.org>
AuthorDate: Tue Oct 28 10:30:04 2014 +0100
Commit:     Julien Cristau <jcristau@debian.org>
CommitDate: Tue Dec 9 17:50:13 2014 +0100

    render: check request size before reading it [CVE-2014-8100 1/2]
    
    Otherwise we may be reading outside of the client request.
    
    Signed-off-by: Julien Cristau <jcristau@debian.org>
    Reviewed-by: Alan Coopersmith <alan.coopersmith@oracle.com>
    Signed-off-by: Alan Coopersmith <alan.coopersmith@oracle.com>
    (cherry picked from commit b5f9ef03df6a650571b29d3d1c1d2b67c6e84336)
    Signed-off-by: Julien Cristau <jcristau@debian.org>

diff --git a/render/render.c b/render/render.c
index 9ac4a98e7..95e50a22c 100644
--- a/render/render.c
+++ b/render/render.c
@@ -276,11 +276,11 @@ ProcRenderQueryVersion(ClientPtr client)
 
     REQUEST(xRenderQueryVersionReq);
 
+    REQUEST_SIZE_MATCH(xRenderQueryVersionReq);
+
     pRenderClient->major_version = stuff->majorVersion;
     pRenderClient->minor_version = stuff->minorVersion;
 
-    REQUEST_SIZE_MATCH(xRenderQueryVersionReq);
-
     if ((stuff->majorVersion * 1000 + stuff->minorVersion) <
         (SERVER_RENDER_MAJOR_VERSION * 1000 + SERVER_RENDER_MINOR_VERSION)) {
         rep.majorVersion = stuff->majorVersion;
