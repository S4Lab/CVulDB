XQuartz__xorg-server
commit 6a493ecad3391a8a00082c2e0b37d3f79b7fd1c3
Author:     Matthieu Herrb <matthieu@bluenote.herrb.com>
AuthorDate: Thu Jan 17 15:28:03 2008 +0100
Commit:     Jeremy Huddleston <jeremy@yuffie.local>
CommitDate: Thu Jan 17 09:50:48 2008 -0800

    Fix for CVE-2007-6428 - TOG-cup extension memory corruption.
    (cherry picked from commit 4848d49d05a318559afe7a17a19ba055947ee1f5)

diff --git a/Xext/cup.c b/Xext/cup.c
index 10d13bae0..631bc2450 100644
--- a/Xext/cup.c
+++ b/Xext/cup.c
@@ -196,6 +196,9 @@ int ProcGetReservedColormapEntries(
 
     REQUEST_SIZE_MATCH (xXcupGetReservedColormapEntriesReq);
 
+    if (stuff->screen >= screenInfo.numScreens)
+	return BadValue;
+
 #ifndef HAVE_SPECIAL_DESKTOP_COLORS
     citems[CUP_BLACK_PIXEL].pixel = 
 	screenInfo.screens[stuff->screen]->blackPixel;
