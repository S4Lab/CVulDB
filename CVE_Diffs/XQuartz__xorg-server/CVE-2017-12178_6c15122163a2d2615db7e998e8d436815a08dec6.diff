XQuartz__xorg-server
commit 6c15122163a2d2615db7e998e8d436815a08dec6
Author:     Nathan Kidd <nkidd@opentext.com>
AuthorDate: Wed Dec 24 16:22:18 2014 -0500
Commit:     Adam Jackson <ajax@redhat.com>
CommitDate: Thu Oct 12 12:25:31 2017 -0400

    Xi: fix wrong extra length check in ProcXIChangeHierarchy (CVE-2017-12178)
    
    Reviewed-by: Alan Coopersmith <alan.coopersmith@oracle.com>
    Reviewed-by: Jeremy Huddleston Sequoia <jeremyhu@apple.com>
    Reviewed-by: Julien Cristau <jcristau@debian.org>
    Signed-off-by: Nathan Kidd <nkidd@opentext.com>
    Signed-off-by: Julien Cristau <jcristau@debian.org>
    (cherry picked from commit 859b08d523307eebde7724fd1a0789c44813e821)

diff --git a/Xi/xichangehierarchy.c b/Xi/xichangehierarchy.c
index f2b7785ad..7286eff55 100644
--- a/Xi/xichangehierarchy.c
+++ b/Xi/xichangehierarchy.c
@@ -423,7 +423,7 @@ ProcXIChangeHierarchy(ClientPtr client)
     if (!stuff->num_changes)
         return rc;
 
-    len = ((size_t)stuff->length << 2) - sizeof(xXIAnyHierarchyChangeInfo);
+    len = ((size_t)stuff->length << 2) - sizeof(xXIChangeHierarchyReq);
 
     any = (xXIAnyHierarchyChangeInfo *) &stuff[1];
     while (stuff->num_changes--) {
