XQuartz__xorg-server
commit 73abb373e65d3617cdf39dcc8b8b47dd3d7d4c2d
Author:     Matthieu Herrb <matthieu@bluenote.herrb.com>
AuthorDate: Thu Jan 17 15:29:06 2008 +0100
Commit:     Jeremy Huddleston <jeremy@yuffie.local>
CommitDate: Thu Jan 17 11:17:44 2008 -0800

    Fix for CVE-2008-0006 - PCF Font parser buffer overflow.
    (cherry picked from commit f09b8007e7f6e60e0b9c9665ec632b578ae08b6f)

diff --git a/dix/dixfonts.c b/dix/dixfonts.c
index 02b6be6ef..ad540c68c 100644
--- a/dix/dixfonts.c
+++ b/dix/dixfonts.c
@@ -329,6 +329,13 @@ doOpenFont(ClientPtr client, OFclosurePtr c)
 	err = BadFontName;
 	goto bail;
     }
+    /* check values for firstCol, lastCol, firstRow, and lastRow */
+    if (pfont->info.firstCol > pfont->info.lastCol ||
+       pfont->info.firstRow > pfont->info.lastRow ||
+       pfont->info.lastCol - pfont->info.firstCol > 255) {
+       err = AllocError;
+       goto bail;
+    }
     if (!pfont->fpe)
 	pfont->fpe = fpe;
     pfont->refcnt++;
