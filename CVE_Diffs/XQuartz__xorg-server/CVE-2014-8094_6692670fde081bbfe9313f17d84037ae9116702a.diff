XQuartz__xorg-server
commit 6692670fde081bbfe9313f17d84037ae9116702a
Author:     Alan Coopersmith <alan.coopersmith@oracle.com>
AuthorDate: Wed Jan 22 23:40:18 2014 -0800
Commit:     Alan Coopersmith <alan.coopersmith@oracle.com>
CommitDate: Mon Dec 8 18:09:47 2014 -0800

    dri2: integer overflow in ProcDRI2GetBuffers() [CVE-2014-8094]
    
    ProcDRI2GetBuffers() tries to validate a length field (count).
    There is an integer overflow in the validation. This can cause
    out of bound reads and memory corruption later on.
    
    Reported-by: Ilja Van Sprundel <ivansprundel@ioactive.com>
    Signed-off-by: Alan Coopersmith <alan.coopersmith@oracle.com>
    Reviewed-by: Peter Hutterer <peter.hutterer@who-t.net>
    Reviewed-by: Julien Cristau <jcristau@debian.org>

diff --git a/hw/xfree86/dri2/dri2ext.c b/hw/xfree86/dri2/dri2ext.c
index ffd66fad6..221ec530b 100644
--- a/hw/xfree86/dri2/dri2ext.c
+++ b/hw/xfree86/dri2/dri2ext.c
@@ -270,6 +270,9 @@ ProcDRI2GetBuffers(ClientPtr client)
     unsigned int *attachments;
 
     REQUEST_FIXED_SIZE(xDRI2GetBuffersReq, stuff->count * 4);
+    if (stuff->count > (INT_MAX / 4))
+        return BadLength;
+
     if (!validDrawable(client, stuff->drawable, DixReadAccess | DixWriteAccess,
                        &pDrawable, &status))
         return status;
