gsliepen__tinc
commit e97943b7cc9c851ae36f5a41e2b6102faa74193f
Author:     Guus Sliepen <guus@tinc-vpn.org>
AuthorDate: Sun Sep 9 16:44:43 2018 +0200
Commit:     Guus Sliepen <guus@tinc-vpn.org>
CommitDate: Wed Sep 12 21:51:55 2018 +0200

    Prevent a MITM from forcing a NULL cipher for UDP (CVE-2018-16758)
    
    If a man-in-the-middle has intercepted the TCP connection it might be
    able to force plaintext UDP packets between two nodes for up to
    a PingInterval period.

diff --git a/src/protocol_key.c b/src/protocol_key.c
index ee292b65..6140a532 100644
--- a/src/protocol_key.c
+++ b/src/protocol_key.c
@@ -286,6 +286,11 @@ bool ans_key_h(connection_t *c) {
 			return true;
 		}
 	} else {
+		if(from->outkeylength != 1) {
+			logger(LOG_ERR, "Node %s (%s) uses wrong keylength!", from->name, from->hostname);
+			return true;
+		}
+
 		from->outcipher = NULL;
 	}
 
